import{c as _y,l as CC,m as IC,f as Wt,a as Ue,d as Yt,o as nn,j as qf,p as Aw,t as gu}from"../chunks/B975nKYy.js";import{o as kw,a as yb,w as Cp}from"../chunks/DIWkVe--.js";import{aP as AC,h as ti,A as Su,z as p0,o as P,ap as kC,ae as DC,H as zC,S as vb,Q as Zl,a2 as bf,e as qo,C as Dw,a7 as RC,P as xb,c as LC,b as yy,s as FC,a5 as m0,aK as BC,q as em,ah as OC,aU as NC,aV as VC,aW as jC,a as Wp,aX as Go,r as zw,p as Rw,aY as z_,a0 as Lw,a4 as UC,d as qC,_ as yu,aZ as Fw,w as GC,a_ as $C,t as Zt,y as Bw,a$ as ZC,a8 as WC,a1 as HC,b0 as XC,V as YC,b1 as KC,ai as JC,af as QC,v as pa,f as dn,b2 as Mu,ak as Vt,aG as hn,aI as le,ac as Ir,j as At,l as $t,k as Tt,i as pn,g as kt,a9 as Qn,b3 as xi,b4 as g0,b5 as bb,x as nf,aq as jm,aF as eI,b6 as wb,b7 as Ci,b8 as Us,R as R_}from"../chunks/DbVLL1rh.js";import{s as $r,c as tI,b as Tb}from"../chunks/DXsGKffy.js";import{p as tn,i as It,b as xa,r as vr,s as Gi,a as _0,c as Ra}from"../chunks/D5o_JJlW.js";import{s as Dn,c as nI,b as ri,d as ir,e as La,a as Ct,f as Zr,g as Cf}from"../chunks/CFB3dnCP.js";import{B as Ow}from"../chunks/nqcIIULR.js";function rI(){return Symbol(AC)}function vy(n,o,h){ti&&Su();var p=new Ow(n);p0(()=>{var b=o();p.ensure(b,h)})}function ya(n,o){return o}function iI(n,o,h){for(var p=[],b=o.length,T,v=o.length,l=0;l<b;l++){let B=o[l];Rw(B,()=>{if(T){if(T.pending.delete(B),T.done.add(B),T.pending.size===0){var V=n.outrogroups;xy(m0(T.done)),V.delete(T),V.size===0&&(n.outrogroups=null)}}else v-=1},!1)}if(v===0){var C=p.length===0&&h!==null;if(C){var D=h,z=D.parentNode;UC(z),z.append(D),n.items.clear()}xy(o,!C)}else T={pending:new Set(o),done:new Set},(n.outrogroups??=new Set).add(T)}function xy(n,o=!0){for(var h=0;h<n.length;h++)qC(n[h],o)}var Sb;function ii(n,o,h,p,b,T=null){var v=n,l=new Map,C=(o&Fw)!==0;if(C){var D=n;v=ti?Zl(yu(D)):D.appendChild(Wp())}ti&&Su();var z=null,B=kC(()=>{var se=h();return BC(se)?se:se==null?[]:m0(se)}),V,G=!0;function Q(){U.fallback=z,aI(U,V,v,o,p),z!==null&&(V.length===0?(z.f&Go)===0?zw(z):(z.f^=Go,hf(z,null,v)):Rw(z,()=>{z=null}))}var ee=p0(()=>{V=P(B);var se=V.length;let Me=!1;if(ti){var me=DC(v)===zC;me!==(se===0)&&(v=vb(),Zl(v),bf(!1),Me=!0)}for(var K=new Set,ce=LC,oe=FC(),ue=0;ue<se;ue+=1){ti&&qo.nodeType===Dw&&qo.data===RC&&(v=qo,Me=!0,bf(!1));var de=V[ue],be=p(de,ue),Re=G?null:l.get(be);Re?(Re.v&&xb(Re.v,de),Re.i&&xb(Re.i,ue),oe&&ce.skipped_effects.delete(Re.e)):(Re=oI(l,G?v:Sb??=Wp(),de,be,ue,b,o,h),G||(Re.e.f|=Go),l.set(be,Re)),K.add(be)}if(se===0&&T&&!z&&(G?z=yy(()=>T(v)):(z=yy(()=>T(Sb??=Wp())),z.f|=Go)),ti&&se>0&&Zl(vb()),!G)if(oe){for(const[Ve,qe]of l)K.has(Ve)||ce.skipped_effects.add(qe.e);ce.oncommit(Q),ce.ondiscard(()=>{})}else Q();Me&&bf(!0),P(B)}),U={effect:ee,items:l,outrogroups:null,fallback:z};G=!1,ti&&(v=qo)}function aI(n,o,h,p,b){var T=(p&$C)!==0,v=o.length,l=n.items,C=n.effect.first,D,z=null,B,V=[],G=[],Q,ee,U,se;if(T)for(se=0;se<v;se+=1)Q=o[se],ee=b(Q,se),U=l.get(ee).e,(U.f&Go)===0&&(U.nodes?.a?.measure(),(B??=new Set).add(U));for(se=0;se<v;se+=1){if(Q=o[se],ee=b(Q,se),U=l.get(ee).e,n.outrogroups!==null)for(const Re of n.outrogroups)Re.pending.delete(U),Re.done.delete(U);if((U.f&Go)!==0)if(U.f^=Go,U===C)hf(U,null,h);else{var Me=z?z.next:C;U===n.effect.last&&(n.effect.last=U.prev),U.prev&&(U.prev.next=U.next),U.next&&(U.next.prev=U.prev),Ds(n,z,U),Ds(n,U,Me),hf(U,Me,h),z=U,V=[],G=[],C=z.next;continue}if((U.f&z_)!==0&&(zw(U),T&&(U.nodes?.a?.unfix(),(B??=new Set).delete(U))),U!==C){if(D!==void 0&&D.has(U)){if(V.length<G.length){var me=G[0],K;z=me.prev;var ce=V[0],oe=V[V.length-1];for(K=0;K<V.length;K+=1)hf(V[K],me,h);for(K=0;K<G.length;K+=1)D.delete(G[K]);Ds(n,ce.prev,oe.next),Ds(n,z,ce),Ds(n,oe,me),C=me,z=oe,se-=1,V=[],G=[]}else D.delete(U),hf(U,C,h),Ds(n,U.prev,U.next),Ds(n,U,z===null?n.effect.first:z.next),Ds(n,z,U),z=U;continue}for(V=[],G=[];C!==null&&C!==U;)(D??=new Set).add(C),G.push(C),C=C.next;if(C===null)continue}(U.f&Go)===0&&V.push(U),z=U,C=U.next}if(n.outrogroups!==null){for(const Re of n.outrogroups)Re.pending.size===0&&(xy(m0(Re.done)),n.outrogroups?.delete(Re));n.outrogroups.size===0&&(n.outrogroups=null)}if(C!==null||D!==void 0){var ue=[];if(D!==void 0)for(U of D)(U.f&z_)===0&&ue.push(U);for(;C!==null;)(C.f&z_)===0&&C!==n.fallback&&ue.push(C),C=C.next;var de=ue.length;if(de>0){var be=(p&Fw)!==0&&v===0?h:null;if(T){for(se=0;se<de;se+=1)ue[se].nodes?.a?.measure();for(se=0;se<de;se+=1)ue[se].nodes?.a?.fix()}iI(n,ue,be)}}T&&GC(()=>{if(B!==void 0)for(U of B)U.nodes?.a?.apply()})}function oI(n,o,h,p,b,T,v,l){var C=(v&VC)!==0?(v&jC)===0?OC(h,!1,!1):em(h):null,D=(v&NC)!==0?em(b):null;return{v:C,i:D,e:yy(()=>(T(o,C??h,D??b,l),()=>{n.delete(p)}))}}function hf(n,o,h){if(n.nodes)for(var p=n.nodes.start,b=n.nodes.end,T=o&&(o.f&Go)===0?o.nodes.start:h;p!==null;){var v=Lw(p);if(T.before(p),p===b)return;p=v}}function Ds(n,o,h){o===null?n.effect.first=h:o.next=h,h===null?n.effect.last=o:h.prev=o}function sI(n,o,h=!1,p=!1,b=!1){var T=n,v="";Zt(()=>{var l=Bw;if(v===(v=o()??"")){ti&&Su();return}if(l.nodes!==null&&(ZC(l.nodes.start,l.nodes.end),l.nodes=null),v!==""){if(ti){qo.data;for(var C=Su(),D=C;C!==null&&(C.nodeType!==Dw||C.data!=="");)D=C,C=Lw(C);if(C===null)throw WC(),HC;_y(qo,D),T=Zl(C);return}var z=v+"";h?z=`<svg>${z}</svg>`:p&&(z=`<math>${z}</math>`);var B=CC(z);if((h||p)&&(B=yu(B)),_y(yu(B),B.lastChild),h||p)for(;yu(B);)T.before(yu(B));else T.before(B)}})}function Nw(n,o,h,p,b,T){let v=ti;ti&&Su();var l=null;ti&&qo.nodeType===XC&&(l=qo,Su());var C=ti?qo:n,D=new Ow(C,!1);p0(()=>{const z=o()||null;var B=KC;if(z===null){D.ensure(null,null);return}return D.ensure(z,V=>{if(z){if(l=ti?l:document.createElementNS(B,z),_y(l,l),p){ti&&IC(z)&&l.append(document.createComment(""));var G=ti?yu(l):l.appendChild(Wp());ti&&(G===null?bf(!1):Zl(G)),p(l,G)}Bw.nodes.end=l,V.before(l)}ti&&Zl(V)}),()=>{}},YC),JC(()=>{}),v&&(bf(!0),Zl(C))}class y0{#e=new WeakMap;#t;#n;static entries=new WeakMap;constructor(o){this.#n=o}observe(o,h){var p=this.#e.get(o)||new Set;return p.add(h),this.#e.set(o,p),this.#r().observe(o,this.#n),()=>{var b=this.#e.get(o);b.delete(h),b.size===0&&(this.#e.delete(o),this.#t.unobserve(o))}}#r(){return this.#t??(this.#t=new ResizeObserver(o=>{for(var h of o){y0.entries.set(h.target,h);for(var p of this.#e.get(h.target)||[])p(h)}}))}}var lI=new y0({box:"border-box"});function cI(n,o,h){var p=lI.observe(n,()=>h(n[o]));QC(()=>(pa(()=>h(n[o])),p))}function Vw(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Hp={exports:{}};var uI=Hp.exports,Mb;function hI(){return Mb||(Mb=1,(function(n,o){(function(h,p){n.exports=p()})(uI,(function(){var h={},p={};function b(v,l,C){if(p[v]=C,v==="index"){var D="var sharedModule = {}; ("+p.shared+")(sharedModule); ("+p.worker+")(sharedModule);",z={};return p.shared(z),p.index(h,z),typeof window<"u"&&h.setWorkerUrl(window.URL.createObjectURL(new Blob([D],{type:"text/javascript"}))),h}}b("shared",["exports"],(function(v){function l(i,e,r,s){return new(r||(r=Promise))((function(u,d){function m(M){try{w(s.next(M))}catch(I){d(I)}}function y(M){try{w(s.throw(M))}catch(I){d(I)}}function w(M){var I;M.done?u(M.value):(I=M.value,I instanceof r?I:new r((function(k){k(I)}))).then(m,y)}w((s=s.apply(i,e||[])).next())}))}function C(i,e){this.x=i,this.y=e}function D(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var z,B;typeof SuppressedError=="function"&&SuppressedError,C.prototype={clone(){return new C(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){const e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const e=Math.cos(i),r=Math.sin(i),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround(i,e){const r=Math.cos(i),s=Math.sin(i),u=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:C},C.convert=function(i){if(i instanceof C)return i;if(Array.isArray(i))return new C(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new C(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var V=(function(){if(B)return z;function i(e,r,s,u){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=s,this.p2y=u}return B=1,z=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,u=0;u<8;u++){var d=this.sampleCurveX(s)-e;if(Math.abs(d)<r)return s;var m=this.sampleCurveDerivativeX(s);if(Math.abs(m)<1e-6)break;s-=d/m}var y=0,w=1;for(s=e,u=0;u<20&&(d=this.sampleCurveX(s),!(Math.abs(d-e)<r));u++)e>d?y=s:w=s,s=.5*(w-y)+y;return s},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},z})(),G=D(V);let Q,ee;function U(){return Q==null&&(Q=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Q}function se(){if(ee==null&&(ee=!1,U())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let s=0;s<25;s++){const u=4*s;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(s%5,Math.floor(s/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let s=0;s<100;s++)if(s%4!=3&&r[s]!==s){ee=!0;break}}}return ee||!1}var Me=1e-6,me=typeof Float32Array<"u"?Float32Array:Array;function K(){var i=new me(9);return me!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function ce(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function oe(){var i=new me(3);return me!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function ue(i){var e=i[0],r=i[1],s=i[2];return Math.sqrt(e*e+r*r+s*s)}function de(i,e,r){var s=new me(3);return s[0]=i,s[1]=e,s[2]=r,s}function be(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i}function Re(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i}function Ve(i,e,r){var s=e[0],u=e[1],d=e[2],m=r[0],y=r[1],w=r[2];return i[0]=u*w-d*y,i[1]=d*m-s*w,i[2]=s*y-u*m,i}var qe,Ye=ue;function et(i,e,r){var s=e[0],u=e[1],d=e[2],m=e[3];return i[0]=r[0]*s+r[4]*u+r[8]*d+r[12]*m,i[1]=r[1]*s+r[5]*u+r[9]*d+r[13]*m,i[2]=r[2]*s+r[6]*u+r[10]*d+r[14]*m,i[3]=r[3]*s+r[7]*u+r[11]*d+r[15]*m,i}function Ie(){var i=new me(4);return me!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Je(i,e,r,s){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",d=Math.PI/360;e*=d,s*=d,r*=d;var m=Math.sin(e),y=Math.cos(e),w=Math.sin(r),M=Math.cos(r),I=Math.sin(s),k=Math.cos(s);switch(u){case"xyz":i[0]=m*M*k+y*w*I,i[1]=y*w*k-m*M*I,i[2]=y*M*I+m*w*k,i[3]=y*M*k-m*w*I;break;case"xzy":i[0]=m*M*k-y*w*I,i[1]=y*w*k-m*M*I,i[2]=y*M*I+m*w*k,i[3]=y*M*k+m*w*I;break;case"yxz":i[0]=m*M*k+y*w*I,i[1]=y*w*k-m*M*I,i[2]=y*M*I-m*w*k,i[3]=y*M*k+m*w*I;break;case"yzx":i[0]=m*M*k+y*w*I,i[1]=y*w*k+m*M*I,i[2]=y*M*I-m*w*k,i[3]=y*M*k-m*w*I;break;case"zxy":i[0]=m*M*k-y*w*I,i[1]=y*w*k+m*M*I,i[2]=y*M*I+m*w*k,i[3]=y*M*k-m*w*I;break;case"zyx":i[0]=m*M*k-y*w*I,i[1]=y*w*k+m*M*I,i[2]=y*M*I-m*w*k,i[3]=y*M*k+m*w*I;break;default:throw new Error("Unknown angle order "+u)}return i}function Qe(){var i=new me(2);return me!=Float32Array&&(i[0]=0,i[1]=0),i}function $e(i,e){var r=new me(2);return r[0]=i,r[1]=e,r}oe(),qe=new me(4),me!=Float32Array&&(qe[0]=0,qe[1]=0,qe[2]=0,qe[3]=0),oe(),de(1,0,0),de(0,1,0),Ie(),Ie(),K(),Qe();const at=8192;function zt(i,e,r){return e*(at/(i.tileSize*Math.pow(2,r-i.tileID.overscaledZ)))}function rt(i,e){return(i%e+e)%e}function ct(i,e,r){return i*(1-r)+e*r}function xt(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,r=e*i;return 4*(i<.5?r:3*(i-e)+r-.75)}function vt(i,e,r,s){const u=new G(i,e,r,s);return d=>u.solve(d)}const Pt=vt(.25,.1,.25,1);function pt(i,e,r){return Math.min(r,Math.max(e,i))}function Et(i,e,r){const s=r-e,u=((i-e)%s+s)%s+e;return u===e?r:u}function Kt(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}let ot=1;function _t(i,e,r){const s={};for(const u in i)s[u]=e.call(this,i[u],u,i);return s}function Rt(i,e,r){const s={};for(const u in i)e.call(this,i[u],u,i)&&(s[u]=i[u]);return s}function Ze(i){return Array.isArray(i)?i.map(Ze):typeof i=="object"&&i?_t(i,Ze):i}const Pn={};function Nt(i){Pn[i]||(typeof console<"u"&&console.warn(i),Pn[i]=!0)}function Jt(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Ut(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let qt=null;function cn(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Pr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Xr(i,e,r,s,u){return l(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const d=new VideoFrame(i,{timestamp:0});try{const m=d?.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const y=m.startsWith("BGR"),w=new Uint8ClampedArray(s*u*4);if(yield d.copyTo(w,(function(M,I,k,L,F){const j=4*Math.max(-I,0),q=(Math.max(0,k)-k)*L*4+j,Z=4*L,Y=Math.max(0,I),fe=Math.max(0,k);return{rect:{x:Y,y:fe,width:Math.min(M.width,I+L)-Y,height:Math.min(M.height,k+F)-fe},layout:[{offset:q,stride:Z}]}})(i,e,r,s,u)),y)for(let M=0;M<w.length;M+=4){const I=w[M];w[M]=w[M+2],w[M+2]=I}return w}finally{d.close()}}))}let oi,Ar;function ba(i,e,r,s){return i.addEventListener(e,r,s),{unsubscribe:()=>{i.removeEventListener(e,r,s)}}}function Oa(i){return i*Math.PI/180}function gr(i){return i/Math.PI*180}const ke={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},H={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},W="AbortError";class te extends Error{constructor(e=W){super(e instanceof Error?e.message:e),this.name=W,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function Se(i){return i.name===W}const Ee={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ze(i){return Ee.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const ve="global-dispatcher";class ye extends Error{constructor(e,r,s,u){super(`AJAXError: ${r} (${e}): ${s}`),this.status=e,this.statusText=r,this.url=s,this.body=u}}const Ae=()=>Ut(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Xe=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const s=ze(i.url);if(s)return s(i,e);if(Ut(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:ve},e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Ae())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(s,u){return l(this,void 0,void 0,(function*(){const d=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:Ae(),signal:u.signal});let m,y;s.type!=="json"||d.headers.has("Accept")||d.headers.set("Accept","application/json");try{m=yield fetch(d)}catch(M){throw Se(M)?M:new ye(0,M.message,s.url,new Blob)}if(!m.ok){const M=yield m.blob();throw new ye(m.status,m.statusText,s.url,M)}y=s.type==="arrayBuffer"||s.type==="image"?m.arrayBuffer():s.type==="json"?m.json():m.text();const w=yield y;return u.signal.throwIfAborted(),{data:w,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}}))})(i,e);if(Ut(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:ve},e)}var r;return(function(s,u){return new Promise(((d,m)=>{var y;const w=new XMLHttpRequest;w.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(w.responseType="arraybuffer");for(const M in s.headers)w.setRequestHeader(M,s.headers[M]);s.type==="json"&&(w.responseType="text",!((y=s.headers)===null||y===void 0)&&y.Accept||w.setRequestHeader("Accept","application/json")),w.withCredentials=s.credentials==="include",w.onerror=()=>{m(new Error(w.statusText))},w.onload=()=>{if(!u.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let M=w.response;if(s.type==="json")try{M=JSON.parse(w.response)}catch(I){return void m(I)}d({data:M,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{const M=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});m(new ye(w.status,w.statusText,s.url,M))}},u.signal.addEventListener("abort",(()=>{w.abort(),m(new te(u.signal.reason))})),w.send(s.body)}))})(i,e)};function We(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function ft(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function Mt(i,e,r){if(r&&r[i]){const s=r[i].indexOf(e);s!==-1&&r[i].splice(s,1)}}class jt{constructor(e,r={}){Kt(this,r),this.type=e}}class Cn extends jt{constructor(e,r={}){super("error",Kt({error:e},r))}}class yn{on(e,r){return this._listeners=this._listeners||{},ft(e,r,this._listeners),{unsubscribe:()=>{this.off(e,r)}}}off(e,r){return Mt(e,r,this._listeners),Mt(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},ft(e,r,this._oneTimeListeners),this):new Promise((s=>this.once(e,s)))}fire(e,r){typeof e=="string"&&(e=new jt(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const u=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of u)y.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of d)Mt(s,y,this._oneTimeListeners),y.call(this,e);const m=this._eventedParent;m&&(Kt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof Cn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const Ln=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Nr(i,e){const r={};for(const s in i)s!=="ref"&&(r[s]=i[s]);return Ln.forEach((s=>{s in e&&(r[s]=e[s])})),r}function Ht(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Ht(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!Ht(i[r],e[r]))return!1;return!0}return i===e}function An(i,e){i.push(e)}function Vr(i,e,r){An(r,{command:"addSource",args:[i,e[i]]})}function $n(i,e,r){An(e,{command:"removeSource",args:[i]}),r[i]=!0}function ar(i,e,r,s){$n(i,r,s),Vr(i,e,r)}function Fn(i,e,r){let s;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!Ht(i[r][s],e[r][s]))return!1;for(s in e[r])if(Object.prototype.hasOwnProperty.call(e[r],s)&&s!=="data"&&!Ht(i[r][s],e[r][s]))return!1;return!0}function xr(i,e,r,s,u,d){i=i||{},e=e||{};for(const m in i)Object.prototype.hasOwnProperty.call(i,m)&&(Ht(i[m],e[m])||r.push({command:d,args:[s,m,e[m],u]}));for(const m in e)Object.prototype.hasOwnProperty.call(e,m)&&!Object.prototype.hasOwnProperty.call(i,m)&&(Ht(i[m],e[m])||r.push({command:d,args:[s,m,e[m],u]}))}function Zs(i){return i.id}function Ws(i,e){return i[e.id]=e,i}class st{constructor(e,r,s,u){this.message=(e?`${e}: `:"")+s,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function si(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}class li extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class sc{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,u]of r)this.bindings[s]=u}concat(e){return new sc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const zi={kind:"null"},gt={kind:"number"},rn={kind:"string"},an={kind:"boolean"},bi={kind:"color"},lc={kind:"projectionDefinition"},wa={kind:"object"},Qt={kind:"value"},Hs={kind:"collator"},Xs={kind:"formatted"},cc={kind:"padding"},es={kind:"colorArray"},Ys={kind:"numberArray"},ts={kind:"resolvedImage"},Ks={kind:"variableAnchorOffsetCollection"};function ci(i,e){return{kind:"array",itemType:i,N:e}}function kn(i){if(i.kind==="array"){const e=kn(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const uc=[zi,gt,rn,an,bi,lc,Xs,wa,ci(Qt),cc,Ys,es,ts,Ks];function ns(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ns(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of uc)if(!ns(r,e))return null}}return`Expected ${kn(i)} but found ${kn(e)} instead.`}function Js(i,e){return e.some((r=>r.kind===i.kind))}function ho(i,e){return e.some((r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i))}function Wi(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const Qf=.96422,fo=.82521,hc=4/29,or=6/29,ed=3*or*or,td=or*or*or,Qs=Math.PI/180,nd=180/Math.PI;function rd(i){return(i%=360)<0&&(i+=360),i}function id([i,e,r,s]){let u,d;const m=ju((.2225045*(i=fc(i))+.7168786*(e=fc(e))+.0606169*(r=fc(r)))/1);i===e&&e===r?u=d=m:(u=ju((.4360747*i+.3850649*e+.1430804*r)/Qf),d=ju((.0139322*i+.0971045*e+.7141733*r)/fo));const y=116*m-16;return[y<0?0:y,500*(u-m),200*(m-d),s]}function fc(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ju(i){return i>td?Math.pow(i,1/3):i/ed+hc}function Uu([i,e,r,s]){let u=(i+16)/116,d=isNaN(e)?u:u+e/500,m=isNaN(r)?u:u-r/200;return u=1*Gu(u),d=Qf*Gu(d),m=fo*Gu(m),[qu(3.1338561*d-1.6168667*u-.4906146*m),qu(-.9787684*d+1.9161415*u+.033454*m),qu(.0719453*d-.2289914*u+1.4052427*m),s]}function qu(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Gu(i){return i>or?i*i*i:ed*(i-hc)}const cg=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function el(i,e){return cg(i,e)?i[e]:void 0}function dc(i){return parseInt(i.padEnd(2,i),16)/255}function ad(i,e){return rs(e?i/100:i,0,1)}function rs(i,e,r){return Math.min(Math.max(e,i),r)}function $u(i){return!i.some(Number.isNaN)}const tl={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Na(i,e,r){return i+r*(e-i)}function is(i,e,r){return i.map(((s,u)=>Na(s,e[u],r)))}class on{constructor(e,r,s,u=1,d=!0){this.r=e,this.g=r,this.b=s,this.a=u,d||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,r,s,u]))}static parse(e){if(e instanceof on)return e;if(typeof e!="string")return;const r=(function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=el(tl,s);if(u){const[m,y,w]=u;return[m/255,y/255,w/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const m=s.length<6?1:2;let y=1;return[dc(s.slice(y,y+=m)),dc(s.slice(y,y+=m)),dc(s.slice(y,y+=m)),dc(s.slice(y,y+m)||"ff")]}if(s.startsWith("rgb")){const m=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[y,w,M,I,k,L,F,j,q,Z,Y,fe]=m,J=[I||" ",F||" ",Z].join("");if(J==="  "||J==="  /"||J===",,"||J===",,,"){const ne=[M,L,q].join(""),ge=ne==="%%%"?100:ne===""?255:0;if(ge){const we=[rs(+w/ge,0,1),rs(+k/ge,0,1),rs(+j/ge,0,1),Y?ad(+Y,fe):1];if($u(we))return we}}return}}const d=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[m,y,w,M,I,k,L,F,j]=d,q=[w||" ",I||" ",L].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const Z=[+y,rs(+M,0,100),rs(+k,0,100),F?ad(+F,j):1];if($u(Z))return(function([Y,fe,J,ne]){function ge(we){const De=(we+Y/30)%12,Ke=fe*Math.min(J,1-J);return J-Ke*Math.max(-1,Math.min(De-3,9-De,1))}return Y=rd(Y),fe/=100,J/=100,[ge(0),ge(8),ge(4),ne]})(Z)}}})(e);return r?new on(...r,!1):void 0}get rgb(){const{r:e,g:r,b:s,a:u}=this,d=u||1/0;return this.overwriteGetter("rgb",[e/d,r/d,s/d,u])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[r,s,u,d]=id(e),m=Math.sqrt(s*s+u*u);return[Math.round(1e4*m)?rd(Math.atan2(u,s)*nd):NaN,m,r,d]})(this.rgb))}get lab(){return this.overwriteGetter("lab",id(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,s,u]=this.rgb;return`rgba(${[e,r,s].map((d=>Math.round(255*d))).join(",")},${u})`}static interpolate(e,r,s,u="rgb"){switch(u){case"rgb":{const[d,m,y,w]=is(e.rgb,r.rgb,s);return new on(d,m,y,w,!1)}case"hcl":{const[d,m,y,w]=e.hcl,[M,I,k,L]=r.hcl;let F,j;if(isNaN(d)||isNaN(M))isNaN(d)?isNaN(M)?F=NaN:(F=M,y!==1&&y!==0||(j=I)):(F=d,k!==1&&k!==0||(j=m));else{let J=M-d;M>d&&J>180?J-=360:M<d&&d-M>180&&(J+=360),F=d+s*J}const[q,Z,Y,fe]=(function([J,ne,ge,we]){return J=isNaN(J)?0:J*Qs,Uu([ge,Math.cos(J)*ne,Math.sin(J)*ne,we])})([F,j??Na(m,I,s),Na(y,k,s),Na(w,L,s)]);return new on(q,Z,Y,fe,!1)}case"lab":{const[d,m,y,w]=Uu(is(e.lab,r.lab,s));return new on(d,m,y,w,!1)}}}}on.black=new on(0,0,0,1),on.white=new on(1,1,1,1),on.transparent=new on(0,0,0,0),on.red=new on(1,0,0,1);class Zu{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const ug=["bottom","center","top"];class Wu{constructor(e,r,s,u,d,m){this.text=e,this.image=r,this.scale=s,this.fontStack=u,this.textColor=d,this.verticalAlign=m}}class mi{constructor(e){this.sections=e}static fromString(e){return new mi([new Wu(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof mi?e:mi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class Yr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Yr)return e;if(typeof e=="number")return new Yr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Yr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,s){return new Yr(is(e.values,r.values,s))}}class tr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof tr)return e;if(typeof e=="number")return new tr([e]);if(Array.isArray(e)){for(const r of e)if(typeof r!="number")return;return new tr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,s){return new tr(is(e.values,r.values,s))}}class Gt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Gt)return e;if(typeof e=="string"){const s=on.parse(e);return s?new Gt([s]):void 0}if(!Array.isArray(e))return;const r=[];for(const s of e){if(typeof s!="string")return;const u=on.parse(s);if(!u)return;r.push(u)}return new Gt(r)}toString(){return JSON.stringify(this.values)}static interpolate(e,r,s,u="rgb"){const d=[];if(e.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let m=0;m<e.values.length;m++)d.push(on.interpolate(e.values[m],r.values[m],s,u));return new Gt(d)}}class Bn extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Va=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ui{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ui)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const s=e[r],u=e[r+1];if(typeof s!="string"||!Va.has(s)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new ui(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,s){const u=e.values,d=r.values;if(u.length!==d.length)throw new Bn(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${r.toString()}`);const m=[];for(let y=0;y<u.length;y+=2){if(u[y]!==d[y])throw new Bn(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${u[y]}, to[${y}]: ${d[y]}`);m.push(u[y]);const[w,M]=u[y+1],[I,k]=d[y+1];m.push([Na(w,I,s),Na(M,k,s)])}return new ui(m)}}class wi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new wi({name:e,available:!1}):null}}class hi{constructor(e,r,s){this.from=e,this.to=r,this.transition=s}static interpolate(e,r,s){return new hi(e,r,s)}static parse(e){return e instanceof hi?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new hi(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new hi(e.from,e.to,e.transition):typeof e=="string"?new hi(e,e,1):void 0}}function as(i,e,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,r,s]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ja(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof hi||i instanceof on||i instanceof Zu||i instanceof mi||i instanceof Yr||i instanceof tr||i instanceof Gt||i instanceof ui||i instanceof wi)return!0;if(Array.isArray(i)){for(const e of i)if(!ja(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!ja(i[e]))return!1;return!0}return!1}function hr(i){if(i===null)return zi;if(typeof i=="string")return rn;if(typeof i=="boolean")return an;if(typeof i=="number")return gt;if(i instanceof on)return bi;if(i instanceof hi)return lc;if(i instanceof Zu)return Hs;if(i instanceof mi)return Xs;if(i instanceof Yr)return cc;if(i instanceof tr)return Ys;if(i instanceof Gt)return es;if(i instanceof ui)return Ks;if(i instanceof wi)return ts;if(Array.isArray(i)){const e=i.length;let r;for(const s of i){const u=hr(s);if(r){if(r===u)continue;r=Qt;break}r=u}return ci(r||Qt,e)}return wa}function po(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof on||i instanceof hi||i instanceof mi||i instanceof Yr||i instanceof tr||i instanceof Gt||i instanceof ui||i instanceof wi?i.toString():JSON.stringify(i)}class oa{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ja(e[1]))return r.error("invalid value");const s=e[1];let u=hr(s);const d=r.expectedType;return u.kind!=="array"||u.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(u=d),new oa(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const pc={string:rn,number:gt,boolean:an,object:wa};class gi{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,u=1;const d=e[0];if(d==="array"){let y,w;if(e.length>2){const M=e[1];if(typeof M!="string"||!(M in pc)||M==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=pc[M],u++}else y=Qt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);w=e[2],u++}s=ci(y,w)}else{if(!pc[d])throw new Error(`Types doesn't contain name = ${d}`);s=pc[d]}const m=[];for(;u<e.length;u++){const y=r.parse(e[u],u,Qt);if(!y)return null;m.push(y)}return new gi(s,m)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!ns(this.type,hr(s)))return s;if(r===this.args.length-1)throw new Bn(`Expected value to be of type ${kn(this.type)}, but found ${kn(hr(s))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const mo={"to-boolean":an,"to-color":bi,"to-number":gt,"to-string":rn};class Ta{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if(!mo[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const u=mo[s],d=[];for(let m=1;m<e.length;m++){const y=r.parse(e[m],m,Qt);if(!y)return null;d.push(y)}return new Ta(u,d)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,s;for(const u of this.args){if(r=u.evaluate(e),s=null,r instanceof on)return r;if(typeof r=="string"){const d=e.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:as(r[0],r[1],r[2],r[3]),!s))return new on(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Bn(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(e);const u=Yr.parse(r);if(u)return u}throw new Bn(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const s of this.args){r=s.evaluate(e);const u=tr.parse(r);if(u)return u}throw new Bn(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const s of this.args){r=s.evaluate(e);const u=Gt.parse(r);if(u)return u}throw new Bn(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(e);const u=ui.parse(r);if(u)return u}throw new Bn(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new Bn(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return mi.fromString(po(this.args[0].evaluate(e)));case"resolvedImage":return wi.fromString(po(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return po(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const od=["Unknown","Point","LineString","Polygon"];class Hu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?od[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache.get(e);return r||(r=on.parse(e),this._parseColorCache.set(e,r)),r}}class go{constructor(e,r,s=[],u,d=new sc,m=[]){this.registry=e,this.path=s,this.key=s.map((y=>`[${y}]`)).join(""),this.scope=d,this.errors=m,this.expectedType=u,this._isConstant=r}parse(e,r,s,u,d={}){return r?this.concat(r,s,u)._parse(e,d):this._parse(e,d)}_parse(e,r){function s(u,d,m){return m==="assert"?new gi(d,[u]):m==="coerce"?new Ta(d,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[u];if(d){let m=d.parse(e,this);if(!m)return null;if(this.expectedType){const y=this.expectedType,w=m.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||w.kind!=="value"){if(y.kind==="projectionDefinition"&&["string","array"].includes(w.kind)||["color","formatted","resolvedImage"].includes(y.kind)&&["value","string"].includes(w.kind)||["padding","numberArray"].includes(y.kind)&&["value","number","array"].includes(w.kind)||y.kind==="colorArray"&&["value","string","array"].includes(w.kind)||y.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(w.kind))m=s(m,y,r.typeAnnotation||"coerce");else if(this.checkSubtype(y,w))return null}else m=s(m,y,r.typeAnnotation||"assert")}if(!(m instanceof oa)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const y=new Hu;try{m=new oa(m.type,m.evaluate(y))}catch(w){return this.error(w.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const u=typeof e=="number"?this.path.concat(e):this.path,d=s?this.scope.concat(s):this.scope;return new go(this.registry,this._isConstant,u,r||null,d,this.errors)}error(e,...r){const s=`${this.key}${r.map((u=>`[${u}]`)).join("")}`;this.errors.push(new li(s,e))}checkSubtype(e,r){const s=ns(e,r);return s&&this.error(s),s}}class On{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let d=1;d<e.length-1;d+=2){const m=e[d];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,d);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=r.parse(e[d+1],d+1);if(!y)return null;s.push([m,y])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return u?new On(s,u):null}outputDefined(){return this.result.outputDefined()}}class os{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new os(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class vn{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,gt),u=r.parse(e[2],2,ci(r.expectedType||Qt));return s&&u?new vn(u.type.itemType,s,u):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new Bn(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new Bn(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new Bn(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class en{constructor(e,r){this.type=an,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Qt),u=r.parse(e[2],2,Qt);return s&&u?Js(s.type,[an,rn,gt,zi,Qt])?new en(s,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${kn(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!ho(r,["boolean","string","number","null"]))throw new Bn(`Expected first argument to be of type boolean, string, number or null, but found ${kn(hr(r))} instead.`);if(!ho(s,["string","array"]))throw new Bn(`Expected second argument to be of type array or string, but found ${kn(hr(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class ss{constructor(e,r,s){this.type=gt,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Qt),u=r.parse(e[2],2,Qt);if(!s||!u)return null;if(!Js(s.type,[an,rn,gt,zi,Qt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${kn(s.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,gt);return d?new ss(s,u,d):null}return new ss(s,u)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!ho(r,["boolean","string","number","null"]))throw new Bn(`Expected first argument to be of type boolean, string, number or null, but found ${kn(hr(r))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(e)),ho(s,["string"])){const d=s.indexOf(r,u);return d===-1?-1:[...s.slice(0,d)].length}if(ho(s,["array"]))return s.indexOf(r,u);throw new Bn(`Expected second argument to be of type array or string, but found ${kn(hr(s))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class wn{constructor(e,r,s,u,d,m){this.inputType=e,this.type=r,this.input=s,this.cases=u,this.outputs=d,this.otherwise=m}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const d={},m=[];for(let M=2;M<e.length-1;M+=2){let I=e[M];const k=e[M+1];Array.isArray(I)||(I=[I]);const L=r.concat(M);if(I.length===0)return L.error("Expected at least one branch label.");for(const j of I){if(typeof j!="number"&&typeof j!="string")return L.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return L.error("Numeric branch labels must be integer values.");if(s){if(L.checkSubtype(s,hr(j)))return null}else s=hr(j);if(d[String(j)]!==void 0)return L.error("Branch labels must be unique.");d[String(j)]=m.length}const F=r.parse(k,M,u);if(!F)return null;u=u||F.type,m.push(F)}const y=r.parse(e[1],1,Qt);if(!y)return null;const w=r.parse(e[e.length-1],e.length-1,u);return w?y.type.kind!=="value"&&r.concat(1).checkSubtype(s,y.type)?null:new wn(s,u,y,d,m,w):null}evaluate(e){const r=this.input.evaluate(e);return(hr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class nl{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const u=[];for(let m=1;m<e.length-1;m+=2){const y=r.parse(e[m],m,an);if(!y)return null;const w=r.parse(e[m+1],m+1,s);if(!w)return null;u.push([y,w]),s=s||w.type}const d=r.parse(e[e.length-1],e.length-1,s);if(!d)return null;if(!s)throw new Error("Can't infer output type");return new nl(s,u,d)}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every((([e,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}}class Ri{constructor(e,r,s,u){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Qt),u=r.parse(e[2],2,gt);if(!s||!u)return null;if(!Js(s.type,[ci(Qt),rn,Qt]))return r.error(`Expected first argument to be of type array or string, but found ${kn(s.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,gt);return d?new Ri(s.type,s,u,d):null}return new Ri(s.type,s,u)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);let u;if(this.endIndex&&(u=this.endIndex.evaluate(e)),ho(r,["string"]))return[...r].slice(s,u).join("");if(ho(r,["array"]))return r.slice(s,u);throw new Bn(`Expected first argument to be of type array or string, but found ${kn(hr(r))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function ls(i,e){const r=i.length-1;let s,u,d=0,m=r,y=0;for(;d<=m;)if(y=Math.floor((d+m)/2),s=i[y],u=i[y+1],s<=e){if(y===r||e<u)return y;d=y+1}else{if(!(s>e))throw new Bn("Input is not a number.");m=y-1}return 0}class Ua{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,d]of s)this.labels.push(u),this.outputs.push(d)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,gt);if(!s)return null;const u=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let m=1;m<e.length;m+=2){const y=m===1?-1/0:e[m],w=e[m+1],M=m,I=m+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(u.length&&u[u.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const k=r.parse(w,I,d);if(!k)return null;d=d||k.type,u.push([y,k])}return new Ua(d,s,u)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return s[0].evaluate(e);const d=r.length;return u>=r[d-1]?s[d-1].evaluate(e):s[ls(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function sd(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var rl,Xu,hg=(function(){if(Xu)return rl;function i(e,r,s,u){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=s,this.p2y=u}return Xu=1,rl=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,u=0;u<8;u++){var d=this.sampleCurveX(s)-e;if(Math.abs(d)<r)return s;var m=this.sampleCurveDerivativeX(s);if(Math.abs(m)<1e-6)break;s-=d/m}var y=0,w=1;for(s=e,u=0;u<20&&(d=this.sampleCurveX(s),!(Math.abs(d-e)<r));u++)e>d?y=s:w=s,s=.5*(w-y)+y;return s},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},rl})(),ld=sd(hg);class fi{constructor(e,r,s,u,d){this.type=e,this.operator=r,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[m,y]of d)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(e,r,s,u){let d=0;if(e.name==="exponential")d=sa(r,e.base,s,u);else if(e.name==="linear")d=sa(r,1,s,u);else if(e.name==="cubic-bezier"){const m=e.controlPoints;d=new ld(m[0],m[1],m[2],m[3]).solve(sa(r,1,s,u))}return d}static parse(e,r){let[s,u,d,...m]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const M=u[1];if(typeof M!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:M}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const M=u.slice(1);if(M.length!==4||M.some((I=>typeof I!="number"||I<0||I>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:M}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,gt),!d)return null;const y=[];let w=null;s!=="interpolate-hcl"&&s!=="interpolate-lab"||r.expectedType==es?r.expectedType&&r.expectedType.kind!=="value"&&(w=r.expectedType):w=bi;for(let M=0;M<m.length;M+=2){const I=m[M],k=m[M+1],L=M+3,F=M+4;if(typeof I!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(y.length&&y[y.length-1][0]>=I)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const j=r.parse(k,F,w);if(!j)return null;w=w||j.type,y.push([I,j])}return Wi(w,gt)||Wi(w,lc)||Wi(w,bi)||Wi(w,cc)||Wi(w,Ys)||Wi(w,es)||Wi(w,Ks)||Wi(w,ci(gt))?new fi(w,s,u,d,y):r.error(`Type ${kn(w)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return s[0].evaluate(e);const d=r.length;if(u>=r[d-1])return s[d-1].evaluate(e);const m=ls(r,u),y=fi.interpolationFactor(this.interpolation,u,r[m],r[m+1]),w=s[m].evaluate(e),M=s[m+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Na(w,M,y);case"color":return on.interpolate(w,M,y);case"padding":return Yr.interpolate(w,M,y);case"colorArray":return Gt.interpolate(w,M,y);case"numberArray":return tr.interpolate(w,M,y);case"variableAnchorOffsetCollection":return ui.interpolate(w,M,y);case"array":return is(w,M,y);case"projectionDefinition":return hi.interpolate(w,M,y)}case"interpolate-hcl":switch(this.type.kind){case"color":return on.interpolate(w,M,y,"hcl");case"colorArray":return Gt.interpolate(w,M,y,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return on.interpolate(w,M,y,"lab");case"colorArray":return Gt.interpolate(w,M,y,"lab")}}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function sa(i,e,r,s){const u=s-r,d=i-r;return u===0?0:e===1?d/u:(Math.pow(e,d)-1)/(Math.pow(e,u)-1)}const Hn={color:on.interpolate,number:Na,padding:Yr.interpolate,numberArray:tr.interpolate,colorArray:Gt.interpolate,variableAnchorOffsetCollection:ui.interpolate,array:is};class _o{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s=null;const u=r.expectedType;u&&u.kind!=="value"&&(s=u);const d=[];for(const y of e.slice(1)){const w=r.parse(y,1+d.length,s,void 0,{typeAnnotation:"omit"});if(!w)return null;s=s||w.type,d.push(w)}if(!s)throw new Error("No output type");const m=u&&d.some((y=>ns(u,y.type)));return new _o(m?Qt:s,d)}evaluate(e){let r,s=null,u=0;for(const d of this.args)if(u++,s=d.evaluate(e),s&&s instanceof wi&&!s.available&&(r||(r=s.name),s=null,u===this.args.length&&(s=r)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function Yu(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function il(i,e,r,s){return s.compare(e,r)===0}function sr(i,e,r){const s=i!=="=="&&i!=="!=";return class jw{constructor(d,m,y){this.type=an,this.lhs=d,this.rhs=m,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||m.type.kind==="value"}static parse(d,m){if(d.length!==3&&d.length!==4)return m.error("Expected two or three arguments.");const y=d[0];let w=m.parse(d[1],1,Qt);if(!w)return null;if(!Yu(y,w.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${kn(w.type)}'.`);let M=m.parse(d[2],2,Qt);if(!M)return null;if(!Yu(y,M.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${kn(M.type)}'.`);if(w.type.kind!==M.type.kind&&w.type.kind!=="value"&&M.type.kind!=="value")return m.error(`Cannot compare types '${kn(w.type)}' and '${kn(M.type)}'.`);s&&(w.type.kind==="value"&&M.type.kind!=="value"?w=new gi(M.type,[w]):w.type.kind!=="value"&&M.type.kind==="value"&&(M=new gi(w.type,[M])));let I=null;if(d.length===4){if(w.type.kind!=="string"&&M.type.kind!=="string"&&w.type.kind!=="value"&&M.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(I=m.parse(d[3],3,Hs),!I)return null}return new jw(w,M,I)}evaluate(d){const m=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(s&&this.hasUntypedArgument){const w=hr(m),M=hr(y);if(w.kind!==M.kind||w.kind!=="string"&&w.kind!=="number")throw new Bn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${w.kind}, ${M.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const w=hr(m),M=hr(y);if(w.kind!=="string"||M.kind!=="string")return e(d,m,y)}return this.collator?r(d,m,y,this.collator.evaluate(d)):e(d,m,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}const cd=sr("==",(function(i,e,r){return e===r}),il),Ku=sr("!=",(function(i,e,r){return e!==r}),(function(i,e,r,s){return!il(0,e,r,s)})),ud=sr("<",(function(i,e,r){return e<r}),(function(i,e,r,s){return s.compare(e,r)<0})),fg=sr(">",(function(i,e,r){return e>r}),(function(i,e,r,s){return s.compare(e,r)>0})),cs=sr("<=",(function(i,e,r){return e<=r}),(function(i,e,r,s){return s.compare(e,r)<=0})),mc=sr(">=",(function(i,e,r){return e>=r}),(function(i,e,r,s){return s.compare(e,r)>=0}));class us{constructor(e,r,s){this.type=Hs,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const u=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,an);if(!u)return null;const d=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,an);if(!d)return null;let m=null;return s.locale&&(m=r.parse(s.locale,1,rn),!m)?null:new us(u,d,m)}evaluate(e){return new Zu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Ju{constructor(e,r,s,u,d){this.type=rn,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=u,this.maxFractionDigits=d}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,gt);if(!s)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let d=null;if(u.locale&&(d=r.parse(u.locale,1,rn),!d))return null;let m=null;if(u.currency&&(m=r.parse(u.currency,1,rn),!m))return null;let y=null;if(u["min-fraction-digits"]&&(y=r.parse(u["min-fraction-digits"],1,gt),!y))return null;let w=null;return u["max-fraction-digits"]&&(w=r.parse(u["max-fraction-digits"],1,gt),!w)?null:new Ju(s,d,m,y,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class al{constructor(e){this.type=Xs,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const u=[];let d=!1;for(let m=1;m<=e.length-1;++m){const y=e[m];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let w=null;if(y["font-scale"]&&(w=r.parse(y["font-scale"],1,gt),!w))return null;let M=null;if(y["text-font"]&&(M=r.parse(y["text-font"],1,ci(rn)),!M))return null;let I=null;if(y["text-color"]&&(I=r.parse(y["text-color"],1,bi),!I))return null;let k=null;if(y["vertical-align"]){if(typeof y["vertical-align"]=="string"&&!ug.includes(y["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${y["vertical-align"]}' instead.`);if(k=r.parse(y["vertical-align"],1,rn),!k)return null}const L=u[u.length-1];L.scale=w,L.font=M,L.textColor=I,L.verticalAlign=k}else{const w=r.parse(e[m],1,Qt);if(!w)return null;const M=w.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,u.push({content:w,scale:null,font:null,textColor:null,verticalAlign:null})}}return new al(u)}evaluate(e){return new mi(this.sections.map((r=>{const s=r.content.evaluate(e);return hr(s)===ts?new Wu("",s,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(e):null):new Wu(po(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null,r.verticalAlign?r.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor),r.verticalAlign&&e(r.verticalAlign)}outputDefined(){return!1}}class hs{constructor(e){this.type=ts,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,rn);return s?new hs(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=wi.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class fs{constructor(e){this.type=gt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${kn(s.type)} instead.`):new fs(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Bn(`Expected value to be of type string or array, but found ${kn(hr(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const br=8192;function hd(i,e){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*br),Math.round(s*u*br)]}function ds(i,e){const r=Math.pow(2,e.z);return[(u=(i[0]/br+e.x)/r,360*u-180),(s=(i[1]/br+e.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90)];var s,u}function ol(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function yo(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function dg(i,e,r){const s=i[0]-e[0],u=i[1]-e[1],d=i[0]-r[0],m=i[1]-r[1];return s*m-d*u==0&&s*d<=0&&u*m<=0}function gc(i,e,r,s){return(u=[s[0]-r[0],s[1]-r[1]])[0]*(d=[e[0]-i[0],e[1]-i[1]])[1]-u[1]*d[0]!=0&&!(!Qu(i,e,r,s)||!Qu(r,s,i,e));var u,d}function pg(i,e,r){for(const s of r)for(let u=0;u<s.length-1;++u)if(gc(i,e,s[u],s[u+1]))return!0;return!1}function ps(i,e,r=!1){let s=!1;for(const y of e)for(let w=0;w<y.length-1;w++){if(dg(i,y[w],y[w+1]))return r;(d=y[w])[1]>(u=i)[1]!=(m=y[w+1])[1]>u[1]&&u[0]<(m[0]-d[0])*(u[1]-d[1])/(m[1]-d[1])+d[0]&&(s=!s)}var u,d,m;return s}function _c(i,e){for(const r of e)if(ps(i,r))return!0;return!1}function fd(i,e){for(const r of i)if(!ps(r,e))return!1;for(let r=0;r<i.length-1;++r)if(pg(i[r],i[r+1],e))return!1;return!0}function dd(i,e){for(const r of e)if(fd(i,r))return!0;return!1}function Qu(i,e,r,s){const u=s[0]-r[0],d=s[1]-r[1],m=(i[0]-r[0])*d-u*(i[1]-r[1]),y=(e[0]-r[0])*d-u*(e[1]-r[1]);return m>0&&y<0||m<0&&y>0}function eh(i,e,r){const s=[];for(let u=0;u<i.length;u++){const d=[];for(let m=0;m<i[u].length;m++){const y=hd(i[u][m],r);ol(e,y),d.push(y)}s.push(d)}return s}function th(i,e,r){const s=[];for(let u=0;u<i.length;u++){const d=eh(i[u],e,r);s.push(d)}return s}function pd(i,e,r,s){if(i[0]<r[0]||i[0]>r[2]){const u=.5*s;let d=i[0]-r[0]>u?-s:r[0]-i[0]>u?s:0;d===0&&(d=i[0]-r[2]>u?-s:r[2]-i[0]>u?s:0),i[0]+=d}ol(e,i)}function md(i,e,r,s){const u=Math.pow(2,s.z)*br,d=[s.x*br,s.y*br],m=[];for(const y of i)for(const w of y){const M=[w.x+d[0],w.y+d[1]];pd(M,e,r,u),m.push(M)}return m}function gd(i,e,r,s){const u=Math.pow(2,s.z)*br,d=[s.x*br,s.y*br],m=[];for(const w of i){const M=[];for(const I of w){const k=[I.x+d[0],I.y+d[1]];ol(e,k),M.push(k)}m.push(M)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const w of m)for(const M of w)pd(M,e,r,u)}var y;return m}class vo{constructor(e,r){this.type=an,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ja(e[1])){const s=e[1];if(s.type==="FeatureCollection"){const u=[];for(const d of s.features){const{type:m,coordinates:y}=d.geometry;m==="Polygon"&&u.push(y),m==="MultiPolygon"&&u.push(...y)}if(u.length)return new vo(s,{type:"MultiPolygon",coordinates:u})}else if(s.type==="Feature"){const u=s.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new vo(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new vo(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(r,s){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(s.type==="Polygon"){const y=eh(s.coordinates,d,m),w=md(r.geometry(),u,d,m);if(!yo(u,d))return!1;for(const M of w)if(!ps(M,y))return!1}if(s.type==="MultiPolygon"){const y=th(s.coordinates,d,m),w=md(r.geometry(),u,d,m);if(!yo(u,d))return!1;for(const M of w)if(!_c(M,y))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(r,s){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(s.type==="Polygon"){const y=eh(s.coordinates,d,m),w=gd(r.geometry(),u,d,m);if(!yo(u,d))return!1;for(const M of w)if(!fd(M,y))return!1}if(s.type==="MultiPolygon"){const y=th(s.coordinates,d,m),w=gd(r.geometry(),u,d,m);if(!yo(u,d))return!1;for(const M of w)if(!dd(M,y))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let _d=class{constructor(i=[],e=(r,s)=>r<s?-1:r>s?1:0){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:r}=this,s=e[i];for(;i>0;){const u=i-1>>1,d=e[u];if(r(s,d)>=0)break;e[i]=d,i=u}e[i]=s}_down(i){const{data:e,compare:r}=this,s=this.length>>1,u=e[i];for(;i<s;){let d=1+(i<<1);const m=d+1;if(m<this.length&&r(e[m],e[d])<0&&(d=m),r(e[d],u)>=0)break;e[i]=e[d],i=d}e[i]=u}};function nh(i,e,r=0,s=i.length-1,u=yd){for(;s>r;){if(s-r>600){const w=s-r+1,M=e-r+1,I=Math.log(w),k=.5*Math.exp(2*I/3),L=.5*Math.sqrt(I*k*(w-k)/w)*(M-w/2<0?-1:1);nh(i,e,Math.max(r,Math.floor(e-M*k/w+L)),Math.min(s,Math.floor(e+(w-M)*k/w+L)),u)}const d=i[e];let m=r,y=s;for(ms(i,r,e),u(i[s],d)>0&&ms(i,r,s);m<y;){for(ms(i,m,y),m++,y--;u(i[m],d)<0;)m++;for(;u(i[y],d)>0;)y--}u(i[r],d)===0?ms(i,r,y):(y++,ms(i,y,s)),y<=e&&(r=y+1),e<=y&&(s=y-1)}}function ms(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}function yd(i,e){return i<e?-1:i>e?1:0}function yc(i,e){if(i.length<=1)return[i];const r=[];let s,u;for(const d of i){const m=gg(d);m!==0&&(d.area=Math.abs(m),u===void 0&&(u=m<0),u===m<0?(s&&r.push(s),s=[d]):s.push(d))}if(s&&r.push(s),e>1)for(let d=0;d<r.length;d++)r[d].length<=e||(nh(r[d],e,1,r[d].length-1,mg),r[d]=r[d].slice(0,e));return r}function mg(i,e){return e.area-i.area}function gg(i){let e=0;for(let r,s,u=0,d=i.length,m=d-1;u<d;m=u++)r=i[u],s=i[m],e+=(s.x-r.x)*(r.y+s.y);return e}const vd=1/298.257223563,sl=vd*(2-vd),xd=Math.PI/180;class rh{constructor(e){const r=6378.137*xd*1e3,s=Math.cos(e*xd),u=1/(1-sl*(1-s*s)),d=Math.sqrt(u);this.kx=r*d*s,this.ky=r*d*u*(1-sl)}distance(e,r){const s=this.wrap(e[0]-r[0])*this.kx,u=(e[1]-r[1])*this.ky;return Math.sqrt(s*s+u*u)}pointOnLine(e,r){let s,u,d,m,y=1/0;for(let w=0;w<e.length-1;w++){let M=e[w][0],I=e[w][1],k=this.wrap(e[w+1][0]-M)*this.kx,L=(e[w+1][1]-I)*this.ky,F=0;k===0&&L===0||(F=(this.wrap(r[0]-M)*this.kx*k+(r[1]-I)*this.ky*L)/(k*k+L*L),F>1?(M=e[w+1][0],I=e[w+1][1]):F>0&&(M+=k/this.kx*F,I+=L/this.ky*F)),k=this.wrap(r[0]-M)*this.kx,L=(r[1]-I)*this.ky;const j=k*k+L*L;j<y&&(y=j,s=M,u=I,d=w,m=F)}return{point:[s,u],index:d,t:Math.max(0,Math.min(1,m))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function bd(i,e){return e[0]-i[0]}function vc(i){return i[1]-i[0]+1}function Hi(i,e){return i[1]>=i[0]&&i[1]<e}function xc(i,e){if(i[0]>i[1])return[null,null];const r=vc(i);if(e){if(r===2)return[i,null];const u=Math.floor(r/2);return[[i[0],i[0]+u],[i[0]+u,i[1]]]}if(r===1)return[i,null];const s=Math.floor(r/2)-1;return[[i[0],i[0]+s],[i[0]+s+1,i[1]]]}function ih(i,e){if(!Hi(e,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let s=e[0];s<=e[1];++s)ol(r,i[s]);return r}function ah(i){const e=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const s of r)ol(e,s);return e}function oh(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function bc(i,e,r){if(!oh(i)||!oh(e))return NaN;let s=0,u=0;return i[2]<e[0]&&(s=e[0]-i[2]),i[0]>e[2]&&(s=i[0]-e[2]),i[1]>e[3]&&(u=i[1]-e[3]),i[3]<e[1]&&(u=e[1]-i[3]),r.distance([0,0],[s,u])}function xo(i,e,r){const s=r.pointOnLine(e,i);return r.distance(i,s.point)}function sh(i,e,r,s,u){const d=Math.min(xo(i,[r,s],u),xo(e,[r,s],u)),m=Math.min(xo(r,[i,e],u),xo(s,[i,e],u));return Math.min(d,m)}function _g(i,e,r,s,u){if(!Hi(e,i.length)||!Hi(s,r.length))return 1/0;let d=1/0;for(let m=e[0];m<e[1];++m){const y=i[m],w=i[m+1];for(let M=s[0];M<s[1];++M){const I=r[M],k=r[M+1];if(gc(y,w,I,k))return 0;d=Math.min(d,sh(y,w,I,k,u))}}return d}function wd(i,e,r,s,u){if(!Hi(e,i.length)||!Hi(s,r.length))return NaN;let d=1/0;for(let m=e[0];m<=e[1];++m)for(let y=s[0];y<=s[1];++y)if(d=Math.min(d,u.distance(i[m],r[y])),d===0)return d;return d}function yg(i,e,r){if(ps(i,e,!0))return 0;let s=1/0;for(const u of e){const d=u[0],m=u[u.length-1];if(d!==m&&(s=Math.min(s,xo(i,[m,d],r)),s===0))return s;const y=r.pointOnLine(u,i);if(s=Math.min(s,r.distance(i,y.point)),s===0)return s}return s}function vg(i,e,r,s){if(!Hi(e,i.length))return NaN;for(let d=e[0];d<=e[1];++d)if(ps(i[d],r,!0))return 0;let u=1/0;for(let d=e[0];d<e[1];++d){const m=i[d],y=i[d+1];for(const w of r)for(let M=0,I=w.length,k=I-1;M<I;k=M++){const L=w[k],F=w[M];if(gc(m,y,L,F))return 0;u=Math.min(u,sh(m,y,L,F,s))}}return u}function Td(i,e){for(const r of i)for(const s of r)if(ps(s,e,!0))return!0;return!1}function xg(i,e,r,s=1/0){const u=ah(i),d=ah(e);if(s!==1/0&&bc(u,d,r)>=s)return s;if(yo(u,d)){if(Td(i,e))return 0}else if(Td(e,i))return 0;let m=1/0;for(const y of i)for(let w=0,M=y.length,I=M-1;w<M;I=w++){const k=y[I],L=y[w];for(const F of e)for(let j=0,q=F.length,Z=q-1;j<q;Z=j++){const Y=F[Z],fe=F[j];if(gc(k,L,Y,fe))return 0;m=Math.min(m,sh(k,L,Y,fe,r))}}return m}function Mn(i,e,r,s,u,d){if(!d)return;const m=bc(ih(s,d),u,r);m<e&&i.push([m,d,[0,0]])}function wc(i,e,r,s,u,d,m){if(!d||!m)return;const y=bc(ih(s,d),ih(u,m),r);y<e&&i.push([y,d,m])}function Tc(i,e,r,s,u=1/0){let d=Math.min(s.distance(i[0],r[0][0]),u);if(d===0)return d;const m=new _d([[0,[0,i.length-1],[0,0]]],bd),y=ah(r);for(;m.length>0;){const w=m.pop();if(w[0]>=d)continue;const M=w[1],I=e?50:100;if(vc(M)<=I){if(!Hi(M,i.length))return NaN;if(e){const k=vg(i,M,r,s);if(isNaN(k)||k===0)return k;d=Math.min(d,k)}else for(let k=M[0];k<=M[1];++k){const L=yg(i[k],r,s);if(d=Math.min(d,L),d===0)return 0}}else{const k=xc(M,e);Mn(m,d,s,i,y,k[0]),Mn(m,d,s,i,y,k[1])}}return d}function Sc(i,e,r,s,u,d=1/0){let m=Math.min(d,u.distance(i[0],r[0]));if(m===0)return m;const y=new _d([[0,[0,i.length-1],[0,r.length-1]]],bd);for(;y.length>0;){const w=y.pop();if(w[0]>=m)continue;const M=w[1],I=w[2],k=e?50:100,L=s?50:100;if(vc(M)<=k&&vc(I)<=L){if(!Hi(M,i.length)&&Hi(I,r.length))return NaN;let F;if(e&&s)F=_g(i,M,r,I,u),m=Math.min(m,F);else if(e&&!s){const j=i.slice(M[0],M[1]+1);for(let q=I[0];q<=I[1];++q)if(F=xo(r[q],j,u),m=Math.min(m,F),m===0)return m}else if(!e&&s){const j=r.slice(I[0],I[1]+1);for(let q=M[0];q<=M[1];++q)if(F=xo(i[q],j,u),m=Math.min(m,F),m===0)return m}else F=wd(i,M,r,I,u),m=Math.min(m,F)}else{const F=xc(M,e),j=xc(I,s);wc(y,m,u,i,r,F[0],j[0]),wc(y,m,u,i,r,F[0],j[1]),wc(y,m,u,i,r,F[1],j[0]),wc(y,m,u,i,r,F[1],j[1])}}return m}function lh(i){return i.type==="MultiPolygon"?i.coordinates.map((e=>({type:"Polygon",coordinates:e}))):i.type==="MultiLineString"?i.coordinates.map((e=>({type:"LineString",coordinates:e}))):i.type==="MultiPoint"?i.coordinates.map((e=>({type:"Point",coordinates:e}))):[i]}class bo{constructor(e,r){this.type=gt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ja(e[1])){const s=e[1];if(s.type==="FeatureCollection")return new bo(s,s.features.map((u=>lh(u.geometry))).flat());if(s.type==="Feature")return new bo(s,lh(s.geometry));if("type"in s&&"coordinates"in s)return new bo(s,lh(s))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(r,s){const u=r.geometry(),d=u.flat().map((w=>ds([w.x,w.y],r.canonical)));if(u.length===0)return NaN;const m=new rh(d[0][1]);let y=1/0;for(const w of s){switch(w.type){case"Point":y=Math.min(y,Sc(d,!1,[w.coordinates],!1,m,y));break;case"LineString":y=Math.min(y,Sc(d,!1,w.coordinates,!0,m,y));break;case"Polygon":y=Math.min(y,Tc(d,!1,w.coordinates,m,y))}if(y===0)return y}return y})(e,this.geometries);if(e.geometryType()==="LineString")return(function(r,s){const u=r.geometry(),d=u.flat().map((w=>ds([w.x,w.y],r.canonical)));if(u.length===0)return NaN;const m=new rh(d[0][1]);let y=1/0;for(const w of s){switch(w.type){case"Point":y=Math.min(y,Sc(d,!0,[w.coordinates],!1,m,y));break;case"LineString":y=Math.min(y,Sc(d,!0,w.coordinates,!0,m,y));break;case"Polygon":y=Math.min(y,Tc(d,!0,w.coordinates,m,y))}if(y===0)return y}return y})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(r,s){const u=r.geometry();if(u.length===0||u[0].length===0)return NaN;const d=yc(u,0).map((w=>w.map((M=>M.map((I=>ds([I.x,I.y],r.canonical))))))),m=new rh(d[0][0][0][1]);let y=1/0;for(const w of s)for(const M of d){switch(w.type){case"Point":y=Math.min(y,Tc([w.coordinates],!1,M,m,y));break;case"LineString":y=Math.min(y,Tc(w.coordinates,!0,M,m,y));break;case"Polygon":y=Math.min(y,xg(M,w.coordinates,m,y))}if(y===0)return y}return y})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class ll{constructor(e){this.type=Qt,this.key=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=e[1];return s==null?r.error("Global state property must be defined."):typeof s!="string"?r.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new ll(s)}evaluate(e){var r;const s=(r=e.globals)===null||r===void 0?void 0:r.globalState;return s&&Object.keys(s).length!==0?el(s,this.key):null}eachChild(){}outputDefined(){return!1}}const gs={"==":cd,"!=":Ku,">":fg,"<":ud,">=":mc,"<=":cs,array:gi,at:vn,boolean:gi,case:nl,coalesce:_o,collator:us,format:al,image:hs,in:en,"index-of":ss,interpolate:fi,"interpolate-hcl":fi,"interpolate-lab":fi,length:fs,let:On,literal:oa,match:wn,number:gi,"number-format":Ju,object:gi,slice:Ri,step:Ua,string:gi,"to-boolean":Ta,"to-color":Ta,"to-number":Ta,"to-string":Ta,var:os,within:vo,distance:bo,"global-state":ll};class Li{constructor(e,r,s,u){this.name=e,this.type=r,this._evaluate=s,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const s=e[0],u=Li.definitions[s];if(!u)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=m.filter((([M])=>!Array.isArray(M)||M.length===e.length-1));let w=null;for(const[M,I]of y){w=new go(r.registry,Mc,r.path,null,r.scope);const k=[];let L=!1;for(let F=1;F<e.length;F++){const j=e[F],q=Array.isArray(M)?M[F-1]:M.type,Z=w.parse(j,1+k.length,q);if(!Z){L=!0;break}k.push(Z)}if(!L)if(Array.isArray(M)&&M.length!==k.length)w.error(`Expected ${M.length} arguments, but found ${k.length} instead.`);else{for(let F=0;F<k.length;F++){const j=Array.isArray(M)?M[F]:M.type,q=k[F];w.concat(F+1).checkSubtype(j,q.type)}if(w.errors.length===0)return new Li(s,d,I,k)}}if(y.length===1)r.errors.push(...w.errors);else{const M=(y.length?y:m).map((([k])=>{return L=k,Array.isArray(L)?`(${L.map(kn).join(", ")})`:`(${kn(L.type)}...)`;var L})).join(" | "),I=[];for(let k=1;k<e.length;k++){const L=r.parse(e[k],1+I.length);if(!L)return null;I.push(kn(L.type))}r.error(`Expected arguments of type ${M}, but found (${I.join(", ")}) instead.`)}return null}static register(e,r){Li.definitions=r;for(const s in r)e[s]=Li}}function Sd(i,[e,r,s,u]){e=e.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const d=u?u.evaluate(i):1,m=as(e,r,s,d);if(m)throw new Bn(m);return new on(e/255,r/255,s/255,d,!1)}function Md(i,e){return i in e}function ch(i,e){const r=e[i];return r===void 0?null:r}function wo(i){return{type:i}}function Mc(i){if(i instanceof os)return Mc(i.boundExpression);if(i instanceof Li&&i.name==="error"||i instanceof us||i instanceof vo||i instanceof bo||i instanceof ll)return!1;const e=i instanceof Ta||i instanceof gi;let r=!0;return i.eachChild((s=>{r=e?r&&Mc(s):r&&s instanceof oa})),!!r&&Pc(i)&&Ec(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Pc(i){if(i instanceof Li&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof vo||i instanceof bo)return!1;let e=!0;return i.eachChild((r=>{e&&!Pc(r)&&(e=!1)})),e}function cl(i){if(i instanceof Li&&i.name==="feature-state")return!1;let e=!0;return i.eachChild((r=>{e&&!cl(r)&&(e=!1)})),e}function Ec(i,e){if(i instanceof Li&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild((s=>{r&&!Ec(s,e)&&(r=!1)})),r}function Pd(i){return{result:"success",value:i}}function _s(i){return{result:"error",value:i}}function ys(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Ed(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function uh(i){return!!i.expression&&i.expression.interpolated}function sn(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Cc(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&hr(i)===wa}function bg(i){return i}function Cd(i,e){const r=i.stops&&typeof i.stops[0][0]=="object",s=r||!(r||i.property!==void 0),u=i.type||(uh(e)?"exponential":"interval"),d=(function(I){switch(I.type){case"color":return on.parse;case"padding":return Yr.parse;case"numberArray":return tr.parse;case"colorArray":return Gt.parse;default:return null}})(e);if(d&&((i=si({},i)).stops&&(i.stops=i.stops.map((I=>[I[0],d(I[1])]))),i.default=d(i.default?i.default:e.default)),i.colorSpace&&(m=i.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var m;const y=(function(I){switch(I){case"exponential":return Id;case"interval":return Tg;case"categorical":return wg;case"identity":return Sg;default:throw new Error(`Unknown function type "${I}"`)}})(u);let w,M;if(u==="categorical"){w=Object.create(null);for(const I of i.stops)w[I[0]]=I[1];M=typeof i.stops[0][0]}if(r){const I={},k=[];for(let j=0;j<i.stops.length;j++){const q=i.stops[j],Z=q[0].zoom;I[Z]===void 0&&(I[Z]={zoom:Z,type:i.type,property:i.property,default:i.default,stops:[]},k.push(Z)),I[Z].stops.push([q[0].value,q[1]])}const L=[];for(const j of k)L.push([I[j].zoom,Cd(I[j],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:fi.interpolationFactor.bind(void 0,F),zoomStops:L.map((j=>j[0])),evaluate:({zoom:j},q)=>Id({stops:L,base:i.base},e,j).evaluate(j,q)}}if(s){const I=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:fi.interpolationFactor.bind(void 0,I),zoomStops:i.stops.map((k=>k[0])),evaluate:({zoom:k})=>y(i,e,k,w,M)}}return{kind:"source",evaluate(I,k){const L=k&&k.properties?k.properties[i.property]:void 0;return L===void 0?ul(i.default,e.default):y(i,e,L,w,M)}}}function ul(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function wg(i,e,r,s,u){return ul(typeof r===u?s[r]:void 0,i.default,e.default)}function Tg(i,e,r){if(sn(r)!=="number")return ul(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const u=ls(i.stops.map((d=>d[0])),r);return i.stops[u][1]}function Id(i,e,r){const s=i.base!==void 0?i.base:1;if(sn(r)!=="number")return ul(i.default,e.default);const u=i.stops.length;if(u===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[u-1][0])return i.stops[u-1][1];const d=ls(i.stops.map((I=>I[0])),r),m=(function(I,k,L,F){const j=F-L,q=I-L;return j===0?0:k===1?q/j:(Math.pow(k,q)-1)/(Math.pow(k,j)-1)})(r,s,i.stops[d][0],i.stops[d+1][0]),y=i.stops[d][1],w=i.stops[d+1][1],M=Hn[e.type]||bg;return typeof y.evaluate=="function"?{evaluate(...I){const k=y.evaluate.apply(void 0,I),L=w.evaluate.apply(void 0,I);if(k!==void 0&&L!==void 0)return M(k,L,m,i.colorSpace)}}:M(y,w,m,i.colorSpace)}function Sg(i,e,r){switch(e.type){case"color":r=on.parse(r);break;case"formatted":r=mi.fromString(r.toString());break;case"resolvedImage":r=wi.fromString(r.toString());break;case"padding":r=Yr.parse(r);break;case"colorArray":r=Gt.parse(r);break;case"numberArray":r=tr.parse(r);break;default:sn(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return ul(r,i.default,e.default)}Li.register(gs,{error:[{kind:"error"},[rn],(i,[e])=>{throw new Bn(e.evaluate(i))}],typeof:[rn,[Qt],(i,[e])=>kn(hr(e.evaluate(i)))],"to-rgba":[ci(gt,4),[bi],(i,[e])=>{const[r,s,u,d]=e.evaluate(i).rgb;return[255*r,255*s,255*u,d]}],rgb:[bi,[gt,gt,gt],Sd],rgba:[bi,[gt,gt,gt,gt],Sd],has:{type:an,overloads:[[[rn],(i,[e])=>Md(e.evaluate(i),i.properties())],[[rn,wa],(i,[e,r])=>Md(e.evaluate(i),r.evaluate(i))]]},get:{type:Qt,overloads:[[[rn],(i,[e])=>ch(e.evaluate(i),i.properties())],[[rn,wa],(i,[e,r])=>ch(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Qt,[rn],(i,[e])=>ch(e.evaluate(i),i.featureState||{})],properties:[wa,[],i=>i.properties()],"geometry-type":[rn,[],i=>i.geometryType()],id:[Qt,[],i=>i.id()],zoom:[gt,[],i=>i.globals.zoom],"heatmap-density":[gt,[],i=>i.globals.heatmapDensity||0],elevation:[gt,[],i=>i.globals.elevation||0],"line-progress":[gt,[],i=>i.globals.lineProgress||0],accumulated:[Qt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[gt,wo(gt),(i,e)=>{let r=0;for(const s of e)r+=s.evaluate(i);return r}],"*":[gt,wo(gt),(i,e)=>{let r=1;for(const s of e)r*=s.evaluate(i);return r}],"-":{type:gt,overloads:[[[gt,gt],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[gt],(i,[e])=>-e.evaluate(i)]]},"/":[gt,[gt,gt],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[gt,[gt,gt],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[gt,[],()=>Math.LN2],pi:[gt,[],()=>Math.PI],e:[gt,[],()=>Math.E],"^":[gt,[gt,gt],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[gt,[gt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[gt,[gt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[gt,[gt],(i,[e])=>Math.log(e.evaluate(i))],log2:[gt,[gt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[gt,[gt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[gt,[gt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[gt,[gt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[gt,[gt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[gt,[gt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[gt,[gt],(i,[e])=>Math.atan(e.evaluate(i))],min:[gt,wo(gt),(i,e)=>Math.min(...e.map((r=>r.evaluate(i))))],max:[gt,wo(gt),(i,e)=>Math.max(...e.map((r=>r.evaluate(i))))],abs:[gt,[gt],(i,[e])=>Math.abs(e.evaluate(i))],round:[gt,[gt],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[gt,[gt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[gt,[gt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[an,[rn,Qt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[an,[Qt],(i,[e])=>i.id()===e.value],"filter-type-==":[an,[rn],(i,[e])=>i.geometryType()===e.value],"filter-<":[an,[rn,Qt],(i,[e,r])=>{const s=i.properties()[e.value],u=r.value;return typeof s==typeof u&&s<u}],"filter-id-<":[an,[Qt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[an,[rn,Qt],(i,[e,r])=>{const s=i.properties()[e.value],u=r.value;return typeof s==typeof u&&s>u}],"filter-id->":[an,[Qt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[an,[rn,Qt],(i,[e,r])=>{const s=i.properties()[e.value],u=r.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[an,[Qt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[an,[rn,Qt],(i,[e,r])=>{const s=i.properties()[e.value],u=r.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[an,[Qt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[an,[Qt],(i,[e])=>e.value in i.properties()],"filter-has-id":[an,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[an,[ci(rn)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[an,[ci(Qt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[an,[rn,ci(Qt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[an,[rn,ci(Qt)],(i,[e,r])=>(function(s,u,d,m){for(;d<=m;){const y=d+m>>1;if(u[y]===s)return!0;u[y]>s?m=y-1:d=y+1}return!1})(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:an,overloads:[[[an,an],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[wo(an),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:an,overloads:[[[an,an],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[wo(an),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[an,[an],(i,[e])=>!e.evaluate(i)],"is-supported-script":[an,[rn],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[rn,[rn],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[rn,[rn],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[rn,wo(Qt),(i,e)=>e.map((r=>po(r.evaluate(i)))).join("")],"resolved-locale":[rn,[Hs],(i,[e])=>e.evaluate(i).resolvedLocale()]});class hh{constructor(e,r,s){this.expression=e,this._warningHistory={},this._evaluator=new Hu,this._defaultValue=r?(function(u){if(u.type==="color"&&Cc(u.default))return new on(0,0,0,0);switch(u.type){case"color":return on.parse(u.default)||null;case"padding":return Yr.parse(u.default)||null;case"numberArray":return tr.parse(u.default)||null;case"colorArray":return Gt.parse(u.default)||null;case"variableAnchorOffsetCollection":return ui.parse(u.default)||null;case"projectionDefinition":return hi.parse(u.default)||null;default:return u.default===void 0?null:u.default}})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this._globalState=s}evaluateWithoutErrorHandling(e,r,s,u,d,m){return this._globalState&&(e=To(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=u,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,u,d,m){this._globalState&&(e=To(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Bn(`Expected value to be one of ${Object.keys(this._enumValues).map((w=>JSON.stringify(w))).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function vs(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in gs}function hl(i,e,r){const s=new go(gs,Mc,[],e?(function(d){const m={color:bi,string:rn,number:gt,enum:rn,boolean:an,formatted:Xs,padding:cc,numberArray:Ys,colorArray:es,projectionDefinition:lc,resolvedImage:ts,variableAnchorOffsetCollection:Ks};return d.type==="array"?ci(m[d.value]||Qt,d.length):m[d.type]})(e):void 0),u=s.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Pd(new hh(u,e,r)):_s(s.errors)}class Ic{constructor(e,r,s){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!cl(r.expression),this.globalStateRefs=qa(r.expression),this._globalState=s}evaluateWithoutErrorHandling(e,r,s,u,d,m){return this._globalState&&(e=To(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,r,s,u,d,m)}evaluate(e,r,s,u,d,m){return this._globalState&&(e=To(e,this._globalState)),this._styleExpression.evaluate(e,r,s,u,d,m)}}class fh{constructor(e,r,s,u,d){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!cl(r.expression),this.globalStateRefs=qa(r.expression),this.interpolationType=u,this._globalState=d}evaluateWithoutErrorHandling(e,r,s,u,d,m){return this._globalState&&(e=To(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,r,s,u,d,m)}evaluate(e,r,s,u,d,m){return this._globalState&&(e=To(e,this._globalState)),this._styleExpression.evaluate(e,r,s,u,d,m)}interpolationFactor(e,r,s){return this.interpolationType?fi.interpolationFactor(this.interpolationType,e,r,s):0}}function dh(i,e,r){const s=hl(i,e,r);if(s.result==="error")return s;const u=s.value.expression,d=Pc(u);if(!d&&!ys(e))return _s([new li("","data expressions not supported")]);const m=Ec(u,["zoom"]);if(!m&&!Ed(e))return _s([new li("","zoom expressions not supported")]);const y=kc(u);return y||m?y instanceof li?_s([y]):y instanceof fi&&!uh(e)?_s([new li("",'"interpolate" expressions cannot be used with this property')]):Pd(y?new fh(d?"camera":"composite",s.value,y.labels,y instanceof fi?y.interpolation:void 0,r):new Ic(d?"constant":"source",s.value,r)):_s([new li("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ac{constructor(e,r){this._parameters=e,this._specification=r,si(this,Cd(this._parameters,this._specification))}static deserialize(e){return new Ac(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function kc(i){let e=null;if(i instanceof On)e=kc(i.result);else if(i instanceof _o){for(const r of i.args)if(e=kc(r),e)break}else(i instanceof Ua||i instanceof fi)&&i.input instanceof Li&&i.input.name==="zoom"&&(e=i);return e instanceof li||i.eachChild((r=>{const s=kc(r);s instanceof li?e=s:!e&&s?e=new li("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new li("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function qa(i,e=new Set){return i instanceof ll&&e.add(i.key),i.eachChild((r=>{qa(r,e)})),e}function To(i,e){const{zoom:r,heatmapDensity:s,elevation:u,lineProgress:d,isSupportedScript:m,accumulated:y}=i??{};return{zoom:r,heatmapDensity:s,elevation:u,lineProgress:d,isSupportedScript:m,accumulated:y,globalState:e}}function ph(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ph(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Mg={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function fl(i,e){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ph(i)||(i=dl(i));const r=hl(i,Mg,e);if(r.result==="error")throw new Error(r.value.map((s=>`${s.key}: ${s.message}`)).join(", "));return{filter:(s,u,d)=>r.value.evaluate(s,u,{},d),needGeometry:Ad(i),getGlobalStateRefs:()=>qa(r.value.expression)}}function Pg(i,e){return i<e?-1:i>e?1:0}function Ad(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(Ad(i[e]))return!0;return!1}function dl(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Dc(i[1],i[2],"=="):e==="!="?pl(Dc(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Dc(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(dl))):e==="all"?["all"].concat(i.slice(1).map(dl)):e==="none"?["all"].concat(i.slice(1).map(dl).map(pl)):e==="in"?kd(i[1],i.slice(2)):e==="!in"?pl(kd(i[1],i.slice(2))):e==="has"?Dd(i[1]):e!=="!has"||pl(Dd(i[1]));var r}function Dc(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function kd(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((r=>typeof r!=typeof e[0]))?["filter-in-large",i,["literal",e.sort(Pg)]]:["filter-in-small",i,["literal",e]]}}function Dd(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function pl(i){return["!",i]}function zc(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let u="[";for(const d of i)u+=`${zc(d)},`;return`${u}]`}const r=Object.keys(i).sort();let s="{";for(let u=0;u<r.length;u++)s+=`${JSON.stringify(r[u])}:${zc(i[r[u]])},`;return`${s}}`}function zd(i){let e="";for(const r of Ln)e+=`/${zc(i[r])}`;return e}function Rd(i){const e=i.value;return e?[new st(i.key,e,"constants have been deprecated as of v8")]:[]}function fr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function So(i){if(Array.isArray(i))return i.map(So);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=So(i[r]);return e}return fr(i)}function Ti(i){const e=i.key,r=i.value,s=i.valueSpec||{},u=i.objectElementValidators||{},d=i.style,m=i.styleSpec,y=i.validateSpec;let w=[];const M=sn(r);if(M!=="object")return[new st(e,r,`object expected, ${M} found`)];for(const I in r){const k=I.split(".")[0],L=el(s,k)||s["*"];let F;if(el(u,k))F=u[k];else if(el(s,k)){if(r[I]===void 0)continue;F=y}else if(u["*"])F=u["*"];else{if(!s["*"]){w.push(new st(e,r[I],`unknown property "${I}"`));continue}F=y}w=w.concat(F({key:(e&&`${e}.`)+I,value:r[I],valueSpec:L,style:d,styleSpec:m,object:r,objectKey:I,validateSpec:y},r))}for(const I in s)u[I]||s[I].required&&s[I].default===void 0&&r[I]===void 0&&w.push(new st(e,r,`missing required property "${I}"`));return w}function Rc(i){const e=i.value,r=i.valueSpec,s=i.style,u=i.styleSpec,d=i.key,m=i.arrayElementValidator||i.validateSpec;if(sn(e)!=="array")return[new st(d,e,`array expected, ${sn(e)} found`)];if(r.length&&e.length!==r.length)return[new st(d,e,`array length ${r.length} expected, length ${e.length} found`)];let y={type:r.value,values:r.values};u.$version<7&&(y.function=r.function),sn(r.value)==="object"&&(y=r.value);let w=[];for(let M=0;M<e.length;M++)w=w.concat(m({array:e,arrayIndex:M,value:e[M],valueSpec:y,validateSpec:i.validateSpec,style:s,styleSpec:u,key:`${d}[${M}]`}));return w}function ml(i){const e=i.key,r=i.value,s=i.valueSpec;let u=sn(r);return u==="number"&&r!=r&&(u="NaN"),u!=="number"?[new st(e,r,`number expected, ${u} found`)]:"minimum"in s&&r<s.minimum?[new st(e,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new st(e,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function Lc(i){const e=i.valueSpec,r=fr(i.value.type);let s,u,d,m={};const y=r!=="categorical"&&i.value.property===void 0,w=!y,M=sn(i.value.stops)==="array"&&sn(i.value.stops[0])==="array"&&sn(i.value.stops[0][0])==="object",I=Ti({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(r==="identity")return[new st(F.key,F.value,'identity function may not have a "stops" property')];let j=[];const q=F.value;return j=j.concat(Rc({key:F.key,value:q,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:k})),sn(q)==="array"&&q.length===0&&j.push(new st(F.key,q,"array must have at least one stop")),j},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return r==="identity"&&y&&I.push(new st(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||I.push(new st(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!uh(i.valueSpec)&&I.push(new st(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(w&&!ys(i.valueSpec)?I.push(new st(i.key,i.value,"property functions not supported")):y&&!Ed(i.valueSpec)&&I.push(new st(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!M||i.value.property!==void 0||I.push(new st(i.key,i.value,'"property" property is required')),I;function k(F){let j=[];const q=F.value,Z=F.key;if(sn(q)!=="array")return[new st(Z,q,`array expected, ${sn(q)} found`)];if(q.length!==2)return[new st(Z,q,`array length 2 expected, length ${q.length} found`)];if(M){if(sn(q[0])!=="object")return[new st(Z,q,`object expected, ${sn(q[0])} found`)];if(q[0].zoom===void 0)return[new st(Z,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new st(Z,q,"object stop key must have value")];if(d&&d>fr(q[0].zoom))return[new st(Z,q[0].zoom,"stop zoom values must appear in ascending order")];fr(q[0].zoom)!==d&&(d=fr(q[0].zoom),u=void 0,m={}),j=j.concat(Ti({key:`${Z}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:ml,value:L}}))}else j=j.concat(L({key:`${Z}[0]`,value:q[0],validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},q));return vs(So(q[1]))?j.concat([new st(`${Z}[1]`,q[1],"expressions are not allowed in function stops.")]):j.concat(F.validateSpec({key:`${Z}[1]`,value:q[1],valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function L(F,j){const q=sn(F.value),Z=fr(F.value),Y=F.value!==null?F.value:j;if(s){if(q!==s)return[new st(F.key,Y,`${q} stop domain type must match previous stop domain type ${s}`)]}else s=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new st(F.key,Y,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&r!=="categorical"){let fe=`number expected, ${q} found`;return ys(e)&&r===void 0&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new st(F.key,Y,fe)]}return r!=="categorical"||q!=="number"||isFinite(Z)&&Math.floor(Z)===Z?r!=="categorical"&&q==="number"&&u!==void 0&&Z<u?[new st(F.key,Y,"stop domain values must appear in ascending order")]:(u=Z,r==="categorical"&&Z in m?[new st(F.key,Y,"stop domain values must be unique")]:(m[Z]=!0,[])):[new st(F.key,Y,`integer expected, found ${Z}`)]}}function Ga(i){const e=(i.expressionContext==="property"?dh:hl)(So(i.value),i.valueSpec);if(e.result==="error")return e.value.map((s=>new st(`${i.key}${s.key}`,i.value,s.message)));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new st(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!cl(r))return[new st(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!cl(r))return[new st(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ec(r,["zoom","feature-state"]))return[new st(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Pc(r))return[new st(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function gl(i){const e=i.key,r=i.value,s=sn(r);return s!=="string"?[new st(e,r,`color expected, ${s} found`)]:on.parse(String(r))?[]:[new st(e,r,`color expected, "${r}" found`)]}function Mo(i){const e=i.key,r=i.value,s=i.valueSpec,u=[];return Array.isArray(s.values)?s.values.indexOf(fr(r))===-1&&u.push(new st(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(fr(r))===-1&&u.push(new st(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),u}function xs(i){return ph(So(i.value))?Ga(si({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ld(i)}function Ld(i){const e=i.value,r=i.key;if(sn(e)!=="array")return[new st(r,e,`array expected, ${sn(e)} found`)];const s=i.styleSpec;let u,d=[];if(e.length<1)return[new st(r,e,"filter array must have at least 1 element")];switch(d=d.concat(Mo({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),fr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&fr(e[1])==="$type"&&d.push(new st(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new st(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=sn(e[1]),u!=="string"&&d.push(new st(`${r}[1]`,e[1],`string expected, ${u} found`)));for(let m=2;m<e.length;m++)u=sn(e[m]),fr(e[1])==="$type"?d=d.concat(Mo({key:`${r}[${m}]`,value:e[m],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&d.push(new st(`${r}[${m}]`,e[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)d=d.concat(Ld({key:`${r}[${m}]`,value:e[m],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=sn(e[1]),e.length!==2?d.push(new st(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&d.push(new st(`${r}[1]`,e[1],`string expected, ${u} found`))}return d}function Fd(i,e){const r=i.key,s=i.validateSpec,u=i.style,d=i.styleSpec,m=i.value,y=i.objectKey,w=d[`${e}_${i.layerType}`];if(!w)return[];const M=y.match(/^(.*)-transition$/);if(e==="paint"&&M&&w[M[1]]&&w[M[1]].transition)return s({key:r,value:m,valueSpec:d.transition,style:u,styleSpec:d});const I=i.valueSpec||w[y];if(!I)return[new st(r,m,`unknown property "${y}"`)];let k;if(sn(m)==="string"&&ys(I)&&!I.tokens&&(k=/^{([^}]+)}$/.exec(m)))return[new st(r,m,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];const L=[];return i.layerType==="symbol"&&y==="text-font"&&Cc(So(m))&&fr(m.type)==="identity"&&L.push(new st(r,m,'"text-font" does not support identity functions')),L.concat(s({key:i.key,value:m,valueSpec:I,style:u,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:y}))}function Bd(i){return Fd(i,"paint")}function Od(i){return Fd(i,"layout")}function Nd(i){let e=[];const r=i.value,s=i.key,u=i.style,d=i.styleSpec;if(sn(r)!=="object")return[new st(s,r,`object expected, ${sn(r)} found`)];r.type||r.ref||e.push(new st(s,r,'either "type" or "ref" is required'));let m=fr(r.type);const y=fr(r.ref);if(r.id){const w=fr(r.id);for(let M=0;M<i.arrayIndex;M++){const I=u.layers[M];fr(I.id)===w&&e.push(new st(s,r.id,`duplicate layer id "${r.id}", previously used at line ${I.id.__line__}`))}}if("ref"in r){let w;["type","source","source-layer","filter","layout"].forEach((M=>{M in r&&e.push(new st(s,r[M],`"${M}" is prohibited for ref layers`))})),u.layers.forEach((M=>{fr(M.id)===y&&(w=M)})),w?w.ref?e.push(new st(s,r.ref,"ref cannot reference another ref layer")):m=fr(w.type):e.push(new st(s,r.ref,`ref layer "${y}" not found`))}else if(m!=="background")if(r.source){const w=u.sources&&u.sources[r.source],M=w&&fr(w.type);w?M==="vector"&&m==="raster"?e.push(new st(s,r.source,`layer "${r.id}" requires a raster source`)):M!=="raster-dem"&&m==="hillshade"||M!=="raster-dem"&&m==="color-relief"?e.push(new st(s,r.source,`layer "${r.id}" requires a raster-dem source`)):M==="raster"&&m!=="raster"?e.push(new st(s,r.source,`layer "${r.id}" requires a vector source`)):M!=="vector"||r["source-layer"]?M==="raster-dem"&&m!=="hillshade"&&m!=="color-relief"?e.push(new st(s,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):m!=="line"||!r.paint||!r.paint["line-gradient"]||M==="geojson"&&w.lineMetrics||e.push(new st(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new st(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new st(s,r.source,`source "${r.source}" not found`))}else e.push(new st(s,r,'missing required property "source"'));return e=e.concat(Ti({key:s,value:r,valueSpec:d.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:r.type,valueSpec:d.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:xs,layout:w=>Ti({layer:r,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":M=>Od(si({layerType:m},M))}}),paint:w=>Ti({layer:r,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":M=>Bd(si({layerType:m},M))}})}})),e}function $a(i){const e=i.value,r=i.key,s=sn(e);return s!=="string"?[new st(r,e,`string expected, ${s} found`)]:[]}const mh={promoteId:function({key:i,value:e}){if(sn(e)==="string")return $a({key:i,value:e});{const r=[];for(const s in e)r.push(...$a({key:`${i}.${s}`,value:e[s]}));return r}}};function gh(i){const e=i.value,r=i.key,s=i.styleSpec,u=i.style,d=i.validateSpec;if(!e.type)return[new st(r,e,'"type" is required')];const m=fr(e.type);let y;switch(m){case"vector":case"raster":return y=Ti({key:r,value:e,valueSpec:s[`source_${m.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:mh,validateSpec:d}),y;case"raster-dem":return y=(function(w){var M;const I=(M=w.sourceName)!==null&&M!==void 0?M:"",k=w.value,L=w.styleSpec,F=L.source_raster_dem,j=w.style;let q=[];const Z=sn(k);if(k===void 0)return q;if(Z!=="object")return q.push(new st("source_raster_dem",k,`object expected, ${Z} found`)),q;const Y=fr(k.encoding)==="custom",fe=["redFactor","greenFactor","blueFactor","baseShift"],J=w.value.encoding?`"${w.value.encoding}"`:"Default";for(const ne in k)!Y&&fe.includes(ne)?q.push(new st(ne,k[ne],`In "${I}": "${ne}" is only valid when "encoding" is set to "custom". ${J} encoding found`)):F[ne]?q=q.concat(w.validateSpec({key:ne,value:k[ne],valueSpec:F[ne],validateSpec:w.validateSpec,style:j,styleSpec:L})):q.push(new st(ne,k[ne],`unknown property "${ne}"`));return q})({sourceName:r,value:e,style:i.style,styleSpec:s,validateSpec:d}),y;case"geojson":if(y=Ti({key:r,value:e,valueSpec:s.source_geojson,style:u,styleSpec:s,validateSpec:d,objectElementValidators:mh}),e.cluster)for(const w in e.clusterProperties){const[M,I]=e.clusterProperties[w],k=typeof M=="string"?[M,["accumulated"],["get",w]]:M;y.push(...Ga({key:`${r}.${w}.map`,value:I,expressionContext:"cluster-map"})),y.push(...Ga({key:`${r}.${w}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return y;case"video":return Ti({key:r,value:e,valueSpec:s.source_video,style:u,validateSpec:d,styleSpec:s});case"image":return Ti({key:r,value:e,valueSpec:s.source_image,style:u,validateSpec:d,styleSpec:s});case"canvas":return[new st(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Mo({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function _l(i){const e=i.value,r=i.styleSpec,s=r.light,u=i.style;let d=[];const m=sn(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new st("light",e,`object expected, ${m} found`)]),d;for(const y in e){const w=y.match(/^(.*)-transition$/);d=d.concat(w&&s[w[1]]&&s[w[1]].transition?i.validateSpec({key:y,value:e[y],valueSpec:r.transition,validateSpec:i.validateSpec,style:u,styleSpec:r}):s[y]?i.validateSpec({key:y,value:e[y],valueSpec:s[y],validateSpec:i.validateSpec,style:u,styleSpec:r}):[new st(y,e[y],`unknown property "${y}"`)])}return d}function Vd(i){const e=i.value,r=i.styleSpec,s=r.sky,u=i.style,d=sn(e);if(e===void 0)return[];if(d!=="object")return[new st("sky",e,`object expected, ${d} found`)];let m=[];for(const y in e)m=m.concat(s[y]?i.validateSpec({key:y,value:e[y],valueSpec:s[y],style:u,styleSpec:r}):[new st(y,e[y],`unknown property "${y}"`)]);return m}function _h(i){const e=i.value,r=i.styleSpec,s=r.terrain,u=i.style;let d=[];const m=sn(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new st("terrain",e,`object expected, ${m} found`)]),d;for(const y in e)d=d.concat(s[y]?i.validateSpec({key:y,value:e[y],valueSpec:s[y],validateSpec:i.validateSpec,style:u,styleSpec:r}):[new st(y,e[y],`unknown property "${y}"`)]);return d}function yh(i){let e=[];const r=i.value,s=i.key;if(Array.isArray(r)){const u=[],d=[];for(const m in r)r[m].id&&u.includes(r[m].id)&&e.push(new st(s,r,`all the sprites' ids must be unique, but ${r[m].id} is duplicated`)),u.push(r[m].id),r[m].url&&d.includes(r[m].url)&&e.push(new st(s,r,`all the sprites' URLs must be unique, but ${r[m].url} is duplicated`)),d.push(r[m].url),e=e.concat(Ti({key:`${s}[${m}]`,value:r[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return $a({key:s,value:r})}function jd(i){return!!i&&i.constructor===Object}function vh(i){return jd(i.value)?[]:[new st(i.key,i.value,`object expected, ${sn(i.value)} found`)]}const xh={"*":()=>[],array:Rc,boolean:function(i){const e=i.value,r=i.key,s=sn(e);return s!=="boolean"?[new st(r,e,`boolean expected, ${s} found`)]:[]},number:ml,color:gl,constants:Rd,enum:Mo,filter:xs,function:Lc,layer:Nd,object:Ti,source:gh,light:_l,sky:Vd,terrain:_h,projection:function(i){const e=i.value,r=i.styleSpec,s=r.projection,u=i.style,d=sn(e);if(e===void 0)return[];if(d!=="object")return[new st("projection",e,`object expected, ${d} found`)];let m=[];for(const y in e)m=m.concat(s[y]?i.validateSpec({key:y,value:e[y],valueSpec:s[y],style:u,styleSpec:r}):[new st(y,e[y],`unknown property "${y}"`)]);return m},projectionDefinition:function(i){const e=i.key;let r=i.value;r=r instanceof String?r.valueOf():r;const s=sn(r);return s!=="array"||(function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"})(r)||(function(u){return!!["interpolate","step","literal"].includes(u[0])})(r)?["array","string"].includes(s)?[]:[new st(e,r,`projection expected, invalid type "${s}" found`)]:[new st(e,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:$a,formatted:function(i){return $a(i).length===0?[]:Ga(i)},resolvedImage:function(i){return $a(i).length===0?[]:Ga(i)},padding:function(i){const e=i.key,r=i.value;if(sn(r)==="array"){if(r.length<1||r.length>4)return[new st(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let u=[];for(let d=0;d<r.length;d++)u=u.concat(i.validateSpec({key:`${e}[${d}]`,value:r[d],validateSpec:i.validateSpec,valueSpec:s}));return u}return ml({key:e,value:r,valueSpec:{}})},numberArray:function(i){const e=i.key,r=i.value;if(sn(r)==="array"){const s={type:"number"};if(r.length<1)return[new st(e,r,"array length at least 1 expected, length 0 found")];let u=[];for(let d=0;d<r.length;d++)u=u.concat(i.validateSpec({key:`${e}[${d}]`,value:r[d],validateSpec:i.validateSpec,valueSpec:s}));return u}return ml({key:e,value:r,valueSpec:{}})},colorArray:function(i){const e=i.key,r=i.value;if(sn(r)==="array"){if(r.length<1)return[new st(e,r,"array length at least 1 expected, length 0 found")];let s=[];for(let u=0;u<r.length;u++)s=s.concat(gl({key:`${e}[${u}]`,value:r[u]}));return s}return gl({key:e,value:r})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,s=sn(r),u=i.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new st(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let m=0;m<r.length;m+=2)d=d.concat(Mo({key:`${e}[${m}]`,value:r[m],valueSpec:u.layout_symbol["text-anchor"]})),d=d.concat(Rc({key:`${e}[${m+1}]`,value:r[m+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:u}));return d},sprite:yh,state:vh,fontFaces:function(i){const e=i.key,r=i.value,s=i.validateSpec,u=i.styleSpec,d=i.style;if(!jd(r))return[new st(e,r,`object expected, ${sn(r)} found`)];const m=[];for(const y in r){const w=r[y],M=sn(w);if(M==="string")m.push(...$a({key:`${e}.${y}`,value:w}));else if(M==="array"){const I={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[k,L]of w.entries())m.push(...Ti({key:`${e}.${y}[${k}]`,value:L,valueSpec:I,styleSpec:u,style:d,validateSpec:s}))}else m.push(new st(`${e}.${y}`,w,`string or array expected, ${M} found`))}return m}};function Za(i){const e=i.value,r=i.valueSpec,s=i.styleSpec;return i.validateSpec=Za,r.expression&&Cc(fr(e))?Lc(i):r.expression&&vs(So(e))?Ga(i):r.type&&xh[r.type]?xh[r.type](i):Ti(si({},i,{valueSpec:r.type?s[r.type]:r}))}function Ud(i){const e=i.value,r=i.key,s=$a(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new st(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new st(r,e,'"glyphs" url must include a "{range}" token'))),s}function Fi(i,e=Fe){let r=[];return r=r.concat(Za({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Za,objectElementValidators:{glyphs:Ud,"*":()=>[]}})),i.constants&&(r=r.concat(Rd({key:"constants",value:i.constants}))),qd(r)}function Xi(i){return function(e){return i(Object.assign({},e,{validateSpec:Za}))}}function qd(i){return[].concat(i).sort(((e,r)=>e.line-r.line))}function Yi(i){return function(...e){return qd(i.apply(this,e))}}Fi.source=Yi(Xi(gh)),Fi.sprite=Yi(Xi(yh)),Fi.glyphs=Yi(Xi(Ud)),Fi.light=Yi(Xi(_l)),Fi.sky=Yi(Xi(Vd)),Fi.terrain=Yi(Xi(_h)),Fi.state=Yi(Xi(vh)),Fi.layer=Yi(Xi(Nd)),Fi.filter=Yi(Xi(xs)),Fi.paintProperty=Yi(Xi(Bd)),Fi.layoutProperty=Yi(Xi(Od));const Eg={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class yl{constructor(e,r){this._globalState=r,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const r=hl(e,Eg,this._globalState);if(r.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(r.value.map((s=>`${s.key}: ${s.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=r.value,this._globalStateRefs=qa(r.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const vl=Fe,kr=Fi,xl=kr.light,Gd=kr.sky,Cg=kr.paintProperty,Ig=kr.layoutProperty;function bs(i,e){let r=!1;if(e&&e.length)for(const s of e)i.fire(new Cn(new Error(s.message))),r=!0;return r}class ws{constructor(e,r,s){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const m=new Int32Array(this.arrayBuffer);e=m[0],this.d=(r=m[1])+2*(s=m[2]);for(let w=0;w<this.d*this.d;w++){const M=m[3+w],I=m[3+w+1];u.push(M===I?null:m.subarray(M,I))}const y=m[3+u.length+1];this.keys=m.subarray(m[3+u.length],y),this.bboxes=m.subarray(y),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let m=0;m<this.d*this.d;m++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=s,this.scale=r/e,this.uid=0;const d=s/r*e;this.min=-d,this.max=e+d}insert(e,r,s,u,d){this._forEachCell(r,s,u,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,s,u,d,m){this.cells[d].push(m)}query(e,r,s,u,d){const m=this.min,y=this.max;if(e<=m&&r<=m&&y<=s&&y<=u&&!d)return Array.prototype.slice.call(this.keys);{const w=[];return this._forEachCell(e,r,s,u,this._queryCell,w,{},d),w}}_queryCell(e,r,s,u,d,m,y,w){const M=this.cells[d];if(M!==null){const I=this.keys,k=this.bboxes;for(let L=0;L<M.length;L++){const F=M[L];if(y[F]===void 0){const j=4*F;(w?w(k[j+0],k[j+1],k[j+2],k[j+3]):e<=k[j+2]&&r<=k[j+3]&&s>=k[j+0]&&u>=k[j+1])?(y[F]=!0,m.push(I[F])):y[F]=!1}}}}_forEachCell(e,r,s,u,d,m,y,w){const M=this._convertToCellCoord(e),I=this._convertToCellCoord(r),k=this._convertToCellCoord(s),L=this._convertToCellCoord(u);for(let F=M;F<=k;F++)for(let j=I;j<=L;j++){const q=this.d*j+F;if((!w||w(this._convertFromCellCoord(F),this._convertFromCellCoord(j),this._convertFromCellCoord(F+1),this._convertFromCellCoord(j+1)))&&d.call(this,e,r,s,u,q,m,y,w))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let s=0;for(let m=0;m<this.cells.length;m++)s+=this.cells[m].length;const u=new Int32Array(r+s+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let d=r;for(let m=0;m<e.length;m++){const y=e[m];u[3+m]=d,u.set(y,d),d+=y.length}return u[3+e.length]=d,u.set(this.keys,d),d+=this.keys.length,u[3+e.length+1]=d,u.set(this.bboxes,d),d+=this.bboxes.length,u.buffer}static serialize(e,r){const s=e.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(e){return new ws(e.buffer)}}const Ki={};function wt(i,e,r={}){if(Ki[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Ki[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}wt("Object",Object),wt("Set",Set),wt("TransferableGridIndex",ws),wt("Color",on),wt("Error",Error),wt("AJAXError",ye),wt("ResolvedImage",wi),wt("StylePropertyFunction",Ac),wt("StyleExpression",hh,{omit:["_evaluator"]}),wt("ZoomDependentExpression",fh),wt("ZoomConstantExpression",Ic),wt("CompoundExpression",Li,{omit:["_evaluate"]});for(const i in gs)gs[i]._classRegistryKey||wt(`Expression_${i}`,gs[i]);function Fc(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function bh(i){return i.$name||i.constructor._classRegistryKey}function Ts(i){return!(function(e){if(e===null||typeof e!="object")return!1;const r=bh(e);return!(!r||r==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Fc(i)||cn(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function bl(i,e){if(Ts(i))return(Fc(i)||cn(i))&&e&&e.push(i),ArrayBuffer.isView(i)&&e&&e.push(i.buffer),i instanceof ImageData&&e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const d=[];for(const m of i)d.push(bl(m,e));return d}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=bh(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Ki[r])throw new Error(`${r} is not registered.`);const{klass:s}=Ki[r],u=s.serialize?s.serialize(i,e):{};if(s.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in i){if(!i.hasOwnProperty(d)||Ki[r].omit.indexOf(d)>=0)continue;const m=i[d];u[d]=Ki[r].shallow.indexOf(d)>=0?m:bl(m,e)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(u.$name=r),u}function wl(i){if(Ts(i))return i;if(Array.isArray(i))return i.map(wl);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const e=bh(i)||"Object";if(!Ki[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Ki[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const u of Object.keys(i)){if(u==="$name")continue;const d=i[u];s[u]=Ki[e].shallow.indexOf(u)>=0?d:wl(d)}return s}class wh{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}function Tl(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function Th(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function $d(i){return/\s/u.test(String.fromCodePoint(i))}function Ss(i){for(const e of i)if(Th(e.codePointAt(0)))return!0;return!1}function Ag(i){for(const e of i)if(!Zd(e.codePointAt(0)))return!1;return!0}function Bc(i){const e=i.map((r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}})).filter((r=>r));return new RegExp(e.join("|"),"u")}const Oc=Bc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Zd(i){return!Oc.test(String.fromCodePoint(i))}function Sh(i){return!(Th(i)||(e=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const Wd=Bc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Mh(i){return Wd.test(String.fromCodePoint(i))}function Ph(i,e){return!(!e&&Mh(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function Hd(i){for(const e of i)if(Mh(e.codePointAt(0)))return!0;return!1}const Wa=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(Wa.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,e){return l(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const r=i.pluginURL,s=new Promise((d=>{this.loadScriptResolve=d}));e(r);const u=new Promise((d=>setTimeout((()=>d()),this.TIMEOUT)));if(yield Promise.race([s,u]),this.isParsed()){const d={pluginStatus:"loaded",pluginURL:r};return this.setState(d),d}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)}))}};class Rn{constructor(e,r){this.isSupportedScript=kg,this.zoom=e,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new wh,this.transition=r.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new wh,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}function kg(i){return(function(e,r){for(const s of e)if(!Ph(s.codePointAt(0),r))return!1;return!0})(i,Wa.getRTLTextPluginStatus()==="loaded")}const Sl="-transition";class Nc{constructor(e,r,s){this.property=e,this.value=r,this.expression=(function(u,d,m){if(Cc(u))return new Ac(u,d);if(vs(u)){const y=dh(u,d,m);if(y.result==="error")throw new Error(y.value.map((w=>`${w.key}: ${w.message}`)).join(", "));return y.value}{let y=u;return d.type==="color"&&typeof u=="string"?y=on.parse(u):d.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?d.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?d.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?y=ui.parse(u):d.type==="projectionDefinition"&&typeof u=="string"&&(y=hi.parse(u)):y=Gt.parse(u):y=tr.parse(u):y=Yr.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>y}}})(r===void 0?e.specification.default:r,e.specification,s)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class Vc{constructor(e,r){this.property=e,this.value=new Nc(e,void 0,r)}transitioned(e,r){return new Xd(this.property,this.value,r,Kt({},e.transition,this.transition),e.now)}untransitioned(){return new Xd(this.property,this.value,null,{},0)}}class Eh{constructor(e,r){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=r}getValue(e){return Ze(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Vc(this._values[e].property,this._globalState)),this._values[e].value=new Nc(this._values[e].property,r===null?void 0:Ze(r),this._globalState)}getTransition(e){return Ze(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Vc(this._values[e].property,this._globalState)),this._values[e].transition=Ze(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const u=this.getTransition(r);u!==void 0&&(e[`${r}${Sl}`]=u)}return e}transitioned(e,r){const s=new Yd(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(e,r._values[u]);return s}untransitioned(){const e=new Yd(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Xd{constructor(e,r,s,u,d){this.property=e,this.value=r,this.begin=d+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const u=e.now||0,d=this.value.possiblyEvaluate(e,r,s),m=this.prior;if(m){if(u>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(u<this.begin)return m.possiblyEvaluate(e,r,s);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,r,s),d,xt(y))}}return d}}class Yd{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const u=new Ml(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,r,s);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Kd{constructor(e,r){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=r}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Ze(this._values[e].value)}setValue(e,r){this._values[e]=new Nc(this._values[e].property,r===null?void 0:Ze(r),this._globalState)}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const u=new Ml(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,r,s);return u}}class Ji{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,u){return this.property.evaluate(this.value,this.parameters,e,r,s,u)}}class Ml{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Dt{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,s){const u=Hn[this.specification.type];return u?u(e,r,s):e}}class Ot{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,u){return new Ji(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,u)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Ji(this,{kind:"constant",value:void 0},e.parameters);const u=Hn[this.specification.type];if(u){const d=u(e.value.value,r.value.value,s);return new Ji(this,{kind:"constant",value:d},e.parameters)}return e}evaluate(e,r,s,u,d,m){return e.kind==="constant"?e.value:e.evaluate(r,s,u,d,m)}}class Pl extends Ot{possiblyEvaluate(e,r,s,u){if(e.value===void 0)return new Ji(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const d=e.expression.evaluate(r,null,{},s,u),m=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,y=this._calculate(m,m,m,r);return new Ji(this,{kind:"constant",value:y},r)}if(e.expression.kind==="camera"){const d=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new Ji(this,{kind:"constant",value:d},r)}return new Ji(this,e.expression,r)}evaluate(e,r,s,u,d,m){if(e.kind==="source"){const y=e.evaluate(r,s,u,d,m);return this._calculate(y,y,y,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,u),e.evaluate({zoom:Math.floor(r.zoom)},s,u),e.evaluate({zoom:Math.floor(r.zoom)+1},s,u),r):e.value}_calculate(e,r,s,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class jc{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const d=e.expression.evaluate(r,null,{},s,u);return this._calculate(d,d,d,r)}return this._calculate(e.expression.evaluate(new Rn(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Rn(Math.floor(r.zoom),r)),e.expression.evaluate(new Rn(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class Uc{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,u){return!!e.expression.evaluate(r,null,{},s,u)}interpolate(){return!1}}class di{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new Nc(s,void 0,void 0),d=this.defaultTransitionablePropertyValues[r]=new Vc(s,void 0);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate({})}}}wt("DataDrivenProperty",Ot),wt("DataConstantProperty",Dt),wt("CrossFadedDataDrivenProperty",Pl),wt("CrossFadedProperty",jc),wt("ColorRampProperty",Uc);class Bi extends yn{constructor(e,r,s){if(super(),this.id=e.id,this.type=e.type,this._globalState=s,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},this._visibilityExpression=(function(u,d){return new yl(u,d)})(this.visibility,s),e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=fl(e.filter,s)),r.layout&&(this._unevaluatedLayout=new Kd(r.layout,s)),r.paint)){this._transitionablePaint=new Eh(r.paint,s);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ml(r.paint)}}setFilter(e){this.filter=e,this._featureFilter=fl(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const r of this._visibilityExpression.getGlobalStateRefs())e.add(r);if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const s=this._unevaluatedLayout._values[r];for(const u of s.getGlobalStateRefs())e.add(u)}for(const r of this._featureFilter.getGlobalStateRefs())e.add(r);return e}getPaintAffectingGlobalStateRefs(){var e;const r=new globalThis.Map;if(this._transitionablePaint)for(const s in this._transitionablePaint._values){const u=this._transitionablePaint._values[s].value;for(const d of u.getGlobalStateRefs()){const m=(e=r.get(d))!==null&&e!==void 0?e:[];m.push({name:s,value:u.value}),r.set(d,m)}}return r}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,r,s={}){if(r==null||!this._validate(Ig,`layers.${this.id}.layout.${e}`,e,r,s))return e==="visibility"?(this.visibility=r,this._visibilityExpression.setValue(r),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,r)}getPaintProperty(e){return e.endsWith(Sl)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(Cg,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(e.endsWith(Sl))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const u=this._transitionablePaint._values[e],d=u.property.specification["property-type"]==="cross-faded-data-driven",m=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const w=this._transitionablePaint._values[e].value;return w.isDataDriven()||m||d||this._handleOverridablePaintPropertyUpdate(e,y,w)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e=this.minzoom,r=!1){return!!(this.minzoom&&e<(r?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Rt(e,((r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length)))}_validate(e,r,s,u,d={}){return(!d||d.validate!==!1)&&bs(this,e.call(kr,{key:r,layerType:this.type,objectKey:s,value:u,styleSpec:Fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Ji&&ys(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let Ch;var Jd={get paint(){return Ch=Ch||new di({"raster-opacity":new Dt(Fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Dt(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Dt(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Dt(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new Dt(Fe.paint_raster["raster-saturation"]),"raster-contrast":new Dt(Fe.paint_raster["raster-contrast"]),"raster-resampling":new Dt(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new Dt(Fe.paint_raster["raster-fade-duration"])})}};class Dg extends Bi{constructor(e,r){super(e,Jd,r)}}const zg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class El{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class nr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function dr(i,e=1){let r=0,s=0;return{members:i.map((u=>{const d=zg[u.type].BYTES_PER_ELEMENT,m=r=Po(r,Math.max(e,d)),y=u.components||1;return s=Math.max(s,d),r+=d*y,{name:u.name,type:u.type,components:y,offset:m}})),size:Po(r,Math.max(s,e)),alignment:e}}function Po(i,e){return Math.ceil(i/e)*e}class Cl extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=s,e}}Cl.prototype.bytesPerElement=4,wt("StructArrayLayout2i4",Cl);class qc extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s)}emplace(e,r,s,u){const d=3*e;return this.int16[d+0]=r,this.int16[d+1]=s,this.int16[d+2]=u,e}}qc.prototype.bytesPerElement=6,wt("StructArrayLayout3i6",qc);class Ih extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,u)}emplace(e,r,s,u,d){const m=4*e;return this.int16[m+0]=r,this.int16[m+1]=s,this.int16[m+2]=u,this.int16[m+3]=d,e}}Ih.prototype.bytesPerElement=8,wt("StructArrayLayout4i8",Ih);class Gc extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,s,u,d,m)}emplace(e,r,s,u,d,m,y){const w=6*e;return this.int16[w+0]=r,this.int16[w+1]=s,this.int16[w+2]=u,this.int16[w+3]=d,this.int16[w+4]=m,this.int16[w+5]=y,e}}Gc.prototype.bytesPerElement=12,wt("StructArrayLayout2i4i12",Gc);class Ah extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,s,u,d,m)}emplace(e,r,s,u,d,m,y){const w=4*e,M=8*e;return this.int16[w+0]=r,this.int16[w+1]=s,this.uint8[M+4]=u,this.uint8[M+5]=d,this.uint8[M+6]=m,this.uint8[M+7]=y,e}}Ah.prototype.bytesPerElement=8,wt("StructArrayLayout2i4ub8",Ah);class Il extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=s,e}}Il.prototype.bytesPerElement=8,wt("StructArrayLayout2f8",Il);class Sa extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,m,y,w,M,I){const k=this.length;return this.resize(k+1),this.emplace(k,e,r,s,u,d,m,y,w,M,I)}emplace(e,r,s,u,d,m,y,w,M,I,k){const L=10*e;return this.uint16[L+0]=r,this.uint16[L+1]=s,this.uint16[L+2]=u,this.uint16[L+3]=d,this.uint16[L+4]=m,this.uint16[L+5]=y,this.uint16[L+6]=w,this.uint16[L+7]=M,this.uint16[L+8]=I,this.uint16[L+9]=k,e}}Sa.prototype.bytesPerElement=20,wt("StructArrayLayout10ui20",Sa);class $c extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,m,y,w){const M=this.length;return this.resize(M+1),this.emplace(M,e,r,s,u,d,m,y,w)}emplace(e,r,s,u,d,m,y,w,M){const I=8*e;return this.uint16[I+0]=r,this.uint16[I+1]=s,this.uint16[I+2]=u,this.uint16[I+3]=d,this.uint16[I+4]=m,this.uint16[I+5]=y,this.uint16[I+6]=w,this.uint16[I+7]=M,e}}$c.prototype.bytesPerElement=16,wt("StructArrayLayout8ui16",$c);class Al extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,m,y,w,M,I,k,L){const F=this.length;return this.resize(F+1),this.emplace(F,e,r,s,u,d,m,y,w,M,I,k,L)}emplace(e,r,s,u,d,m,y,w,M,I,k,L,F){const j=12*e;return this.int16[j+0]=r,this.int16[j+1]=s,this.int16[j+2]=u,this.int16[j+3]=d,this.uint16[j+4]=m,this.uint16[j+5]=y,this.uint16[j+6]=w,this.uint16[j+7]=M,this.int16[j+8]=I,this.int16[j+9]=k,this.int16[j+10]=L,this.int16[j+11]=F,e}}Al.prototype.bytesPerElement=24,wt("StructArrayLayout4i4ui4i24",Al);class Zc extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s)}emplace(e,r,s,u){const d=3*e;return this.float32[d+0]=r,this.float32[d+1]=s,this.float32[d+2]=u,e}}Zc.prototype.bytesPerElement=12,wt("StructArrayLayout3f12",Zc);class kl extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}kl.prototype.bytesPerElement=4,wt("StructArrayLayout1ul4",kl);class kh extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,m,y,w,M){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,s,u,d,m,y,w,M)}emplace(e,r,s,u,d,m,y,w,M,I){const k=10*e,L=5*e;return this.int16[k+0]=r,this.int16[k+1]=s,this.int16[k+2]=u,this.int16[k+3]=d,this.int16[k+4]=m,this.int16[k+5]=y,this.uint32[L+3]=w,this.uint16[k+8]=M,this.uint16[k+9]=I,e}}kh.prototype.bytesPerElement=20,wt("StructArrayLayout6i1ul2ui20",kh);class Ms extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,s,u,d,m)}emplace(e,r,s,u,d,m,y){const w=6*e;return this.int16[w+0]=r,this.int16[w+1]=s,this.int16[w+2]=u,this.int16[w+3]=d,this.int16[w+4]=m,this.int16[w+5]=y,e}}Ms.prototype.bytesPerElement=12,wt("StructArrayLayout2i2i2i12",Ms);class Eo extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,u,d)}emplace(e,r,s,u,d,m){const y=4*e,w=8*e;return this.float32[y+0]=r,this.float32[y+1]=s,this.float32[y+2]=u,this.int16[w+6]=d,this.int16[w+7]=m,e}}Eo.prototype.bytesPerElement=16,wt("StructArrayLayout2f1f2i16",Eo);class Dh extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,s,u,d,m)}emplace(e,r,s,u,d,m,y){const w=16*e,M=4*e,I=8*e;return this.uint8[w+0]=r,this.uint8[w+1]=s,this.float32[M+1]=u,this.float32[M+2]=d,this.int16[I+6]=m,this.int16[I+7]=y,e}}Dh.prototype.bytesPerElement=16,wt("StructArrayLayout2ub2f2i16",Dh);class Dl extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s)}emplace(e,r,s,u){const d=3*e;return this.uint16[d+0]=r,this.uint16[d+1]=s,this.uint16[d+2]=u,e}}Dl.prototype.bytesPerElement=6,wt("StructArrayLayout3ui6",Dl);class Co extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,m,y,w,M,I,k,L,F,j,q,Z,Y){const fe=this.length;return this.resize(fe+1),this.emplace(fe,e,r,s,u,d,m,y,w,M,I,k,L,F,j,q,Z,Y)}emplace(e,r,s,u,d,m,y,w,M,I,k,L,F,j,q,Z,Y,fe){const J=24*e,ne=12*e,ge=48*e;return this.int16[J+0]=r,this.int16[J+1]=s,this.uint16[J+2]=u,this.uint16[J+3]=d,this.uint32[ne+2]=m,this.uint32[ne+3]=y,this.uint32[ne+4]=w,this.uint16[J+10]=M,this.uint16[J+11]=I,this.uint16[J+12]=k,this.float32[ne+7]=L,this.float32[ne+8]=F,this.uint8[ge+36]=j,this.uint8[ge+37]=q,this.uint8[ge+38]=Z,this.uint32[ne+10]=Y,this.int16[J+22]=fe,e}}Co.prototype.bytesPerElement=48,wt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Co);class zh extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,u,d,m,y,w,M,I,k,L,F,j,q,Z,Y,fe,J,ne,ge,we,De,Ke,Ge,tt,ht,it){const He=this.length;return this.resize(He+1),this.emplace(He,e,r,s,u,d,m,y,w,M,I,k,L,F,j,q,Z,Y,fe,J,ne,ge,we,De,Ke,Ge,tt,ht,it)}emplace(e,r,s,u,d,m,y,w,M,I,k,L,F,j,q,Z,Y,fe,J,ne,ge,we,De,Ke,Ge,tt,ht,it,He){const Ne=32*e,bt=16*e;return this.int16[Ne+0]=r,this.int16[Ne+1]=s,this.int16[Ne+2]=u,this.int16[Ne+3]=d,this.int16[Ne+4]=m,this.int16[Ne+5]=y,this.int16[Ne+6]=w,this.int16[Ne+7]=M,this.uint16[Ne+8]=I,this.uint16[Ne+9]=k,this.uint16[Ne+10]=L,this.uint16[Ne+11]=F,this.uint16[Ne+12]=j,this.uint16[Ne+13]=q,this.uint16[Ne+14]=Z,this.uint16[Ne+15]=Y,this.uint16[Ne+16]=fe,this.uint16[Ne+17]=J,this.uint16[Ne+18]=ne,this.uint16[Ne+19]=ge,this.uint16[Ne+20]=we,this.uint16[Ne+21]=De,this.uint16[Ne+22]=Ke,this.uint32[bt+12]=Ge,this.float32[bt+13]=tt,this.float32[bt+14]=ht,this.uint16[Ne+30]=it,this.uint16[Ne+31]=He,e}}zh.prototype.bytesPerElement=64,wt("StructArrayLayout8i15ui1ul2f2ui64",zh);class Wc extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Wc.prototype.bytesPerElement=4,wt("StructArrayLayout1f4",Wc);class Hc extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s)}emplace(e,r,s,u){const d=3*e;return this.uint16[6*e+0]=r,this.float32[d+1]=s,this.float32[d+2]=u,e}}Hc.prototype.bytesPerElement=12,wt("StructArrayLayout1ui2f12",Hc);class Rh extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s)}emplace(e,r,s,u){const d=4*e;return this.uint32[2*e+0]=r,this.uint16[d+2]=s,this.uint16[d+3]=u,e}}Rh.prototype.bytesPerElement=8,wt("StructArrayLayout1ul2ui8",Rh);class g extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=s,e}}g.prototype.bytesPerElement=4,wt("StructArrayLayout2ui4",g);class t extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}t.prototype.bytesPerElement=2,wt("StructArrayLayout1ui2",t);class a extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,u)}emplace(e,r,s,u,d){const m=4*e;return this.float32[m+0]=r,this.float32[m+1]=s,this.float32[m+2]=u,this.float32[m+3]=d,e}}a.prototype.bytesPerElement=16,wt("StructArrayLayout4f16",a);class c extends El{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new C(this.anchorPointX,this.anchorPointY)}}c.prototype.size=20;class f extends kh{get(e){return new c(this,e)}}wt("CollisionBoxArray",f);class _ extends El{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}_.prototype.size=48;class x extends Co{get(e){return new _(this,e)}}wt("PlacedSymbolArray",x);class S extends El{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}S.prototype.size=64;class E extends zh{get(e){return new S(this,e)}}wt("SymbolInstanceArray",E);class A extends Wc{getoffsetX(e){return this.float32[1*e+0]}}wt("GlyphOffsetArray",A);class R extends qc{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}wt("SymbolLineVertexArray",R);class N extends El{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}N.prototype.size=12;class O extends Hc{get(e){return new N(this,e)}}wt("TextAnchorOffsetArray",O);class $ extends El{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}$.prototype.size=8;class X extends Rh{get(e){return new $(this,e)}}wt("FeatureIndexArray",X);class re extends Cl{}class ae extends Cl{}class ie extends Cl{}class pe extends Gc{}class Te extends Ah{}class he extends Il{}class xe extends Sa{}class Pe extends $c{}class _e extends Al{}class Ce extends Zc{}class je extends kl{}class Le extends Ms{}class Be extends Dh{}class Oe extends Dl{}class lt extends g{}const ut=dr([{name:"a_pos",components:2,type:"Int16"}],4),{members:nt}=ut;class dt{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,r,s,u){const d=this.segments[this.segments.length-1];return e>dt.MAX_VERTEX_ARRAY_LENGTH&&Nt(`Max vertices per segment is ${dt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${dt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!d||d.vertexLength+e>dt.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==u?this.createNewSegment(r,s,u):d}createNewSegment(e,r,s){const u={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return s!==void 0&&(u.sortKey=s),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(e,r,s){return this.prepareSegment(0,e,r,s)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,u){return new dt([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}function Xt(i,e){return 256*(i=pt(Math.floor(i),0,255))+pt(Math.floor(e),0,255)}dt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,wt("SegmentVector",dt);const In=dr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Zn=dr([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Nn,Xn,Vn,lr={exports:{}},Yn={exports:{}},Dr={exports:{}},_r=(function(){if(Vn)return lr.exports;Vn=1;var i=(Nn||(Nn=1,Yn.exports=function(r,s){var u,d,m,y,w,M,I,k;for(d=r.length-(u=3&r.length),m=s,w=3432918353,M=461845907,k=0;k<d;)I=255&r.charCodeAt(k)|(255&r.charCodeAt(++k))<<8|(255&r.charCodeAt(++k))<<16|(255&r.charCodeAt(++k))<<24,++k,m=27492+(65535&(y=5*(65535&(m=(m^=I=(65535&(I=(I=(65535&I)*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*M+(((I>>>16)*M&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(I=0,u){case 3:I^=(255&r.charCodeAt(k+2))<<16;case 2:I^=(255&r.charCodeAt(k+1))<<8;case 1:m^=I=(65535&(I=(I=(65535&(I^=255&r.charCodeAt(k)))*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*M+(((I>>>16)*M&65535)<<16)&4294967295}return m^=r.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),Yn.exports),e=(Xn||(Xn=1,Dr.exports=function(r,s){for(var u,d=r.length,m=s^d,y=0;d>=4;)u=1540483477*(65535&(u=255&r.charCodeAt(y)|(255&r.charCodeAt(++y))<<8|(255&r.charCodeAt(++y))<<16|(255&r.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:m^=(255&r.charCodeAt(y+2))<<16;case 2:m^=(255&r.charCodeAt(y+1))<<8;case 1:m=1540483477*(65535&(m^=255&r.charCodeAt(y)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),Dr.exports);return lr.exports=i,lr.exports.murmur3=i,lr.exports.murmur2=e,lr.exports})(),pr=D(_r);class jr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,u){this.ids.push(Ha(e)),this.positions.push(r,s,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Ha(e);let s=0,u=this.ids.length-1;for(;s<u;){const m=s+u>>1;this.ids[m]>=r?u=m:s=m+1}const d=[];for(;this.ids[s]===r;)d.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return d}static serialize(e,r){const s=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Ma(s,u,0,s.length-1),r&&r.push(s.buffer,u.buffer),{ids:s,positions:u}}static deserialize(e){const r=new jr;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Ha(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:pr(String(i))}function Ma(i,e,r,s){for(;r<s;){const u=i[r+s>>1];let d=r-1,m=s+1;for(;;){do d++;while(i[d]<u);do m--;while(i[m]>u);if(d>=m)break;la(i,d,m),la(e,3*d,3*m),la(e,3*d+1,3*m+1),la(e,3*d+2,3*m+2)}m-r<s-m?(Ma(i,e,r,m),r=m+1):(Ma(i,e,m+1,s),s=m)}}function la(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}wt("FeaturePositionMap",jr);class _i{constructor(e,r){this.gl=e.gl,this.location=r}}class Io extends _i{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class zl extends _i{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Ao extends _i{constructor(e,r){super(e,r),this.current=on.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Oi=new Float32Array(16);function ca(i){return[Xt(255*i.r,255*i.g),Xt(255*i.b,255*i.a)]}class Qi{constructor(e,r,s){this.value=e,this.uniformNames=r.map((u=>`u_${u}`)),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return this.type==="color"?new Ao(e,r):new Io(e,r)}}class ea{constructor(e,r){this.uniformNames=r.map((s=>`u_${s}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,r){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,r.y,r.height,r.width]}setUniform(e,r,s,u){let d=null;u==="u_pattern_to"?d=this.patternTo:u==="u_pattern_from"?d=this.patternFrom:u==="u_dasharray_to"?d=this.dashTo:u==="u_dasharray_from"?d=this.dashFrom:u==="u_pixel_ratio_to"?d=this.pixelRatioTo:u==="u_pixel_ratio_from"&&(d=this.pixelRatioFrom),d!==null&&e.set(d)}getBinding(e,r,s){return s.substr(0,9)==="u_pattern"||s.substr(0,12)==="u_dasharray_"?new zl(e,r):new Io(e,r)}}class Un{constructor(e,r,s,u){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map((d=>({name:`a_${d}`,type:"Float32",components:s==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(e,r,s){const u=this.paintVertexArray.length,d=this.expression.evaluate(new Rn(0,s),r,{},s.canonical,[],s.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(u,e,d)}updatePaintArray(e,r,s,u,d){const m=this.expression.evaluate(new Rn(0,d),s,u);this._setPaintValue(e,r,m)}_setPaintValue(e,r,s){if(this.type==="color"){const u=ca(s);for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,u[0],u[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class jn{constructor(e,r,s,u,d,m){this.expression=e,this.uniformNames=r.map((y=>`u_${y}_t`)),this.type=s,this.useIntegerZoom=u,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map((y=>({name:`a_${y}`,type:"Float32",components:s==="color"?4:2,offset:0}))),this.paintVertexArray=new m}populatePaintArray(e,r,s){const u=this.expression.evaluate(new Rn(this.zoom,s),r,{},s.canonical,[],s.formattedSection),d=this.expression.evaluate(new Rn(this.zoom+1,s),r,{},s.canonical,[],s.formattedSection),m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(m,e,u,d)}updatePaintArray(e,r,s,u,d){const m=this.expression.evaluate(new Rn(this.zoom,d),s,u),y=this.expression.evaluate(new Rn(this.zoom+1,d),s,u);this._setPaintValue(e,r,m,y)}_setPaintValue(e,r,s,u){if(this.type==="color"){const d=ca(s),m=ca(u);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,d[0],d[1],m[0],m[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,u=pt(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,r,s){return new Io(e,r)}}class Er{constructor(e,r,s,u,d,m){this.expression=e,this.type=r,this.useIntegerZoom=s,this.zoom=u,this.layerId=m,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(e,r,s){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,this.getPositionIds(r),s)}updatePaintArray(e,r,s,u,d){this._setPaintValues(e,r,this.getPositionIds(s),d)}_setPaintValues(e,r,s,u){const d=this.getPositions(u);if(!d||!s)return;const m=d[s.min],y=d[s.mid],w=d[s.max];if(m&&y&&w)for(let M=e;M<r;M++)this.emplace(this.zoomInPaintVertexArray,M,y,m),this.emplace(this.zoomOutPaintVertexArray,M,y,w)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const r=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,r,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,r,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Cr extends Er{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return In.members}emplace(e,r,s,u){e.emplace(r,s.tlbr[0],s.tlbr[1],s.tlbr[2],s.tlbr[3],u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],s.pixelRatio,u.pixelRatio)}}class Qd extends Er{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return Zn.members}emplace(e,r,s,u){e.emplace(r,0,s.y,s.height,s.width,0,u.y,u.height,u.width)}}class ep{constructor(e,r,s){this.binders={},this._buffers=[];const u=[];for(const d in e.paint._values){if(!s(d))continue;const m=e.paint.get(d);if(!(m instanceof Ji&&ys(m.property.specification)))continue;const y=Rg(d,e.type),w=m.value,M=m.property.specification.type,I=m.property.useIntegerZoom,k=m.property.specification["property-type"],L=k==="cross-faded"||k==="cross-faded-data-driven";if(w.kind==="constant")this.binders[d]=L?new ea(w.value,y):new Qi(w.value,y,M),u.push(`/u_${d}`);else if(w.kind==="source"||L){const F=tp(d,M,"source");this.binders[d]=L?d==="line-dasharray"?new Qd(w,M,I,r,F,e.id):new Cr(w,M,I,r,F,e.id):new Un(w,y,M,F),u.push(`/a_${d}`)}else{const F=tp(d,M,"composite");this.binders[d]=new jn(w,y,M,I,r,F),u.push(`/z_${d}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Un||r instanceof jn?r.maxValue:0}populatePaintArrays(e,r,s){for(const u in this.binders){const d=this.binders[u];(d instanceof Un||d instanceof jn||d instanceof Er)&&d.populatePaintArray(e,r,s)}}setConstantPatternPositions(e,r){for(const s in this.binders){const u=this.binders[s];u instanceof ea&&u.setConstantPatternPositions(e,r)}}setConstantDashPositions(e,r){for(const s in this.binders){const u=this.binders[s];u instanceof ea&&u.setConstantDashPositions(e,r)}}updatePaintArrays(e,r,s,u,d){let m=!1;for(const y in e){const w=r.getPositions(y);for(const M of w){const I=s.feature(M.index);for(const k in this.binders){const L=this.binders[k];if((L instanceof Un||L instanceof jn||L instanceof Er)&&L.expression.isStateDependent===!0){const F=u.paint.get(k);L.expression=F.value,L.updatePaintArray(M.start,M.end,I,e[y],d),m=!0}}}}return m}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Qi||s instanceof ea)&&e.push(...s.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Un||s instanceof jn)for(let u=0;u<s.paintVertexAttributes.length;u++)e.push(s.paintVertexAttributes[u].name);else if(s instanceof Er){const u=s.getVertexAttributes();for(const d of u)e.push(d.name)}}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Qi||s instanceof ea||s instanceof jn)for(const u of s.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof Qi||d instanceof ea||d instanceof jn){for(const m of d.uniformNames)if(r[m]){const y=d.getBinding(e,r[m],m);s.push({name:m,property:u,binding:y})}}}return s}setUniforms(e,r,s,u){for(const{name:d,property:m,binding:y}of r)this.binders[m].setUniform(y,u,s.get(m),d)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof Er){const u=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(s instanceof Un||s instanceof jn)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof Un||s instanceof jn||s instanceof Er)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Un||r instanceof jn||r instanceof Er)&&r.destroy()}}}class ko{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new ep(u,r,s);this.needsUpload=!1,this._featureMap=new jr,this._bufferOffset=0}populatePaintArrays(e,r,s,u){for(const d in this.programConfigurations)this.programConfigurations[d].populatePaintArrays(e,r,u);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,u){for(const d of s)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,r,d,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Rg(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function tp(i,e,r){const s={color:{source:Il,composite:a},number:{source:Wc,composite:Il}},u=(function(d){return{"line-pattern":{source:xe,composite:xe},"fill-pattern":{source:xe,composite:xe},"fill-extrusion-pattern":{source:xe,composite:xe},"line-dasharray":{source:Pe,composite:Pe}}[d]})(i);return u&&u[r]||s[e][r]}wt("ConstantBinder",Qi),wt("CrossFadedConstantBinder",ea),wt("SourceExpressionBinder",Un),wt("CrossFadedPatternBinder",Cr),wt("CrossFadedDasharrayBinder",Qd),wt("CompositeExpressionBinder",jn),wt("ProgramConfiguration",ep,{omit:["_buffers"]}),wt("ProgramConfigurationSet",ko);const Lh=Math.pow(2,14)-1,Xa=-Lh-1;function Ya(i){const e=at/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const u=r[s];for(let d=0;d<u.length;d++){const m=u[d],y=Math.round(m.x*e),w=Math.round(m.y*e);m.x=pt(y,Xa,Lh),m.y=pt(w,Xa,Lh),(y<m.x||y>m.x+1||w<m.y||w>m.y+1)&&Nt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Ka(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Ya(i):[]}}const Fh=-32768;function Bh(i,e,r,s,u){i.emplaceBack(Fh+8*e+s,Fh+8*r+u)}class Xc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ae,this.indexArray=new Oe,this.segments=new dt,this.programConfigurations=new ko(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,s){const u=this.layers[0],d=[];let m=null,y=!1,w=u.type==="heatmap";if(u.type==="circle"){const I=u;m=I.layout.get("circle-sort-key"),y=!m.isConstant(),w=w||I.paint.get("circle-pitch-alignment")==="map"}const M=w?r.subdivisionGranularity.circle:1;for(const{feature:I,id:k,index:L,sourceLayerIndex:F}of e){const j=this.layers[0]._featureFilter.needGeometry,q=Ka(I,j);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom),q,s))continue;const Z=y?m.evaluate(q,{},s):void 0,Y={id:k,properties:I.properties,type:I.type,sourceLayerIndex:F,index:L,geometry:j?q.geometry:Ya(I),patterns:{},sortKey:Z};d.push(Y)}y&&d.sort(((I,k)=>I.sortKey-k.sortKey));for(const I of d){const{geometry:k,index:L,sourceLayerIndex:F}=I,j=e[L].feature;this.addFeature(I,k,L,s,M),r.featureIndex.insert(j,k,L,F,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:s})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,u,d=1){let m;switch(d){case 1:m=[0,7];break;case 3:m=[0,2,5,7];break;case 5:m=[0,1,3,4,6,7];break;case 7:m=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${d}; valid values are 1, 3, 5, 7.`)}const y=m.length;for(const w of r)for(const M of w){const I=M.x,k=M.y;if(I<0||I>=at||k<0||k>=at)continue;const L=this.segments.prepareSegment(y*y,this.layoutVertexArray,this.indexArray,e.sortKey),F=L.vertexLength;for(let j=0;j<y;j++)for(let q=0;q<y;q++)Bh(this.layoutVertexArray,I,k,m[q],m[j]);for(let j=0;j<y-1;j++)for(let q=0;q<y-1;q++){const Z=F+j*y+q,Y=F+(j+1)*y+q;this.indexArray.emplaceBack(Z,Y+1,Z+1),this.indexArray.emplaceBack(Z,Y,Y+1)}L.vertexLength+=y*y,L.primitiveLength+=(y-1)*(y-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{imagePositions:{},canonical:u})}}function Yc(i,e){for(let r=0;r<i.length;r++)if(Kc(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Kc(i,e[r]))return!0;return!!Lg(i,e)}function np(i,e,r){return!!Kc(i,e)||!!Fg(e,i,r)}function sv(i,e){if(i.length===1)return cv(e,i[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let u=0;u<s.length;u++)if(Kc(i,s[u]))return!0}for(let r=0;r<i.length;r++)if(cv(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Lg(i,e[r]))return!0;return!1}function iP(i,e,r){if(i.length>1){if(Lg(i,e))return!0;for(let s=0;s<e.length;s++)if(Fg(e[s],i,r))return!0}for(let s=0;s<i.length;s++)if(Fg(i[s],e,r))return!0;return!1}function Lg(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],u=i[r+1];for(let d=0;d<e.length-1;d++)if(aP(s,u,e[d],e[d+1]))return!0}return!1}function aP(i,e,r,s){return Jt(i,r,s)!==Jt(e,r,s)&&Jt(i,e,r)!==Jt(i,e,s)}function Fg(i,e,r){const s=r*r;if(e.length===1)return i.distSqr(e[0])<s;for(let u=1;u<e.length;u++)if(lv(i,e[u-1],e[u])<s)return!0;return!1}function lv(i,e,r){const s=e.distSqr(r);if(s===0)return i.distSqr(e);const u=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/s;return i.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function cv(i,e){let r,s,u,d=!1;for(let m=0;m<i.length;m++){r=i[m];for(let y=0,w=r.length-1;y<r.length;w=y++)s=r[y],u=r[w],s.y>e.y!=u.y>e.y&&e.x<(u.x-s.x)*(e.y-s.y)/(u.y-s.y)+s.x&&(d=!d)}return d}function Kc(i,e){let r=!1;for(let s=0,u=i.length-1;s<i.length;u=s++){const d=i[s],m=i[u];d.y>e.y!=m.y>e.y&&e.x<(m.x-d.x)*(e.y-d.y)/(m.y-d.y)+d.x&&(r=!r)}return r}function oP(i,e,r){const s=r[0],u=r[2];if(i.x<s.x&&e.x<s.x||i.x>u.x&&e.x>u.x||i.y<s.y&&e.y<s.y||i.y>u.y&&e.y>u.y)return!1;const d=Jt(i,e,r[0]);return d!==Jt(i,e,r[1])||d!==Jt(i,e,r[2])||d!==Jt(i,e,r[3])}function Jc(i,e,r){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(i)}function rp(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function ip(i,e,r,s,u){if(!e[0]&&!e[1])return i;const d=C.convert(e)._mult(u);r==="viewport"&&d._rotate(-s);const m=[];for(let y=0;y<i.length;y++)m.push(i[y].sub(d));return m}function sP(i){const e=[];for(let r=0;r<i.length;r++){const s=i[r],u=e.at(-1);(r===0||u&&!s.equals(u))&&e.push(s)}return e}function lP({queryGeometry:i,size:e},r){return np(i,r,e)}function cP({queryGeometry:i,size:e,transform:r,unwrappedTileID:s,getElevation:u},d){return np(i,d,e*(r.projectTileCoordinates(d.x,d.y,s,u).signedDistanceFromCamera/r.cameraToCenterDistance))}function uP({queryGeometry:i,size:e,transform:r,unwrappedTileID:s,getElevation:u},d){const m=r.projectTileCoordinates(d.x,d.y,s,u).signedDistanceFromCamera,y=e*(r.cameraToCenterDistance/m);return np(i,Bg(d,r,s,u),y)}function hP({queryGeometry:i,size:e,transform:r,unwrappedTileID:s,getElevation:u},d){return np(i,Bg(d,r,s,u),e)}function uv({queryGeometry:i,size:e,transform:r,unwrappedTileID:s,getElevation:u,pitchAlignment:d="map",pitchScale:m="map"},y){const w=d==="map"?m==="map"?lP:cP:m==="map"?uP:hP,M={queryGeometry:i,size:e,transform:r,unwrappedTileID:s,getElevation:u};for(const I of y)for(const k of I)if(w(M,k))return!0;return!1}function Bg(i,e,r,s){const u=e.projectTileCoordinates(i.x,i.y,r,s).point;return new C((.5*u.x+.5)*e.width,(.5*-u.y+.5)*e.height)}let hv,fv;wt("CircleBucket",Xc,{omit:["layers"]});var fP={get paint(){return fv=fv||new di({"circle-radius":new Ot(Fe.paint_circle["circle-radius"]),"circle-color":new Ot(Fe.paint_circle["circle-color"]),"circle-blur":new Ot(Fe.paint_circle["circle-blur"]),"circle-opacity":new Ot(Fe.paint_circle["circle-opacity"]),"circle-translate":new Dt(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new Dt(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Dt(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Dt(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ot(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ot(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ot(Fe.paint_circle["circle-stroke-opacity"])})},get layout(){return hv=hv||new di({"circle-sort-key":new Ot(Fe.layout_circle["circle-sort-key"])})}};class dP extends Bi{constructor(e,r){super(e,fP,r)}createBucket(e){return new Xc(e)}queryRadius(e){const r=e;return Jc("circle-radius",this,r)+Jc("circle-stroke-width",this,r)+rp(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:s,geometry:u,transform:d,pixelsToTileUnits:m,unwrappedTileID:y,getElevation:w}){const M=ip(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-d.bearingInRadians,m),I=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),k=this.paint.get("circle-pitch-scale"),L=this.paint.get("circle-pitch-alignment");let F,j;return L==="map"?(F=M,j=I*m):(F=(function(q,Z,Y,fe){return q.map((J=>Bg(J,Z,Y,fe)))})(M,d,y,w),j=I),uv({queryGeometry:F,size:j,transform:d,unwrappedTileID:y,getElevation:w,pitchAlignment:L,pitchScale:k},u)}}class dv extends Xc{}let pv;wt("HeatmapBucket",dv,{omit:["layers"]});var pP={get paint(){return pv=pv||new di({"heatmap-radius":new Ot(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ot(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Dt(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Uc(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Dt(Fe.paint_heatmap["heatmap-opacity"])})}};function Og(i,{width:e,height:r},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*s)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*r*s}`)}else u=new Uint8Array(e*r*s);return i.width=e,i.height=r,i.data=u,i}function mv(i,{width:e,height:r},s){if(e===i.width&&r===i.height)return;const u=Og({},{width:e,height:r},s);Ng(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},s),i.width=e,i.height=r,i.data=u.data}function Ng(i,e,r,s,u,d){if(u.width===0||u.height===0)return e;if(u.width>i.width||u.height>i.height||r.x>i.width-u.width||r.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||s.x>e.width-u.width||s.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=i.data,y=e.data;if(m===y)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<u.height;w++){const M=((r.y+w)*i.width+r.x)*d,I=((s.y+w)*e.width+s.x)*d;for(let k=0;k<u.width*d;k++)y[I+k]=m[M+k]}return e}class Oh{constructor(e,r){Og(this,e,1,r)}resize(e){mv(this,e,1)}clone(){return new Oh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,u,d){Ng(e,r,s,u,d,1)}}class Si{constructor(e,r){Og(this,e,4,r)}resize(e){mv(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Si({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,u,d){Ng(e,r,s,u,d,4)}setPixel(e,r,s){const u=4*(e*this.width+r);this.data[u+0]=Math.round(255*s.r/s.a),this.data[u+1]=Math.round(255*s.g/s.a),this.data[u+2]=Math.round(255*s.b/s.a),this.data[u+3]=Math.round(255*s.a)}}function gv(i){const e={},r=i.resolution||256,s=i.clips?i.clips.length:1,u=i.image||new Si({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const d=(m,y,w)=>{e[i.evaluationKey]=w;const M=i.expression.evaluate(e);u.setPixel(m/4/r,y/4,M)};if(i.clips)for(let m=0,y=0;m<s;++m,y+=4*r)for(let w=0,M=0;w<r;w++,M+=4){const I=w/(r-1),{start:k,end:L}=i.clips[m];d(y,M,k*(1-I)+L*I)}else for(let m=0,y=0;m<r;m++,y+=4)d(0,y,m/(r-1));return u}wt("AlphaImage",Oh),wt("RGBAImage",Si);const Vg="big-fb";class mP extends Bi{createBucket(e){return new dv(e)}constructor(e,r){super(e,pP,r),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Vg)&&this.heatmapFbos.delete(Vg)}queryRadius(e){return Jc("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:s,geometry:u,transform:d,pixelsToTileUnits:m,unwrappedTileID:y,getElevation:w}){return uv({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(r,s)*m,transform:d,unwrappedTileID:y,getElevation:w},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let _v;var gP={get paint(){return _v=_v||new di({"hillshade-illumination-direction":new Dt(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Dt(Fe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Dt(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Dt(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Dt(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Dt(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Dt(Fe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Dt(Fe.paint_hillshade["hillshade-method"])})}};class _P extends Bi{constructor(e,r){super(e,gP,r),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,s=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const d=Math.max(e.length,r.length,s.length,u.length);e=e.concat(Array(d-e.length).fill(e.at(-1))),r=r.concat(Array(d-r.length).fill(r.at(-1))),s=s.concat(Array(d-s.length).fill(s.at(-1))),u=u.concat(Array(d-u.length).fill(u.at(-1)));const m=r.map(Oa);return{directionRadians:e.map(Oa),altitudeRadians:m,shadowColor:u,highlightColor:s}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let yv;var yP={get paint(){return yv=yv||new di({"color-relief-opacity":new Dt(Fe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Uc(Fe["paint_color-relief"]["color-relief-color"])})}};class jg{constructor(e,r,s,u){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(r,u)}update(e,r,s){const{width:u,height:d}=e,m=!(this.size&&this.size[0]===u&&this.size[1]===d||s),{context:y}=this,{gl:w}=y;if(this.useMipmap=!!(r&&r.useMipmap),w.bindTexture(w.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!r||r.premultiply!==!1)),m)this.size=[u,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||cn(e)?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,e):w.texImage2D(w.TEXTURE_2D,0,this.format,u,d,0,this.format,w.UNSIGNED_BYTE,e.data);else{const{x:M,y:I}=s||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||cn(e)?w.texSubImage2D(w.TEXTURE_2D,0,M,I,w.RGBA,w.UNSIGNED_BYTE,e):w.texSubImage2D(w.TEXTURE_2D,0,M,I,u,d,w.RGBA,w.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&w.generateMipmap(w.TEXTURE_2D),y.pixelStoreUnpackFlipY.setDefault(),y.pixelStoreUnpack.setDefault(),y.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,r,s){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),s!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=d.LINEAR),e!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,s||e),this.filter=e),r!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class vv{constructor(e,r,s,u=1,d=1,m=1,y=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void Nt(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const w=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=d,this.blueFactor=m,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<w;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(w,M)]=this.data[this._idx(w-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,w)]=this.data[this._idx(M,w-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(w,-1)]=this.data[this._idx(w-1,0)],this.data[this._idx(-1,w)]=this.data[this._idx(0,w-1)],this.data[this._idx(w,w)]=this.data[this._idx(w-1,w-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<w;M++)for(let I=0;I<w;I++){const k=this.get(M,I);k>this.max&&(this.max=k),k<this.min&&(this.min=k)}}get(e,r){const s=new Uint8Array(this.data.buffer),u=4*this._idx(e,r);return this.unpack(s[u],s[u+1],s[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${r}, dim: ${this.dim}`);return(r+1)*this.stride+(e+1)}unpack(e,r,s){return e*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}pack(e){return xv(e,this.getUnpackVector())}getPixels(){return new Si({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,d=r*this.dim+this.dim,m=s*this.dim,y=s*this.dim+this.dim;switch(r){case-1:u=d-1;break;case 1:d=u+1}switch(s){case-1:m=y-1;break;case 1:y=m+1}const w=-r*this.dim,M=-s*this.dim;for(let I=m;I<y;I++)for(let k=u;k<d;k++)this.data[this._idx(k,I)]=e.data[this._idx(k+w,I+M)]}}function xv(i,e){const r=e[0],s=e[1],u=e[2],d=e[3],m=Math.min(r,s,u),y=Math.round((i+d)/m);return{r:Math.floor(y*m/r)%256,g:Math.floor(y*m/s)%256,b:Math.floor(y*m/u)%256}}wt("DEMData",vv);class vP extends Bi{constructor(e,r){super(e,yP,r)}_createColorRamp(e){const r={elevationStops:[],colorStops:[]},s=this._transitionablePaint._values["color-relief-color"].value.expression;if(s instanceof Ic&&s._styleExpression.expression instanceof fi){this.colorRampExpression=s;const m=s._styleExpression.expression;r.elevationStops=m.labels,r.colorStops=[];for(const y of r.elevationStops)r.colorStops.push(m.evaluate({globals:{elevation:y}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[on.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=e)return r;const u={elevationStops:[],colorStops:[]},d=(r.elevationStops.length-1)/(e-1);for(let m=0;m<r.elevationStops.length-.5;m+=d)u.elevationStops.push(r.elevationStops[Math.round(m)]),u.colorStops.push(r.colorStops[Math.round(m)]);return Nt(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${r.elevationStops.length}`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,r,s){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(r),d=new Si({width:u.colorStops.length,height:1}),m=new Si({width:u.colorStops.length,height:1});for(let y=0;y<u.elevationStops.length;y++){const w=xv(u.elevationStops[y],s);m.setPixel(0,y,new on(w.r/255,w.g/255,w.b/255,1)),d.setPixel(0,y,u.colorStops[y])}return this.colorRampTextures={elevationTexture:new jg(e,m,e.gl.RGBA),colorTexture:new jg(e,d,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const xP=dr([{name:"a_pos",components:2,type:"Int16"}],4),{members:bP}=xP;function ap(i,e,r){const s=r.patternDependencies;let u=!1;for(const d of e){const m=d.paint.get(`${i}-pattern`);m.isConstant()||(u=!0);const y=m.constantOr(null);y&&(u=!0,s[y.to]=!0,s[y.from]=!0)}return u}function Ug(i,e,r,s,u){const{zoom:d}=s,m=u.patternDependencies;for(const y of e){const w=y.paint.get(`${i}-pattern`).value;if(w.kind!=="constant"){let M=w.evaluate({zoom:d-1},r,{},u.availableImages),I=w.evaluate({zoom:d},r,{},u.availableImages),k=w.evaluate({zoom:d+1},r,{},u.availableImages);M=M&&M.name?M.name:M,I=I&&I.name?I.name:I,k=k&&k.name?k.name:k,m[M]=!0,m[I]=!0,m[k]=!0,r.patterns[y.id]={min:M,mid:I,max:k}}}return r}function bv(i,e,r,s,u){let d;if(u===(function(m,y,w,M){let I=0;for(let k=y,L=w-M;k<w;k+=M)I+=(m[L]-m[k])*(m[k+1]+m[L+1]),L=k;return I})(i,e,r,s)>0)for(let m=e;m<r;m+=s)d=Mv(m/s|0,i[m],i[m+1],d);else for(let m=r-s;m>=e;m-=s)d=Mv(m/s|0,i[m],i[m+1],d);return d&&Qc(d,d.next)&&(Uh(d),d=d.next),d}function Rl(i,e){if(!i)return i;e||(e=i);let r,s=i;do if(r=!1,s.steiner||!Qc(s,s.next)&&yr(s.prev,s,s.next)!==0)s=s.next;else{if(Uh(s),s=e=s.prev,s===s.next)break;r=!0}while(r||s!==e);return e}function Nh(i,e,r,s,u,d,m){if(!i)return;!m&&d&&(function(w,M,I,k){let L=w;do L.z===0&&(L.z=qg(L.x,L.y,M,I,k)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==w);L.prevZ.nextZ=null,L.prevZ=null,(function(F){let j,q=1;do{let Z,Y=F;F=null;let fe=null;for(j=0;Y;){j++;let J=Y,ne=0;for(let we=0;we<q&&(ne++,J=J.nextZ,J);we++);let ge=q;for(;ne>0||ge>0&&J;)ne!==0&&(ge===0||!J||Y.z<=J.z)?(Z=Y,Y=Y.nextZ,ne--):(Z=J,J=J.nextZ,ge--),fe?fe.nextZ=Z:F=Z,Z.prevZ=fe,fe=Z;Y=J}fe.nextZ=null,q*=2}while(j>1)})(L)})(i,s,u,d);let y=i;for(;i.prev!==i.next;){const w=i.prev,M=i.next;if(d?TP(i,s,u,d):wP(i))e.push(w.i,i.i,M.i),Uh(i),i=M.next,y=M.next;else if((i=M)===y){m?m===1?Nh(i=SP(Rl(i),e),e,r,s,u,d,2):m===2&&MP(i,e,r,s,u,d):Nh(Rl(i),e,r,s,u,d,1);break}}}function wP(i){const e=i.prev,r=i,s=i.next;if(yr(e,r,s)>=0)return!1;const u=e.x,d=r.x,m=s.x,y=e.y,w=r.y,M=s.y,I=Math.min(u,d,m),k=Math.min(y,w,M),L=Math.max(u,d,m),F=Math.max(y,w,M);let j=s.next;for(;j!==e;){if(j.x>=I&&j.x<=L&&j.y>=k&&j.y<=F&&Vh(u,y,d,w,m,M,j.x,j.y)&&yr(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function TP(i,e,r,s){const u=i.prev,d=i,m=i.next;if(yr(u,d,m)>=0)return!1;const y=u.x,w=d.x,M=m.x,I=u.y,k=d.y,L=m.y,F=Math.min(y,w,M),j=Math.min(I,k,L),q=Math.max(y,w,M),Z=Math.max(I,k,L),Y=qg(F,j,e,r,s),fe=qg(q,Z,e,r,s);let J=i.prevZ,ne=i.nextZ;for(;J&&J.z>=Y&&ne&&ne.z<=fe;){if(J.x>=F&&J.x<=q&&J.y>=j&&J.y<=Z&&J!==u&&J!==m&&Vh(y,I,w,k,M,L,J.x,J.y)&&yr(J.prev,J,J.next)>=0||(J=J.prevZ,ne.x>=F&&ne.x<=q&&ne.y>=j&&ne.y<=Z&&ne!==u&&ne!==m&&Vh(y,I,w,k,M,L,ne.x,ne.y)&&yr(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;J&&J.z>=Y;){if(J.x>=F&&J.x<=q&&J.y>=j&&J.y<=Z&&J!==u&&J!==m&&Vh(y,I,w,k,M,L,J.x,J.y)&&yr(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;ne&&ne.z<=fe;){if(ne.x>=F&&ne.x<=q&&ne.y>=j&&ne.y<=Z&&ne!==u&&ne!==m&&Vh(y,I,w,k,M,L,ne.x,ne.y)&&yr(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function SP(i,e){let r=i;do{const s=r.prev,u=r.next.next;!Qc(s,u)&&Tv(s,r,r.next,u)&&jh(s,u)&&jh(u,s)&&(e.push(s.i,r.i,u.i),Uh(r),Uh(r.next),r=i=u),r=r.next}while(r!==i);return Rl(r)}function MP(i,e,r,s,u,d){let m=i;do{let y=m.next.next;for(;y!==m.prev;){if(m.i!==y.i&&AP(m,y)){let w=Sv(m,y);return m=Rl(m,m.next),w=Rl(w,w.next),Nh(m,e,r,s,u,d,0),void Nh(w,e,r,s,u,d,0)}y=y.next}m=m.next}while(m!==i)}function PP(i,e){let r=i.x-e.x;return r===0&&(r=i.y-e.y,r===0)&&(r=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function EP(i,e){const r=(function(u,d){let m=d;const y=u.x,w=u.y;let M,I=-1/0;if(Qc(u,m))return m;do{if(Qc(u,m.next))return m.next;if(w<=m.y&&w>=m.next.y&&m.next.y!==m.y){const q=m.x+(w-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(q<=y&&q>I&&(I=q,M=m.x<m.next.x?m:m.next,q===y))return M}m=m.next}while(m!==d);if(!M)return null;const k=M,L=M.x,F=M.y;let j=1/0;m=M;do{if(y>=m.x&&m.x>=L&&y!==m.x&&wv(w<F?y:I,w,L,F,w<F?I:y,w,m.x,m.y)){const q=Math.abs(w-m.y)/(y-m.x);jh(m,u)&&(q<j||q===j&&(m.x>M.x||m.x===M.x&&CP(M,m)))&&(M=m,j=q)}m=m.next}while(m!==k);return M})(i,e);if(!r)return e;const s=Sv(r,i);return Rl(s,s.next),Rl(r,r.next)}function CP(i,e){return yr(i.prev,i,e.prev)<0&&yr(e.next,i,i.next)<0}function qg(i,e,r,s,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function IP(i){let e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function wv(i,e,r,s,u,d,m,y){return(u-m)*(e-y)>=(i-m)*(d-y)&&(i-m)*(s-y)>=(r-m)*(e-y)&&(r-m)*(d-y)>=(u-m)*(s-y)}function Vh(i,e,r,s,u,d,m,y){return!(i===m&&e===y)&&wv(i,e,r,s,u,d,m,y)}function AP(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!(function(r,s){let u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==s.i&&u.next.i!==s.i&&Tv(u,u.next,r,s))return!0;u=u.next}while(u!==r);return!1})(i,e)&&(jh(i,e)&&jh(e,i)&&(function(r,s){let u=r,d=!1;const m=(r.x+s.x)/2,y=(r.y+s.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&m<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(d=!d),u=u.next;while(u!==r);return d})(i,e)&&(yr(i.prev,i,e.prev)||yr(i,e.prev,e))||Qc(i,e)&&yr(i.prev,i,i.next)>0&&yr(e.prev,e,e.next)>0)}function yr(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Qc(i,e){return i.x===e.x&&i.y===e.y}function Tv(i,e,r,s){const u=sp(yr(i,e,r)),d=sp(yr(i,e,s)),m=sp(yr(r,s,i)),y=sp(yr(r,s,e));return u!==d&&m!==y||!(u!==0||!op(i,r,e))||!(d!==0||!op(i,s,e))||!(m!==0||!op(r,i,s))||!(y!==0||!op(r,e,s))}function op(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function sp(i){return i>0?1:i<0?-1:0}function jh(i,e){return yr(i.prev,i,i.next)<0?yr(i,e,i.next)>=0&&yr(i,i.prev,e)>=0:yr(i,e,i.prev)<0||yr(i,i.next,e)<0}function Sv(i,e){const r=Gg(i.i,i.x,i.y),s=Gg(e.i,e.x,e.y),u=i.next,d=e.prev;return i.next=e,e.prev=i,r.next=u,u.prev=r,s.next=r,r.prev=s,d.next=s,s.prev=d,s}function Mv(i,e,r,s){const u=Gg(i,e,r);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function Uh(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Gg(i,e,r){return{i,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class eu{constructor(e,r){if(r>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=r}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class lp{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}lp.noSubdivision=new lp({fill:new eu(0,0),line:new eu(0,0),tile:new eu(0,0),stencil:new eu(0,0),circle:1}),wt("SubdivisionGranularityExpression",eu),wt("SubdivisionGranularitySetting",lp);const tu=-32768,qh=32767;class kP{constructor(e,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=at/e,this._canonical=r}_getKey(e,r){return(e+=32768)<<16|r+32768}_vertexToIndex(e,r){if(e<-32768||r<-32768||e>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const s=0|Math.round(e),u=0|Math.round(r),d=this._getKey(s,u);if(this._vertexDictionary.has(d))return this._vertexDictionary.get(d);const m=this._vertexBuffer.length/2;return this._vertexDictionary.set(d,m),this._vertexBuffer.push(s,u),m}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(u,d){const m=[];for(let y=0;y<d.length;y+=3){const w=d[y],M=d[y+1],I=d[y+2],k=u[2*w],L=u[2*w+1];(u[2*M]-k)*(u[2*I+1]-L)-(u[2*M+1]-L)*(u[2*I]-k)>0?(m.push(w),m.push(I),m.push(M)):(m.push(w),m.push(M),m.push(I))}return m})(this._vertexBuffer,e);const r=[],s=e.length;for(let u=0;u<s;u+=3){const d=[e[u+0],e[u+1],e[u+2]],m=[this._vertexBuffer[2*e[u+0]+0],this._vertexBuffer[2*e[u+0]+1],this._vertexBuffer[2*e[u+1]+0],this._vertexBuffer[2*e[u+1]+1],this._vertexBuffer[2*e[u+2]+0],this._vertexBuffer[2*e[u+2]+1]];let y=1/0,w=1/0,M=-1/0,I=-1/0;for(let q=0;q<3;q++){const Z=m[2*q],Y=m[2*q+1];y=Math.min(y,Z),M=Math.max(M,Z),w=Math.min(w,Y),I=Math.max(I,Y)}if(y===M||w===I)continue;const k=Math.floor(y/this._granularityCellSize),L=Math.ceil(M/this._granularityCellSize),F=Math.floor(w/this._granularityCellSize),j=Math.ceil(I/this._granularityCellSize);if(k!==L||F!==j)for(let q=F;q<j;q++){const Z=this._scanlineGenerateVertexRingForCellRow(q,m,d);DP(this._vertexBuffer,Z,r)}else r.push(...d)}return r}_scanlineGenerateVertexRingForCellRow(e,r,s){const u=e*this._granularityCellSize,d=u+this._granularityCellSize,m=[];for(let y=0;y<3;y++){const w=r[2*y],M=r[2*y+1],I=r[2*(y+1)%6],k=r[(2*(y+1)+1)%6],L=r[2*(y+2)%6],F=r[(2*(y+2)+1)%6],j=I-w,q=k-M,Z=j===0,Y=q===0,fe=(u-M)/q,J=(d-M)/q,ne=Math.min(fe,J),ge=Math.max(fe,J);if(!Y&&(ne>=1||ge<=0)||Y&&(M<u||M>d)){k>=u&&k<=d&&m.push(s[(y+1)%3]);continue}!Y&&ne>0&&m.push(this._vertexToIndex(w+j*ne,M+q*ne));const we=w+j*Math.max(ne,0),De=w+j*Math.min(ge,1);Z||this._generateIntraEdgeVertices(m,w,M,I,k,we,De),!Y&&ge<1&&m.push(this._vertexToIndex(w+j*ge,M+q*ge)),(Y||k>=u&&k<=d)&&m.push(s[(y+1)%3]),!Y&&(k<=u||k>=d)&&this._generateInterEdgeVertices(m,w,M,I,k,L,F,De,u,d)}return m}_generateIntraEdgeVertices(e,r,s,u,d,m,y){const w=u-r,M=d-s,I=M===0,k=I?Math.min(r,u):Math.min(m,y),L=I?Math.max(r,u):Math.max(m,y),F=Math.floor(k/this._granularityCellSize)+1,j=Math.ceil(L/this._granularityCellSize)-1;if(I?r<u:m<y)for(let q=F;q<=j;q++){const Z=q*this._granularityCellSize;e.push(this._vertexToIndex(Z,s+M*(Z-r)/w))}else for(let q=j;q>=F;q--){const Z=q*this._granularityCellSize;e.push(this._vertexToIndex(Z,s+M*(Z-r)/w))}}_generateInterEdgeVertices(e,r,s,u,d,m,y,w,M,I){const k=d-s,L=m-u,F=y-d,j=(M-d)/F,q=(I-d)/F,Z=Math.min(j,q),Y=Math.max(j,q),fe=u+L*Z;let J=Math.floor(Math.min(fe,w)/this._granularityCellSize)+1,ne=Math.ceil(Math.max(fe,w)/this._granularityCellSize)-1,ge=w<fe;const we=F===0;if(we&&(y===M||y===I))return;if(we||Z>=1||Y<=0){const Ke=s-y,Ge=m+(r-m)*Math.min((M-y)/Ke,(I-y)/Ke);J=Math.floor(Math.min(Ge,w)/this._granularityCellSize)+1,ne=Math.ceil(Math.max(Ge,w)/this._granularityCellSize)-1,ge=w<Ge}const De=k>0?I:M;if(ge)for(let Ke=J;Ke<=ne;Ke++)e.push(this._vertexToIndex(Ke*this._granularityCellSize,De));else for(let Ke=ne;Ke>=J;Ke--)e.push(this._vertexToIndex(Ke*this._granularityCellSize,De))}_generateOutline(e){const r=[];for(const s of e){const u=Ll(s,this._granularity,!0),d=this._pointArrayToIndices(u),m=[];for(let y=1;y<d.length;y++)m.push(d[y-1]),m.push(d[y]);r.push(m)}return r}_handlePoles(e){let r=!1,s=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(s=!0)),(r||s)&&this._fillPoles(e,r,s)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let r=0;r<e.length;r+=2){const s=e[r+1];s===tu&&(e[r+1]=-32767),s===qh&&(e[r+1]=32766)}}_generatePoleQuad(e,r,s,u,d,m){u>d!=(m===tu)?(e.push(r),e.push(s),e.push(this._vertexToIndex(u,m)),e.push(s),e.push(this._vertexToIndex(d,m)),e.push(this._vertexToIndex(u,m))):(e.push(s),e.push(r),e.push(this._vertexToIndex(u,m)),e.push(this._vertexToIndex(d,m)),e.push(s),e.push(this._vertexToIndex(u,m)))}_fillPoles(e,r,s){const u=this._vertexBuffer,d=at,m=e.length;for(let y=2;y<m;y+=3){const w=e[y-2],M=e[y-1],I=e[y],k=u[2*w],L=u[2*w+1],F=u[2*M],j=u[2*M+1],q=u[2*I],Z=u[2*I+1];r&&(L===0&&j===0&&this._generatePoleQuad(e,w,M,k,F,tu),j===0&&Z===0&&this._generatePoleQuad(e,M,I,F,q,tu),Z===0&&L===0&&this._generatePoleQuad(e,I,w,q,k,tu)),s&&(L===d&&j===d&&this._generatePoleQuad(e,w,M,k,F,qh),j===d&&Z===d&&this._generatePoleQuad(e,M,I,F,q,qh),Z===d&&L===d&&this._generatePoleQuad(e,I,w,q,k,qh))}}_initializeVertices(e){for(let r=0;r<e.length;r+=2)this._vertexToIndex(e[r],e[r+1])}subdividePolygonInternal(e,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:s,holeIndices:u}=(function(y){const w=[],M=[];for(const I of y)if(I.length!==0){I!==y[0]&&w.push(M.length/2);for(let k=0;k<I.length;k++)M.push(I[k].x),M.push(I[k].y)}return{flattened:M,holeIndices:w}})(e);let d;this._initializeVertices(s);try{const y=(function(M,I,k=2){const L=I&&I.length,F=L?I[0]*k:M.length;let j=bv(M,0,F,k,!0);const q=[];if(!j||j.next===j.prev)return q;let Z,Y,fe;if(L&&(j=(function(J,ne,ge,we){const De=[];for(let Ke=0,Ge=ne.length;Ke<Ge;Ke++){const tt=bv(J,ne[Ke]*we,Ke<Ge-1?ne[Ke+1]*we:J.length,we,!1);tt===tt.next&&(tt.steiner=!0),De.push(IP(tt))}De.sort(PP);for(let Ke=0;Ke<De.length;Ke++)ge=EP(De[Ke],ge);return ge})(M,I,j,k)),M.length>80*k){Z=M[0],Y=M[1];let J=Z,ne=Y;for(let ge=k;ge<F;ge+=k){const we=M[ge],De=M[ge+1];we<Z&&(Z=we),De<Y&&(Y=De),we>J&&(J=we),De>ne&&(ne=De)}fe=Math.max(J-Z,ne-Y),fe=fe!==0?32767/fe:0}return Nh(j,q,k,Z,Y,fe,0),q})(s,u),w=this._convertIndices(s,y);d=this._subdivideTrianglesScanline(w)}catch(y){console.error(y)}let m=[];return r&&(m=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(d),{verticesFlattened:this._vertexBuffer,indicesTriangles:d,indicesLineList:m}}_convertIndices(e,r){const s=[];for(let u=0;u<r.length;u++)s.push(this._vertexToIndex(e[2*r[u]],e[2*r[u]+1]));return s}_pointArrayToIndices(e){const r=[];for(let s=0;s<e.length;s++){const u=e[s];r.push(this._vertexToIndex(u.x,u.y))}return r}}function Pv(i,e,r,s=!0){return new kP(r,e).subdividePolygonInternal(i,s)}function Ll(i,e,r=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const s=i[0],u=i[i.length-1],d=r&&(s.x!==u.x||s.y!==u.y);if(e<2)return d?[...i,i[0]]:[...i];const m=Math.floor(at/e),y=[];y.push(new C(i[0].x,i[0].y));const w=i.length,M=d?w:w-1;for(let I=0;I<M;I++){const k=i[I],L=I<w-1?i[I+1]:i[0],F=k.x,j=k.y,q=L.x,Z=L.y,Y=F!==q,fe=j!==Z;if(!Y&&!fe)continue;const J=q-F,ne=Z-j,ge=Math.abs(J),we=Math.abs(ne);let De=F,Ke=j;for(;;){const tt=J>0?(Math.floor(De/m)+1)*m:(Math.ceil(De/m)-1)*m,ht=ne>0?(Math.floor(Ke/m)+1)*m:(Math.ceil(Ke/m)-1)*m,it=Math.abs(De-tt),He=Math.abs(Ke-ht),Ne=Math.abs(De-q),bt=Math.abs(Ke-Z),yt=Y?it/ge:Number.POSITIVE_INFINITY,St=fe?He/we:Number.POSITIVE_INFINITY;if((Ne<=it||!Y)&&(bt<=He||!fe))break;if(yt<St&&Y||!fe){De=tt,Ke+=ne*yt;const mt=new C(De,Math.round(Ke));y[y.length-1].x===mt.x&&y[y.length-1].y===mt.y||y.push(mt)}else{De+=J*St,Ke=ht;const mt=new C(Math.round(De),Ke);y[y.length-1].x===mt.x&&y[y.length-1].y===mt.y||y.push(mt)}}const Ge=new C(q,Z);y[y.length-1].x===Ge.x&&y[y.length-1].y===Ge.y||y.push(Ge)}return y}function DP(i,e,r){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let s=0,u=i[2*e[0]];for(let w=1;w<e.length;w++){const M=i[2*e[w]];M<u&&(u=M,s=w)}const d=e.length;let m=s,y=(m+1)%d;for(;;){const w=m-1>=0?m-1:d-1,M=(y+1)%d,I=i[2*e[w]],k=i[2*e[M]],L=i[2*e[m]],F=i[2*e[m]+1],j=i[2*e[y]+1];let q=!1;if(I<k)q=!0;else if(I>k)q=!1;else{const Z=j-F,Y=-(i[2*e[y]]-L),fe=F<j?1:-1;((I-L)*Z+(i[2*e[w]+1]-F)*Y)*fe>((k-L)*Z+(i[2*e[M]+1]-F)*Y)*fe&&(q=!0)}if(q){const Z=e[w],Y=e[m],fe=e[y];Z!==Y&&Z!==fe&&Y!==fe&&r.push(fe,Y,Z),m--,m<0&&(m=d-1)}else{const Z=e[M],Y=e[m],fe=e[y];Z!==Y&&Z!==fe&&Y!==fe&&r.push(fe,Y,Z),y++,y>=d&&(y=0)}if(w===M)break}}function Ev(i,e,r,s,u,d,m,y,w){const M=u.length/2,I=m&&y&&w;if(M<dt.MAX_VERTEX_ARRAY_LENGTH){const k=e.prepareSegment(M,r,s),L=k.vertexLength;for(let q=0;q<d.length;q+=3)s.emplaceBack(L+d[q],L+d[q+1],L+d[q+2]);let F,j;k.vertexLength+=M,k.primitiveLength+=d.length/3,I&&(j=m.prepareSegment(M,r,y),F=j.vertexLength,j.vertexLength+=M);for(let q=0;q<u.length;q+=2)i(u[q],u[q+1]);if(I)for(let q=0;q<w.length;q++){const Z=w[q];for(let Y=1;Y<Z.length;Y+=2)y.emplaceBack(F+Z[Y-1],F+Z[Y]);j.primitiveLength+=Z.length/2}}else(function(k,L,F,j,q,Z){const Y=[];for(let we=0;we<j.length/2;we++)Y.push(-1);const fe={count:0};let J=0,ne=k.getOrCreateLatestSegment(L,F),ge=ne.vertexLength;for(let we=2;we<q.length;we+=3){const De=q[we-2],Ke=q[we-1],Ge=q[we];let tt=Y[De]<J,ht=Y[Ke]<J,it=Y[Ge]<J;ne.vertexLength+((tt?1:0)+(ht?1:0)+(it?1:0))>dt.MAX_VERTEX_ARRAY_LENGTH&&(ne=k.createNewSegment(L,F),J=fe.count,tt=!0,ht=!0,it=!0,ge=0);const He=Gh(Y,j,Z,fe,De,tt,ne),Ne=Gh(Y,j,Z,fe,Ke,ht,ne),bt=Gh(Y,j,Z,fe,Ge,it,ne);F.emplaceBack(ge+He-J,ge+Ne-J,ge+bt-J),ne.primitiveLength++}})(e,r,s,u,d,i),I&&(function(k,L,F,j,q,Z){const Y=[];for(let we=0;we<j.length/2;we++)Y.push(-1);const fe={count:0};let J=0,ne=k.getOrCreateLatestSegment(L,F),ge=ne.vertexLength;for(let we=0;we<q.length;we++){const De=q[we];for(let Ke=1;Ke<q[we].length;Ke+=2){const Ge=De[Ke-1],tt=De[Ke];let ht=Y[Ge]<J,it=Y[tt]<J;ne.vertexLength+((ht?1:0)+(it?1:0))>dt.MAX_VERTEX_ARRAY_LENGTH&&(ne=k.createNewSegment(L,F),J=fe.count,ht=!0,it=!0,ge=0);const He=Gh(Y,j,Z,fe,Ge,ht,ne),Ne=Gh(Y,j,Z,fe,tt,it,ne);F.emplaceBack(ge+He-J,ge+Ne-J),ne.primitiveLength++}}})(m,r,y,u,w,i),e.forceNewSegmentOnNextPrepare(),m?.forceNewSegmentOnNextPrepare()}function Gh(i,e,r,s,u,d,m){if(d){const y=s.count;return r(e[2*u],e[2*u+1]),i[u]=s.count,s.count++,m.vertexLength++,y}return i[u]}class $g{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new ie,this.indexArray=new Oe,this.indexArray2=new lt,this.programConfigurations=new ko(e.layers,e.zoom),this.segments=new dt,this.segments2=new dt,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,s){this.hasDependencies=ap("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),d=!u.isConstant(),m=[];for(const{feature:y,id:w,index:M,sourceLayerIndex:I}of e){const k=this.layers[0]._featureFilter.needGeometry,L=Ka(y,k);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom),L,s))continue;const F=d?u.evaluate(L,{},s,r.availableImages):void 0,j={id:w,properties:y.properties,type:y.type,sourceLayerIndex:I,index:M,geometry:k?L.geometry:Ya(y),patterns:{},sortKey:F};m.push(j)}d&&m.sort(((y,w)=>y.sortKey-w.sortKey));for(const y of m){const{geometry:w,index:M,sourceLayerIndex:I}=y;if(this.hasDependencies){const k=Ug("fill",this.layers,y,{zoom:this.zoom},r);this.patternFeatures.push(k)}else this.addFeature(y,w,M,s,{},r.subdivisionGranularity);r.featureIndex.insert(e[M].feature,w,M,I,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:s})}addFeatures(e,r,s){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,s,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,u,d,m){for(const y of yc(r,500)){const w=Pv(y,u,m.fill.getGranularityForZoomLevel(u.z)),M=this.layoutVertexArray;Ev(((I,k)=>{M.emplaceBack(I,k)}),this.segments,this.layoutVertexArray,this.indexArray,w.verticesFlattened,w.indicesTriangles,this.segments2,this.indexArray2,w.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{imagePositions:d,canonical:u})}}let Cv,Iv;wt("FillBucket",$g,{omit:["layers","patternFeatures"]});var zP={get paint(){return Iv=Iv||new di({"fill-antialias":new Dt(Fe.paint_fill["fill-antialias"]),"fill-opacity":new Ot(Fe.paint_fill["fill-opacity"]),"fill-color":new Ot(Fe.paint_fill["fill-color"]),"fill-outline-color":new Ot(Fe.paint_fill["fill-outline-color"]),"fill-translate":new Dt(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new Dt(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Pl(Fe.paint_fill["fill-pattern"])})},get layout(){return Cv=Cv||new di({"fill-sort-key":new Ot(Fe.layout_fill["fill-sort-key"])})}};class RP extends Bi{constructor(e,r){super(e,zP,r)}recalculate(e,r){super.recalculate(e,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new $g(e)}queryRadius(){return rp(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:r,transform:s,pixelsToTileUnits:u}){return sv(ip(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-s.bearingInRadians,u),r)}isTileClipped(){return!0}}const LP=dr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),FP=dr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:BP}=LP;class $h{constructor(e,r,s,u,d){this.properties={},this.extent=s,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=d,e.readFields(OP,this,r)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos,s=[];let u,d=1,m=0,y=0,w=0;for(;e.pos<r;){if(m<=0){const M=e.readVarint();d=7&M,m=M>>3}if(m--,d===1||d===2)y+=e.readSVarint(),w+=e.readSVarint(),d===1&&(u&&s.push(u),u=[]),u&&u.push(new C(y,w));else{if(d!==7)throw new Error(`unknown command ${d}`);u&&u.push(u[0].clone())}}return u&&s.push(u),s}bbox(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos;let s=1,u=0,d=0,m=0,y=1/0,w=-1/0,M=1/0,I=-1/0;for(;e.pos<r;){if(u<=0){const k=e.readVarint();s=7&k,u=k>>3}if(u--,s===1||s===2)d+=e.readSVarint(),m+=e.readSVarint(),d<y&&(y=d),d>w&&(w=d),m<M&&(M=m),m>I&&(I=m);else if(s!==7)throw new Error(`unknown command ${s}`)}return[y,M,w,I]}toGeoJSON(e,r,s){const u=this.extent*Math.pow(2,s),d=this.extent*e,m=this.extent*r,y=this.loadGeometry();function w(L){return[360*(L.x+d)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(L.y+m)/u)*Math.PI))-90]}function M(L){return L.map(w)}let I;if(this.type===1){const L=[];for(const j of y)L.push(j[0]);const F=M(L);I=L.length===1?{type:"Point",coordinates:F[0]}:{type:"MultiPoint",coordinates:F}}else if(this.type===2){const L=y.map(M);I=L.length===1?{type:"LineString",coordinates:L[0]}:{type:"MultiLineString",coordinates:L}}else{if(this.type!==3)throw new Error("unknown feature type");{const L=Av(y),F=[];for(const j of L)F.push(j.map(M));I=F.length===1?{type:"Polygon",coordinates:F[0]}:{type:"MultiPolygon",coordinates:F}}}const k={type:"Feature",geometry:I,properties:this.properties};return this.id!=null&&(k.id=this.id),k}}function OP(i,e,r){i===1?e.id=r.readVarint():i===2?(function(s,u){const d=s.readVarint()+s.pos;for(;s.pos<d;){const m=u._keys[s.readVarint()],y=u._values[s.readVarint()];u.properties[m]=y}})(r,e):i===3?e.type=r.readVarint():i===4&&(e._geometry=r.pos)}function Av(i){const e=i.length;if(e<=1)return[i];const r=[];let s,u;for(let d=0;d<e;d++){const m=NP(i[d]);m!==0&&(u===void 0&&(u=m<0),u===m<0?(s&&r.push(s),s=[i[d]]):s&&s.push(i[d]))}return s&&r.push(s),r}function NP(i){let e=0;for(let r,s,u=0,d=i.length,m=d-1;u<d;m=u++)r=i[u],s=i[m],e+=(s.x-r.x)*(r.y+s.y);return e}$h.types=["Unknown","Point","LineString","Polygon"];class VP{constructor(e,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(jP,this,r),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const r=this._pbf.readVarint()+this._pbf.pos;return new $h(this._pbf,r,this.extent,this._keys,this._values)}}function jP(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push((function(s){let u=null;const d=s.readVarint()+s.pos;for(;s.pos<d;){const m=s.readVarint()>>3;u=m===1?s.readString():m===2?s.readFloat():m===3?s.readDouble():m===4?s.readVarint64():m===5?s.readVarint():m===6?s.readSVarint():m===7?s.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(r))}class kv{constructor(e,r){this.layers=e.readFields(UP,{},r)}}function UP(i,e,r){if(i===3){const s=new VP(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}const Zg=Math.pow(2,13);function Zh(i,e,r,s,u,d,m,y){i.emplaceBack(e,r,2*Math.floor(s*Zg)+m,u*Zg*2,d*Zg*2,Math.round(y))}class Wg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new pe,this.centroidVertexArray=new re,this.indexArray=new Oe,this.programConfigurations=new ko(e.layers,e.zoom),this.segments=new dt,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,s){this.features=[],this.hasDependencies=ap("fill-extrusion",this.layers,r);for(const{feature:u,id:d,index:m,sourceLayerIndex:y}of e){const w=this.layers[0]._featureFilter.needGeometry,M=Ka(u,w);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom),M,s))continue;const I={id:d,sourceLayerIndex:y,index:m,geometry:w?M.geometry:Ya(u),properties:u.properties,type:u.type,patterns:{}};this.hasDependencies?this.features.push(Ug("fill-extrusion",this.layers,I,{zoom:this.zoom},r)):this.addFeature(I,I.geometry,m,s,{},r.subdivisionGranularity),r.featureIndex.insert(u,I.geometry,m,y,this.index,!0)}}addFeatures(e,r,s){for(const u of this.features){const{geometry:d}=u;this.addFeature(u,d,u.index,r,s,e.subdivisionGranularity)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:s})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,BP),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,FP.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,s,u,d,m){for(const y of yc(r,500)){const w={x:0,y:0,sampleCount:0},M=this.layoutVertexArray.length;this.processPolygon(w,u,e,y,m);const I=this.layoutVertexArray.length-M,k=Math.floor(w.x/w.sampleCount),L=Math.floor(w.y/w.sampleCount);for(let F=0;F<I;F++)this.centroidVertexArray.emplaceBack(k,L)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{imagePositions:d,canonical:u})}processPolygon(e,r,s,u,d){if(u.length<1||Dv(u[0]))return;for(const k of u)k.length!==0&&qP(e,k);const m={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},y=d.fill.getGranularityForZoomLevel(r.z),w=$h.types[s.type]==="Polygon";for(const k of u){if(k.length===0||Dv(k))continue;const L=Ll(k,y,w);this._generateSideFaces(L,m)}if(!w)return;const M=Pv(u,r,y,!1),I=this.layoutVertexArray;Ev(((k,L)=>{Zh(I,k,L,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles)}_generateSideFaces(e,r){let s=0;for(let u=1;u<e.length;u++){const d=e[u],m=e[u-1];if(GP(d,m))continue;r.segment.vertexLength+4>dt.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const y=d.sub(m)._perp()._unit(),w=m.dist(d);s+w>32768&&(s=0),Zh(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,0,s),Zh(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,1,s),s+=w,Zh(this.layoutVertexArray,m.x,m.y,y.x,y.y,0,0,s),Zh(this.layoutVertexArray,m.x,m.y,y.x,y.y,0,1,s);const M=r.segment.vertexLength;this.indexArray.emplaceBack(M,M+2,M+1),this.indexArray.emplaceBack(M+1,M+2,M+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function qP(i,e){for(let r=0;r<e.length;r++){const s=e[r];r===e.length-1&&e[0].x===s.x&&e[0].y===s.y||(i.x+=s.x,i.y+=s.y,i.sampleCount++)}}function GP(i,e){return i.x===e.x&&(i.x<0||i.x>at)||i.y===e.y&&(i.y<0||i.y>at)}function Dv(i){return i.every((e=>e.x<0))||i.every((e=>e.x>at))||i.every((e=>e.y<0))||i.every((e=>e.y>at))}let zv;wt("FillExtrusionBucket",Wg,{omit:["layers","features"]});var $P={get paint(){return zv=zv||new di({"fill-extrusion-opacity":new Dt(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ot(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Dt(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Dt(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Pl(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ot(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ot(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Dt(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class ZP extends Bi{constructor(e,r){super(e,$P,r)}createBucket(e){return new Wg(e)}queryRadius(){return rp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:s,geometry:u,transform:d,pixelsToTileUnits:m,pixelPosMatrix:y}){const w=ip(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-d.bearingInRadians,m),M=this.paint.get("fill-extrusion-height").evaluate(r,s),I=this.paint.get("fill-extrusion-base").evaluate(r,s),k=(function(F,j){const q=[];for(const Z of F){const Y=[Z.x,Z.y,0,1];et(Y,Y,j),q.push(new C(Y[0]/Y[3],Y[1]/Y[3]))}return q})(w,y),L=(function(F,j,q,Z){const Y=[],fe=[],J=Z[8]*j,ne=Z[9]*j,ge=Z[10]*j,we=Z[11]*j,De=Z[8]*q,Ke=Z[9]*q,Ge=Z[10]*q,tt=Z[11]*q;for(const ht of F){const it=[],He=[];for(const Ne of ht){const bt=Ne.x,yt=Ne.y,St=Z[0]*bt+Z[4]*yt+Z[12],mt=Z[1]*bt+Z[5]*yt+Z[13],Lt=Z[2]*bt+Z[6]*yt+Z[14],Tn=Z[3]*bt+Z[7]*yt+Z[15],ln=Lt+ge,Kn=Tn+we,Qr=St+De,wr=mt+Ke,Jn=Lt+Ge,Wn=Tn+tt,En=new C((St+J)/Kn,(mt+ne)/Kn);En.z=ln/Kn,it.push(En);const cr=new C(Qr/Wn,wr/Wn);cr.z=Jn/Wn,He.push(cr)}Y.push(it),fe.push(He)}return[Y,fe]})(u,I,M,y);return(function(F,j,q){let Z=1/0;sv(q,j)&&(Z=Rv(q,j[0]));for(let Y=0;Y<j.length;Y++){const fe=j[Y],J=F[Y];for(let ne=0;ne<fe.length-1;ne++){const ge=fe[ne],we=[ge,fe[ne+1],J[ne+1],J[ne],ge];Yc(q,we)&&(Z=Math.min(Z,Rv(q,we)))}}return Z!==1/0&&Z})(L[0],L[1],k)}}function Wh(i,e){return i.x*e.x+i.y*e.y}function Rv(i,e){if(i.length===1){let r=0;const s=e[r++];let u;for(;!u||s.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const d=e[r],m=i[0],y=u.sub(s),w=d.sub(s),M=m.sub(s),I=Wh(y,y),k=Wh(y,w),L=Wh(w,w),F=Wh(M,y),j=Wh(M,w),q=I*L-k*k,Z=(L*F-k*j)/q,Y=(I*j-k*F)/q,fe=s.z*(1-Z-Y)+u.z*Z+d.z*Y;if(isFinite(fe))return fe}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}const WP=dr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:HP}=WP,XP=dr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:YP}=XP,KP=Math.cos(Math.PI/180*37.5),Lv=Math.pow(2,14)/.5;class Hg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new Te,this.layoutVertexArray2=new he,this.indexArray=new Oe,this.programConfigurations=new ko(e.layers,e.zoom),this.segments=new dt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,s){this.hasDependencies=ap("line",this.layers,r)||this.hasLineDasharray(this.layers);const u=this.layers[0].layout.get("line-sort-key"),d=!u.isConstant(),m=[];for(const{feature:y,id:w,index:M,sourceLayerIndex:I}of e){const k=this.layers[0]._featureFilter.needGeometry,L=Ka(y,k);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom),L,s))continue;const F=d?u.evaluate(L,{},s):void 0,j={id:w,properties:y.properties,type:y.type,sourceLayerIndex:I,index:M,geometry:k?L.geometry:Ya(y),patterns:{},dashes:{},sortKey:F};m.push(j)}d&&m.sort(((y,w)=>y.sortKey-w.sortKey));for(const y of m){const{geometry:w,index:M,sourceLayerIndex:I}=y;this.hasDependencies?(ap("line",this.layers,r)?Ug("line",this.layers,y,{zoom:this.zoom},r):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,y,this.zoom,r),this.patternFeatures.push(y)):this.addFeature(y,w,M,s,{},{},r.subdivisionGranularity),r.featureIndex.insert(e[M].feature,w,M,I,this.index)}}update(e,r,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:s,dashPositions:u})}addFeatures(e,r,s,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,s,u,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,YP)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,HP),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,u,d,m,y){const w=this.layers[0].layout,M=w.get("line-join").evaluate(e,{}),I=w.get("line-cap"),k=w.get("line-miter-limit"),L=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const F of r)this.addLine(F,e,M,I,k,L,u,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{imagePositions:d,dashPositions:m,canonical:u})}addLine(e,r,s,u,d,m,y,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Ll(e,y?w.line.getGranularityForZoomLevel(y.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<e.length-1;J++)this.totalDistance+=e[J].dist(e[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=$h.types[r.type]==="Polygon";let I=e.length;for(;I>=2&&e[I-1].equals(e[I-2]);)I--;let k=0;for(;k<I-1&&e[k].equals(e[k+1]);)k++;if(I<(M?3:2))return;s==="bevel"&&(d=1.05);const L=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let j,q,Z,Y,fe;this.e1=this.e2=-1,M&&(j=e[I-2],fe=e[k].sub(j)._unit()._perp());for(let J=k;J<I;J++){if(Z=J===I-1?M?e[k+1]:void 0:e[J+1],Z&&e[J].equals(Z))continue;fe&&(Y=fe),j&&(q=j),j=e[J],fe=Z?Z.sub(j)._unit()._perp():Y,Y=Y||fe;let ne=Y.add(fe);ne.x===0&&ne.y===0||ne._unit();const ge=Y.x*fe.x+Y.y*fe.y,we=ne.x*fe.x+ne.y*fe.y,De=we!==0?1/we:1/0,Ke=2*Math.sqrt(2-2*we),Ge=we<KP&&q&&Z,tt=Y.x*fe.y-Y.y*fe.x>0;if(Ge&&J>k){const He=j.dist(q);if(He>2*L){const Ne=j.sub(j.sub(q)._mult(L/He)._round());this.updateDistance(q,Ne),this.addCurrentVertex(Ne,Y,0,0,F),q=Ne}}const ht=q&&Z;let it=ht?s:M?"butt":u;if(ht&&it==="round"&&(De<m?it="miter":De<=2&&(it="fakeround")),it==="miter"&&De>d&&(it="bevel"),it==="bevel"&&(De>2&&(it="flipbevel"),De<d&&(it="miter")),q&&this.updateDistance(q,j),it==="miter")ne._mult(De),this.addCurrentVertex(j,ne,0,0,F);else if(it==="flipbevel"){if(De>100)ne=fe.mult(-1);else{const He=De*Y.add(fe).mag()/Y.sub(fe).mag();ne._perp()._mult(He*(tt?-1:1))}this.addCurrentVertex(j,ne,0,0,F),this.addCurrentVertex(j,ne.mult(-1),0,0,F)}else if(it==="bevel"||it==="fakeround"){const He=-Math.sqrt(De*De-1),Ne=tt?He:0,bt=tt?0:He;if(q&&this.addCurrentVertex(j,Y,Ne,bt,F),it==="fakeround"){const yt=Math.round(180*Ke/Math.PI/20);for(let St=1;St<yt;St++){let mt=St/yt;if(mt!==.5){const Tn=mt-.5;mt+=mt*Tn*(mt-1)*((1.0904+ge*(ge*(3.55645-1.43519*ge)-3.2452))*Tn*Tn+(.848013+ge*(.215638*ge-1.06021)))}const Lt=fe.sub(Y)._mult(mt)._add(Y)._unit()._mult(tt?-1:1);this.addHalfVertex(j,Lt.x,Lt.y,!1,tt,0,F)}}Z&&this.addCurrentVertex(j,fe,-Ne,-bt,F)}else if(it==="butt")this.addCurrentVertex(j,ne,0,0,F);else if(it==="square"){const He=q?1:-1;this.addCurrentVertex(j,ne,He,He,F)}else it==="round"&&(q&&(this.addCurrentVertex(j,Y,0,0,F),this.addCurrentVertex(j,Y,1,1,F,!0)),Z&&(this.addCurrentVertex(j,fe,-1,-1,F,!0),this.addCurrentVertex(j,fe,0,0,F)));if(Ge&&J<I-1){const He=j.dist(Z);if(He>2*L){const Ne=j.add(Z.sub(j)._mult(L/He)._round());this.updateDistance(j,Ne),this.addCurrentVertex(Ne,fe,0,0,F),j=Ne}}}}addCurrentVertex(e,r,s,u,d,m=!1){const y=r.y*u-r.x,w=-r.y-r.x*u;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,m,!1,s,d),this.addHalfVertex(e,y,w,m,!0,-u,d),this.distance>Lv/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,s,u,d,m))}addHalfVertex({x:e,y:r},s,u,d,m,y,w){const M=.5*(this.lineClips?this.scaledDistance*(Lv-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(r<<1)+(m?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,I,this.e2),w.primitiveLength++),m?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}hasLineDasharray(e){for(const r of e){const s=r.paint.get("line-dasharray");if(s&&!s.isConstant())return!0}return!1}addLineDashDependencies(e,r,s,u){for(const d of e){const m=d.paint.get("line-dasharray");if(!m||m.value.kind==="constant")continue;const y=d.layout.get("line-cap")==="round",w={dasharray:m.value.evaluate({zoom:s-1},r,{}),round:y},M={dasharray:m.value.evaluate({zoom:s},r,{}),round:y},I={dasharray:m.value.evaluate({zoom:s+1},r,{}),round:y},k=`${w.dasharray.join(",")},${w.round}`,L=`${M.dasharray.join(",")},${M.round}`,F=`${I.dasharray.join(",")},${I.round}`;u.dashDependencies[k]=w,u.dashDependencies[L]=M,u.dashDependencies[F]=I,r.dashes[d.id]={min:k,mid:L,max:F}}}}let Fv,Bv;wt("LineBucket",Hg,{omit:["layers","patternFeatures"]});var Ov={get paint(){return Bv=Bv||new di({"line-opacity":new Ot(Fe.paint_line["line-opacity"]),"line-color":new Ot(Fe.paint_line["line-color"]),"line-translate":new Dt(Fe.paint_line["line-translate"]),"line-translate-anchor":new Dt(Fe.paint_line["line-translate-anchor"]),"line-width":new Ot(Fe.paint_line["line-width"]),"line-gap-width":new Ot(Fe.paint_line["line-gap-width"]),"line-offset":new Ot(Fe.paint_line["line-offset"]),"line-blur":new Ot(Fe.paint_line["line-blur"]),"line-dasharray":new Pl(Fe.paint_line["line-dasharray"]),"line-pattern":new Pl(Fe.paint_line["line-pattern"]),"line-gradient":new Uc(Fe.paint_line["line-gradient"])})},get layout(){return Fv=Fv||new di({"line-cap":new Dt(Fe.layout_line["line-cap"]),"line-join":new Ot(Fe.layout_line["line-join"]),"line-miter-limit":new Dt(Fe.layout_line["line-miter-limit"]),"line-round-limit":new Dt(Fe.layout_line["line-round-limit"]),"line-sort-key":new Ot(Fe.layout_line["line-sort-key"])})}};class JP extends Ot{possiblyEvaluate(e,r){return r=new Rn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,s,u){return r=Kt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,s,u)}}let cp;class QP extends Bi{constructor(e,r){super(e,Ov,r),this.gradientVersion=0,cp||(cp=new JP(Ov.paint.properties["line-width"].specification),cp.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!(function(s){return s._styleExpression!==void 0})(r)&&r._styleExpression.expression instanceof Ua,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=cp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Hg(e)}queryRadius(e){const r=e,s=Nv(Jc("line-width",this,r),Jc("line-gap-width",this,r)),u=Jc("line-offset",this,r);return s/2+Math.abs(u)+rp(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:s,geometry:u,transform:d,pixelsToTileUnits:m}){const y=ip(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-d.bearingInRadians,m),w=m/2*Nv(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),M=this.paint.get("line-offset").evaluate(r,s);return M&&(u=(function(I,k){const L=[];for(let F=0;F<I.length;F++){const j=sP(I[F]),q=[];for(let Z=0;Z<j.length;Z++){const Y=j[Z],fe=j[Z-1],J=j[Z+1],ne=Z===0?new C(0,0):Y.sub(fe)._unit()._perp(),ge=Z===j.length-1?new C(0,0):J.sub(Y)._unit()._perp(),we=ne._add(ge)._unit(),De=we.x*ge.x+we.y*ge.y;De!==0&&we._mult(1/De),q.push(we._mult(k)._add(Y))}L.push(q)}return L})(u,M*m)),(function(I,k,L){for(let F=0;F<k.length;F++){const j=k[F];if(I.length>=3){for(let q=0;q<j.length;q++)if(Kc(I,j[q]))return!0}if(iP(I,j,L))return!0}return!1})(y,u,w)}isTileClipped(){return!0}}function Nv(i,e){return e>0?e+2*i:i}const eE=dr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),tE=dr([{name:"a_projected_pos",components:3,type:"Float32"}],4);dr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const nE=dr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);dr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Vv=dr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rE=dr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function iE(i,e,r){return i.sections.forEach((s=>{s.text=(function(u,d,m){const y=d.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),Wa.applyArabicShaping&&(u=Wa.applyArabicShaping(u)),u})(s.text,e,r)})),i}dr([{name:"triangle",components:3,type:"Uint16"}]),dr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),dr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),dr([{type:"Float32",name:"offsetX"}]),dr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),dr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var zr=24;const Hh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},aE={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},oE={40:!0};function jv(i,e,r,s,u,d){if("fontStack"in e){const m=r[e.fontStack],y=m&&m[i];return y?y.metrics.advance*e.scale+u:0}{const m=s[e.imageName];return m?m.displaySize[0]*e.scale*zr/d+u:0}}function Uv(i,e,r,s){const u=Math.pow(i-e,2);return s?i<e?u/2:2*u:u+Math.abs(r)*r}function sE(i,e,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function qv(i,e,r,s,u,d){let m=null,y=Uv(e,r,u,d);for(const w of s){const M=Uv(e-w.x,r,u,d)+w.badness;M<=y&&(m=w,y=M)}return{index:i,x:e,priorBreak:m,badness:y}}function Gv(i){return i?Gv(i.priorBreak).concat(i.index):[]}class nu{constructor(e="",r=[],s=[]){this.text=e,this.sections=r,this.sectionIndex=s,this.imageSectionID=null}static fromFeature(e,r){const s=new nu;for(let u=0;u<e.sections.length;u++){const d=e.sections[u];d.image?s.addImageSection(d):s.addTextSection(d,r)}return s}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let r="",s={premature:!0,value:void 0};const u=e[Symbol.iterator]();let d=u.next();const m=e[Symbol.iterator]();m.next();let y=m.next();for(;!d.done;)r+=!y.done&&Sh(y.value.codePointAt(0))&&!Hh[y.value]||!s.premature&&Sh(s.value.codePointAt(0))&&!Hh[s.value]||!Hh[d.value]?d.value:Hh[d.value],s={value:d.value,premature:!1},d=u.next(),y=m.next();return r})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),r=e?e[0].length:0,s=this.text.match(/\S\s*$/),u=s?s[0].length-1:0;this.text=this.text.substring(r,this.text.length-u),this.sectionIndex=this.sectionIndex.slice(r,this.sectionIndex.length-u)}substring(e,r){const s=[...this.text].slice(e,r).join(""),u=this.sectionIndex.slice(e,r);return new nu(s,this.sections,u)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,r)=>Math.max(e,this.sections[r].scale)),0)}getMaxImageSize(e){let r=0,s=0;for(let u=0;u<this.length();u++){const d=this.getSection(u);if("imageName"in d){const m=e[d.imageName];if(!m)continue;const y=m.displaySize;r=Math.max(r,y[0]),s=Math.max(s,y[1])}}return{maxImageWidth:r,maxImageHeight:s}}addTextSection(e,r){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||r});const s=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>s)))}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Nt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:r}),this.sectionIndex.push(this.sections.length-1)):Nt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,r,s,u,d){const m=[],y=this.determineAverageLineWidth(e,r,s,u,d),w=this.hasZeroWidthSpaces();let M=0,I=0;const k=this.text[Symbol.iterator]();let L=k.next();const F=this.text[Symbol.iterator]();F.next();let j=F.next();const q=this.text[Symbol.iterator]();q.next(),q.next();let Z=q.next();for(;!L.done;){const Y=this.getSection(I),fe=L.value.codePointAt(0);if($d(fe)||(M+=jv(fe,Y,s,u,e,d)),!j.done){const J=Tl(fe),ne=j.value.codePointAt(0);(aE[fe]||J||"imageName"in Y||!Z.done&&oE[ne])&&m.push(qv(I+1,M,y,m,sE(fe,ne,J&&w),!1))}I++,L=k.next(),j=F.next(),Z=q.next()}return Gv(qv(this.length(),M,y,m,0,!0))}determineAverageLineWidth(e,r,s,u,d){let m=0,y=0;for(const w of this.text){const M=this.getSection(y);m+=jv(w.codePointAt(0),M,s,u,e,d),y++}return m/Math.max(1,Math.ceil(m/r))}}const Xg=4294967296,$v=1/Xg,Zv=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class up{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,r,s=this.length){for(;this.pos<s;){const u=this.readVarint(),d=u>>3,m=this.pos;this.type=7&u,e(d,r,this),this.pos===m&&this.skip(u)}return r}readMessage(e,r){return this.readFields(e,r,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Xg;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Xg;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const r=this.buf;let s,u;return u=r[this.pos++],s=127&u,u<128?s:(u=r[this.pos++],s|=(127&u)<<7,u<128?s:(u=r[this.pos++],s|=(127&u)<<14,u<128?s:(u=r[this.pos++],s|=(127&u)<<21,u<128?s:(u=r[this.pos],s|=(15&u)<<28,(function(d,m,y){const w=y.buf;let M,I;if(I=w[y.pos++],M=(112&I)>>4,I<128||(I=w[y.pos++],M|=(127&I)<<3,I<128)||(I=w[y.pos++],M|=(127&I)<<10,I<128)||(I=w[y.pos++],M|=(127&I)<<17,I<128)||(I=w[y.pos++],M|=(127&I)<<24,I<128)||(I=w[y.pos++],M|=(1&I)<<31,I<128))return ru(d,M,m);throw new Error("Expected varint not more than 10 bytes")})(s,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,r=this.pos;return this.pos=e,e-r>=12&&Zv?Zv.decode(this.buf.subarray(r,e)):(function(s,u,d){let m="",y=u;for(;y<d;){const w=s[y];let M,I,k,L=null,F=w>239?4:w>223?3:w>191?2:1;if(y+F>d)break;F===1?w<128&&(L=w):F===2?(M=s[y+1],(192&M)==128&&(L=(31&w)<<6|63&M,L<=127&&(L=null))):F===3?(M=s[y+1],I=s[y+2],(192&M)==128&&(192&I)==128&&(L=(15&w)<<12|(63&M)<<6|63&I,(L<=2047||L>=55296&&L<=57343)&&(L=null))):F===4&&(M=s[y+1],I=s[y+2],k=s[y+3],(192&M)==128&&(192&I)==128&&(192&k)==128&&(L=(15&w)<<18|(63&M)<<12|(63&I)<<6|63&k,(L<=65535||L>=1114112)&&(L=null))),L===null?(L=65533,F=1):L>65535&&(L-=65536,m+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),m+=String.fromCharCode(L),y+=F}return m})(this.buf,r,e)}readBytes(){const e=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,e);return this.pos=e,r}readPackedVarint(e=[],r){const s=this.readPackedEnd();for(;this.pos<s;)e.push(this.readVarint(r));return e}readPackedSVarint(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const r=7&e;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(e,r){this.writeVarint(e<<3|r)}realloc(e){let r=this.length||16;for(;r<this.pos+e;)r*=2;if(r!==this.length){const s=new Uint8Array(r);s.set(this.buf),this.buf=s,this.dataView=new DataView(s.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*$v),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*$v),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(r,s){let u,d;if(r>=0?(u=r%4294967296|0,d=r/4294967296|0):(u=~(-r%4294967296),d=~(-r/4294967296),4294967295^u?u=u+1|0:(u=0,d=d+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),(function(m,y,w){w.buf[w.pos++]=127&m|128,m>>>=7,w.buf[w.pos++]=127&m|128,m>>>=7,w.buf[w.pos++]=127&m|128,m>>>=7,w.buf[w.pos++]=127&m|128,w.buf[w.pos]=127&(m>>>=7)})(u,0,s),(function(m,y){const w=(7&m)<<4;y.buf[y.pos++]|=w|((m>>>=3)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m)))))})(d,s)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const r=this.pos;this.pos=(function(u,d,m){for(let y,w,M=0;M<d.length;M++){if(y=d.charCodeAt(M),y>55295&&y<57344){if(!w){y>56319||M+1===d.length?(u[m++]=239,u[m++]=191,u[m++]=189):w=y;continue}if(y<56320){u[m++]=239,u[m++]=191,u[m++]=189,w=y;continue}y=w-55296<<10|y-56320|65536,w=null}else w&&(u[m++]=239,u[m++]=191,u[m++]=189,w=null);y<128?u[m++]=y:(y<2048?u[m++]=y>>6|192:(y<65536?u[m++]=y>>12|224:(u[m++]=y>>18|240,u[m++]=y>>12&63|128),u[m++]=y>>6&63|128),u[m++]=63&y|128)}return m})(this.buf,e,this.pos);const s=this.pos-r;s>=128&&Wv(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const r=e.length;this.writeVarint(r),this.realloc(r);for(let s=0;s<r;s++)this.buf[this.pos++]=e[s]}writeRawMessage(e,r){this.pos++;const s=this.pos;e(r,this);const u=this.pos-s;u>=128&&Wv(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u}writeMessage(e,r,s){this.writeTag(e,2),this.writeRawMessage(r,s)}writePackedVarint(e,r){r.length&&this.writeMessage(e,lE,r)}writePackedSVarint(e,r){r.length&&this.writeMessage(e,cE,r)}writePackedBoolean(e,r){r.length&&this.writeMessage(e,fE,r)}writePackedFloat(e,r){r.length&&this.writeMessage(e,uE,r)}writePackedDouble(e,r){r.length&&this.writeMessage(e,hE,r)}writePackedFixed32(e,r){r.length&&this.writeMessage(e,dE,r)}writePackedSFixed32(e,r){r.length&&this.writeMessage(e,pE,r)}writePackedFixed64(e,r){r.length&&this.writeMessage(e,mE,r)}writePackedSFixed64(e,r){r.length&&this.writeMessage(e,gE,r)}writeBytesField(e,r){this.writeTag(e,2),this.writeBytes(r)}writeFixed32Field(e,r){this.writeTag(e,5),this.writeFixed32(r)}writeSFixed32Field(e,r){this.writeTag(e,5),this.writeSFixed32(r)}writeFixed64Field(e,r){this.writeTag(e,1),this.writeFixed64(r)}writeSFixed64Field(e,r){this.writeTag(e,1),this.writeSFixed64(r)}writeVarintField(e,r){this.writeTag(e,0),this.writeVarint(r)}writeSVarintField(e,r){this.writeTag(e,0),this.writeSVarint(r)}writeStringField(e,r){this.writeTag(e,2),this.writeString(r)}writeFloatField(e,r){this.writeTag(e,5),this.writeFloat(r)}writeDoubleField(e,r){this.writeTag(e,1),this.writeDouble(r)}writeBooleanField(e,r){this.writeVarintField(e,+r)}}function ru(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Wv(i,e,r){const s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(let u=r.pos-1;u>=i;u--)r.buf[u+s]=r.buf[u]}function lE(i,e){for(let r=0;r<i.length;r++)e.writeVarint(i[r])}function cE(i,e){for(let r=0;r<i.length;r++)e.writeSVarint(i[r])}function uE(i,e){for(let r=0;r<i.length;r++)e.writeFloat(i[r])}function hE(i,e){for(let r=0;r<i.length;r++)e.writeDouble(i[r])}function fE(i,e){for(let r=0;r<i.length;r++)e.writeBoolean(i[r])}function dE(i,e){for(let r=0;r<i.length;r++)e.writeFixed32(i[r])}function pE(i,e){for(let r=0;r<i.length;r++)e.writeSFixed32(i[r])}function mE(i,e){for(let r=0;r<i.length;r++)e.writeFixed64(i[r])}function gE(i,e){for(let r=0;r<i.length;r++)e.writeSFixed64(i[r])}function _E(i,e,r){i===1&&r.readMessage(yE,e)}function yE(i,e,r){if(i===3){const{id:s,bitmap:u,width:d,height:m,left:y,top:w,advance:M}=r.readMessage(vE,{});e.push({id:s,bitmap:new Oh({width:d+6,height:m+6},u),metrics:{width:d,height:m,left:y,top:w,advance:M}})}}function vE(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function Hv(i){let e=0,r=0;for(const m of i)e+=m.w*m.h,r=Math.max(r,m.w);i.sort(((m,y)=>y.h-m.h));const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,d=0;for(const m of i)for(let y=s.length-1;y>=0;y--){const w=s[y];if(!(m.w>w.w||m.h>w.h)){if(m.x=w.x,m.y=w.y,d=Math.max(d,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===w.w&&m.h===w.h){const M=s.pop();M&&y<s.length&&(s[y]=M)}else m.h===w.h?(w.x+=m.w,w.w-=m.w):m.w===w.w?(w.y+=m.h,w.h-=m.h):(s.push({x:w.x+m.w,y:w.y,w:w.w-m.w,h:m.h}),w.y+=m.h,w.h-=m.h);break}}return{w:u,h:d,fill:e/(u*d)||0}}class Yg{constructor(e,{pixelRatio:r,version:s,stretchX:u,stretchY:d,content:m,textFitWidth:y,textFitHeight:w}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=u,this.stretchY=d,this.content=m,this.version=s,this.textFitWidth=y,this.textFitHeight=w}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Xv{constructor(e,r){const s={},u={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,s,d),this.addImages(r,u,d);const{w:m,h:y}=Hv(d),w=new Si({width:m||1,height:y||1});for(const M in e){const I=e[M],k=s[M].paddedRect;Si.copy(I.data,w,{x:0,y:0},{x:k.x+1,y:k.y+1},I.data)}for(const M in r){const I=r[M],k=u[M].paddedRect,L=k.x+1,F=k.y+1,j=I.data.width,q=I.data.height;Si.copy(I.data,w,{x:0,y:0},{x:L,y:F},I.data),Si.copy(I.data,w,{x:0,y:q-1},{x:L,y:F-1},{width:j,height:1}),Si.copy(I.data,w,{x:0,y:0},{x:L,y:F+q},{width:j,height:1}),Si.copy(I.data,w,{x:j-1,y:0},{x:L-1,y:F},{width:1,height:q}),Si.copy(I.data,w,{x:0,y:0},{x:L+j,y:F},{width:1,height:q})}this.image=w,this.iconPositions=s,this.patternPositions=u}addImages(e,r,s){for(const u in e){const d=e[u],m={x:0,y:0,w:d.data.width+2,h:d.data.height+2};s.push(m),r[u]=new Yg(m,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[u,d]=e.tl;s.update(r.data,void 0,{x:u,y:d})}}var Ps;function hp(i,e,r,s,u,d,m,y,w,M,I,k,L,F,j){const q=nu.fromFeature(i,u);let Z;k===v.az.vertical&&q.verticalizePunctuation();let Y=q.determineLineBreaks(M,d,e,s,F);const{processBidirectionalText:fe,processStyledBidirectionalText:J}=Wa;if(fe&&q.sections.length===1){Z=[],Y=Y.map((De=>q.toCodeUnitIndex(De)));const we=fe(q.toString(),Y);for(const De of we){const Ke=[...De].map((()=>0));Z.push(new nu(De,q.sections,Ke))}}else if(J){Z=[],Y=Y.map((Ge=>q.toCodeUnitIndex(Ge)));let we=0;const De=[];for(const Ge of q.text)De.push(...Array(Ge.length).fill(q.sectionIndex[we])),we++;const Ke=J(q.text,De,Y);for(const Ge of Ke){const tt=[];let ht="";for(const it of Ge[0])tt.push(Ge[1][ht.length]),ht+=it;Z.push(new nu(Ge[0],q.sections,tt))}}else Z=(function(we,De){const Ke=[];let Ge=0;for(const tt of De)Ke.push(we.substring(Ge,tt)),Ge=tt;return Ge<we.length()&&Ke.push(we.substring(Ge,we.length())),Ke})(q,Y);const ne=[],ge={positionedLines:ne,text:q.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:k,iconsInText:!1,verticalizable:!1};return(function(we,De,Ke,Ge,tt,ht,it,He,Ne,bt,yt,St){let mt=0,Lt=0,Tn=0,ln=0;const Kn=He==="right"?1:He==="left"?0:.5,Qr=zr/St;let wr=0;for(const En of tt){En.trim();const cr=En.getMaxScale(),mr={positionedGlyphs:[],lineOffset:0};we.positionedLines[wr]=mr;const qn=mr.positionedGlyphs;let Mi=0;if(!En.length()){Lt+=ht,++wr;continue}const ei=xE(Ge,En,Qr);let Pi=0;for(const Fr of En.text){const rr=En.getSection(Pi),Tr=Fr.codePointAt(0),ur=bE(Ne,yt,Tr),Br={glyph:Tr,imageName:null,x:mt,y:Lt+-17,vertical:ur,scale:1,fontStack:"",sectionIndex:En.getSectionIndex(Pi),metrics:null,rect:null};let Ro;if("fontStack"in rr){if(Ro=wE(rr,Tr,ur,ei,De,Ke),!Ro)continue;Br.fontStack=rr.fontStack}else{if(we.iconsInText=!0,rr.scale*=Qr,Ro=TE(rr,ur,cr,ei,Ge),!Ro)continue;Mi=Math.max(Mi,Ro.imageOffset),Br.imageName=rr.imageName}const{rect:Ca,metrics:tf,baselineOffset:ks}=Ro;Br.y+=ks,Br.scale=rr.scale,Br.metrics=tf,Br.rect=Ca,qn.push(Br),ur?(we.verticalizable=!0,mt+=("imageName"in rr?tf.advance:zr)*rr.scale+bt):mt+=tf.advance*rr.scale+bt,Pi++}qn.length!==0&&(Tn=Math.max(mt-bt,Tn),SE(qn,0,qn.length-1,Kn)),mt=0,mr.lineOffset=Math.max(Mi,(cr-1)*zr);const ua=ht*cr+Mi;Lt+=ua,ln=Math.max(ua,ln),++wr}const{horizontalAlign:Jn,verticalAlign:Wn}=Kg(it);(function(En,cr,mr,qn,Mi,ei,Pi,ua,Fr){const rr=(cr-mr)*Mi;let Tr=0;Tr=ei!==Pi?-ua*qn- -17:-qn*Fr*Pi+.5*Pi;for(const ur of En)for(const Br of ur.positionedGlyphs)Br.x+=rr,Br.y+=Tr})(we.positionedLines,Kn,Jn,Wn,Tn,ln,ht,Lt,tt.length),we.top+=-Wn*Lt,we.bottom=we.top+Lt,we.left+=-Jn*Tn,we.right=we.left+Tn})(ge,e,r,s,Z,m,y,w,k,M,L,j),!(function(we){for(const De of we)if(De.positionedGlyphs.length!==0)return!1;return!0})(ne)&&ge}function Kg(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function xE(i,e,r){const s=e.getMaxScale()*zr,{maxImageWidth:u,maxImageHeight:d}=e.getMaxImageSize(i),m=Math.max(s,d*r);return{verticalLineContentWidth:Math.max(s,u*r),horizontalLineContentHeight:m}}function Yv(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function bE(i,e,r){return!(i===v.az.horizontal||!e&&!Th(r)||e&&($d(r)||(s=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(s)))));var s}function wE(i,e,r,s,u,d){const m=d[i.fontStack],y=(function(M,I,k,L){if(M&&M.rect)return M;const F=I[k.fontStack],j=F&&F[L];return j?{rect:null,metrics:j.metrics}:null})(m&&m[e],u,i,e);if(y===null)return null;let w;if(r)w=s.verticalLineContentWidth-i.scale*zr;else{const M=Yv(i.verticalAlign);w=(s.horizontalLineContentHeight-i.scale*zr)*M}return{rect:y.rect,metrics:y.metrics,baselineOffset:w}}function TE(i,e,r,s,u){const d=u[i.imageName];if(!d)return null;const m=d.paddedRect,y=d.displaySize,w={width:y[0],height:y[1],left:1,top:-3,advance:e?y[1]:y[0]};let M;if(e)M=s.verticalLineContentWidth-y[1]*i.scale;else{const I=Yv(i.verticalAlign);M=(s.horizontalLineContentHeight-y[1]*i.scale)*I}return{rect:m,metrics:w,baselineOffset:M,imageOffset:(e?y[0]:y[1])*i.scale-zr*r}}function SE(i,e,r,s){if(s===0)return;const u=i[r],d=(i[r].x+u.metrics.advance*u.scale)*s;for(let m=e;m<=r;m++)i[m].x-=d}function ME(i,e,r){const{horizontalAlign:s,verticalAlign:u}=Kg(r),d=e[0]-i.displaySize[0]*s,m=e[1]-i.displaySize[1]*u;return{image:i,top:m,bottom:m+i.displaySize[1],left:d,right:d+i.displaySize[0]}}function Kv(i){var e,r;let s=i.left,u=i.top,d=i.right-s,m=i.bottom-u;const y=(e=i.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",w=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",M=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(w==="proportional"){if(y==="stretchOnly"&&d/m<M||y==="proportional"){const I=Math.ceil(m*M);s*=I/d,d=I}}else if(y==="proportional"&&w==="stretchOnly"&&M!==0&&d/m>M){const I=Math.ceil(d/M);u*=I/m,m=I}return{x1:s,y1:u,x2:s+d,y2:u+m}}function Jv(i,e,r,s,u,d){const m=i.image;let y;if(m.content){const Z=m.content,Y=m.pixelRatio||1;y=[Z[0]/Y,Z[1]/Y,m.displaySize[0]-Z[2]/Y,m.displaySize[1]-Z[3]/Y]}const w=e.left*d,M=e.right*d;let I,k,L,F;r==="width"||r==="both"?(F=u[0]+w-s[3],k=u[0]+M+s[1]):(F=u[0]+(w+M-m.displaySize[0])/2,k=F+m.displaySize[0]);const j=e.top*d,q=e.bottom*d;return r==="height"||r==="both"?(I=u[1]+j-s[0],L=u[1]+q+s[2]):(I=u[1]+(j+q-m.displaySize[1])/2,L=I+m.displaySize[1]),{image:m,top:I,right:k,bottom:L,left:F,collisionPadding:y}}wt("ImagePosition",Yg),wt("ImageAtlas",Xv),v.az=void 0,(Ps=v.az||(v.az={}))[Ps.none=0]="none",Ps[Ps.horizontal=1]="horizontal",Ps[Ps.vertical=2]="vertical",Ps[Ps.horizontalOnly=3]="horizontalOnly";const Do=128,Es=32640;function Qv(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Rn(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:u}=r;let d=0;for(;d<s.length&&s[d]<=i;)d++;d=Math.max(0,d-1);let m=d;for(;m<s.length&&s[m]<i+1;)m++;m=Math.min(s.length-1,m);const y=s[d],w=s[m];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:w,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:w,minSize:r.evaluate(new Rn(y)),maxSize:r.evaluate(new Rn(w)),interpolationType:u}}}function Jg(i,e,r){let s="never";const u=i.get(e);return u?s=u:i.get(r)&&(s="always"),s}const PE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fp(i,e,r,s,u,d,m,y,w,M,I,k,L){const F=y?Math.min(Es,Math.round(y[0])):0,j=y?Math.min(Es,Math.round(y[1])):0;i.emplaceBack(e,r,Math.round(32*s),Math.round(32*u),d,m,(F<<1)+(w?1:0),j,16*M,16*I,256*k,256*L)}function Qg(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function EE(i){for(const e of i.sections)if(Hd(e.text))return!0;return!1}class e_{constructor(e){this.layoutVertexArray=new _e,this.indexArray=new Oe,this.programConfigurations=e,this.segments=new dt,this.dynamicLayoutVertexArray=new Ce,this.opacityVertexArray=new je,this.hasVisibleVertices=!1,this.placedSymbolArray=new x}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,u){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,eE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,tE.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,PE,!0),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}wt("SymbolBuffers",e_);class t_{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new dt,this.collisionVertexArray=new Be}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,nE.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}wt("CollisionBuffers",t_);class iu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((m=>m.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Qv(this.zoom,r["text-size"]),this.iconSizeData=Qv(this.zoom,r["icon-size"]);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),d=s.get("symbol-z-order");this.canOverlap=Jg(s,"text-overlap","text-allow-overlap")!=="never"||Jg(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map((m=>v.az[m]))),this.stateDependentLayerIds=this.layers.filter((m=>m.isStateDependent())).map((m=>m.id)),this.sourceID=e.sourceID}createArrays(){this.text=new e_(new ko(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new e_(new ko(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new A,this.lineVertexArray=new R,this.symbolInstances=new E,this.textAnchorOffsets=new O}calculateGlyphDependencies(e,r,s,u,d){for(const m of e)if(r[m.codePointAt(0)]=!0,(s||u)&&d){const y=Hh[m];y&&(r[y.codePointAt(0)]=!0)}}populate(e,r,s){const u=this.layers[0],d=u.layout,m=d.get("text-font"),y=d.get("text-field"),w=d.get("icon-image"),M=(y.value.kind!=="constant"||y.value.value instanceof mi&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),I=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,k=d.get("symbol-sort-key");if(this.features=[],!M&&!I)return;const L=r.iconDependencies,F=r.glyphDependencies,j=r.availableImages,q=new Rn(this.zoom);for(const{feature:Z,id:Y,index:fe,sourceLayerIndex:J}of e){const ne=u._featureFilter.needGeometry,ge=Ka(Z,ne);if(!u._featureFilter.filter(q,ge,s))continue;let we,De;if(ne||(ge.geometry=Ya(Z)),M){const Ge=u.getValueAndResolveTokens("text-field",ge,s,j),tt=mi.factory(Ge),ht=this.hasRTLText=this.hasRTLText||EE(tt);(!ht||Wa.getRTLTextPluginStatus()==="unavailable"||ht&&Wa.isParsed())&&(we=iE(tt,u,ge))}if(I){const Ge=u.getValueAndResolveTokens("icon-image",ge,s,j);De=Ge instanceof wi?Ge:wi.fromString(Ge)}if(!we&&!De)continue;const Ke=this.sortFeaturesByKey?k.evaluate(ge,{},s):void 0;if(this.features.push({id:Y,text:we,icon:De,index:fe,sourceLayerIndex:J,geometry:ge.geometry,properties:Z.properties,type:$h.types[Z.type],sortKey:Ke}),De&&(L[De.name]=!0),we){const Ge=m.evaluate(ge,{},s).join(","),tt=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(v.az.vertical)>=0;for(const ht of we.sections)if(ht.image)L[ht.image.name]=!0;else{const it=Ss(we.toString()),He=ht.fontStack||Ge,Ne=F[He]=F[He]||{};this.calculateGlyphDependencies(ht.text,Ne,tt,this.allowVerticalPlacement,it)}}}d.get("symbol-placement")==="line"&&(this.features=(function(Z){const Y={},fe={},J=[];let ne=0;function ge(Ge){J.push(Z[Ge]),ne++}function we(Ge,tt,ht){const it=fe[Ge];return delete fe[Ge],fe[tt]=it,J[it].geometry[0].pop(),J[it].geometry[0]=J[it].geometry[0].concat(ht[0]),it}function De(Ge,tt,ht){const it=Y[tt];return delete Y[tt],Y[Ge]=it,J[it].geometry[0].shift(),J[it].geometry[0]=ht[0].concat(J[it].geometry[0]),it}function Ke(Ge,tt,ht){const it=ht?tt[0][tt[0].length-1]:tt[0][0];return`${Ge}:${it.x}:${it.y}`}for(let Ge=0;Ge<Z.length;Ge++){const tt=Z[Ge],ht=tt.geometry,it=tt.text?tt.text.toString():null;if(!it){ge(Ge);continue}const He=Ke(it,ht),Ne=Ke(it,ht,!0);if(He in fe&&Ne in Y&&fe[He]!==Y[Ne]){const bt=De(He,Ne,ht),yt=we(He,Ne,J[bt].geometry);delete Y[He],delete fe[Ne],fe[Ke(it,J[yt].geometry,!0)]=yt,J[bt].geometry=null}else He in fe?we(He,Ne,ht):Ne in Y?De(He,Ne,ht):(ge(Ge),Y[He]=ne-1,fe[Ne]=ne-1)}return J.filter((Ge=>Ge.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((Z,Y)=>Z.sortKey-Y.sortKey))}update(e,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:s}),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:s}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(r[e.segment+1]),d=e.dist(r[e.segment]);const m={};for(let y=e.segment+1;y<r.length;y++)m[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:u},y<r.length-1&&(u+=r[y+1].dist(r[y]));for(let y=e.segment||0;y>=0;y--)m[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:d},y>0&&(d+=r[y-1].dist(r[y]));for(let y=0;y<r.length;y++){const w=m[y];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,u,d,m,y,w,M,I,k,L){const F=e.indexArray,j=e.layoutVertexArray,q=e.segments.prepareSegment(4*r.length,j,F,this.canOverlap?m.sortKey:void 0),Z=this.glyphOffsetArray.length,Y=q.vertexLength,fe=this.allowVerticalPlacement&&y===v.az.vertical?Math.PI/2:0,J=m.text&&m.text.sections;for(let ne=0;ne<r.length;ne++){const{tl:ge,tr:we,bl:De,br:Ke,tex:Ge,pixelOffsetTL:tt,pixelOffsetBR:ht,minFontScaleX:it,minFontScaleY:He,glyphOffset:Ne,isSDF:bt,sectionIndex:yt}=r[ne],St=q.vertexLength,mt=Ne[1];fp(j,w.x,w.y,ge.x,mt+ge.y,Ge.x,Ge.y,s,bt,tt.x,tt.y,it,He),fp(j,w.x,w.y,we.x,mt+we.y,Ge.x+Ge.w,Ge.y,s,bt,ht.x,tt.y,it,He),fp(j,w.x,w.y,De.x,mt+De.y,Ge.x,Ge.y+Ge.h,s,bt,tt.x,ht.y,it,He),fp(j,w.x,w.y,Ke.x,mt+Ke.y,Ge.x+Ge.w,Ge.y+Ge.h,s,bt,ht.x,ht.y,it,He),Qg(e.dynamicLayoutVertexArray,w,fe),F.emplaceBack(St,St+2,St+1),F.emplaceBack(St+1,St+2,St+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ne[0]),ne!==r.length-1&&yt===r[ne+1].sectionIndex||e.programConfigurations.populatePaintArrays(j.length,m,m.index,{imagePositions:{},canonical:L,formattedSection:J&&J[yt]})}e.placedSymbolArray.emplaceBack(w.x,w.y,Z,this.glyphOffsetArray.length-Z,Y,M,I,w.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],y,0,!1,0,k)}_addCollisionDebugVertex(e,r,s,u,d,m){return r.emplaceBack(0,0),e.emplaceBack(s.x,s.y,u,d,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(e,r,s,u,d,m,y){const w=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),M=w.vertexLength,I=d.layoutVertexArray,k=d.collisionVertexArray,L=y.anchorX,F=y.anchorY;this._addCollisionDebugVertex(I,k,m,L,F,new C(e,r)),this._addCollisionDebugVertex(I,k,m,L,F,new C(s,r)),this._addCollisionDebugVertex(I,k,m,L,F,new C(s,u)),this._addCollisionDebugVertex(I,k,m,L,F,new C(e,u)),w.vertexLength+=4;const j=d.indexArray;j.emplaceBack(M,M+1),j.emplaceBack(M+1,M+2),j.emplaceBack(M+2,M+3),j.emplaceBack(M+3,M),w.primitiveLength+=4}addDebugCollisionBoxes(e,r,s,u){for(let d=e;d<r;d++){const m=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,u?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new t_(Le,Vv.members,lt),this.iconCollisionBox=new t_(Le,Vv.members,lt);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,s,u,d,m,y,w,M){const I={};for(let k=r;k<s;k++){const L=e.get(k);I.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.textFeatureIndex=L.featureIndex;break}for(let k=u;k<d;k++){const L=e.get(k);I.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalTextFeatureIndex=L.featureIndex;break}for(let k=m;k<y;k++){const L=e.get(k);I.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.iconFeatureIndex=L.featureIndex;break}for(let k=w;k<M;k++){const L=e.get(k);I.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalIconFeatureIndex=L.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),u=s.vertexStartIndex+4*s.numGlyphs;for(let d=s.vertexStartIndex;d<u;d+=4)e.indexArray.emplaceBack(d,d+2,d+1),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),u=[],d=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const w=this.symbolInstances.get(y);u.push(0|Math.round(r*w.anchorX+s*w.anchorY)),d.push(w.featureIndex)}return m.sort(((y,w)=>u[y]-u[w]||d[w]-d[y])),m}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach(((u,d,m)=>{u>=0&&m.indexOf(u)===d&&this.addIndicesForPlacedSymbol(this.text,u)})),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ex,tx;wt("SymbolBucket",iu,{omit:["layers","collisionBoxArray","features","compareText"]}),iu.MAX_GLYPHS=65535,iu.addDynamicAttributes=Qg;var n_={get paint(){return tx=tx||new di({"icon-opacity":new Ot(Fe.paint_symbol["icon-opacity"]),"icon-color":new Ot(Fe.paint_symbol["icon-color"]),"icon-halo-color":new Ot(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ot(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ot(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new Dt(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Dt(Fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ot(Fe.paint_symbol["text-opacity"]),"text-color":new Ot(Fe.paint_symbol["text-color"],{runtimeType:bi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ot(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new Ot(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new Ot(Fe.paint_symbol["text-halo-blur"]),"text-translate":new Dt(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new Dt(Fe.paint_symbol["text-translate-anchor"])})},get layout(){return ex=ex||new di({"symbol-placement":new Dt(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new Dt(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Dt(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ot(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Dt(Fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Dt(Fe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Dt(Fe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Dt(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Dt(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Dt(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ot(Fe.layout_symbol["icon-size"]),"icon-text-fit":new Dt(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Dt(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ot(Fe.layout_symbol["icon-image"]),"icon-rotate":new Ot(Fe.layout_symbol["icon-rotate"]),"icon-padding":new Ot(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new Dt(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new Ot(Fe.layout_symbol["icon-offset"]),"icon-anchor":new Ot(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Dt(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Dt(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Dt(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new Ot(Fe.layout_symbol["text-field"]),"text-font":new Ot(Fe.layout_symbol["text-font"]),"text-size":new Ot(Fe.layout_symbol["text-size"]),"text-max-width":new Ot(Fe.layout_symbol["text-max-width"]),"text-line-height":new Dt(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new Ot(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new Ot(Fe.layout_symbol["text-justify"]),"text-radial-offset":new Ot(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Dt(Fe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ot(Fe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ot(Fe.layout_symbol["text-anchor"]),"text-max-angle":new Dt(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new Dt(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new Ot(Fe.layout_symbol["text-rotate"]),"text-padding":new Dt(Fe.layout_symbol["text-padding"]),"text-keep-upright":new Dt(Fe.layout_symbol["text-keep-upright"]),"text-transform":new Ot(Fe.layout_symbol["text-transform"]),"text-offset":new Ot(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new Dt(Fe.layout_symbol["text-allow-overlap"]),"text-overlap":new Dt(Fe.layout_symbol["text-overlap"]),"text-ignore-placement":new Dt(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new Dt(Fe.layout_symbol["text-optional"])})}};class nx{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:zi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}wt("FormatSectionOverride",nx,{omit:["defaultValue"]});class dp extends Bi{constructor(e,r){super(e,n_,r)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const d of s)u.indexOf(d)<0&&u.push(d);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,u){const d=this.layout.get(e).evaluate(r,{},s,u),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||vs(m.value)||!d?d:(function(y,w){return w.replace(/{([^{}]+)}/g,((M,I)=>y&&I in y?String(y[I]):""))})(r.properties,d)}createBucket(e){return new iu(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of n_.paint.overridableProperties){if(!dp.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new nx(r),u=new hh(s,r.property.specification);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new Ic("source",u):new fh("composite",u,r.value.zoomStops),this.paint._values[e]=new Ji(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&dp.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),u=n_.paint.properties[r];let d=!1;const m=y=>{for(const w of y)if(u.overrides&&u.overrides.hasOverride(w))return void(d=!0)};if(s.value.kind==="constant"&&s.value.value instanceof mi)m(s.value.value.sections);else if(s.value.kind==="source"||s.value.kind==="composite"){const y=M=>{d||(M instanceof oa&&hr(M.value)===Xs?m(M.value.sections):M instanceof al?m(M.sections):M.eachChild(y))},w=s.value;w._styleExpression&&y(w._styleExpression.expression)}return d}}let rx;var CE={get paint(){return rx=rx||new di({"background-color":new Dt(Fe.paint_background["background-color"]),"background-pattern":new jc(Fe.paint_background["background-pattern"]),"background-opacity":new Dt(Fe.paint_background["background-opacity"])})}};class IE extends Bi{constructor(e,r){super(e,CE,r)}}class AE extends Bi{constructor(e,r){super(e,{},r),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class kE{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const DE={once:!0},r_=63710088e-1;class Cs{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Cs(Et(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,u=e.lat*r,d=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return r_*Math.acos(Math.min(d,1))}static convert(e){if(e instanceof Cs)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Cs(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Cs(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ix=2*Math.PI*r_;function ax(i){return ix*Math.cos(i*Math.PI/180)}function ox(i){return(180+i)/360}function sx(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function lx(i,e){return i/ax(e)}function cx(i){return 360*i-180}function pp(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function ux(i,e){return i*ax(pp(e))}class Xh{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=Cs.convert(e);return new Xh(ox(s.lng),sx(s.lat),lx(r,s.lat))}toLngLat(){return new Cs(cx(this.x),pp(this.y))}toAltitude(){return ux(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ix*(e=pp(this.y),1/Math.cos(e*Math.PI/180));var e}}function hx(i,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class i_{constructor(e,r,s){if(!(function(u,d,m){return!(u<0||u>25||m<0||m>=Math.pow(2,u)||d<0||d>=Math.pow(2,u))})(e,r,s))throw new Error(`x=${r}, y=${s}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=s,this.key=au(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,s){const u=(function(m,y,w){var M=hx(256*m,256*(y=Math.pow(2,w)-y-1),w),I=hx(256*(m+1),256*(y+1),w);return M[0]+","+M[1]+","+I[0]+","+I[1]})(this.x,this.y,this.z),d=(function(m,y,w){let M,I="";for(let k=m;k>0;k--)M=1<<k-1,I+=(y&M?1:0)+(w&M?2:0);return I})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,d).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new C((e.x*r-this.x)*at,(e.y*r-this.y)*at)}toString(){return`${this.z}/${this.x}/${this.y}`}}class fx{constructor(e,r){this.wrap=e,this.canonical=r,this.key=au(e,r.z,r.z,r.x,r.y)}}class ta{constructor(e,r,s,u,d){if(this.terrainRttPosMatrix32f=null,e<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${s}`);this.overscaledZ=e,this.wrap=r,this.canonical=new i_(s,+u,+d),this.key=au(r,e,s,u,d)}clone(){return new ta(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new ta(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ta(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?au(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):au(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const r=this.canonical.z-e.canonical.z;return!(r<0)&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new ta(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new ta(r,this.wrap,r,s,u),new ta(r,this.wrap,r,s+1,u),new ta(r,this.wrap,r,s,u+1),new ta(r,this.wrap,r,s+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ta(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ta(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new fx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Xh(e.x-this.wrap,e.y))}}function au(i,e,r,s,u){(i*=2)<0&&(i=-1*i-1);const d=1<<r;return(d*d*i+d*u+s).toString(36)+r.toString(36)+e.toString(36)}function a_(i,e){return e?i.properties[e]:i.id}function zE(i,e){const r={id:i.id};if(e.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const s of e.removeProperties){const u=i.addOrUpdateProperties.findIndex((d=>d.key===s));u>-1&&i.addOrUpdateProperties.splice(u,1)}return(i.removeAllProperties||e.removeAllProperties)&&(r.removeAllProperties=!0),(i.removeProperties||e.removeProperties)&&(r.removeProperties=[...i.removeProperties||[],...e.removeProperties||[]]),(i.addOrUpdateProperties||e.addOrUpdateProperties)&&(r.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(i.newGeometry||e.newGeometry)&&(r.newGeometry=e.newGeometry||i.newGeometry),r}function dx(i){var e,r;if(!i)return{};const s={};return s.removeAll=i.removeAll,s.remove=new Set(i.remove||[]),s.add=new Map((e=i.add)===null||e===void 0?void 0:e.map((u=>[u.id,u]))),s.update=new Map((r=i.update)===null||r===void 0?void 0:r.map((u=>[u.id,u]))),s}wt("CanonicalTileID",i_),wt("OverscaledTileID",ta,{omit:["terrainRttPosMatrix32f"]});class Fl{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const r=new Fl;return r.extend(e(new C(this.minX,this.minY))),r.extend(e(new C(this.maxX,this.minY))),r.extend(e(new C(this.minX,this.maxY))),r.extend(e(new C(this.maxX,this.maxY))),r}static fromPoints(e){const r=new Fl;for(const s of e)r.extend(s);return r}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class px{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class mx{constructor(e,r,s,u,d){this.type="Feature",this._vectorTileFeature=e,this._x=s,this._y=u,this._z=r,this.properties=e.properties,this.id=d}projectPoint(e,r,s,u){return[360*(e.x+r)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+s)/u)*Math.PI))-90]}projectLine(e,r,s,u){return e.map((d=>this.projectPoint(d,r,s,u)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,r=e.extent*Math.pow(2,this._z),s=e.extent*this._x,u=e.extent*this._y,d=e.loadGeometry();switch(e.type){case 1:{const m=[];for(const w of d)m.push(w[0]);const y=this.projectLine(m,s,u,r);this._geometry=m.length===1?{type:"Point",coordinates:y[0]}:{type:"MultiPoint",coordinates:y};break}case 2:{const m=d.map((y=>this.projectLine(y,s,u,r)));this._geometry=m.length===1?{type:"LineString",coordinates:m[0]}:{type:"MultiLineString",coordinates:m};break}case 3:{const m=Av(d),y=[];for(const w of m)y.push(w.map((M=>this.projectLine(M,s,u,r))));this._geometry=y.length===1?{type:"Polygon",coordinates:y[0]}:{type:"MultiPolygon",coordinates:y};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&r!=="_x"&&r!=="_y"&&r!=="_z"&&(e[r]=this[r]);return e}}class ou{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,r,s){this._name=e,this.dataBuffer=r,typeof s=="number"?this._size=s:(this.nullabilityBuffer=s,this._size=s.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class mp extends ou{}class o_ extends mp{getValueFromBuffer(e){return this.dataBuffer[e]}}class s_ extends mp{getValueFromBuffer(e){return this.dataBuffer[e]}}class gx extends ou{delta;constructor(e,r,s,u){super(e,r,u),this.delta=s}}class l_ extends gx{constructor(e,r,s,u){super(e,Int32Array.of(r),s,u)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class c_ extends ou{constructor(e,r,s){super(e,Int32Array.of(r),s)}getValueFromBuffer(e){return this.dataBuffer[0]}}class RE{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,r,s,u,d=4096){this._name=e,this._geometryVector=r,this._idVector=s,this._propertyVectors=u,this._extent=d}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((r=>[r.name,r])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let r=0;for(;r<this.numFeatures;){let s;this.idVector&&(s=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(r)):this.idVector.getValue(r));const u=e?.next().value,d={};for(const m of this.propertyVectors){if(!m)continue;const y=m.name,w=m.getValue(r);w!==null&&(d[y]=w)}r++,yield{id:s,geometry:u,properties:d}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],r=this.geometryVector.getGeometries();for(let s=0;s<this.numFeatures;s++){let u;this.idVector&&(u=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(s)):this.idVector.getValue(s));const d={coordinates:r[s],type:this.geometryVector.geometryType(s)},m={};for(const y of this.propertyVectors){if(!y)continue;const w=y.name,M=y.getValue(s);M!==null&&(m[w]=M)}e.push({id:u,geometry:d,properties:m})}return e}containsMaxSaveIntegerValues(e){return e instanceof o_||e instanceof c_&&e instanceof l_||e instanceof s_}}class LE{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var un,zo,Kr,Pa,Bl,Ni,Rr,Lr,_x,na;function Ur(i,e,r){const s=new Int32Array(r);let u=0,d=e.get();for(let m=0;m<s.length;m++){let y=i[d++],w=127&y;y<128||(y=i[d++],w|=(127&y)<<7,y<128||(y=i[d++],w|=(127&y)<<14,y<128||(y=i[d++],w|=(127&y)<<21,y<128||(y=i[d++],w|=(15&y)<<28)))),s[u++]=w}return e.set(d),s}function gp(i,e,r){const s=new BigInt64Array(r);for(let u=0;u<s.length;u++)s[u]=BE(i,e);return s}function FE(i,e){let r,s;return s=i[e.get()],e.increment(),r=127&s,s<128?r:(s=i[e.get()],e.increment(),r|=(127&s)<<7,s<128?r:(s=i[e.get()],e.increment(),r|=(127&s)<<14,s<128?r:(s=i[e.get()],e.increment(),r|=(127&s)<<21,s<128?r:(s=i[e.get()],r|=(15&s)<<28,(function(u,d,m){let y,w;if(w=d[m.get()],m.increment(),y=(112&w)>>4,w<128||(w=d[m.get()],m.increment(),y|=(127&w)<<3,w<128)||(w=d[m.get()],m.increment(),y|=(127&w)<<10,w<128)||(w=d[m.get()],m.increment(),y|=(127&w)<<17,w<128)||(w=d[m.get()],m.increment(),y|=(127&w)<<24,w<128)||(w=d[m.get()],m.increment(),y|=(1&w)<<31,w<128))return 4294967296*y+(u>>>0);throw new Error("Expected varint not more than 10 bytes")})(r,i,e)))))}function yx(i,e,r,s){throw new Error("FastPFor is not implemented yet.")}function Ol(i){return i>>>1^-(1&i)}function su(i){return i>>1n^-(1n&i)}function BE(i,e){let r=0n,s=0,u=e.get();for(;u<i.length;){const d=i[u++];if(r|=BigInt(127&d)<<BigInt(s),!(128&d))break;if(s+=7,s>=64)throw new Error("Varint too long")}return e.set(u),r}function vx(i,e,r){const s=new Int32Array(r);let u=0;for(let d=0;d<e;d++){const m=i[d];s.fill(i[d+e],u,u+m),u+=m}return s}function xx(i,e,r){const s=new BigInt64Array(r);let u=0;for(let d=0;d<e;d++){const m=Number(i[d]);s.fill(i[d+e],u,u+m),u+=m}return s}function bx(i,e,r){const s=new Float64Array(r);let u=0;for(let d=0;d<e;d++){const m=i[d];s.fill(i[d+e],u,u+m),u+=m}return s}function u_(i){const e=i.length/4*4;let r=1;if(e>=4)for(let s=i[0];r<e-4;r+=4)s=i[r]+=s,s=i[r+1]+=s,s=i[r+2]+=s,s=i[r+3]+=s;for(;r!=i.length;)i[r]+=i[r-1],++r}function wx(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const e=i.length/4*4;let r=2;if(e>=4)for(;r<e-4;r+=4){const s=i[r],u=i[r+1],d=i[r+2],m=i[r+3];i[r]=(s>>>1^-(1&s))+i[r-2],i[r+1]=(u>>>1^-(1&u))+i[r-1],i[r+2]=(d>>>1^-(1&d))+i[r],i[r+3]=(m>>>1^-(1&m))+i[r+1]}for(;r!=i.length;r+=2)i[r]=(i[r]>>>1^-(1&i[r]))+i[r-2],i[r+1]=(i[r+1]>>>1^-(1&i[r+1]))+i[r-1]}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(un||(un={})),(function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"})(zo||(zo={})),(function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"})(Kr||(Kr={}));class h_{_dictionaryType;_offsetType;_lengthType;constructor(e,r,s){this._dictionaryType=e,this._offsetType=r,this._lengthType=s}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function yi(i,e){const r=(function(s,u){const d=s[u.get()],m=Object.values(Kr)[d>>4];let y=null;switch(m){case Kr.DATA:y=new h_(Object.values(Pa)[15&d]);break;case Kr.OFFSET:y=new h_(null,Object.values(Bl)[15&d]);break;case Kr.LENGTH:y=new h_(null,null,Object.values(Ni)[15&d])}u.increment();const w=s[u.get()],M=Object.values(un)[w>>5],I=Object.values(un)[w>>2&7],k=Object.values(zo)[3&w];u.increment();const L=Ur(s,u,2),F=L[0];return{physicalStreamType:m,logicalStreamType:y,logicalLevelTechnique1:M,logicalLevelTechnique2:I,physicalLevelTechnique:k,numValues:F,byteLength:L[1],decompressedCount:F}})(i,e);return r.logicalLevelTechnique1===un.MORTON?(function(s,u,d){const m=Ur(u,d,2);return{physicalStreamType:s.physicalStreamType,logicalStreamType:s.logicalStreamType,logicalLevelTechnique1:s.logicalLevelTechnique1,logicalLevelTechnique2:s.logicalLevelTechnique2,physicalLevelTechnique:s.physicalLevelTechnique,numValues:s.numValues,byteLength:s.byteLength,decompressedCount:s.decompressedCount,numBits:m[0],coordinateShift:m[1]}})(r,i,e):un.RLE!==r.logicalLevelTechnique1&&un.RLE!==r.logicalLevelTechnique2||zo.NONE===r.physicalLevelTechnique?r:(function(s,u,d){const m=Ur(u,d,2);return{physicalStreamType:s.physicalStreamType,logicalStreamType:s.logicalStreamType,logicalLevelTechnique1:s.logicalLevelTechnique1,logicalLevelTechnique2:s.logicalLevelTechnique2,physicalLevelTechnique:s.physicalLevelTechnique,numValues:s.numValues,byteLength:s.byteLength,decompressedCount:m[1],runs:m[0],numRleValues:m[1]}})(r,i,e)}(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(Pa||(Pa={})),(function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"})(Bl||(Bl={})),(function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"})(Ni||(Ni={})),(function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Rr||(Rr={}));class Ea{values;_size;constructor(e,r){this.values=e,this._size=r}get(e){const r=Math.floor(e/8);return(this.values[r]>>e%8&1)==1}set(e,r){const s=Math.floor(e/8);this.values[s]=this.values[s]|(r?1:0)<<e%8}getInt(e){const r=Math.floor(e/8);return this.values[r]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function vi(i,e,r,s,u){return(function(d,m,y){switch(m.logicalLevelTechnique1){case un.DELTA:return m.logicalLevelTechnique2===un.RLE?(function(w,M,I){const k=new Int32Array(I);let L=0,F=0;for(let j=0;j<M;j++){const q=w[j],Z=Ol(w[j+M]);for(let Y=0;Y<q;Y++)F+=Z,k[L++]=F}return k})(d,m.runs,m.numRleValues):((function(w){w[0]=w[0]>>>1^-(1&w[0]);const M=w.length/4*4;let I=1;if(M>=4)for(;I<M-4;I+=4){const k=w[I],L=w[I+1],F=w[I+2],j=w[I+3];w[I]=(k>>>1^-(1&k))+w[I-1],w[I+1]=(L>>>1^-(1&L))+w[I],w[I+2]=(F>>>1^-(1&F))+w[I+1],w[I+3]=(j>>>1^-(1&j))+w[I+2]}for(;I!=w.length;++I)w[I]=(w[I]>>>1^-(1&w[I]))+w[I-1]})(d),d);case un.RLE:return(function(w,M,I){return I?(function(k,L,F){const j=new Int32Array(F);let q=0;for(let Z=0;Z<L;Z++){const Y=k[Z];let fe=k[Z+L];fe=fe>>>1^-(1&fe),j.fill(fe,q,q+Y),q+=Y}return j})(w,M.runs,M.numRleValues):vx(w,M.runs,M.numRleValues)})(d,m,y);case un.MORTON:return u_(d),d;case un.COMPONENTWISE_DELTA:return wx(d),d;case un.NONE:return y&&(function(w){for(let M=0;M<w.length;M++){const I=w[M];w[M]=I>>>1^-(1&I)}})(d),d;default:throw new Error(`The specified Logical level technique is not supported: ${m.logicalLevelTechnique1}`)}})(_p(i,e,r),r,s)}function Is(i,e,r){return(function(s,u){if(u.logicalLevelTechnique1===un.DELTA&&u.logicalLevelTechnique2===un.NONE)return(function(m){const y=new Int32Array(m.length+1);y[0]=0,y[1]=Ol(m[0]);let w=y[1],M=2;for(;M!=y.length;++M){const I=m[M-1];w+=I>>>1^-(1&I),y[M]=y[M-1]+w}return y})(s);if(u.logicalLevelTechnique1===un.RLE&&u.logicalLevelTechnique2===un.NONE)return(function(m,y,w){const M=new Int32Array(w+1);M[0]=0;let I=1,k=M[0];for(let L=0;L<y;L++){const F=m[L],j=m[L+y];for(let q=I;q<I+F;q++)M[q]=j+k,k=M[q];I+=F}return M})(s,u.runs,u.numRleValues);if(u.logicalLevelTechnique1===un.NONE&&u.logicalLevelTechnique2===un.NONE){(function(m){let y=0;for(let w=0;w<m.length;w++)m[w]+=y,y=m[w]})(s);const d=new Int32Array(u.numValues+1);return d[0]=0,d.set(s,1),d}if(u.logicalLevelTechnique1===un.DELTA&&u.logicalLevelTechnique2===un.RLE){const d=(function(m,y,w){const M=new Int32Array(w+1);M[0]=0;let I=1,k=M[0];for(let L=0;L<y;L++){const F=m[L];let j=m[L+y];j=j>>>1^-(1&j);for(let q=I;q<I+F;q++)M[q]=j+k,k=M[q];I+=F}return M})(s,u.runs,u.numRleValues);return u_(d),d}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(_p(i,e,r),r)}function _p(i,e,r){const s=r.physicalLevelTechnique;if(s===zo.FAST_PFOR)return yx();if(s===zo.VARINT)return Ur(i,e,r.numValues);if(s===zo.NONE){const u=e.get();e.add(r.byteLength);const d=i.subarray(u,e.get());return new Int32Array(d)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function f_(i,e,r,s){const u=_p(i,e,r);if(u.length===1){const d=u[0];return s?Ol(d):d}return s?(function(d){return Ol(d[1])})(u):(function(d){return d[1]})(u)}function Tx(i,e,r){return(function(s){if(s.length==2){const u=Ol(s[1]);return[u,u]}return[Ol(s[2]),Ol(s[3])]})(_p(i,e,r))}function Sx(i,e,r){return(function(s){if(s.length==2){const u=su(s[1]);return[u,u]}return[su(s[2]),su(s[3])]})(gp(i,e,r.numValues))}function Mx(i,e,r,s){return(function(u,d,m){switch(d.logicalLevelTechnique1){case un.DELTA:return d.logicalLevelTechnique2===un.RLE?(function(y,w,M){const I=new BigInt64Array(M);let k=0,L=0n;for(let F=0;F<w;F++){const j=Number(y[F]),q=su(y[F+w]);for(let Z=0;Z<j;Z++)L+=q,I[k++]=L}return I})(u,d.runs,d.numRleValues):((function(y){y[0]=y[0]>>1n^-(1n&y[0]);const w=y.length/4*4;let M=1;if(w>=4)for(;M<w-4;M+=4){const I=y[M],k=y[M+1],L=y[M+2],F=y[M+3];y[M]=(I>>1n^-(1n&I))+y[M-1],y[M+1]=(k>>1n^-(1n&k))+y[M],y[M+2]=(L>>1n^-(1n&L))+y[M+1],y[M+3]=(F>>1n^-(1n&F))+y[M+2]}for(;M!=y.length;++M)y[M]=(y[M]>>1n^-(1n&y[M]))+y[M-1]})(u),u);case un.RLE:return(function(y,w,M){return M?(function(I,k,L){const F=new BigInt64Array(L);let j=0;for(let q=0;q<k;q++){const Z=Number(I[q]);let Y=I[q+k];Y=Y>>1n^-(1n&Y),F.fill(Y,j,j+Z),j+=Z}return F})(y,w.runs,w.numRleValues):xx(y,w.runs,w.numRleValues)})(u,d,m);case un.NONE:return m&&(function(y){for(let w=0;w<y.length;w++){const M=y[w];y[w]=M>>1n^-(1n&M)}})(u),u;default:throw new Error(`The specified Logical level technique is not supported: ${d.logicalLevelTechnique1}`)}})(gp(i,e,r.numValues),r,s)}function Px(i,e,r,s){const u=gp(i,e,r.numValues);if(u.length===1){const d=u[0];return s?su(d):d}return s?(function(d){return su(d[1])})(u):(function(d){return d[1]})(u)}function d_(i,e,r,s,u){return(function(d,m,y,w){switch(m.logicalLevelTechnique1){case un.DELTA:return m.logicalLevelTechnique2===un.RLE&&(d=vx(d,m.runs,m.numRleValues)),(function(M,I){const k=new Int32Array(M.size());let L=0;M.get(0)?(k[0]=M.get(0)?I[0]>>>1^-(1&I[0]):0,L=1):k[0]=0;let F=1;for(;F!=k.length;++F)k[F]=M.get(F)?k[F-1]+(I[L]>>>1^-(1&I[L++])):k[F-1];return k})(w,d);case un.RLE:return(function(M,I,k,L){const F=I;return k?(function(j,q,Z){const Y=new Int32Array(j.size());let fe=0;for(let J=0;J<Z;J++){const ne=q[J];let ge=q[J+Z];ge=ge>>>1^-(1&ge);for(let we=fe;we<fe+ne;we++)j.get(we)?Y[we]=ge:(Y[we]=0,fe++);fe+=ne}return Y})(L,M,F.runs):(function(j,q,Z){const Y=new Int32Array(j.size());let fe=0;for(let J=0;J<Z;J++){const ne=q[J],ge=q[J+Z];for(let we=fe;we<fe+ne;we++)j.get(we)?Y[we]=ge:(Y[we]=0,fe++);fe+=ne}return Y})(L,M,F.runs)})(d,m,y,w);case un.MORTON:return u_(d),d;case un.COMPONENTWISE_DELTA:return wx(d),d;case un.NONE:return d=y?(function(M,I){const k=new Int32Array(M.size());let L=0,F=0;for(;F!=k.length;++F)if(M.get(F)){const j=I[L++];k[F]=j>>>1^-(1&j)}else k[F]=0;return k})(w,d):(function(M,I){const k=new Int32Array(M.size());let L=0,F=0;for(;F!=k.length;++F)k[F]=M.get(F)?I[L++]:0;return k})(w,d),d;default:throw new Error("The specified Logical level technique is not supported")}})(r.physicalLevelTechnique===zo.FAST_PFOR?yx():Ur(i,e,r.numValues),r,s,u)}function yp(i,e,r,s){const u=i.logicalLevelTechnique1;if(u===un.RLE)return i.runs===1?Rr.CONST:Rr.FLAT;const d=e instanceof Ea?e.size():e;if(u===un.DELTA&&i.logicalLevelTechnique2===un.RLE){const m=i.runs,y=2;if(i.numRleValues!==d)return Rr.FLAT;if(m===1)return Rr.SEQUENCE;if(m===2){const w=s.get();let M;if(i.physicalLevelTechnique===zo.VARINT)M=Ur(r,s,4);else{const I=s.get();M=new Int32Array(r.buffer,r.byteOffset+I,4)}if(s.set(w),M[2]===y&&M[3]===y)return Rr.SEQUENCE}}return i.numValues===1?Rr.CONST:Rr.FLAT}class Ex extends mp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Cx extends gx{constructor(e,r,s,u){super(e,BigInt64Array.of(r),s,u)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class lu{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,r,s){this._geometryOffsets=e,this._partOffsets=r,this._ringOffsets=s}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function p_(i,e,r){return{x:Ix(i,e)-r,y:Ix(i>>1,e)-r}}function Ix(i,e){let r=0;for(let s=0;s<e;s++)r|=(i&1<<2*s)>>s;return r}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(Lr||(Lr={})),(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"})(_x||(_x={})),(function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"})(na||(na={}));class OE{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((r=>[r]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,r){return[e].concat(r)}createMultiPolygon(e){return e.flat()}}function Ax(i){const e=new Array(i.numGeometries);let r=1,s=1,u=1,d=0;const m=new OE;let y=0,w=0;const M=i.mortonSettings,I=i.topologyVector,k=I.geometryOffsets,L=I.partOffsets,F=I.ringOffsets,j=i.vertexOffsets,q=i.containsPolygonGeometry(),Z=i.vertexBuffer;for(let Y=0;Y<i.numGeometries;Y++){const fe=i.geometryType(Y);if(fe===Lr.POINT){if(j&&j.length!==0)if(i.vertexBufferType===na.VEC_2){const J=2*j[w++],ne=new C(Z[J],Z[J+1]);e[d++]=m.createPoint(ne)}else{const J=p_(Z[j[w++]],M.numBits,M.coordinateShift),ne=new C(J.x,J.y);e[d++]=m.createPoint(ne)}else{const J=new C(Z[y++],Z[y++]);e[d++]=m.createPoint(J)}k&&u++,L&&r++,F&&s++}else if(fe===Lr.MULTIPOINT){const J=k[u]-k[u-1];u++;const ne=new Array(J);if(j&&j.length!==0){for(let ge=0;ge<J;ge++){const we=2*j[w++];ne[ge]=new C(Z[we],Z[we+1])}e[d++]=m.createMultiPoint(ne)}else{for(let ge=0;ge<J;ge++){const we=Z[y++],De=Z[y++];ne[ge]=new C(we,De)}e[d++]=m.createMultiPoint(ne)}}else if(fe===Lr.LINESTRING){let J,ne=0;q?(ne=F[s]-F[s-1],s++):ne=L[r]-L[r-1],r++,j&&j.length!==0?(J=i.vertexBufferType===na.VEC_2?g_(Z,j,w,ne,!1):__(Z,j,w,ne,!1,M),w+=ne):(J=m_(Z,y,ne,!1),y+=2*ne),e[d++]=m.createLineString(J),k&&u++}else if(fe===Lr.POLYGON){const J=L[r]-L[r-1];r++;const ne=new Array(J-1);let ge=F[s]-F[s-1];if(s++,j&&j.length!==0){const we=i.vertexBufferType===na.VEC_2?xp(Z,j,w,ge):bp(Z,j,w,ge,0,M);w+=ge;for(let De=0;De<ne.length;De++)ge=F[s]-F[s-1],s++,ne[De]=i.vertexBufferType===na.VEC_2?xp(Z,j,w,ge):bp(Z,j,w,ge,0,M),w+=ge;e[d++]=m.createPolygon(we,ne)}else{const we=vp(Z,y,ge);y+=2*ge;for(let De=0;De<ne.length;De++)ge=F[s]-F[s-1],s++,ne[De]=vp(Z,y,ge),y+=2*ge;e[d++]=m.createPolygon(we,ne)}k&&u++}else if(fe===Lr.MULTILINESTRING){const J=k[u]-k[u-1];u++;const ne=new Array(J);if(j&&j.length!==0){for(let ge=0;ge<J;ge++){let we=0;q?(we=F[s]-F[s-1],s++):we=L[r]-L[r-1],r++;const De=i.vertexBufferType===na.VEC_2?g_(Z,j,w,we,!1):__(Z,j,w,we,!1,M);ne[ge]=De,w+=we}e[d++]=m.createMultiLineString(ne)}else{for(let ge=0;ge<J;ge++){let we=0;q?(we=F[s]-F[s-1],s++):we=L[r]-L[r-1],r++,ne[ge]=m_(Z,y,we,!1),y+=2*we}e[d++]=m.createMultiLineString(ne)}}else{if(fe!==Lr.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const J=k[u]-k[u-1];u++;const ne=new Array(J);let ge=0;if(j&&j.length!==0){for(let we=0;we<J;we++){const De=L[r]-L[r-1];r++;const Ke=new Array(De-1);ge=F[s]-F[s-1],s++;const Ge=i.vertexBufferType===na.VEC_2?xp(Z,j,w,ge):bp(Z,j,w,ge,0,M);w+=ge;for(let tt=0;tt<Ke.length;tt++)ge=F[s]-F[s-1],s++,Ke[tt]=i.vertexBufferType===na.VEC_2?xp(Z,j,w,ge):bp(Z,j,w,ge,0,M),w+=ge;ne[we]=m.createPolygon(Ge,Ke)}e[d++]=m.createMultiPolygon(ne)}else{for(let we=0;we<J;we++){const De=L[r]-L[r-1];r++;const Ke=new Array(De-1);ge=F[s]-F[s-1],s++;const Ge=vp(Z,y,ge);y+=2*ge;for(let tt=0;tt<Ke.length;tt++){const ht=F[s]-F[s-1];s++,Ke[tt]=vp(Z,y,ht),y+=2*ht}ne[we]=m.createPolygon(Ge,Ke)}e[d++]=m.createMultiPolygon(ne)}}}}return e}function vp(i,e,r){return m_(i,e,r,!0)}function xp(i,e,r,s){return g_(i,e,r,s,!0)}function bp(i,e,r,s,u,d){return __(i,e,r,s,!0,d)}function m_(i,e,r,s){const u=new Array(s?r+1:r);for(let d=0;d<2*r;d+=2)u[d/2]=new C(i[e+d],i[e+d+1]);return s&&(u[u.length-1]=u[0]),u}function g_(i,e,r,s,u){const d=new Array(u?s+1:s);for(let m=0;m<2*s;m+=2){const y=2*e[r+m/2];d[m/2]=new C(i[y],i[y+1])}return u&&(d[d.length-1]=d[0]),d}function __(i,e,r,s,u,d){const m=new Array(u?s+1:s);for(let y=0;y<s;y++){const w=p_(i[e[r+y]],d.numBits,d.coordinateShift);m[y]=new C(w.x,w.y)}return u&&(m[m.length-1]=m[0]),m}class kx{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,r,s,u,d){this._vertexBufferType=e,this._topologyVector=r,this._vertexOffsets=s,this._vertexBuffer=u,this._mortonSettings=d}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Ax(this);let r=0;for(;r<this.numGeometries;)yield{coordinates:e[r],type:this.geometryType(r)},r++}getSimpleEncodedVertex(e){const r=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[r],this.vertexBuffer[r+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const s=p_(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[s.x,s.y]}const r=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[r],this.vertexBuffer[r+1]]}getGeometries(){return Ax(this)}get mortonSettings(){return this._mortonSettings}}class Dx extends kx{_numGeometries;_geometryType;constructor(e,r,s,u,d,m,y){super(s,u,d,m,y),this._numGeometries=e,this._geometryType=r}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Lr.POLYGON||this._geometryType===Lr.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class zx extends kx{_geometryTypes;constructor(e,r,s,u,d,m){super(e,s,u,d,m),this._geometryTypes=r}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===Lr.POLYGON||this.geometryType(e)===Lr.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Rx{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,r,s,u){this._triangleOffsets=e,this._indexBuffer=r,this._vertexBuffer=s,this._topologyVector=u}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),r=this._topologyVector,s=r.partOffsets,u=r.ringOffsets,d=r.geometryOffsets;let m=0,y=1,w=1,M=1;for(let I=0;I<this.numGeometries;I++)switch(this.geometryType(I)){case Lr.POLYGON:{const k=s[y]-s[y-1];y++;const L=[];for(let F=0;F<k;F++){const j=u[w]-u[w-1];w++;const q=[];for(let Z=0;Z<j;Z++){const Y=this._vertexBuffer[m++],fe=this._vertexBuffer[m++];q.push(new C(Y,fe))}q.length>0&&q.push(q[0]),L.push(q)}e[I]=L,d&&M++}break;case Lr.MULTIPOLYGON:{const k=d[M]-d[M-1];M++;const L=[];for(let F=0;F<k;F++){const j=s[y]-s[y-1];y++;for(let q=0;q<j;q++){const Z=u[w]-u[w-1];w++;const Y=[];for(let fe=0;fe<Z;fe++){const J=this._vertexBuffer[m++],ne=this._vertexBuffer[m++];Y.push(new C(J,ne))}Y.length>0&&Y.push(Y[0]),L.push(Y)}}e[I]=L}}return e}[Symbol.iterator](){return null}}function Lx(i,e,r,s,u,d){return new NE(i,e,r,s,u,d)}class NE extends Rx{_numGeometries;_geometryType;constructor(e,r,s,u,d,m){super(s,u,d,m),this._numGeometries=e,this._geometryType=r}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function Fx(i,e,r,s,u){return new VE(i,e,r,s,u)}class VE extends Rx{_geometryTypes;constructor(e,r,s,u,d){super(r,s,u,d),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function jE(i,e,r,s,u){const d=yi(i,r);let m=null,y=null,w=null,M=null,I=null,k=null,L=null,F=null;if(yp(d,s,i,r)===Rr.CONST){const q=f_(i,r,d,!1);for(let Z=0;Z<e-1;Z++){const Y=yi(i,r);switch(Y.physicalStreamType){case Kr.LENGTH:switch(Y.logicalStreamType.lengthType){case Ni.GEOMETRIES:m=Is(i,r,Y);break;case Ni.PARTS:y=Is(i,r,Y);break;case Ni.RINGS:w=Is(i,r,Y);break;case Ni.TRIANGLES:L=Is(i,r,Y)}break;case Kr.OFFSET:switch(Y.logicalStreamType.offsetType){case Bl.VERTEX:M=vi(i,r,Y,!1);break;case Bl.INDEX:F=vi(i,r,Y,!1)}break;case Kr.DATA:Pa.VERTEX===Y.logicalStreamType.dictionaryType?I=vi(i,r,Y,!0):(k={numBits:Y.numBits,coordinateShift:Y.coordinateShift},I=vi(i,r,Y,!1))}}return F!==null?m!=null||y!=null?Lx(s,q,L,F,I,new lu(m,y,w)):Lx(s,q,L,F,I):k===null?(function(Z,Y,fe,J,ne){return new Dx(Z,Y,na.VEC_2,fe,J,ne)})(s,q,new lu(m,y,w),M,I):(function(Z,Y,fe,J,ne,ge){return new Dx(Z,Y,na.MORTON,fe,J,ne,ge)})(s,q,new lu(m,y,w),M,I,k)}const j=vi(i,r,d,!1);for(let q=0;q<e-1;q++){const Z=yi(i,r);switch(Z.physicalStreamType){case Kr.LENGTH:switch(Z.logicalStreamType.lengthType){case Ni.GEOMETRIES:m=vi(i,r,Z,!1);break;case Ni.PARTS:y=vi(i,r,Z,!1);break;case Ni.RINGS:w=vi(i,r,Z,!1);break;case Ni.TRIANGLES:L=Is(i,r,Z)}break;case Kr.OFFSET:switch(Z.logicalStreamType.offsetType){case Bl.VERTEX:M=vi(i,r,Z,!1);break;case Bl.INDEX:F=vi(i,r,Z,!1)}break;case Kr.DATA:Pa.VERTEX===Z.logicalStreamType.dictionaryType?I=vi(i,r,Z,!0):(k={numBits:Z.numBits,coordinateShift:Z.coordinateShift},I=vi(i,r,Z,!1))}}return F!==null&&y===null?Fx(j,L,F,I):(m!==null?(m=y_(j,m,2),y!==null&&w!==null?(y=Bx(j,m,y,!1),w=(function(q,Z,Y,fe){const J=new Int32Array(Y[Y.length-1]+1);let ne=0;J[0]=ne;let ge=1,we=1,De=0;for(let Ke=0;Ke<q.length;Ke++){const Ge=q[Ke],tt=Z[Ke+1]-Z[Ke];if(Ge!==0&&Ge!==3)for(let ht=0;ht<tt;ht++){const it=Y[ge]-Y[ge-1];ge++;for(let He=0;He<it;He++)ne=J[we++]=ne+fe[De++]}else for(let ht=0;ht<tt;ht++)J[we++]=++ne,ge++}return J})(j,m,y,w)):y!==null&&(y=(function(q,Z,Y){const fe=new Int32Array(Z[Z.length-1]+1);let J=0;fe[0]=J;let ne=1,ge=0;for(let we=0;we<q.length;we++){const De=q[we],Ke=Z[we+1]-Z[we];if(De===4||De===1)for(let Ge=0;Ge<Ke;Ge++)J=fe[ne++]=J+Y[ge++];else for(let Ge=0;Ge<Ke;Ge++)fe[ne++]=++J}return fe})(j,m,y))):y!==null&&w!==null?(y=y_(j,y,1),w=Bx(j,y,w,!0)):y!==null&&(y=y_(j,y,0)),F!==null?Fx(j,L,F,I,new lu(m,y,w)):k===null?(function(q,Z,Y,fe){return new zx(na.VEC_2,q,Z,Y,fe)})(j,new lu(m,y,w),M,I):(function(q,Z,Y,fe,J){return new zx(na.MORTON,q,Z,Y,fe,J)})(j,new lu(m,y,w),M,I,k))}function y_(i,e,r){const s=new Int32Array(i.length+1);let u=0;s[0]=u;let d=0;for(let m=0;m<i.length;m++)u=s[m+1]=u+(i[m]>r?e[d++]:1);return s}function Bx(i,e,r,s){const u=new Int32Array(e[e.length-1]+1);let d=0;u[0]=d;let m=1,y=0;for(let w=0;w<i.length;w++){const M=i[w],I=e[w+1]-e[w];if(M===5||M===2||s&&(M===4||M===1))for(let k=0;k<I;k++)d=u[m++]=d+r[y++];else for(let k=0;k<I;k++)u[m++]=++d}return u}class UE extends ou{dataVector;constructor(e,r,s){super(e,r.getBuffer(),s),this.dataVector=r}getValueFromBuffer(e){return this.dataVector.get(e)}}class qE extends mp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Ox extends ou{constructor(e,r,s){super(e,BigInt64Array.of(r),s)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Yh(i,e,r){return Nx(i,Math.ceil(e/8),r)}function Nx(i,e,r){const s=new Uint8Array(e);let u=0;for(;u<e;){const d=i[r.increment()];if(d<=127){const m=d+3,y=i[r.increment()],w=u+m;s.fill(y,u,w),u=w}else{const m=256-d;for(let y=0;y<m;y++)s[u++]=i[r.increment()]}}return s}const GE=new TextDecoder;function v_(i,e,r){return r-e>=12?GE.decode(i.subarray(e,r)):(function(s,u,d){let m="",y=u;for(;y<d;){const w=s[y];let M,I,k,L=null,F=w>239?4:w>223?3:w>191?2:1;if(y+F>d)break;F===1?w<128&&(L=w):F===2?(M=s[y+1],(192&M)==128&&(L=(31&w)<<6|63&M,L<=127&&(L=null))):F===3?(M=s[y+1],I=s[y+2],(192&M)==128&&(192&I)==128&&(L=(15&w)<<12|(63&M)<<6|63&I,(L<=2047||L>=55296&&L<=57343)&&(L=null))):F===4&&(M=s[y+1],I=s[y+2],k=s[y+3],(192&M)==128&&(192&I)==128&&(192&k)==128&&(L=(15&w)<<18|(63&M)<<12|(63&I)<<6|63&k,(L<=65535||L>=1114112)&&(L=null))),L===null?(L=65533,F=1):L>65535&&(L-=65536,m+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),m+=String.fromCharCode(L),y+=F}return m})(i,e,r)}class x_ extends ou{offsetBuffer;constructor(e,r,s,u){super(e,s,u),this.offsetBuffer=r}}class Vx extends x_{textEncoder;constructor(e,r,s,u){super(e,r,s,u??r.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return v_(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class cu extends x_{indexBuffer;textEncoder;constructor(e,r,s,u,d){super(e,s,u,d??r.length),this.indexBuffer=r,this.indexBuffer=r,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const r=this.indexBuffer[e];return v_(this.dataBuffer,this.offsetBuffer[r],this.offsetBuffer[r+1])}}class jx extends x_{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,r,s,u,d,m,y){super(e,s,u,y),this.indexBuffer=r,this.symbolOffsetBuffer=d,this.symbolTableBuffer=m,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(s,u,d){const m=[],y=new Array(u.length).fill(0);for(let w=1;w<u.length;w++)y[w]=y[w-1]+u[w-1];for(let w=0;w<d.length;w++)if(d[w]===255)m.push(d[++w]);else{const M=u[d[w]],I=y[d[w]];for(let k=0;k<M;k++)m.push(s[I+k])}return new Uint8Array(m)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const r=this.indexBuffer[e];return v_(this.decodedDictionary,this.offsetBuffer[r],this.offsetBuffer[r+1])}offsetToLengthBuffer(e){const r=new Uint32Array(e.length-1);let s=e[0];for(let u=1;u<e.length;u++){const d=e[u];r[u-1]=d-s,s=d}return r}}function $E(i,e,r,s,u,d){return r.type==="scalarType"?(function(m,y,w,M,I,k){let L=null,F=0;if(m===0)return null;if(k.nullable){const q=yi(y,w);F=q.numValues;const Z=w.get(),Y=Yh(y,F,w);w.set(Z+q.byteLength),L=new Ea(Y,q.numValues)}const j=L??M;switch(I.physicalType){case 4:case 3:return(function(q,Z,Y,fe,J){const ne=yi(q,Z),ge=yp(ne,J,q,Z),we=fe.physicalType===3;if(ge===Rr.FLAT){const De=Kh(J)?d_(q,Z,ne,we,J):vi(q,Z,ne,we);return new o_(Y.name,De,J)}if(ge===Rr.SEQUENCE){const De=Tx(q,Z,ne);return new l_(Y.name,De[0],De[1],ne.numRleValues)}{const De=f_(q,Z,ne,we);return new c_(Y.name,De,J)}})(y,w,k,I,j);case 9:return(function(q,Z,Y,fe,J){let ne=null,ge=null,we=null,De=null,Ke=null,Ge=null,tt=null,ht=null;for(let it=0;it<fe;it++){const He=yi(Z,Y);if(He.byteLength!==0)switch(He.physicalStreamType){case Kr.PRESENT:{const Ne=Yh(Z,He.numValues,Y);Ge=new Ea(Ne,He.numValues);break}case Kr.OFFSET:ge=J!=null||Ge!=null?d_(Z,Y,He,!1,J??Ge):vi(Z,Y,He,!1);break;case Kr.LENGTH:{const Ne=Is(Z,Y,He);Ni.DICTIONARY===He.logicalStreamType.lengthType?ne=Ne:Ni.SYMBOL===He.logicalStreamType.lengthType?De=Ne:tt=Ne;break}case Kr.DATA:{const Ne=Z.subarray(Y.get(),Y.get()+He.byteLength);Y.add(He.byteLength);const bt=He.logicalStreamType.dictionaryType;Pa.FSST===bt?Ke=Ne:Pa.SINGLE===bt||Pa.SHARED===bt?we=Ne:Pa.NONE===bt&&(ht=Ne);break}}}return(function(it,He,Ne,bt,yt,St,mt){return He?new jx(it,Ne,bt,yt,St,He,mt):null})(q,Ke,ge,ne,we,De,J??Ge)??(function(it,He,Ne,bt,yt){return He?yt?new cu(it,Ne,bt,He,yt):new cu(it,Ne,bt,He):null})(q,we,ge,ne,J??Ge)??(function(it,He,Ne,bt,yt){if(!He||!Ne)return null;if(bt)return yt?new cu(it,bt,He,Ne,yt):new cu(it,bt,He,Ne);if(yt&&yt.size()!==He.length-1){const St=new Int32Array(yt.size());let mt=0;for(let Lt=0;Lt<yt.size();Lt++)St[Lt]=yt.get(Lt)?mt++:0;return new cu(it,St,He,Ne,yt)}return yt?new Vx(it,He,Ne,yt):new Vx(it,He,Ne)})(q,tt,ht,ge,J??Ge)})(k.name,y,w,k.nullable?m-1:m,L);case 0:return(function(q,Z,Y,fe,J){const ne=yi(q,Z),ge=ne.numValues,we=Z.get(),De=Kh(J)?(function(Ge,tt,ht,it){const He=Nx(Ge,Math.ceil(tt/8),ht),Ne=new Ea(He,tt),bt=it.size(),yt=new Ea(new Uint8Array(bt),bt);let St=0;for(let mt=0;mt<it.size();mt++){const Lt=!!it.get(mt)&&Ne.get(St++);yt.set(mt,Lt)}return yt.getBuffer()})(q,ge,Z,J):Yh(q,ge,Z);Z.set(we+ne.byteLength);const Ke=new Ea(De,ge);return new UE(Y.name,Ke,J)})(y,w,k,0,j);case 6:case 5:return(function(q,Z,Y,fe,J){const ne=yi(q,Z),ge=yp(ne,fe,q,Z),we=J.physicalType===5;if(ge===Rr.FLAT){const De=Kh(fe)?(function(Ke,Ge,tt,ht,it){return(function(He,Ne,bt,yt){switch(Ne.logicalLevelTechnique1){case un.DELTA:return Ne.logicalLevelTechnique2===un.RLE&&(He=xx(He,Ne.runs,Ne.numRleValues)),(function(St,mt){const Lt=new BigInt64Array(St.size());let Tn=0;St.get(0)?(Lt[0]=St.get(0)?mt[0]>>1n^-(1n&mt[0]):0n,Tn=1):Lt[0]=0n;let ln=1;for(;ln!=Lt.length;++ln)Lt[ln]=St.get(ln)?Lt[ln-1]+(mt[Tn]>>1n^-(1n&mt[Tn++])):Lt[ln-1];return Lt})(yt,He);case un.RLE:return(function(St,mt,Lt,Tn){const ln=mt;return Lt?(function(Kn,Qr,wr){const Jn=new BigInt64Array(Kn.size());let Wn=0;for(let En=0;En<wr;En++){const cr=Number(Qr[En]);let mr=Qr[En+wr];mr=mr>>1n^-(1n&mr);for(let qn=Wn;qn<Wn+cr;qn++)Kn.get(qn)?Jn[qn]=mr:(Jn[qn]=0n,Wn++);Wn+=cr}return Jn})(Tn,St,ln.runs):(function(Kn,Qr,wr){const Jn=new BigInt64Array(Kn.size());let Wn=0;for(let En=0;En<wr;En++){const cr=Number(Qr[En]),mr=Qr[En+wr];for(let qn=Wn;qn<Wn+cr;qn++)Kn.get(qn)?Jn[qn]=mr:(Jn[qn]=0n,Wn++);Wn+=cr}return Jn})(Tn,St,ln.runs)})(He,Ne,bt,yt);case un.NONE:return He=bt?(function(St,mt){const Lt=new BigInt64Array(St.size());let Tn=0,ln=0;for(;ln!=Lt.length;++ln)if(St.get(ln)){const Kn=mt[Tn++];Lt[ln]=Kn>>1n^-(1n&Kn)}else Lt[ln]=0n;return Lt})(yt,He):(function(St,mt){const Lt=new BigInt64Array(St.size());let Tn=0,ln=0;for(;ln!=Lt.length;++ln)Lt[ln]=St.get(ln)?mt[Tn++]:0n;return Lt})(yt,He),He;default:throw new Error("The specified Logical level technique is not supported")}})(gp(Ke,Ge,tt.numValues),tt,ht,it)})(q,Z,ne,we,fe):Mx(q,Z,ne,we);return new Ex(Y.name,De,fe)}if(ge===Rr.SEQUENCE){const De=Sx(q,Z,ne);return new Cx(Y.name,De[0],De[1],ne.numRleValues)}{const De=Px(q,Z,ne,we);return new Ox(Y.name,De,fe)}})(y,w,k,j,I);case 7:return(function(q,Z,Y,fe){const J=yi(q,Z),ne=Kh(fe)?(function(ge,we,De,Ke){const Ge=we.get(),tt=Ge+Ke*Float32Array.BYTES_PER_ELEMENT,ht=new Uint8Array(ge.subarray(Ge,tt)).buffer,it=new Float32Array(ht);we.set(tt);const He=De.size(),Ne=new Float32Array(He);let bt=0;for(let yt=0;yt<He;yt++)Ne[yt]=De.get(yt)?it[bt++]:0;return Ne})(q,Z,fe,J.numValues):(function(ge,we,De){const Ke=we.get(),Ge=Ke+De*Float32Array.BYTES_PER_ELEMENT,tt=new Uint8Array(ge.subarray(Ke,Ge)).buffer,ht=new Float32Array(tt);return we.set(Ge),ht})(q,Z,J.numValues);return new qE(Y.name,ne,fe)})(y,w,k,j);case 8:return(function(q,Z,Y,fe){const J=yi(q,Z),ne=Kh(fe)?(function(ge,we,De,Ke){const Ge=we.get(),tt=Ge+Ke*Float64Array.BYTES_PER_ELEMENT,ht=new Uint8Array(ge.subarray(Ge,tt)).buffer,it=new Float64Array(ht);we.set(tt);const He=De.size(),Ne=new Float64Array(He);let bt=0;for(let yt=0;yt<He;yt++)Ne[yt]=De.get(yt)?it[bt++]:0;return Ne})(q,Z,fe,J.numValues):(function(ge,we,De){const Ke=we.get(),Ge=Ke+De*Float64Array.BYTES_PER_ELEMENT,tt=new Uint8Array(ge.subarray(Ke,Ge)).buffer,ht=new Float64Array(tt);return we.set(Ge),ht})(q,Z,J.numValues);return new s_(Y.name,ne,fe)})(y,w,k,j);default:throw new Error(`The specified data type for the field is currently not supported: ${I}`)}})(s,i,e,u,r.scalarType,r):s!=1?null:(function(m,y,w,M){let I=null,k=null,L=null,F=null,j=!1;for(;!j;){const fe=yi(m,y);switch(fe.physicalStreamType){case Kr.LENGTH:Ni.DICTIONARY===fe.logicalStreamType.lengthType?I=Is(m,y,fe):L=Is(m,y,fe);break;case Kr.DATA:Pa.SINGLE===fe.logicalStreamType.dictionaryType||Pa.SHARED===fe.logicalStreamType.dictionaryType?(k=m.subarray(y.get(),y.get()+fe.byteLength),j=!0):F=m.subarray(y.get(),y.get()+fe.byteLength),y.add(fe.byteLength)}}const q=w.complexType.children,Z=[];let Y=0;for(const fe of q){const J=Ur(m,y,1)[0];if(J==0)continue;const ne=`${w.name}${fe.name==="default"?"":":"+fe.name}`;if(J!==2||fe.type!=="scalarField"||fe.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const ge=yi(m,y),we=Yh(m,ge.numValues,y),De=yi(m,y),Ke=De.decompressedCount!==M?d_(m,y,De,!1,new Ea(we,ge.numValues)):vi(m,y,De,!1);Z[Y++]=F?new jx(ne,Ke,I,k,L,F,new Ea(we,ge.numValues)):new cu(ne,Ke,I,k,new Ea(we,ge.numValues))}return Z})(i,e,r,u)}function Kh(i){return i instanceof Ea}function ZE(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const e=i.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(i.type==="complexType"){const e=i.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}const WE=new TextDecoder;function Ux(i,e){const r=Ur(i,e,1)[0];if(r===0)return"";const s=e.get(),u=i.subarray(s,s+r);return e.add(r),WE.decode(u)}function qx(i,e){const r=Ur(i,e,1)[0]>>>0,s=!!(4&r),u=!!(2&r),d=Ur(i,e,1)[0]>>>0,m={};if(1&r&&(m.nullable=!0),u){const y={};if(s?(y.type="logicalType",y.logicalType=d):(y.type="physicalType",y.physicalType=d),8&r){const w=Ur(i,e,1)[0]>>>0;y.children=new Array(w);for(let M=0;M<w;M++)y.children[M]=qx(i,e)}m.type="complexField",m.complexField=y}else{const y={};s?(y.type="logicalType",y.logicalType=d):(y.type="physicalType",y.physicalType=d),m.type="scalarField",m.scalarField=y}return m}function HE(i,e){const r=Ur(i,e,1)[0]>>>0,s=(function(u){switch(u){case 0:case 1:case 2:case 3:{const d={};d.nullable=!!(1&u),d.columnScope=0;const m={};return m.physicalType=u>1?6:4,m.type="physicalType",d.scalarType=m,d.type="scalarType",d}case 4:{const d={nullable:!1,columnScope:0},m={type:"physicalType",physicalType:0};return d.type="complexType",d.complexType=m,d}case 30:{const d={nullable:!1,columnScope:0},m={type:"physicalType",physicalType:1};return d.type="complexType",d.complexType=m,d}default:return(function(d){let m=null;switch(d){case 10:case 11:m=0;break;case 12:case 13:m=1;break;case 14:case 15:m=2;break;case 16:case 17:m=3;break;case 18:case 19:m=4;break;case 20:case 21:m=5;break;case 22:case 23:m=6;break;case 24:case 25:m=7;break;case 26:case 27:m=8;break;case 28:case 29:m=9;break;default:return null}const y={};y.nullable=!!(1&d),y.columnScope=0;const w={type:"physicalType"};return w.physicalType=m,y.type="scalarType",y.scalarType=w,y})(u)}})(r);if(!s)throw new Error(`Unsupported column type code: ${r}`);if((function(u){return u>=10})(r)?s.name=Ux(i,e):r>=0&&r<=3?s.name="id":r===4&&(s.name="geometry"),(function(u){return u===30})(r)){const u=Ur(i,e,1)[0]>>>0,d=s.complexType;d.children=new Array(u);for(let m=0;m<u;m++)d.children[m]=qx(i,e)}return s}function XE(i,e){const r={featureTables:[]},s={};s.name=Ux(i,e);const u=Ur(i,e,1)[0]>>>0,d=Ur(i,e,1)[0]>>>0;s.columns=new Array(d);for(let m=0;m<d;m++)s.columns[m]=HE(i,e);return r.featureTables.push(s),[r,u]}function YE(i,e,r,s,u,d,m=!1){const y=e.scalarType.physicalType,w=yp(u,d,i,r);if(y===4)switch(w){case Rr.FLAT:{const M=vi(i,r,u,!1);return new o_(s,M,d)}case Rr.SEQUENCE:{const M=Tx(i,r,u);return new l_(s,M[0],M[1],u.numRleValues)}case Rr.CONST:{const M=f_(i,r,u,!1);return new c_(s,M,d)}}else switch(w){case Rr.FLAT:{if(m){const I=(function(k,L,F,j){const q=(function(Z,Y,fe){const J=new Float64Array(Y);for(let ne=0;ne<Y;ne++)J[ne]=FE(Z,fe);return J})(k,F.numValues,L);return(function(Z,Y,fe){switch(Y.logicalLevelTechnique1){case un.DELTA:return Y.logicalLevelTechnique2===un.RLE&&(Z=bx(Z,Y.runs,Y.numRleValues)),(function(J){J[0]=J[0]%2==1?(J[0]+1)/-2:J[0]/2;const ne=J.length/4*4;let ge=1;if(ne>=4)for(;ge<ne-4;ge+=4){const we=J[ge],De=J[ge+1],Ke=J[ge+2],Ge=J[ge+3];J[ge]=(we%2==1?(we+1)/-2:we/2)+J[ge-1],J[ge+1]=(De%2==1?(De+1)/-2:De/2)+J[ge],J[ge+2]=(Ke%2==1?(Ke+1)/-2:Ke/2)+J[ge+1],J[ge+3]=(Ge%2==1?(Ge+1)/-2:Ge/2)+J[ge+2]}for(;ge!=J.length;++ge)J[ge]=(J[ge]%2==1?(J[ge]+1)/-2:J[ge]/2)+J[ge-1]})(Z),Z;case un.RLE:return(function(J,ne,ge){return bx(J,ne.runs,ne.numRleValues)})(Z,Y);case un.NONE:return Z;default:throw new Error(`The specified Logical level technique is not supported: ${Y.logicalLevelTechnique1}`)}})(q,F)})(i,r,u);return new s_(s,I,d)}const M=Mx(i,r,u,!1);return new Ex(s,M,d)}case Rr.SEQUENCE:{const M=Sx(i,r,u);return new Cx(s,M[0],M[1],u.numRleValues)}case Rr.CONST:{const M=Px(i,r,u,!1);return new Ox(s,M,d)}}throw new Error("Vector type not supported for id column.")}class KE{constructor(e,r){var s;switch(this._featureData=e,this.properties=this._featureData.properties||{},(s=this._featureData.geometry)===null||s===void 0?void 0:s.type){case Lr.POINT:case Lr.MULTIPOINT:this.type=1;break;case Lr.LINESTRING:case Lr.MULTILINESTRING:this.type=2;break;case Lr.POLYGON:case Lr.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=r,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const r of this._featureData.geometry.coordinates){const s=[];for(const u of r)s.push(new C(u.x,u.y));e.push(s)}return e}}class JE{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new KE(this.features[e],this.extent)}}class Gx{constructor(e){this.layers={};const r=(function(s,u,d=!0){const m=new LE(0),y=[];for(;m.get()<s.length;){const w=Ur(s,m,1)[0]>>>0,M=m.get()+w;if(M>s.length)throw new Error(`Block overruns tile: ${M} > ${s.length}`);if(Ur(s,m,1)[0]>>>0!=1){m.set(M);continue}const I=XE(s,m),k=I[1],L=I[0].featureTables[0];let F=null,j=null;const q=[];let Z=0;for(const fe of L.columns){const J=fe.name;if(J==="id"){let ne=null;if(fe.nullable){const we=yi(s,m),De=m.get(),Ke=Yh(s,we.numValues,m);m.set(De+we.byteLength),ne=new Ea(Ke,we.numValues)}const ge=yi(s,m);Z=ge.decompressedCount,F=YE(s,fe,m,J,ge,ne??Z,d)}else if(J==="geometry"){const ne=Ur(s,m,1)[0];if(Z===0){const ge=m.get();Z=yi(s,m).decompressedCount,m.set(ge)}j=jE(s,ne,m,Z)}else{const ne=ZE(fe)?Ur(s,m,1)[0]:1;if(ne===0&&fe.type==="scalarType")continue;const ge=$E(s,m,fe,ne,Z);if(ge)if(Array.isArray(ge))for(const we of ge)q.push(we);else q.push(ge)}}const Y=new RE(L.name,j,F,q,k);y.push(Y),m.set(M)}return y})(new Uint8Array(e));this.layers=r.reduce(((s,u)=>Object.assign(Object.assign({},s),{[u.name]:new JE(u)})),{})}}class QE{constructor(e,r){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=r,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],r=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const s of r){const u=[];for(const d of s)u.push(new C(d[0],d[1]));e.push(u)}return e}}const Jh="_geojsonTileLayer";function eC(i,e){e.writeVarintField(15,i.version||1),e.writeStringField(1,i.name||""),e.writeVarintField(5,i.extent||4096);const r={keys:[],values:[],keycache:{},valuecache:{}};for(let d=0;d<i.length;d++)r.feature=i.feature(d),e.writeMessage(2,tC,r);const s=r.keys;for(const d of s)e.writeStringField(3,d);const u=r.values;for(const d of u)e.writeMessage(4,iC,d)}function tC(i,e){if(!i.feature)return;const r=i.feature;r.id!==void 0&&e.writeVarintField(1,r.id),e.writeMessage(2,nC,i),e.writeVarintField(3,r.type),e.writeMessage(4,rC,r)}function nC(i,e){for(const r in i.feature?.properties){let s=i.feature.properties[r],u=i.keycache[r];if(s==null)continue;u===void 0&&(i.keys.push(r),u=i.keys.length-1,i.keycache[r]=u),e.writeVarint(u),typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"&&(s=JSON.stringify(s));const d=typeof s+":"+s;let m=i.valuecache[d];m===void 0&&(i.values.push(s),m=i.values.length-1,i.valuecache[d]=m),e.writeVarint(m)}}function b_(i,e){return(e<<3)+(7&i)}function $x(i){return i<<1^i>>31}function rC(i,e){const r=i.loadGeometry(),s=i.type;let u=0,d=0;for(const m of r){let y=1;s===1&&(y=m.length),e.writeVarint(b_(1,y));const w=s===3?m.length-1:m.length;for(let M=0;M<w;M++){M===1&&s!==1&&e.writeVarint(b_(2,w-1));const I=m[M].x-u,k=m[M].y-d;e.writeVarint($x(I)),e.writeVarint($x(k)),u+=I,d+=k}i.type===3&&e.writeVarint(b_(7,1))}}function iC(i,e){const r=typeof i;r==="string"?e.writeStringField(1,i):r==="boolean"?e.writeBooleanField(7,i):r==="number"&&(i%1!=0?e.writeDoubleField(3,i):i<0?e.writeSVarintField(6,i):e.writeVarintField(5,i))}class Zx{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ws(at,16,0),this.grid3D=new ws(at,16,0),this.featureIndexArray=new X,this.promoteId=r}insert(e,r,s,u,d,m){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,d);const w=m?this.grid3D:this.grid;for(let M=0;M<r.length;M++){const I=r[M],k=[1/0,1/0,-1/0,-1/0];for(let L=0;L<I.length;L++){const F=I[L];k[0]=Math.min(k[0],F.x),k[1]=Math.min(k[1],F.y),k[2]=Math.max(k[2],F.x),k[3]=Math.max(k[3],F.y)}k[0]<at&&k[1]<at&&k[2]>=0&&k[3]>=0&&w.insert(y,k[0],k[1],k[2],k[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new kv(new up(this.rawTileData)).layers:new Gx(this.rawTileData).layers,this.sourceLayerCoder=new px(this.vtLayers?Object.keys(this.vtLayers).sort():[Jh])),this.vtLayers}query(e,r,s,u){this.loadVTLayers();const d=e.params,m=at/e.tileSize/e.scale,y=fl(d.filter,d.globalState),w=e.queryGeometry,M=e.queryPadding*m,I=Fl.fromPoints(w),k=this.grid.query(I.minX-M,I.minY-M,I.maxX+M,I.maxY+M),L=Fl.fromPoints(e.cameraQueryGeometry).expandBy(M),F=this.grid3D.query(L.minX,L.minY,L.maxX,L.maxY,((Z,Y,fe,J)=>(function(ne,ge,we,De,Ke){for(const tt of ne)if(ge<=tt.x&&we<=tt.y&&De>=tt.x&&Ke>=tt.y)return!0;const Ge=[new C(ge,we),new C(ge,Ke),new C(De,Ke),new C(De,we)];if(ne.length>2){for(const tt of Ge)if(Kc(ne,tt))return!0}for(let tt=0;tt<ne.length-1;tt++)if(oP(ne[tt],ne[tt+1],Ge))return!0;return!1})(e.cameraQueryGeometry,Z-M,Y-M,fe+M,J+M)));for(const Z of F)k.push(Z);k.sort(aC);const j={};let q;for(let Z=0;Z<k.length;Z++){const Y=k[Z];if(Y===q)continue;q=Y;const fe=this.featureIndexArray.get(Y);let J=null;this.loadMatchingFeature(j,fe.bucketIndex,fe.sourceLayerIndex,fe.featureIndex,y,d.layers,d.availableImages,r,s,u,((ne,ge,we)=>(J||(J=Ya(ne)),ge.queryIntersectsFeature({queryGeometry:w,feature:ne,featureState:we,geometry:J,zoom:this.z,transform:e.transform,pixelsToTileUnits:m,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return j}loadMatchingFeature(e,r,s,u,d,m,y,w,M,I,k){const L=this.bucketLayerIDs[r];if(m&&!L.some((Z=>m.has(Z))))return;const F=this.sourceLayerCoder.decode(s),j=this.vtLayers[F].feature(u);if(d.needGeometry){const Z=Ka(j,!0);if(!d.filter(new Rn(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!d.filter(new Rn(this.tileID.overscaledZ),j))return;const q=this.getId(j,F);for(let Z=0;Z<L.length;Z++){const Y=L[Z];if(m&&!m.has(Y))continue;const fe=w[Y];if(!fe)continue;let J={};q&&I&&(J=I.getState(fe.sourceLayer||Jh,q));const ne=Kt({},M[Y]);ne.paint=Wx(ne.paint,fe.paint,j,J,y),ne.layout=Wx(ne.layout,fe.layout,j,J,y);const ge=!k||k(j,fe,J);if(!ge)continue;const we=new mx(j,this.z,this.x,this.y,q);we.layer=ne;let De=e[Y];De===void 0&&(De=e[Y]=[]),De.push({featureIndex:u,feature:we,intersectionZ:ge})}}lookupSymbolFeatures(e,r,s,u,d,m,y,w){const M={};this.loadVTLayers();const I=fl(d.filterSpec,d.globalState);for(const k of e)this.loadMatchingFeature(M,s,u,k,I,m,y,w,r);return M}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){var s;let u=e.id;return this.promoteId&&(u=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((s=e.properties)===null||s===void 0)&&s.cluster)&&this.promoteId&&(u=Number(e.properties.cluster_id))),u}}function Wx(i,e,r,s,u){return _t(i,((d,m)=>{const y=e instanceof Ml?e.get(m):null;return y&&y.evaluate?y.evaluate(r,s,u):y}))}function aC(i,e){return e-i}function Hx(i,e,r,s,u){const d=[];for(let m=0;m<i.length;m++){const y=i[m];let w;for(let M=0;M<y.length-1;M++){let I=y[M],k=y[M+1];I.x<e&&k.x<e||(I.x<e?I=new C(e,I.y+(e-I.x)/(k.x-I.x)*(k.y-I.y))._round():k.x<e&&(k=new C(e,I.y+(e-I.x)/(k.x-I.x)*(k.y-I.y))._round()),I.y<r&&k.y<r||(I.y<r?I=new C(I.x+(r-I.y)/(k.y-I.y)*(k.x-I.x),r)._round():k.y<r&&(k=new C(I.x+(r-I.y)/(k.y-I.y)*(k.x-I.x),r)._round()),I.x>=s&&k.x>=s||(I.x>=s?I=new C(s,I.y+(s-I.x)/(k.x-I.x)*(k.y-I.y))._round():k.x>=s&&(k=new C(s,I.y+(s-I.x)/(k.x-I.x)*(k.y-I.y))._round()),I.y>=u&&k.y>=u||(I.y>=u?I=new C(I.x+(u-I.y)/(k.y-I.y)*(k.x-I.x),u)._round():k.y>=u&&(k=new C(I.x+(u-I.y)/(k.y-I.y)*(k.x-I.x),u)._round()),w&&I.equals(w[w.length-1])||(w=[I],d.push(w)),w.push(k)))))}}return d}function Xx(i,e,r,s,u){switch(e){case 1:return(function(d,m,y,w){const M=[];for(const I of d)for(const k of I){const L=w===0?k.x:k.y;L>=m&&L<=y&&M.push([k])}return M})(i,r,s,u);case 2:return Yx(i,r,s,u,!1);case 3:return Yx(i,r,s,u,!0)}return[]}function oC(i,e,r,s,u){const d=s===0?sC:lC;let m=[];const y=[];for(let I=0;I<i.length-1;I++){const k=i[I],L=i[I+1],F=s===0?k.x:k.y,j=s===0?L.x:L.y;let q=!1;F<e?j>e&&m.push(d(k,L,e)):F>r?j<r&&m.push(d(k,L,r)):m.push(k),j<e&&F>=e&&(m.push(d(k,L,e)),q=!0),j>r&&F<=r&&(m.push(d(k,L,r)),q=!0),!u&&q&&(y.push(m),m=[])}const w=i.length-1,M=s===0?i[w].x:i[w].y;return M>=e&&M<=r&&m.push(i[w]),u&&m.length>0&&!m[0].equals(m[m.length-1])&&m.push(new C(m[0].x,m[0].y)),m.length>0&&y.push(m),y}function Yx(i,e,r,s,u){const d=[];for(const m of i){const y=oC(m,e,r,s,u);y.length>0&&d.push(...y)}return d}function sC(i,e,r){return new C(r,i.y+(r-i.x)/(e.x-i.x)*(e.y-i.y))}function lC(i,e,r){return new C(i.x+(r-i.y)/(e.y-i.y)*(e.x-i.x),r)}wt("FeatureIndex",Zx,{omit:["rawTileData","sourceLayerCoder"]});class As extends C{constructor(e,r,s,u){super(e,r),this.angle=s,u!==void 0&&(this.segment=u)}clone(){return new As(this.x,this.y,this.angle,this.segment)}}function Kx(i,e,r,s,u){if(e.segment===void 0||r===0)return!0;let d=e,m=e.segment+1,y=0;for(;y>-r/2;){if(m--,m<0)return!1;y-=i[m].dist(d),d=i[m]}y+=i[m].dist(i[m+1]),m++;const w=[];let M=0;for(;y<r/2;){const I=i[m],k=i[m+1];if(!k)return!1;let L=i[m-1].angleTo(I)-I.angleTo(k);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:y,angleDelta:L}),M+=L;y-w[0].distance>s;)M-=w.shift().angleDelta;if(M>u)return!1;m++,y+=I.dist(k)}return!0}function Jx(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Qx(i,e,r){return i?.6*e*r:0}function eb(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function cC(i,e,r,s,u,d){const m=Qx(r,u,d),y=eb(r,s)*d;let w=0;const M=Jx(i)/2;for(let I=0;I<i.length-1;I++){const k=i[I],L=i[I+1],F=k.dist(L);if(w+F>M){const j=(M-w)/F,q=Hn.number(k.x,L.x,j),Z=Hn.number(k.y,L.y,j),Y=new As(q,Z,L.angleTo(k),I);return Y._round(),!m||Kx(i,Y,y,m,e)?Y:void 0}w+=F}}function uC(i,e,r,s,u,d,m,y,w){const M=Qx(s,d,m),I=eb(s,u),k=I*m,L=i[0].x===0||i[0].x===w||i[0].y===0||i[0].y===w;return e-k<e/4&&(e=k+e/4),tb(i,L?e/2*y%e:(I/2+2*d)*m*y%e,e,M,r,k,L,!1,w)}function tb(i,e,r,s,u,d,m,y,w){const M=d/2,I=Jx(i);let k=0,L=e-r,F=[];for(let j=0;j<i.length-1;j++){const q=i[j],Z=i[j+1],Y=q.dist(Z),fe=Z.angleTo(q);for(;L+r<k+Y;){L+=r;const J=(L-k)/Y,ne=Hn.number(q.x,Z.x,J),ge=Hn.number(q.y,Z.y,J);if(ne>=0&&ne<w&&ge>=0&&ge<w&&L-M>=0&&L+M<=I){const we=new As(ne,ge,fe,j);we._round(),s&&!Kx(i,we,d,s,u)||F.push(we)}}k+=Y}return y||F.length||m||(F=tb(i,k/2,r,s,u,d,m,!0,w)),F}function nb(i,e,r,s){const u=[],d=i.image,m=d.pixelRatio,y=d.paddedRect.w-2,w=d.paddedRect.h-2;let M={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const I=d.stretchX||[[0,y]],k=d.stretchY||[[0,w]],L=(Ne,bt)=>Ne+bt[1]-bt[0],F=I.reduce(L,0),j=k.reduce(L,0),q=y-F,Z=w-j;let Y=0,fe=F,J=0,ne=j,ge=0,we=q,De=0,Ke=Z;if(d.content&&s){const Ne=d.content,bt=Ne[2]-Ne[0],yt=Ne[3]-Ne[1];(d.textFitWidth||d.textFitHeight)&&(M=Kv(i)),Y=wp(I,0,Ne[0]),J=wp(k,0,Ne[1]),fe=wp(I,Ne[0],Ne[2]),ne=wp(k,Ne[1],Ne[3]),ge=Ne[0]-Y,De=Ne[1]-J,we=bt-fe,Ke=yt-ne}const Ge=M.x1,tt=M.y1,ht=M.x2-Ge,it=M.y2-tt,He=(Ne,bt,yt,St)=>{const mt=Tp(Ne.stretch-Y,fe,ht,Ge),Lt=Sp(Ne.fixed-ge,we,Ne.stretch,F),Tn=Tp(bt.stretch-J,ne,it,tt),ln=Sp(bt.fixed-De,Ke,bt.stretch,j),Kn=Tp(yt.stretch-Y,fe,ht,Ge),Qr=Sp(yt.fixed-ge,we,yt.stretch,F),wr=Tp(St.stretch-J,ne,it,tt),Jn=Sp(St.fixed-De,Ke,St.stretch,j),Wn=new C(mt,Tn),En=new C(Kn,Tn),cr=new C(Kn,wr),mr=new C(mt,wr),qn=new C(Lt/m,ln/m),Mi=new C(Qr/m,Jn/m),ei=e*Math.PI/180;if(ei){const Fr=Math.sin(ei),rr=Math.cos(ei),Tr=[rr,-Fr,Fr,rr];Wn._matMult(Tr),En._matMult(Tr),mr._matMult(Tr),cr._matMult(Tr)}const Pi=Ne.stretch+Ne.fixed,ua=bt.stretch+bt.fixed;return{tl:Wn,tr:En,bl:mr,br:cr,tex:{x:d.paddedRect.x+1+Pi,y:d.paddedRect.y+1+ua,w:yt.stretch+yt.fixed-Pi,h:St.stretch+St.fixed-ua},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qn,pixelOffsetBR:Mi,minFontScaleX:we/m/ht,minFontScaleY:Ke/m/it,isSDF:r}};if(s&&(d.stretchX||d.stretchY)){const Ne=rb(I,q,F),bt=rb(k,Z,j);for(let yt=0;yt<Ne.length-1;yt++){const St=Ne[yt],mt=Ne[yt+1];for(let Lt=0;Lt<bt.length-1;Lt++)u.push(He(St,bt[Lt],mt,bt[Lt+1]))}}else u.push(He({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:w+1}));return u}function wp(i,e,r){let s=0;for(const u of i)s+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return s}function rb(i,e,r){const s=[{fixed:-1,stretch:0}];for(const[u,d]of i){const m=s[s.length-1];s.push({fixed:u-m.stretch,stretch:m.stretch}),s.push({fixed:u-m.stretch,stretch:m.stretch+(d-u)})}return s.push({fixed:e+1,stretch:r}),s}function Tp(i,e,r,s){return i/e*r+s}function Sp(i,e,r,s){return i-e*r/s}wt("Anchor",As);class Mp{constructor(e,r,s,u,d,m,y,w,M,I){var k;if(this.boxStartIndex=e.length,M){let L=m.top,F=m.bottom;const j=m.collisionPadding;j&&(L-=j[1],F+=j[3]);let q=F-L;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{const L=!((k=m.image)===null||k===void 0)&&k.content&&(m.image.textFitWidth||m.image.textFitHeight)?Kv(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};L.y1=L.y1*y-w[0],L.y2=L.y2*y+w[2],L.x1=L.x1*y-w[3],L.x2=L.x2*y+w[1];const F=m.collisionPadding;if(F&&(L.x1-=F[0]*y,L.y1-=F[1]*y,L.x2+=F[2]*y,L.y2+=F[3]*y),I){const j=new C(L.x1,L.y1),q=new C(L.x2,L.y1),Z=new C(L.x1,L.y2),Y=new C(L.x2,L.y2),fe=I*Math.PI/180;j._rotate(fe),q._rotate(fe),Z._rotate(fe),Y._rotate(fe),L.x1=Math.min(j.x,q.x,Z.x,Y.x),L.x2=Math.max(j.x,q.x,Z.x,Y.x),L.y1=Math.min(j.y,q.y,Z.y,Y.y),L.y2=Math.max(j.y,q.y,Z.y,Y.y)}e.emplaceBack(r.x,r.y,L.x1,L.y1,L.x2,L.y2,s,u,d)}this.boxEndIndex=e.length}}class hC{constructor(e=[],r=(s,u)=>s<u?-1:s>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,u=r[e];for(;e>0;){const d=e-1>>1,m=r[d];if(s(u,m)>=0)break;r[e]=m,e=d}r[e]=u}_down(e){const{data:r,compare:s}=this,u=this.length>>1,d=r[e];for(;e<u;){let m=1+(e<<1);const y=m+1;if(y<this.length&&s(r[y],r[m])<0&&(m=y),s(r[m],d)>=0)break;r[e]=r[m],e=m}r[e]=d}}function fC(i,e=1,r=!1){const s=Fl.fromPoints(i[0]),u=Math.min(s.width(),s.height());let d=u/2;const m=new hC([],dC),{minX:y,minY:w,maxX:M,maxY:I}=s;if(u===0)return new C(y,w);for(let F=y;F<M;F+=u)for(let j=w;j<I;j+=u)m.push(new uu(F+d,j+d,d,i));let k=(function(F){let j=0,q=0,Z=0;const Y=F[0];for(let fe=0,J=Y.length,ne=J-1;fe<J;ne=fe++){const ge=Y[fe],we=Y[ne],De=ge.x*we.y-we.x*ge.y;q+=(ge.x+we.x)*De,Z+=(ge.y+we.y)*De,j+=3*De}return new uu(q/j,Z/j,0,F)})(i),L=m.length;for(;m.length;){const F=m.pop();(F.d>k.d||!k.d)&&(k=F,r&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,L)),F.max-k.d<=e||(d=F.h/2,m.push(new uu(F.p.x-d,F.p.y-d,d,i)),m.push(new uu(F.p.x+d,F.p.y-d,d,i)),m.push(new uu(F.p.x-d,F.p.y+d,d,i)),m.push(new uu(F.p.x+d,F.p.y+d,d,i)),L+=4)}return r&&(console.log(`num probes: ${L}`),console.log(`best distance: ${k.d}`)),k.p}function dC(i,e){return e.max-i.max}function uu(i,e,r,s){this.p=new C(i,e),this.h=r,this.d=(function(u,d){let m=!1,y=1/0;for(let w=0;w<d.length;w++){const M=d[w];for(let I=0,k=M.length,L=k-1;I<k;L=I++){const F=M[I],j=M[L];F.y>u.y!=j.y>u.y&&u.x<(j.x-F.x)*(u.y-F.y)/(j.y-F.y)+F.x&&(m=!m),y=Math.min(y,lv(u,F,j))}}return(m?1:-1)*Math.sqrt(y)})(this.p,s),this.max=this.d+this.h*Math.SQRT2}var Jr;v.aP=void 0,(Jr=v.aP||(v.aP={}))[Jr.center=1]="center",Jr[Jr.left=2]="left",Jr[Jr.right=3]="right",Jr[Jr.top=4]="top",Jr[Jr.bottom=5]="bottom",Jr[Jr["top-left"]=6]="top-left",Jr[Jr["top-right"]=7]="top-right",Jr[Jr["bottom-left"]=8]="bottom-left",Jr[Jr["bottom-right"]=9]="bottom-right";const w_=Number.POSITIVE_INFINITY;function ib(i,e){return e[1]!==w_?(function(r,s,u){let d=0,m=0;switch(s=Math.abs(s),u=Math.abs(u),r){case"top-right":case"top-left":case"top":m=u-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-u}switch(r){case"top-right":case"bottom-right":case"right":d=-s;break;case"top-left":case"bottom-left":case"left":d=s}return[d,m]})(i,e[0],e[1]):(function(r,s){let u=0,d=0;s<0&&(s=0);const m=s/Math.SQRT2;switch(r){case"top-right":case"top-left":d=m-7;break;case"bottom-right":case"bottom-left":d=7-m;break;case"bottom":d=7-s;break;case"top":d=s-7}switch(r){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=s;break;case"right":u=-s}return[u,d]})(i,e[0])}function ab(i,e,r){var s;const u=i.layout,d=(s=u.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(e,{},r);if(d){const y=d.values,w=[];for(let M=0;M<y.length;M+=2){const I=w[M]=y[M],k=y[M+1].map((L=>L*zr));I.startsWith("top")?k[1]-=7:I.startsWith("bottom")&&(k[1]+=7),w[M+1]=k}return new ui(w)}const m=u.get("text-variable-anchor");if(m){let y;y=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},r)*zr,w_]:u.get("text-offset").evaluate(e,{},r).map((M=>M*zr));const w=[];for(const M of m)w.push(M,ib(M,y));return new ui(w)}return null}function T_(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function pC(i,e,r,s,u,d,m,y,w,M,I,k){let L=d.textMaxSize.evaluate(e,{});L===void 0&&(L=m);const F=i.layers[0].layout,j=F.get("icon-offset").evaluate(e,{},I),q=sb(r.horizontal),Z=m/24,Y=i.tilePixelRatio*Z,fe=i.tilePixelRatio*L/24,J=i.tilePixelRatio*y,ne=i.tilePixelRatio*F.get("symbol-spacing"),ge=F.get("text-padding")*i.tilePixelRatio,we=(function(yt,St,mt,Lt=1){const Tn=yt.get("icon-padding").evaluate(St,{},mt),ln=Tn&&Tn.values;return[ln[0]*Lt,ln[1]*Lt,ln[2]*Lt,ln[3]*Lt]})(F,e,I,i.tilePixelRatio),De=F.get("text-max-angle")/180*Math.PI,Ke=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",Ge=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",tt=F.get("symbol-placement"),ht=ne/2,it=F.get("icon-text-fit");let He;s&&it!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(He=Jv(s,r.vertical,it,F.get("icon-text-fit-padding"),j,Z)),q&&(s=Jv(s,q,it,F.get("icon-text-fit-padding"),j,Z)));const Ne=I?k.line.getGranularityForZoomLevel(I.z):1,bt=(yt,St)=>{St.x<0||St.x>=at||St.y<0||St.y>=at||(function(mt,Lt,Tn,ln,Kn,Qr,wr,Jn,Wn,En,cr,mr,qn,Mi,ei,Pi,ua,Fr,rr,Tr,ur,Br,Ro,Ca,tf){const ks=mt.addToLineVertexArray(Lt,Tn);let Nl,hu,fu,du,hb=0,fb=0,db=0,pb=0,k_=-1,D_=-1;const Lo={};let mb=pr("");if(mt.allowVerticalPlacement&&ln.vertical){const pi=Jn.layout.get("text-rotate").evaluate(ur,{},Ca)+90;fu=new Mp(Wn,Lt,En,cr,mr,ln.vertical,qn,Mi,ei,pi),wr&&(du=new Mp(Wn,Lt,En,cr,mr,wr,ua,Fr,ei,pi))}if(Kn){const pi=Jn.layout.get("icon-rotate").evaluate(ur,{}),ra=Jn.layout.get("icon-text-fit")!=="none",Vl=nb(Kn,pi,Ro,ra),Aa=wr?nb(wr,pi,Ro,ra):void 0;hu=new Mp(Wn,Lt,En,cr,mr,Kn,ua,Fr,!1,pi),hb=4*Vl.length;const jl=mt.iconSizeData;let Ja=null;jl.kind==="source"?(Ja=[Do*Jn.layout.get("icon-size").evaluate(ur,{})],Ja[0]>Es&&Nt(`${mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):jl.kind==="composite"&&(Ja=[Do*Br.compositeIconSizes[0].evaluate(ur,{},Ca),Do*Br.compositeIconSizes[1].evaluate(ur,{},Ca)],(Ja[0]>Es||Ja[1]>Es)&&Nt(`${mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),mt.addSymbols(mt.icon,Vl,Ja,Tr,rr,ur,v.az.none,Lt,ks.lineStartIndex,ks.lineLength,-1,Ca),k_=mt.icon.placedSymbolArray.length-1,Aa&&(fb=4*Aa.length,mt.addSymbols(mt.icon,Aa,Ja,Tr,rr,ur,v.az.vertical,Lt,ks.lineStartIndex,ks.lineLength,-1,Ca),D_=mt.icon.placedSymbolArray.length-1)}const gb=Object.keys(ln.horizontal);for(const pi of gb){const ra=ln.horizontal[pi];if(!Nl){mb=pr(ra.text);const Aa=Jn.layout.get("text-rotate").evaluate(ur,{},Ca);Nl=new Mp(Wn,Lt,En,cr,mr,ra,qn,Mi,ei,Aa)}const Vl=ra.positionedLines.length===1;if(db+=ob(mt,Lt,ra,Qr,Jn,ei,ur,Pi,ks,ln.vertical?v.az.horizontal:v.az.horizontalOnly,Vl?gb:[pi],Lo,k_,Br,Ca),Vl)break}ln.vertical&&(pb+=ob(mt,Lt,ln.vertical,Qr,Jn,ei,ur,Pi,ks,v.az.vertical,["vertical"],Lo,D_,Br,Ca));const _C=Nl?Nl.boxStartIndex:mt.collisionBoxArray.length,yC=Nl?Nl.boxEndIndex:mt.collisionBoxArray.length,vC=fu?fu.boxStartIndex:mt.collisionBoxArray.length,xC=fu?fu.boxEndIndex:mt.collisionBoxArray.length,bC=hu?hu.boxStartIndex:mt.collisionBoxArray.length,wC=hu?hu.boxEndIndex:mt.collisionBoxArray.length,TC=du?du.boxStartIndex:mt.collisionBoxArray.length,SC=du?du.boxEndIndex:mt.collisionBoxArray.length;let Ia=-1;const Ep=(pi,ra)=>pi&&pi.circleDiameter?Math.max(pi.circleDiameter,ra):ra;Ia=Ep(Nl,Ia),Ia=Ep(fu,Ia),Ia=Ep(hu,Ia),Ia=Ep(du,Ia);const _b=Ia>-1?1:0;_b&&(Ia*=tf/zr),mt.glyphOffsetArray.length>=iu.MAX_GLYPHS&&Nt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ur.sortKey!==void 0&&mt.addToSortKeyRanges(mt.symbolInstances.length,ur.sortKey);const MC=ab(Jn,ur,Ca),[PC,EC]=(function(pi,ra){const Vl=pi.length,Aa=ra?.values;if(Aa?.length>0)for(let jl=0;jl<Aa.length;jl+=2){const Ja=Aa[jl+1];pi.emplaceBack(v.aP[Aa[jl]],Ja[0],Ja[1])}return[Vl,pi.length]})(mt.textAnchorOffsets,MC);mt.symbolInstances.emplaceBack(Lt.x,Lt.y,Lo.right>=0?Lo.right:-1,Lo.center>=0?Lo.center:-1,Lo.left>=0?Lo.left:-1,Lo.vertical||-1,k_,D_,mb,_C,yC,vC,xC,bC,wC,TC,SC,En,db,pb,hb,fb,_b,0,qn,Ia,PC,EC)})(i,St,yt,r,s,u,He,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,Y,[ge,ge,ge,ge],Ke,w,J,we,Ge,j,e,d,M,I,m)};if(tt==="line")for(const yt of Hx(e.geometry,0,0,at,at)){const St=Ll(yt,Ne),mt=uC(St,ne,De,r.vertical||q,s,24,fe,i.overscaling,at);for(const Lt of mt)q&&mC(i,q.text,ht,Lt)||bt(St,Lt)}else if(tt==="line-center"){for(const yt of e.geometry)if(yt.length>1){const St=Ll(yt,Ne),mt=cC(St,De,r.vertical||q,s,24,fe);mt&&bt(St,mt)}}else if(e.type==="Polygon")for(const yt of yc(e.geometry,0)){const St=fC(yt,16);bt(Ll(yt[0],Ne,!0),new As(St.x,St.y,0))}else if(e.type==="LineString")for(const yt of e.geometry){const St=Ll(yt,Ne);bt(St,new As(St[0].x,St[0].y,0))}else if(e.type==="Point")for(const yt of e.geometry)for(const St of yt)bt([St],new As(St.x,St.y,0))}function ob(i,e,r,s,u,d,m,y,w,M,I,k,L,F,j){const q=(function(fe,J,ne,ge,we,De,Ke,Ge){const tt=ge.layout.get("text-rotate").evaluate(De,{})*Math.PI/180,ht=[];for(const it of J.positionedLines)for(const He of it.positionedGlyphs){if(!He.rect)continue;const Ne=He.rect||{};let bt=4,yt=!0,St=1,mt=0;const Lt=(we||Ge)&&He.vertical,Tn=He.metrics.advance*He.scale/2;if(Ge&&J.verticalizable&&(mt=it.lineOffset/2-(He.imageName?-(zr-He.metrics.width*He.scale)/2:(He.scale-1)*zr)),He.imageName){const Fr=Ke[He.imageName];yt=Fr.sdf,St=Fr.pixelRatio,bt=1/St}const ln=we?[He.x+Tn,He.y]:[0,0];let Kn=we?[0,0]:[He.x+Tn+ne[0],He.y+ne[1]-mt],Qr=[0,0];Lt&&(Qr=Kn,Kn=[0,0]);const wr=He.metrics.isDoubleResolution?2:1,Jn=(He.metrics.left-bt)*He.scale-Tn+Kn[0],Wn=(-He.metrics.top-bt)*He.scale+Kn[1],En=Jn+Ne.w/wr*He.scale/St,cr=Wn+Ne.h/wr*He.scale/St,mr=new C(Jn,Wn),qn=new C(En,Wn),Mi=new C(Jn,cr),ei=new C(En,cr);if(Lt){const Fr=new C(-Tn,Tn- -17),rr=-Math.PI/2,Tr=12-Tn,ur=new C(22-Tr,-(He.imageName?Tr:0)),Br=new C(...Qr);mr._rotateAround(rr,Fr)._add(ur)._add(Br),qn._rotateAround(rr,Fr)._add(ur)._add(Br),Mi._rotateAround(rr,Fr)._add(ur)._add(Br),ei._rotateAround(rr,Fr)._add(ur)._add(Br)}if(tt){const Fr=Math.sin(tt),rr=Math.cos(tt),Tr=[rr,-Fr,Fr,rr];mr._matMult(Tr),qn._matMult(Tr),Mi._matMult(Tr),ei._matMult(Tr)}const Pi=new C(0,0),ua=new C(0,0);ht.push({tl:mr,tr:qn,bl:Mi,br:ei,tex:Ne,writingMode:J.writingMode,glyphOffset:ln,sectionIndex:He.sectionIndex,isSDF:yt,pixelOffsetTL:Pi,pixelOffsetBR:ua,minFontScaleX:0,minFontScaleY:0})}return ht})(0,r,y,u,d,m,s,i.allowVerticalPlacement),Z=i.textSizeData;let Y=null;Z.kind==="source"?(Y=[Do*u.layout.get("text-size").evaluate(m,{})],Y[0]>Es&&Nt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Z.kind==="composite"&&(Y=[Do*F.compositeTextSizes[0].evaluate(m,{},j),Do*F.compositeTextSizes[1].evaluate(m,{},j)],(Y[0]>Es||Y[1]>Es)&&Nt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,q,Y,y,d,m,M,e,w.lineStartIndex,w.lineLength,L,j);for(const fe of I)k[fe]=i.text.placedSymbolArray.length-1;return 4*q.length}function sb(i){for(const e in i)return i[e];return null}function mC(i,e,r,s){const u=i.compareText;if(e in u){const d=u[e];for(let m=d.length-1;m>=0;m--)if(s.dist(d[m])<r)return!0}else u[e]=[];return u[e].push(s),!1}const lb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class S_{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=s>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const d=lb[15&s];if(!d)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new S_(y,m,d,e)}constructor(e,r=64,s=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=lb.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-y%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${s}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=r,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return M_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:m,nodeSize:y}=this,w=[0,d.length-1,0],M=[];for(;w.length;){const I=w.pop()||0,k=w.pop()||0,L=w.pop()||0;if(k-L<=y){for(let Z=L;Z<=k;Z++){const Y=m[2*Z],fe=m[2*Z+1];Y>=e&&Y<=s&&fe>=r&&fe<=u&&M.push(d[Z])}continue}const F=L+k>>1,j=m[2*F],q=m[2*F+1];j>=e&&j<=s&&q>=r&&q<=u&&M.push(d[F]),(I===0?e<=j:r<=q)&&(w.push(L),w.push(F-1),w.push(1-I)),(I===0?s>=j:u>=q)&&(w.push(F+1),w.push(k),w.push(1-I))}return M}within(e,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:d,nodeSize:m}=this,y=[0,u.length-1,0],w=[],M=s*s;for(;y.length;){const I=y.pop()||0,k=y.pop()||0,L=y.pop()||0;if(k-L<=m){for(let Z=L;Z<=k;Z++)ub(d[2*Z],d[2*Z+1],e,r)<=M&&w.push(u[Z]);continue}const F=L+k>>1,j=d[2*F],q=d[2*F+1];ub(j,q,e,r)<=M&&w.push(u[F]),(I===0?e-s<=j:r-s<=q)&&(y.push(L),y.push(F-1),y.push(1-I)),(I===0?e+s>=j:r+s>=q)&&(y.push(F+1),y.push(k),y.push(1-I))}return w}}function M_(i,e,r,s,u,d){if(u-s<=r)return;const m=s+u>>1;cb(i,e,m,s,u,d),M_(i,e,r,s,m-1,1-d),M_(i,e,r,m+1,u,1-d)}function cb(i,e,r,s,u,d){for(;u>s;){if(u-s>600){const M=u-s+1,I=r-s+1,k=Math.log(M),L=.5*Math.exp(2*k/3),F=.5*Math.sqrt(k*L*(M-L)/M)*(I-M/2<0?-1:1);cb(i,e,r,Math.max(s,Math.floor(r-I*L/M+F)),Math.min(u,Math.floor(r+(M-I)*L/M+F)),d)}const m=e[2*r+d];let y=s,w=u;for(Qh(i,e,s,r),e[2*u+d]>m&&Qh(i,e,s,u);y<w;){for(Qh(i,e,y,w),y++,w--;e[2*y+d]<m;)y++;for(;e[2*w+d]>m;)w--}e[2*s+d]===m?Qh(i,e,s,w):(w++,Qh(i,e,w,u)),w<=r&&(s=w+1),r<=w&&(u=w-1)}}function Qh(i,e,r,s){P_(i,r,s),P_(e,2*r,2*s),P_(e,2*r+1,2*s+1)}function P_(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}function ub(i,e,r,s){const u=i-r,d=e-s;return u*u+d*d}var E_;v.cH=void 0,(E_=v.cH||(v.cH={})).create="create",E_.load="load",E_.fullLoad="fullLoad";let Pp=null,ef=[];const C_=1e3/60,I_="loadTime",A_="fullLoadTime",gC={mark(i){performance.mark(i)},frame(i){const e=i;Pp!=null&&ef.push(e-Pp),Pp=e},clearMetrics(){Pp=null,ef=[],performance.clearMeasures(I_),performance.clearMeasures(A_);for(const i in v.cH)performance.clearMarks(v.cH[i])},getPerformanceMetrics(){performance.measure(I_,v.cH.create,v.cH.load),performance.measure(A_,v.cH.create,v.cH.fullLoad);const i=performance.getEntriesByName(I_)[0].duration,e=performance.getEntriesByName(A_)[0].duration,r=ef.length,s=1/(ef.reduce(((d,m)=>d+m),0)/r/1e3),u=ef.filter((d=>d>C_)).reduce(((d,m)=>d+(m-C_)/C_),0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:u/(r+u)*100,totalFrames:r}}};v.$=U,v.A=me,v.B=bs,v.C=kr,v.D=Dt,v.E=yn,v.F=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},v.G=Hn,v.H=Rn,v.I=Yg,v.J=Gd,v.K=function(i){if(qt==null){const e=i.navigator?i.navigator.userAgent:null;qt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return qt},v.L=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new kE((()=>this.process())),this.subscription=ba(this.target,"message",(r=>this.receive(r)),!1),this.globalScope=Ut(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,e){return new Promise(((r,s)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),d=e?ba(e.signal,"abort",(()=>{d?.unsubscribe(),delete this.resolveRejects[u];const w={id:u,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(w)}),DE):null;this.resolveRejects[u]={resolve:w=>{d?.unsubscribe(),r(w)},reject:w=>{d?.unsubscribe(),s(w)}};const m=[],y=Object.assign(Object.assign({},i),{id:u,sourceMapId:this.mapId,origin:location.origin,data:bl(i.data,m)});this.target.postMessage(y,{transfer:m})}))}receive(i){const e=i.data,r=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[r];const s=this.abortControllers[r];return delete this.abortControllers[r],void(s&&s.abort())}if(Ut(self)||e.mustQueue)return this.tasks[r]=e,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return l(this,void 0,void 0,(function*(){if(e.type==="<response>"){const u=this.resolveRejects[i];return delete this.resolveRejects[i],u?void(e.error?u.reject(wl(e.error)):u.resolve(wl(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=wl(e.data),s=new AbortController;this.abortControllers[i]=s;try{const u=yield this.messageHandlers[e.type](e.sourceMapId,r,s);this.completeTask(i,null,u)}catch(u){this.completeTask(i,u)}}))}completeTask(i,e,r){const s=[];delete this.abortControllers[i];const u={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?bl(e):null,data:bl(r,s)};this.target.postMessage(u,{transfer:s})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},v.M=ve,v.N=function(){var i=new me(16);return me!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},v.O=function(i,e,r){var s,u,d,m,y,w,M,I,k,L,F,j,q=r[0],Z=r[1],Y=r[2];return e===i?(i[12]=e[0]*q+e[4]*Z+e[8]*Y+e[12],i[13]=e[1]*q+e[5]*Z+e[9]*Y+e[13],i[14]=e[2]*q+e[6]*Z+e[10]*Y+e[14],i[15]=e[3]*q+e[7]*Z+e[11]*Y+e[15]):(u=e[1],d=e[2],m=e[3],y=e[4],w=e[5],M=e[6],I=e[7],k=e[8],L=e[9],F=e[10],j=e[11],i[0]=s=e[0],i[1]=u,i[2]=d,i[3]=m,i[4]=y,i[5]=w,i[6]=M,i[7]=I,i[8]=k,i[9]=L,i[10]=F,i[11]=j,i[12]=s*q+y*Z+k*Y+e[12],i[13]=u*q+w*Z+L*Y+e[13],i[14]=d*q+M*Z+F*Y+e[14],i[15]=m*q+I*Z+j*Y+e[15]),i},v.P=C,v.Q=function(i,e,r){var s=r[0],u=r[1],d=r[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*u,i[5]=e[5]*u,i[6]=e[6]*u,i[7]=e[7]*u,i[8]=e[8]*d,i[9]=e[9]*d,i[10]=e[10]*d,i[11]=e[11]*d,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},v.R=Si,v.S=function(i,e,r){var s=e[0],u=e[1],d=e[2],m=e[3],y=e[4],w=e[5],M=e[6],I=e[7],k=e[8],L=e[9],F=e[10],j=e[11],q=e[12],Z=e[13],Y=e[14],fe=e[15],J=r[0],ne=r[1],ge=r[2],we=r[3];return i[0]=J*s+ne*y+ge*k+we*q,i[1]=J*u+ne*w+ge*L+we*Z,i[2]=J*d+ne*M+ge*F+we*Y,i[3]=J*m+ne*I+ge*j+we*fe,i[4]=(J=r[4])*s+(ne=r[5])*y+(ge=r[6])*k+(we=r[7])*q,i[5]=J*u+ne*w+ge*L+we*Z,i[6]=J*d+ne*M+ge*F+we*Y,i[7]=J*m+ne*I+ge*j+we*fe,i[8]=(J=r[8])*s+(ne=r[9])*y+(ge=r[10])*k+(we=r[11])*q,i[9]=J*u+ne*w+ge*L+we*Z,i[10]=J*d+ne*M+ge*F+we*Y,i[11]=J*m+ne*I+ge*j+we*fe,i[12]=(J=r[12])*s+(ne=r[13])*y+(ge=r[14])*k+(we=r[15])*q,i[13]=J*u+ne*w+ge*L+we*Z,i[14]=J*d+ne*M+ge*F+we*Y,i[15]=J*m+ne*I+ge*j+we*fe,i},v.T=jg,v.U=function(i,e){const r={};for(let s=0;s<e.length;s++){const u=e[s];u in i&&(r[u]=i[u])}return r},v.V=Cs,v.W=Et,v.X=sx,v.Y=ox,v.Z=Se,v._=l,v.a=te,v.a$=Re,v.a0=se,v.a1=Xr,v.a2=ta,v.a3=cx,v.a4=pp,v.a5=at,v.a6=function(i,e,r){if(!i)return e||{};if(!e)return i||{};const s=dx(i),u=dx(e);(function(m,y){y.removeAll&&(m.add.clear(),m.update.clear(),m.remove.clear(),y.remove.clear());for(const w of y.remove)m.add.delete(w),m.update.delete(w);for(const[w,M]of y.update){const I=m.update.get(w);I&&(y.update.set(w,zE(I,M)),m.update.delete(w))}})(s,u);const d={};if((s.removeAll||u.removeAll)&&(d.removeAll=!0),d.remove=new Set([...s.remove,...u.remove]),d.add=new Map([...s.add,...u.add]),d.update=new Map([...s.update,...u.update]),d.remove.size&&d.add.size)for(const m of d.add.keys())d.remove.delete(m);return(function(m){const y={};return m.removeAll&&(y.removeAll=m.removeAll),m.remove&&(y.remove=Array.from(m.remove)),m.add&&(y.add=Array.from(m.add.values())),m.update&&(y.update=Array.from(m.update.values())),y})(d)},v.a7=function(i,e){const r=new Map;if(i==null||i.type==null)return r;if(i.type==="Feature"){const s=a_(i,e);return s==null?void 0:(r.set(s,i),r)}if(i.type==="FeatureCollection"){const s=new Set;for(const u of i.features){const d=a_(u,e);if(d==null||s.has(d))return;s.add(d),r.set(d,u)}return r}},v.a8=function(i,e,r){var s,u;const d=[];if(e.removeAll)i.clear();else if(e.remove)for(const m of e.remove){const y=i.get(m);y&&(d.push(y.geometry),i.delete(m))}if(e.add)for(const m of e.add){const y=a_(m,r);if(y==null)continue;const w=i.get(y);w&&d.push(w.geometry),d.push(m.geometry),i.set(y,m)}if(e.update)for(const m of e.update){const y=i.get(m.id);if(!y)continue;const w=!!m.newGeometry,M=m.removeAllProperties||((s=m.removeProperties)===null||s===void 0?void 0:s.length)>0||((u=m.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0;if(!w&&!M)continue;d.push(y.geometry);const I=Object.assign({},y);if(i.set(m.id,I),w&&(d.push(m.newGeometry),I.geometry=m.newGeometry),M){if(I.properties=m.removeAllProperties?{}:Object.assign({},I.properties||{}),m.removeProperties)for(const k of m.removeProperties)delete I.properties[k];if(m.addOrUpdateProperties)for(const{key:k,value:L}of m.addOrUpdateProperties)I.properties[k]=L}}return d},v.a9=Xh,v.aA=function(i,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:u}){return i.kind==="source"?s/Do:i.kind==="composite"?Hn.number(s/Do,u/Do,r):e},v.aB=function(i,e){var r=e[0],s=e[1],u=e[2],d=e[3],m=e[4],y=e[5],w=e[6],M=e[7],I=e[8],k=e[9],L=e[10],F=e[11],j=e[12],q=e[13],Z=e[14],Y=e[15],fe=r*y-s*m,J=r*w-u*m,ne=r*M-d*m,ge=s*w-u*y,we=s*M-d*y,De=u*M-d*w,Ke=I*q-k*j,Ge=I*Z-L*j,tt=I*Y-F*j,ht=k*Z-L*q,it=k*Y-F*q,He=L*Y-F*Z,Ne=fe*He-J*it+ne*ht+ge*tt-we*Ge+De*Ke;return Ne?(i[0]=(y*He-w*it+M*ht)*(Ne=1/Ne),i[1]=(u*it-s*He-d*ht)*Ne,i[2]=(q*De-Z*we+Y*ge)*Ne,i[3]=(L*we-k*De-F*ge)*Ne,i[4]=(w*tt-m*He-M*Ge)*Ne,i[5]=(r*He-u*tt+d*Ge)*Ne,i[6]=(Z*ne-j*De-Y*J)*Ne,i[7]=(I*De-L*ne+F*J)*Ne,i[8]=(m*it-y*tt+M*Ke)*Ne,i[9]=(s*tt-r*it-d*Ke)*Ne,i[10]=(j*we-q*ne+Y*fe)*Ne,i[11]=(k*ne-I*we-F*fe)*Ne,i[12]=(y*Ge-m*ht-w*Ke)*Ne,i[13]=(r*ht-s*Ge+u*Ke)*Ne,i[14]=(q*J-j*ge-Z*fe)*Ne,i[15]=(I*ge-k*J+L*fe)*Ne,i):null},v.aC=Qe,v.aD=function(i){var e=i[0],r=i[1];return Math.sqrt(e*e+r*r)},v.aE=function(i){return i[0]=0,i[1]=0,i},v.aF=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i},v.aG=Qg,v.aH=et,v.aI=function(i,e,r,s){const u=e.y-i.y,d=e.x-i.x,m=s.y-r.y,y=s.x-r.x,w=m*d-y*u;if(w===0)return null;const M=(y*(i.y-r.y)-m*(i.x-r.x))/w;return new C(i.x+M*d,i.y+M*u)},v.aJ=Hx,v.aK=Yc,v.aL=function(i){let e=1/0,r=1/0,s=-1/0,u=-1/0;for(const d of i)e=Math.min(e,d.x),r=Math.min(r,d.y),s=Math.max(s,d.x),u=Math.max(u,d.y);return[e,r,s,u]},v.aM=zr,v.aN=zt,v.aO=function(i,e,r,s,u=!1){if(!r[0]&&!r[1])return[0,0];const d=u?s==="map"?-i.bearingInRadians:0:s==="viewport"?i.bearingInRadians:0;if(d){const m=Math.sin(d),y=Math.cos(d);r=[r[0]*y-r[1]*m,r[0]*m+r[1]*y]}return[u?r[0]:zt(e,r[0],i.zoom),u?r[1]:zt(e,r[1],i.zoom)]},v.aQ=Jg,v.aR=T_,v.aS=Kg,v.aT=S_,v.aU=dr,v.aV=lp,v.aW=re,v.aX=dt,v.aY=Oe,v.aZ=gr,v.a_=ux,v.aa=Fl,v.ab=25,v.ac=i_,v.ad=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((r=>{e.onloadstart=()=>{r(e)};for(const s of i){const u=window.document.createElement("source");We(s)||(e.crossOrigin="Anonymous"),u.src=s,e.appendChild(u)}}))},v.ae=st,v.af=function(){return ot++},v.ag=f,v.ah=iu,v.ai=Jh,v.aj=fl,v.ak=Ka,v.al=mx,v.am=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,s,u,d)=>{const m=u||d;return e[s]=!m||m.toLowerCase(),""})),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},v.an=pt,v.ao=85.051129,v.ap=Oa,v.aq=function(i){return Math.pow(2,i)},v.ar=ce,v.as=lx,v.at=function(i){return Math.log(i)/Math.LN2},v.au=function(i){var e=i[0],r=i[1];return e*e+r*r},v.av=function(i){if(!i.length)return new Set;const e=Math.max(...i.map((w=>w.canonical.z)));let r=1/0,s=-1/0,u=1/0,d=-1/0;const m=[];for(const w of i){const{x:M,y:I,z:k}=w.canonical,L=Math.pow(2,e-k),F=M*L,j=I*L;m.push({id:w,x:F,y:j}),F<r&&(r=F),F>s&&(s=F),j<u&&(u=j),j>d&&(d=j)}const y=new Set;for(const w of m)w.x!==r&&w.x!==s&&w.y!==u&&w.y!==d||y.add(w.id);return y},v.aw=function(i,e){const r=Math.abs(2*i.wrap)-+(i.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||s-r||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x},v.ax=class{constructor(i,e){this.max=i,this.onRemove=e,this.reset()}reset(){for(const i in this.data)for(const e of this.data[i])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(i,e,r){const s=i.wrapped().key;this.data[s]===void 0&&(this.data[s]=[]);const u={value:e,timeout:void 0};if(r!==void 0&&(u.timeout=setTimeout((()=>{this.remove(i,u)}),r)),this.data[s].push(u),this.order.push(s),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const e=this.data[i].shift();return e.timeout&&clearTimeout(e.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),e.value}getByKey(i){const e=this.data[i];return e?e[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,e){if(!this.has(i))return this;const r=i.wrapped().key,s=e===void 0?0:this.data[r].indexOf(e),u=this.data[r][s];return this.data[r].splice(s,1),u.timeout&&clearTimeout(u.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(u.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(i){const e=[];for(const r in this.data)for(const s of this.data[r])i(s.value)||e.push(s);for(const r of e)this.remove(r.value.tileID,r)}},v.ay=function(i,e){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:d,maxZoom:m}=i,y=u?pt(fi.interpolationFactor(u,e,d,m),0,1):0;i.kind==="camera"?s=Hn.number(i.minSize,i.maxSize,y):r=y}return{uSizeT:r,uSize:s}},v.b=cn,v.b$=Ao,v.b0=be,v.b1=function(i){var e=new me(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},v.b2=function(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i},v.b3=function(i,e){var r=e[0],s=e[1],u=e[2],d=r*r+s*s+u*u;return d>0&&(d=1/Math.sqrt(d)),i[0]=e[0]*d,i[1]=e[1]*d,i[2]=e[2]*d,i},v.b4=Ve,v.b5=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},v.b6=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},v.b7=ue,v.b8=function(i,e,r){const s=e[0]*r[0]+e[1]*r[1]+e[2]*r[2];return s===0?null:(-(i[0]*r[0]+i[1]*r[1]+i[2]*r[2])-r[3])/s},v.b9=Ye,v.bA=function(i,e,r,s){return i[0]=e[0]+r[0]*s,i[1]=e[1]+r[1]*s,i[2]=e[2]+r[2]*s,i},v.bB=Je,v.bC=function(i,e,r){var s=r[0],u=r[1],d=r[2],m=r[3],y=e[0],w=e[1],M=e[2],I=u*M-d*w,k=d*y-s*M,L=s*w-u*y;return i[0]=y+m*(I+=I)+u*(L+=L)-d*(k+=k),i[1]=w+m*k+d*I-s*L,i[2]=M+m*L+s*k-u*I,i},v.bD=function(i,e,r){const s=(function(w){var M=w[3],I=w[4],k=w[5],L=w[6],F=w[7],j=w[8];return w[0]*(j*I-k*F)+w[1]*(-j*M+k*L)+w[2]*(F*M-I*L)})([i[0],i[1],i[2],e[0],e[1],e[2],r[0],r[1],r[2]]);if(s===0)return null;const u=Ve([],[e[0],e[1],e[2]],[r[0],r[1],r[2]]),d=Ve([],[r[0],r[1],r[2]],[i[0],i[1],i[2]]),m=Ve([],[i[0],i[1],i[2]],[e[0],e[1],e[2]]),y=Re([],u,-i[3]);return be(y,y,Re([],d,-e[3])),be(y,y,Re([],m,-r[3])),Re(y,y,1/s),y},v.bE=r_,v.bF=function(){return new Float64Array(4)},v.bG=function(i,e,r,s){var u=[],d=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],d[0]=u[0]*Math.cos(s)-u[1]*Math.sin(s),d[1]=u[0]*Math.sin(s)+u[1]*Math.cos(s),d[2]=u[2],i[0]=d[0]+r[0],i[1]=d[1]+r[1],i[2]=d[2]+r[2],i},v.bH=function(i,e,r,s){var u=[],d=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],d[0]=u[0],d[1]=u[1]*Math.cos(s)-u[2]*Math.sin(s),d[2]=u[1]*Math.sin(s)+u[2]*Math.cos(s),i[0]=d[0]+r[0],i[1]=d[1]+r[1],i[2]=d[2]+r[2],i},v.bI=function(i,e,r,s){var u=[],d=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],d[0]=u[2]*Math.sin(s)+u[0]*Math.cos(s),d[1]=u[1],d[2]=u[2]*Math.cos(s)-u[0]*Math.sin(s),i[0]=d[0]+r[0],i[1]=d[1]+r[1],i[2]=d[2]+r[2],i},v.bJ=function(i,e,r){var s=Math.sin(r),u=Math.cos(r),d=e[0],m=e[1],y=e[2],w=e[3],M=e[8],I=e[9],k=e[10],L=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*u-M*s,i[1]=m*u-I*s,i[2]=y*u-k*s,i[3]=w*u-L*s,i[8]=d*s+M*u,i[9]=m*s+I*u,i[10]=y*s+k*u,i[11]=w*s+L*u,i},v.bK=function(i,e){const r=rt(i,360),s=rt(e,360),u=s-r,d=s>r?u-360:u+360;return Math.abs(u)<Math.abs(d)?u:d},v.bL=function(i){return i[0]=0,i[1]=0,i[2]=0,i},v.bM=function(i,e,r,s){const u=Math.sqrt(i*i+e*e),d=Math.sqrt(r*r+s*s);i/=u,e/=u,r/=d,s/=d;const m=Math.acos(i*r+e*s);return-e*r+i*s>0?m:-m},v.bN=function(i,e){const r=rt(i,2*Math.PI),s=rt(e,2*Math.PI);return Math.min(Math.abs(r-s),Math.abs(r-s+2*Math.PI),Math.abs(r-s-2*Math.PI))},v.bO=function(){const i={},e=Fe.$version;for(const r in Fe.$root){const s=Fe.$root[r];if(s.required){let u=null;u=r==="version"?e:s.type==="array"?[]:{},u!=null&&(i[r]=u)}}return i},v.bP=Ae,v.bQ=wh,v.bR=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(!i(e[s],r[s]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const s in e)if(!i(e[s],r[s]))return!1;return!0}return e===r},v.bS=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Nr(i[r],e[i[r].ref]));return i},v.bT=function(i,e){if(i.type==="custom")return new AE(i,e);switch(i.type){case"background":return new IE(i,e);case"circle":return new dP(i,e);case"color-relief":return new vP(i,e);case"fill":return new RP(i,e);case"fill-extrusion":return new ZP(i,e);case"heatmap":return new mP(i,e);case"hillshade":return new _P(i,e);case"line":return new QP(i,e);case"raster":return new Dg(i,e);case"symbol":return new dp(i,e)}},v.bU=i=>i.type==="raster",v.bV=Ze,v.bW=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let r=[];try{if(!Ht(i.version,e.version))return[{command:"setStyle",args:[e]}];Ht(i.center,e.center)||r.push({command:"setCenter",args:[e.center]}),Ht(i.state,e.state)||r.push({command:"setGlobalState",args:[e.state]}),Ht(i.centerAltitude,e.centerAltitude)||r.push({command:"setCenterAltitude",args:[e.centerAltitude]}),Ht(i.zoom,e.zoom)||r.push({command:"setZoom",args:[e.zoom]}),Ht(i.bearing,e.bearing)||r.push({command:"setBearing",args:[e.bearing]}),Ht(i.pitch,e.pitch)||r.push({command:"setPitch",args:[e.pitch]}),Ht(i.roll,e.roll)||r.push({command:"setRoll",args:[e.roll]}),Ht(i.sprite,e.sprite)||r.push({command:"setSprite",args:[e.sprite]}),Ht(i.glyphs,e.glyphs)||r.push({command:"setGlyphs",args:[e.glyphs]}),Ht(i.transition,e.transition)||r.push({command:"setTransition",args:[e.transition]}),Ht(i.light,e.light)||r.push({command:"setLight",args:[e.light]}),Ht(i.terrain,e.terrain)||r.push({command:"setTerrain",args:[e.terrain]}),Ht(i.sky,e.sky)||r.push({command:"setSky",args:[e.sky]}),Ht(i.projection,e.projection)||r.push({command:"setProjection",args:[e.projection]});const s={},u=[];(function(m,y,w,M){let I;for(I in y=y||{},m=m||{})Object.prototype.hasOwnProperty.call(m,I)&&(Object.prototype.hasOwnProperty.call(y,I)||$n(I,w,M));for(I in y)Object.prototype.hasOwnProperty.call(y,I)&&(Object.prototype.hasOwnProperty.call(m,I)?Ht(m[I],y[I])||(m[I].type==="geojson"&&y[I].type==="geojson"&&Fn(m,y,I)?An(w,{command:"setGeoJSONSourceData",args:[I,y[I].data]}):ar(I,y,w,M)):Vr(I,y,w))})(i.sources,e.sources,u,s);const d=[];i.layers&&i.layers.forEach((m=>{"source"in m&&s[m.source]?r.push({command:"removeLayer",args:[m.id]}):d.push(m)})),r=r.concat(u),(function(m,y,w){y=y||[];const M=(m=m||[]).map(Zs),I=y.map(Zs),k=m.reduce(Ws,{}),L=y.reduce(Ws,{}),F=M.slice(),j=Object.create(null);let q,Z,Y,fe,J;for(let ne=0,ge=0;ne<M.length;ne++)q=M[ne],Object.prototype.hasOwnProperty.call(L,q)?ge++:(An(w,{command:"removeLayer",args:[q]}),F.splice(F.indexOf(q,ge),1));for(let ne=0,ge=0;ne<I.length;ne++)q=I[I.length-1-ne],F[F.length-1-ne]!==q&&(Object.prototype.hasOwnProperty.call(k,q)?(An(w,{command:"removeLayer",args:[q]}),F.splice(F.lastIndexOf(q,F.length-ge),1)):ge++,fe=F[F.length-ne],An(w,{command:"addLayer",args:[L[q],fe]}),F.splice(F.length-ne,0,q),j[q]=!0);for(let ne=0;ne<I.length;ne++)if(q=I[ne],Z=k[q],Y=L[q],!j[q]&&!Ht(Z,Y))if(Ht(Z.source,Y.source)&&Ht(Z["source-layer"],Y["source-layer"])&&Ht(Z.type,Y.type)){for(J in xr(Z.layout,Y.layout,w,q,null,"setLayoutProperty"),xr(Z.paint,Y.paint,w,q,null,"setPaintProperty"),Ht(Z.filter,Y.filter)||An(w,{command:"setFilter",args:[q,Y.filter]}),Ht(Z.minzoom,Y.minzoom)&&Ht(Z.maxzoom,Y.maxzoom)||An(w,{command:"setLayerZoomRange",args:[q,Y.minzoom,Y.maxzoom]}),Z)Object.prototype.hasOwnProperty.call(Z,J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&(J.indexOf("paint.")===0?xr(Z[J],Y[J],w,q,J.slice(6),"setPaintProperty"):Ht(Z[J],Y[J])||An(w,{command:"setLayerProperty",args:[q,J,Y[J]]}));for(J in Y)Object.prototype.hasOwnProperty.call(Y,J)&&!Object.prototype.hasOwnProperty.call(Z,J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&(J.indexOf("paint.")===0?xr(Z[J],Y[J],w,q,J.slice(6),"setPaintProperty"):Ht(Z[J],Y[J])||An(w,{command:"setLayerProperty",args:[q,J,Y[J]]}))}else An(w,{command:"removeLayer",args:[q]}),fe=F[F.lastIndexOf(q)+1],An(w,{command:"addLayer",args:[Y,fe]})})(d,e.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:"setStyle",args:[e]}]}return r},v.bX=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},v.bY=_t,v.bZ=Rt,v.b_=class extends _i{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},v.ba=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i},v.bb=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]},v.bc=fx,v.bd=au,v.be=function(i,e,r,s,u){var d=1/Math.tan(e/2);if(i[0]=d/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0){var m=1/(s-u);i[10]=(u+s)*m,i[14]=2*u*s*m}else i[10]=-1,i[14]=-2*s;return i},v.bf=function(i){var e=new me(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},v.bg=function(i,e,r){var s=Math.sin(r),u=Math.cos(r),d=e[0],m=e[1],y=e[2],w=e[3],M=e[4],I=e[5],k=e[6],L=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*u+M*s,i[1]=m*u+I*s,i[2]=y*u+k*s,i[3]=w*u+L*s,i[4]=M*u-d*s,i[5]=I*u-m*s,i[6]=k*u-y*s,i[7]=L*u-w*s,i},v.bh=function(i,e,r){var s=Math.sin(r),u=Math.cos(r),d=e[4],m=e[5],y=e[6],w=e[7],M=e[8],I=e[9],k=e[10],L=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=d*u+M*s,i[5]=m*u+I*s,i[6]=y*u+k*s,i[7]=w*u+L*s,i[8]=M*u-d*s,i[9]=I*u-m*s,i[10]=k*u-y*s,i[11]=L*u-w*s,i},v.bi=function(){const i=new Float32Array(16);return ce(i),i},v.bj=function(){const i=new Float64Array(16);return ce(i),i},v.bk=function(){return new Float64Array(16)},v.bl=function(i,e,r){const s=new Float64Array(4);return Je(s,i,e-90,r),s},v.bm=function(i,e,r,s){var u,d,m,y,w,M=e[0],I=e[1],k=e[2],L=e[3],F=r[0],j=r[1],q=r[2],Z=r[3];return(d=M*F+I*j+k*q+L*Z)<0&&(d=-d,F=-F,j=-j,q=-q,Z=-Z),1-d>Me?(u=Math.acos(d),m=Math.sin(u),y=Math.sin((1-s)*u)/m,w=Math.sin(s*u)/m):(y=1-s,w=s),i[0]=y*M+w*F,i[1]=y*I+w*j,i[2]=y*k+w*q,i[3]=y*L+w*Z,i},v.bn=function(i){const e=new Float64Array(9);(function(d,m){var y=m[0],w=m[1],M=m[2],I=m[3],k=y+y,L=w+w,F=M+M,j=y*k,q=w*k,Z=w*L,Y=M*k,fe=M*L,J=M*F,ne=I*k,ge=I*L,we=I*F;d[0]=1-Z-J,d[3]=q-we,d[6]=Y+ge,d[1]=q+we,d[4]=1-j-J,d[7]=fe-ne,d[2]=Y-ge,d[5]=fe+ne,d[8]=1-j-Z})(e,i);const r=gr(-Math.asin(pt(e[2],-1,1)));let s,u;return Math.hypot(e[5],e[8])<.001?(s=0,u=-gr(Math.atan2(e[3],e[4]))):(s=gr(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),u=gr(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:s,pitch:r+90,bearing:u}},v.bo=function(i,e){return i.roll==e.roll&&i.pitch==e.pitch&&i.bearing==e.bearing},v.bp=on,v.bq=Io,v.br=tu,v.bs=qh,v.bt=eu,v.bu=ct,v.bv=xt,v.bw=hi,v.bx=function(i,e,r,s,u){return ct(s,u,pt((i-e)/(r-e),0,1))},v.by=rt,v.bz=function(){return new Float64Array(3)},v.c=Ee,v.c$=function(i,e,r,s,u){return l(this,void 0,void 0,(function*(){if(se())try{return yield Xr(i,e,r,s,u)}catch{}return(function(d,m,y,w,M){const I=d.width,k=d.height;oi&&Ar||(oi=new OffscreenCanvas(I,k),Ar=oi.getContext("2d",{willReadFrequently:!0})),oi.width=I,oi.height=k,Ar.drawImage(d,0,0,I,k);const L=Ar.getImageData(m,y,w,M);return Ar.clearRect(0,0,I,k),L.data})(i,e,r,s,u)}))},v.c0=class extends _i{constructor(i,e){super(i,e),this.current=Oi}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},v.c1=zl,v.c2=class extends _i{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},v.c3=class extends _i{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},v.c4=K,v.c5=function(i,e){var r=Math.sin(e),s=Math.cos(e);return i[0]=s,i[1]=r,i[2]=0,i[3]=-r,i[4]=s,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},v.c6=function(i,e,r){var s=e[0],u=e[1],d=e[2];return i[0]=s*r[0]+u*r[3]+d*r[6],i[1]=s*r[1]+u*r[4]+d*r[7],i[2]=s*r[2]+u*r[5]+d*r[8],i},v.c7=function(i,e,r,s,u,d,m){var y=1/(e-r),w=1/(s-u),M=1/(d-m);return i[0]=-2*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*M,i[11]=0,i[12]=(e+r)*y,i[13]=(u+s)*w,i[14]=(m+d)*M,i[15]=1,i},v.c8=class extends _i{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(4*i.length);for(let r=0;r<i.length;r++)e[4*r]=i[r].r,e[4*r+1]=i[r].g,e[4*r+2]=i[r].b,e[4*r+3]=i[r].a;this.gl.uniform4fv(this.location,e)}}},v.c9=class extends _i{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(i);this.gl.uniform1fv(this.location,e)}}},v.cA=function(i,e){return ke[e]&&"touches"in i},v.cB=function(i){return ke[i]||H[i]},v.cC=function(i,e,r){var s=e[0],u=e[1];return i[0]=r[0]*s+r[4]*u+r[12],i[1]=r[1]*s+r[5]*u+r[13],i},v.cD=function(i,e){const{x:r,y:s}=Xh.fromLngLat(e);return!(i<0||i>25||s<0||s>=1||r<0||r>=1)},v.cE=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},v.cF=class extends qc{},v.cG=gC,v.cI=ye,v.cJ=function(i,e){Ee.REGISTERED_PROTOCOLS[i]=e},v.cK=function(i){delete Ee.REGISTERED_PROTOCOLS[i]},v.cL=function(i,e){const r={};for(let u=0;u<i.length;u++){const d=e&&e[i[u].id]||zd(i[u]);e&&(e[i[u].id]=d);let m=r[d];m||(m=r[d]=[]),m.push(i[u])}const s=[];for(const u in r)s.push(r[u]);return s},v.cM=wt,v.cN=px,v.cO=Zx,v.cP=Xv,v.cQ=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=at/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,s=e._unevaluatedLayout._values,u={layoutIconSize:s["icon-size"].possiblyEvaluate(new Rn(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new Rn(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new Rn(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:I}=i.bucket.textSizeData;u.compositeTextSizes=[s["text-size"].possiblyEvaluate(new Rn(M),i.canonical),s["text-size"].possiblyEvaluate(new Rn(I),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:I}=i.bucket.iconSizeData;u.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new Rn(M),i.canonical),s["icon-size"].possiblyEvaluate(new Rn(I),i.canonical)]}const d=r.get("text-line-height")*zr,m=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",y=r.get("text-keep-upright"),w=r.get("text-size");for(const M of i.bucket.features){const I=r.get("text-font").evaluate(M,{},i.canonical).join(","),k=w.evaluate(M,{},i.canonical),L=u.layoutTextSize.evaluate(M,{},i.canonical),F=u.layoutIconSize.evaluate(M,{},i.canonical),j={horizontal:{},vertical:void 0},q=M.text;let Z,Y=[0,0];if(q){const ne=q.toString(),ge=r.get("text-letter-spacing").evaluate(M,{},i.canonical)*zr,we=Ag(ne)?ge:0,De=r.get("text-anchor").evaluate(M,{},i.canonical),Ke=ab(e,M,i.canonical);if(!Ke){const it=r.get("text-radial-offset").evaluate(M,{},i.canonical);Y=it?ib(De,[it*zr,w_]):r.get("text-offset").evaluate(M,{},i.canonical).map((He=>He*zr))}let Ge=m?"center":r.get("text-justify").evaluate(M,{},i.canonical);const tt=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(M,{},i.canonical)*zr:1/0,ht=()=>{i.bucket.allowVerticalPlacement&&Ss(ne)&&(j.vertical=hp(q,i.glyphMap,i.glyphPositions,i.imagePositions,I,tt,d,De,"left",we,Y,v.az.vertical,!0,L,k))};if(!m&&Ke){const it=new Set;if(Ge==="auto")for(let Ne=0;Ne<Ke.values.length;Ne+=2)it.add(T_(Ke.values[Ne]));else it.add(Ge);let He=!1;for(const Ne of it)if(!j.horizontal[Ne])if(He)j.horizontal[Ne]=j.horizontal[0];else{const bt=hp(q,i.glyphMap,i.glyphPositions,i.imagePositions,I,tt,d,"center",Ne,we,Y,v.az.horizontal,!1,L,k);bt&&(j.horizontal[Ne]=bt,He=bt.positionedLines.length===1)}ht()}else{Ge==="auto"&&(Ge=T_(De));const it=hp(q,i.glyphMap,i.glyphPositions,i.imagePositions,I,tt,d,De,Ge,we,Y,v.az.horizontal,!1,L,k);it&&(j.horizontal[Ge]=it),ht(),Ss(ne)&&m&&y&&(j.vertical=hp(q,i.glyphMap,i.glyphPositions,i.imagePositions,I,tt,d,De,Ge,we,Y,v.az.vertical,!1,L,k))}}let fe=!1;if(M.icon&&M.icon.name){const ne=i.imageMap[M.icon.name];ne&&(Z=ME(i.imagePositions[M.icon.name],r.get("icon-offset").evaluate(M,{},i.canonical),r.get("icon-anchor").evaluate(M,{},i.canonical)),fe=!!ne.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=fe:i.bucket.sdfIcons!==fe&&Nt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ne.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const J=sb(j.horizontal)||j.vertical;i.bucket.iconsInText=!!J&&J.iconsInText,(J||Z)&&pC(i.bucket,M,j,Z,i.imageMap,u,L,F,Y,fe,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},v.cR=$g,v.cS=Wg,v.cT=Hg,v.cU=function(i){const e=new up;return(function(r,s){for(const u in r.layers)s.writeMessage(3,eC,r.layers[u])})(i,e),e.finish()},v.cV=function(i,e,r,s,u,d){let m=Xx(i,e,r,u,0);return m=Xx(m,e,s,d,1),m},v.cW=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const e=this.map.get(i);return e!==void 0&&(this.map.delete(i),this.map.set(i,e)),e}set(i,e){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const r=this.map.keys().next().value;this.map.delete(r)}this.map.set(i,e)}clear(){this.map.clear()}},v.cX=kv,v.cY=up,v.cZ=Gx,v.c_=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},v.ca=class extends Eo{},v.cb=rE,v.cc=class extends Dl{},v.cd=Vg,v.ce=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},v.cf=gv,v.cg=function(i,e,r){var s=e[0],u=e[1],d=e[2],m=r[3]*s+r[7]*u+r[11]*d+r[15];return i[0]=(r[0]*s+r[4]*u+r[8]*d+r[12])/(m=m||1),i[1]=(r[1]*s+r[5]*u+r[9]*d+r[13])/m,i[2]=(r[2]*s+r[6]*u+r[10]*d+r[14])/m,i},v.ch=class extends Ih{},v.ci=class extends t{},v.cj=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},v.ck=function(i,e){var r=i[0],s=i[1],u=i[2],d=i[3],m=i[4],y=i[5],w=i[6],M=i[7],I=i[8],k=i[9],L=i[10],F=i[11],j=i[12],q=i[13],Z=i[14],Y=i[15],fe=e[0],J=e[1],ne=e[2],ge=e[3],we=e[4],De=e[5],Ke=e[6],Ge=e[7],tt=e[8],ht=e[9],it=e[10],He=e[11],Ne=e[12],bt=e[13],yt=e[14],St=e[15];return Math.abs(r-fe)<=Me*Math.max(1,Math.abs(r),Math.abs(fe))&&Math.abs(s-J)<=Me*Math.max(1,Math.abs(s),Math.abs(J))&&Math.abs(u-ne)<=Me*Math.max(1,Math.abs(u),Math.abs(ne))&&Math.abs(d-ge)<=Me*Math.max(1,Math.abs(d),Math.abs(ge))&&Math.abs(m-we)<=Me*Math.max(1,Math.abs(m),Math.abs(we))&&Math.abs(y-De)<=Me*Math.max(1,Math.abs(y),Math.abs(De))&&Math.abs(w-Ke)<=Me*Math.max(1,Math.abs(w),Math.abs(Ke))&&Math.abs(M-Ge)<=Me*Math.max(1,Math.abs(M),Math.abs(Ge))&&Math.abs(I-tt)<=Me*Math.max(1,Math.abs(I),Math.abs(tt))&&Math.abs(k-ht)<=Me*Math.max(1,Math.abs(k),Math.abs(ht))&&Math.abs(L-it)<=Me*Math.max(1,Math.abs(L),Math.abs(it))&&Math.abs(F-He)<=Me*Math.max(1,Math.abs(F),Math.abs(He))&&Math.abs(j-Ne)<=Me*Math.max(1,Math.abs(j),Math.abs(Ne))&&Math.abs(q-bt)<=Me*Math.max(1,Math.abs(q),Math.abs(bt))&&Math.abs(Z-yt)<=Me*Math.max(1,Math.abs(Z),Math.abs(yt))&&Math.abs(Y-St)<=Me*Math.max(1,Math.abs(Y),Math.abs(St))},v.cl=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},v.cm=i=>i.type==="symbol",v.cn=i=>i.type==="circle",v.co=i=>i.type==="heatmap",v.cp=i=>i.type==="line",v.cq=i=>i.type==="fill",v.cr=i=>i.type==="fill-extrusion",v.cs=i=>i.type==="hillshade",v.ct=i=>i.type==="color-relief",v.cu=i=>i.type==="background",v.cv=i=>i.type==="custom",v.cw=vt,v.cx=function(i,e,r){const s=$e(e.x-r.x,e.y-r.y),u=$e(i.x-r.x,i.y-r.y),d=Math.atan2(s[0]*u[1]-s[1]*u[0],(function(m,y){return m[0]*y[0]+m[1]*y[1]})(s,u));return gr(d)},v.cy=Pt,v.cz=function(i,e){return H[e]&&(i instanceof MouseEvent||i instanceof WheelEvent)},v.d=We,v.d0=vv,v.d1=D,v.d2=class{constructor(i,e){this.layers={[Jh]:this},this.name=Jh,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=i.length,this.features=i}feature(i){return new QE(this.features[i],this.extent)}},v.d3=hl,v.d4=Wa,v.e=Kt,v.f=i=>l(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),v.g=ze,v.h=i=>new Promise(((e,r)=>{const s=new Image;s.onload=()=>{e(s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame((()=>{s.src=Pr}))},s.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(i)],{type:"image/png"});s.src=i.byteLength?URL.createObjectURL(u):Pr})),v.i=Ut,v.j=(i,e)=>Xe(Kt(i,{type:"json"}),e),v.k=Cn,v.l=jt,v.m=Xe,v.n=(i,e)=>Xe(Kt(i,{type:"arrayBuffer"}),e),v.o=function(i){return new up(i).readFields(_E,[])},v.p=Hv,v.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},v.r=Oh,v.s=ba,v.t=di,v.u=Fe,v.v=vl,v.w=Nt,v.x=Eh,v.y=xl,v.z=Sl})),b("worker",["./shared"],(function(v){class l{constructor(H,W){this.keyCache={},H&&this.replace(H,W)}replace(H,W){this._layerConfigs={},this._layers={},this.update(H,[],W)}update(H,W,te){for(const Ee of H){this._layerConfigs[Ee.id]=Ee;const ze=this._layers[Ee.id]=v.bT(Ee,te);ze._featureFilter=v.aj(ze.filter,te),this.keyCache[Ee.id]&&delete this.keyCache[Ee.id]}for(const Ee of W)delete this.keyCache[Ee],delete this._layerConfigs[Ee],delete this._layers[Ee];this.familiesBySource={};const Se=v.cL(Object.values(this._layerConfigs),this.keyCache);for(const Ee of Se){const ze=Ee.map((ft=>this._layers[ft.id])),ve=ze[0];if(ve.isHidden())continue;const ye=ve.source||"";let Ae=this.familiesBySource[ye];Ae||(Ae=this.familiesBySource[ye]={});const Xe=ve.sourceLayer||v.ai;let We=Ae[Xe];We||(We=Ae[Xe]=[]),We.push(ze)}}}class C{constructor(H){const W={},te=[];for(const ve in H){const ye=H[ve],Ae=W[ve]={};for(const Xe in ye){const We=ye[+Xe];if(!We||We.bitmap.width===0||We.bitmap.height===0)continue;const ft={x:0,y:0,w:We.bitmap.width+2,h:We.bitmap.height+2};te.push(ft),Ae[Xe]={rect:ft,metrics:We.metrics}}}const{w:Se,h:Ee}=v.p(te),ze=new v.r({width:Se||1,height:Ee||1});for(const ve in H){const ye=H[ve];for(const Ae in ye){const Xe=ye[+Ae];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;const We=W[ve][Ae].rect;v.r.copy(Xe.bitmap,ze,{x:0,y:0},{x:We.x+1,y:We.y+1},Xe.bitmap)}}this.image=ze,this.positions=W}}v.cM("GlyphAtlas",C);class D{constructor(H){this.tileID=new v.a2(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.uid=H.uid,this.zoom=H.zoom,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.returnDependencies=!!H.returnDependencies,this.promoteId=H.promoteId,this.inFlightDependencies=[]}parse(H,W,te,Se,Ee){return v._(this,void 0,void 0,(function*(){this.status="parsing",this.data=H,this.collisionBoxArray=new v.ag;const ze=new v.cN(Object.keys(H.layers).sort()),ve=new v.cO(this.tileID,this.promoteId);ve.bucketLayerIDs=[];const ye={},Ae={featureIndex:ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:te,subdivisionGranularity:Ee},Xe=W.familiesBySource[this.source];for(const Fn in Xe){const xr=H.layers[Fn];if(!xr)continue;xr.version===1&&v.w(`Vector tile source "${this.source}" layer "${Fn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Zs=ze.encode(Fn),Ws=[];for(let st=0;st<xr.length;st++){const si=xr.feature(st),li=ve.getId(si,Fn);Ws.push({feature:si,id:li,index:st,sourceLayerIndex:Zs})}for(const st of Xe[Fn]){const si=st[0];si.source!==this.source&&v.w(`layer.source = ${si.source} does not equal this.source = ${this.source}`),si.isHidden(this.zoom,!0)||(z(st,this.zoom,te),(ye[si.id]=si.createBucket({index:ve.bucketLayerIDs.length,layers:st,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Zs,sourceID:this.source})).populate(Ws,Ae,this.tileID.canonical),ve.bucketLayerIDs.push(st.map((li=>li.id))))}}const We=v.bY(Ae.glyphDependencies,(Fn=>Object.keys(Fn).map(Number)));this.inFlightDependencies.forEach((Fn=>Fn?.abort())),this.inFlightDependencies=[];let ft=Promise.resolve({});if(Object.keys(We).length){const Fn=new AbortController;this.inFlightDependencies.push(Fn),ft=Se.sendAsync({type:"GG",data:{stacks:We,source:this.source,tileID:this.tileID,type:"glyphs"}},Fn)}const Mt=Object.keys(Ae.iconDependencies);let jt=Promise.resolve({});if(Mt.length){const Fn=new AbortController;this.inFlightDependencies.push(Fn),jt=Se.sendAsync({type:"GI",data:{icons:Mt,source:this.source,tileID:this.tileID,type:"icons"}},Fn)}const Cn=Object.keys(Ae.patternDependencies);let yn=Promise.resolve({});if(Cn.length){const Fn=new AbortController;this.inFlightDependencies.push(Fn),yn=Se.sendAsync({type:"GI",data:{icons:Cn,source:this.source,tileID:this.tileID,type:"patterns"}},Fn)}const Fe=Ae.dashDependencies;let Ln=Promise.resolve({});if(Object.keys(Fe).length){const Fn=new AbortController;this.inFlightDependencies.push(Fn),Ln=Se.sendAsync({type:"GDA",data:{dashes:Fe}},Fn)}const[Nr,Ht,An,Vr]=yield Promise.all([ft,jt,yn,Ln]),$n=new C(Nr),ar=new v.cP(Ht,An);for(const Fn in ye){const xr=ye[Fn];xr instanceof v.ah?(z(xr.layers,this.zoom,te),v.cQ({bucket:xr,glyphMap:Nr,glyphPositions:$n.positions,imageMap:Ht,imagePositions:ar.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ae.subdivisionGranularity})):xr.hasDependencies&&(xr instanceof v.cR||xr instanceof v.cS||xr instanceof v.cT)&&(z(xr.layers,this.zoom,te),xr.addFeatures(Ae,this.tileID.canonical,ar.patternPositions,Vr))}return this.status="done",{buckets:Object.values(ye).filter((Fn=>!Fn.isEmpty())),featureIndex:ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:$n.image,imageAtlas:ar,dashPositions:Vr,glyphMap:this.returnDependencies?Nr:null,iconMap:this.returnDependencies?Ht:null,glyphPositions:this.returnDependencies?$n.positions:null}}))}}function z(ke,H,W){const te=new v.H(H);for(const Se of ke)Se.recalculate(te,W)}class B{constructor(H,W,te,Se,Ee){this.type=H,this.properties=te||{},this.extent=Ee,this.pointsArray=W,this.id=Se}loadGeometry(){return this.pointsArray.map((H=>H.map((W=>new v.P(W.x,W.y)))))}}class V{constructor(H,W,te){this.version=2,this._myFeatures=H,this.name=W,this.length=H.length,this.extent=te}feature(H){return this._myFeatures[H]}}class G{constructor(){this.layers={}}addLayer(H){this.layers[H.name]=H}}function Q(ke){let H=v.cU(ke);return H.byteOffset===0&&H.byteLength===H.buffer.byteLength||(H=new Uint8Array(H)),{vectorTile:ke,rawData:H.buffer}}function ee(ke,H,W){const{extent:te}=ke,Se=Math.pow(2,W.z-H.z),Ee=(W.x-H.x*Se)*te,ze=(W.y-H.y*Se)*te,ve=[];for(let ye=0;ye<ke.length;ye++){const Ae=ke.feature(ye);let Xe=Ae.loadGeometry();for(const ft of Xe)for(const Mt of ft)Mt.x=Mt.x*Se-Ee,Mt.y=Mt.y*Se-ze;const We=128;Xe=v.cV(Xe,Ae.type,-We,-We,te+We,te+We),Xe.length!==0&&ve.push(new B(Ae.type,Xe,Ae.properties,Ae.id,te))}return new V(ve,ke.name,te)}class U{constructor(H,W,te){this.actor=H,this.layerIndex=W,this.availableImages=te,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new v.cW(1e3)}loadVectorTile(H,W){return v._(this,void 0,void 0,(function*(){const te=yield v.n(H.request,W);try{return{vectorTile:H.encoding!=="mlt"?new v.cX(new v.cY(te.data)):new v.cZ(te.data),rawData:te.data,cacheControl:te.cacheControl,expires:te.expires}}catch(Se){const Ee=new Uint8Array(te.data);let ze=`Unable to parse the tile at ${H.request.url}, `;throw ze+=Ee[0]===31&&Ee[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Se.message}`,new Error(ze)}}))}loadTile(H){return v._(this,void 0,void 0,(function*(){const{uid:W,overzoomParameters:te}=H;te&&(H.request=te.overzoomRequest);const Se=!!(H&&H.request&&H.request.collectResourceTiming)&&new v.c_(H.request),Ee=new D(H);this.loading[W]=Ee;const ze=new AbortController;Ee.abort=ze;try{const ve=yield this.loadVectorTile(H,ze);if(delete this.loading[W],!ve)return null;if(te){const ft=this._getOverzoomTile(H,ve.vectorTile);ve.rawData=ft.rawData,ve.vectorTile=ft.vectorTile}const ye=ve.rawData,Ae={};ve.expires&&(Ae.expires=ve.expires),ve.cacheControl&&(Ae.cacheControl=ve.cacheControl);const Xe={};if(Se){const ft=Se.finish();ft&&(Xe.resourceTiming=JSON.parse(JSON.stringify(ft)))}Ee.vectorTile=ve.vectorTile;const We=Ee.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity);this.loaded[W]=Ee,this.fetching[W]={rawTileData:ye,cacheControl:Ae,resourceTiming:Xe};try{const ft=yield We;return v.e({rawTileData:ye.slice(0),encoding:H.encoding},ft,Ae,Xe)}finally{delete this.fetching[W]}}catch(ve){throw delete this.loading[W],Ee.status="done",this.loaded[W]=Ee,ve}}))}_getOverzoomTile(H,W){const{tileID:te,source:Se,overzoomParameters:Ee}=H,{maxZoomTileID:ze}=Ee,ve=`${ze.key}_${te.key}`,ye=this.overzoomedTileResultCache.get(ve);if(ye)return ye;const Ae=new G,Xe=this.layerIndex.familiesBySource[Se];for(const ft in Xe){const Mt=W.layers[ft];if(!Mt)continue;const jt=ee(Mt,ze,te.canonical);jt.length>0&&Ae.addLayer(jt)}const We=Q(Ae);return this.overzoomedTileResultCache.set(ve,We),We}reloadTile(H){return v._(this,void 0,void 0,(function*(){const W=H.uid;if(!this.loaded||!this.loaded[W])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const te=this.loaded[W];if(te.showCollisionBoxes=H.showCollisionBoxes,te.status==="parsing"){const Se=yield te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity);let Ee;if(this.fetching[W]){const{rawTileData:ze,cacheControl:ve,resourceTiming:ye}=this.fetching[W];delete this.fetching[W],Ee=v.e({rawTileData:ze.slice(0),encoding:H.encoding},Se,ve,ye)}else Ee=Se;return Ee}if(te.status==="done"&&te.vectorTile)return te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity)}))}abortTile(H){return v._(this,void 0,void 0,(function*(){const W=this.loading,te=H.uid;W&&W[te]&&W[te].abort&&(W[te].abort.abort(),delete W[te])}))}removeTile(H){return v._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[H.uid]&&delete this.loaded[H.uid]}))}}class se{constructor(){this.loaded={}}loadTile(H){return v._(this,void 0,void 0,(function*(){const{uid:W,encoding:te,rawImageData:Se,redFactor:Ee,greenFactor:ze,blueFactor:ve,baseShift:ye}=H,Ae=Se.width+2,Xe=Se.height+2,We=v.b(Se)?new v.R({width:Ae,height:Xe},yield v.c$(Se,-1,-1,Ae,Xe)):Se,ft=new v.d0(W,We,te,Ee,ze,ve,ye);return this.loaded=this.loaded||{},this.loaded[W]=ft,ft}))}removeTile(H){const W=this.loaded,te=H.uid;W&&W[te]&&delete W[te]}}var Me,me,K=(function(){if(me)return Me;function ke(W,te){if(W.length!==0){H(W[0],te);for(var Se=1;Se<W.length;Se++)H(W[Se],!te)}}function H(W,te){for(var Se=0,Ee=0,ze=0,ve=W.length,ye=ve-1;ze<ve;ye=ze++){var Ae=(W[ze][0]-W[ye][0])*(W[ye][1]+W[ze][1]),Xe=Se+Ae;Ee+=Math.abs(Se)>=Math.abs(Ae)?Se-Xe+Ae:Ae-Xe+Se,Se=Xe}Se+Ee>=0!=!!te&&W.reverse()}return me=1,Me=function W(te,Se){var Ee,ze=te&&te.type;if(ze==="FeatureCollection")for(Ee=0;Ee<te.features.length;Ee++)W(te.features[Ee],Se);else if(ze==="GeometryCollection")for(Ee=0;Ee<te.geometries.length;Ee++)W(te.geometries[Ee],Se);else if(ze==="Feature")W(te.geometry,Se);else if(ze==="Polygon")ke(te.coordinates,Se);else if(ze==="MultiPolygon")for(Ee=0;Ee<te.coordinates.length;Ee++)ke(te.coordinates[Ee],Se);return te}})(),ce=v.d1(K);const oe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ke=>ke},ue=Math.fround||(de=new Float32Array(1),ke=>(de[0]=+ke,de[0]));var de;class be{constructor(H){this.options=Object.assign(Object.create(oe),H),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(H){const{log:W,minZoom:te,maxZoom:Se}=this.options;W&&console.time("total time");const Ee=`prepare ${H.length} points`;W&&console.time(Ee),this.points=H;const ze=[];for(let ye=0;ye<H.length;ye++){const Ae=H[ye];if(!Ae.geometry)continue;const[Xe,We]=Ae.geometry.coordinates,ft=ue(qe(Xe)),Mt=ue(Ye(We));ze.push(ft,Mt,1/0,ye,-1,1),this.options.reduce&&ze.push(0)}let ve=this.trees[Se+1]=this._createTree(ze);W&&console.timeEnd(Ee);for(let ye=Se;ye>=te;ye--){const Ae=+Date.now();ve=this.trees[ye]=this._createTree(this._cluster(ve,ye)),W&&console.log("z%d: %d clusters in %dms",ye,ve.numItems,+Date.now()-Ae)}return W&&console.timeEnd("total time"),this}getClusters(H,W){let te=((H[0]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,H[1]));let Ee=H[2]===180?180:((H[2]+180)%360+360)%360-180;const ze=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)te=-180,Ee=180;else if(te>Ee){const We=this.getClusters([te,Se,180,ze],W),ft=this.getClusters([-180,Se,Ee,ze],W);return We.concat(ft)}const ve=this.trees[this._limitZoom(W)],ye=ve.range(qe(te),Ye(ze),qe(Ee),Ye(Se)),Ae=ve.data,Xe=[];for(const We of ye){const ft=this.stride*We;Xe.push(Ae[ft+5]>1?Re(Ae,ft,this.clusterProps):this.points[Ae[ft+3]])}return Xe}getChildren(H){const W=this._getOriginId(H),te=this._getOriginZoom(H),Se="No cluster with the specified id.",Ee=this.trees[te];if(!Ee)throw new Error(Se);const ze=Ee.data;if(W*this.stride>=ze.length)throw new Error(Se);const ve=this.options.radius/(this.options.extent*Math.pow(2,te-1)),ye=Ee.within(ze[W*this.stride],ze[W*this.stride+1],ve),Ae=[];for(const Xe of ye){const We=Xe*this.stride;ze[We+4]===H&&Ae.push(ze[We+5]>1?Re(ze,We,this.clusterProps):this.points[ze[We+3]])}if(Ae.length===0)throw new Error(Se);return Ae}getLeaves(H,W,te){const Se=[];return this._appendLeaves(Se,H,W=W||10,te=te||0,0),Se}getTile(H,W,te){const Se=this.trees[this._limitZoom(H)],Ee=Math.pow(2,H),{extent:ze,radius:ve}=this.options,ye=ve/ze,Ae=(te-ye)/Ee,Xe=(te+1+ye)/Ee,We={features:[]};return this._addTileFeatures(Se.range((W-ye)/Ee,Ae,(W+1+ye)/Ee,Xe),Se.data,W,te,Ee,We),W===0&&this._addTileFeatures(Se.range(1-ye/Ee,Ae,1,Xe),Se.data,Ee,te,Ee,We),W===Ee-1&&this._addTileFeatures(Se.range(0,Ae,ye/Ee,Xe),Se.data,-1,te,Ee,We),We.features.length?We:null}getClusterExpansionZoom(H){let W=this._getOriginZoom(H)-1;for(;W<=this.options.maxZoom;){const te=this.getChildren(H);if(W++,te.length!==1)break;H=te[0].properties.cluster_id}return W}_appendLeaves(H,W,te,Se,Ee){const ze=this.getChildren(W);for(const ve of ze){const ye=ve.properties;if(ye&&ye.cluster?Ee+ye.point_count<=Se?Ee+=ye.point_count:Ee=this._appendLeaves(H,ye.cluster_id,te,Se,Ee):Ee<Se?Ee++:H.push(ve),H.length===te)break}return Ee}_createTree(H){const W=new v.aT(H.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<H.length;te+=this.stride)W.add(H[te],H[te+1]);return W.finish(),W.data=H,W}_addTileFeatures(H,W,te,Se,Ee,ze){for(const ve of H){const ye=ve*this.stride,Ae=W[ye+5]>1;let Xe,We,ft;if(Ae)Xe=Ve(W,ye,this.clusterProps),We=W[ye],ft=W[ye+1];else{const Cn=this.points[W[ye+3]];Xe=Cn.properties;const[yn,Fe]=Cn.geometry.coordinates;We=qe(yn),ft=Ye(Fe)}const Mt={type:1,geometry:[[Math.round(this.options.extent*(We*Ee-te)),Math.round(this.options.extent*(ft*Ee-Se))]],tags:Xe};let jt;jt=Ae||this.options.generateId?W[ye+3]:this.points[W[ye+3]].id,jt!==void 0&&(Mt.id=jt),ze.features.push(Mt)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,W){const{radius:te,extent:Se,reduce:Ee,minPoints:ze}=this.options,ve=te/(Se*Math.pow(2,W)),ye=H.data,Ae=[],Xe=this.stride;for(let We=0;We<ye.length;We+=Xe){if(ye[We+2]<=W)continue;ye[We+2]=W;const ft=ye[We],Mt=ye[We+1],jt=H.within(ye[We],ye[We+1],ve),Cn=ye[We+5];let yn=Cn;for(const Fe of jt){const Ln=Fe*Xe;ye[Ln+2]>W&&(yn+=ye[Ln+5])}if(yn>Cn&&yn>=ze){let Fe,Ln=ft*Cn,Nr=Mt*Cn,Ht=-1;const An=(We/Xe<<5)+(W+1)+this.points.length;for(const Vr of jt){const $n=Vr*Xe;if(ye[$n+2]<=W)continue;ye[$n+2]=W;const ar=ye[$n+5];Ln+=ye[$n]*ar,Nr+=ye[$n+1]*ar,ye[$n+4]=An,Ee&&(Fe||(Fe=this._map(ye,We,!0),Ht=this.clusterProps.length,this.clusterProps.push(Fe)),Ee(Fe,this._map(ye,$n)))}ye[We+4]=An,Ae.push(Ln/yn,Nr/yn,1/0,An,-1,yn),Ee&&Ae.push(Ht)}else{for(let Fe=0;Fe<Xe;Fe++)Ae.push(ye[We+Fe]);if(yn>1)for(const Fe of jt){const Ln=Fe*Xe;if(!(ye[Ln+2]<=W)){ye[Ln+2]=W;for(let Nr=0;Nr<Xe;Nr++)Ae.push(ye[Ln+Nr])}}}}return Ae}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,W,te){if(H[W+5]>1){const ze=this.clusterProps[H[W+6]];return te?Object.assign({},ze):ze}const Se=this.points[H[W+3]].properties,Ee=this.options.map(Se);return te&&Ee===Se?Object.assign({},Ee):Ee}}function Re(ke,H,W){return{type:"Feature",id:ke[H+3],properties:Ve(ke,H,W),geometry:{type:"Point",coordinates:[(te=ke[H],360*(te-.5)),et(ke[H+1])]}};var te}function Ve(ke,H,W){const te=ke[H+5],Se=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,Ee=ke[H+6],ze=Ee===-1?{}:Object.assign({},W[Ee]);return Object.assign(ze,{cluster:!0,cluster_id:ke[H+3],point_count:te,point_count_abbreviated:Se})}function qe(ke){return ke/360+.5}function Ye(ke){const H=Math.sin(ke*Math.PI/180),W=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return W<0?0:W>1?1:W}function et(ke){const H=(180-360*ke)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function Ie(ke,H,W,te){let Se=te;const Ee=H+(W-H>>1);let ze,ve=W-H;const ye=ke[H],Ae=ke[H+1],Xe=ke[W],We=ke[W+1];for(let ft=H+3;ft<W;ft+=3){const Mt=Je(ke[ft],ke[ft+1],ye,Ae,Xe,We);if(Mt>Se)ze=ft,Se=Mt;else if(Mt===Se){const jt=Math.abs(ft-Ee);jt<ve&&(ze=ft,ve=jt)}}Se>te&&(ze-H>3&&Ie(ke,H,ze,te),ke[ze+2]=Se,W-ze>3&&Ie(ke,ze,W,te))}function Je(ke,H,W,te,Se,Ee){let ze=Se-W,ve=Ee-te;if(ze!==0||ve!==0){const ye=((ke-W)*ze+(H-te)*ve)/(ze*ze+ve*ve);ye>1?(W=Se,te=Ee):ye>0&&(W+=ze*ye,te+=ve*ye)}return ze=ke-W,ve=H-te,ze*ze+ve*ve}function Qe(ke,H,W,te){const Se={id:ke??null,type:H,geometry:W,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(H==="Point"||H==="MultiPoint"||H==="LineString")$e(Se,W);else if(H==="Polygon")$e(Se,W[0]);else if(H==="MultiLineString")for(const Ee of W)$e(Se,Ee);else if(H==="MultiPolygon")for(const Ee of W)$e(Se,Ee[0]);return Se}function $e(ke,H){for(let W=0;W<H.length;W+=3)ke.minX=Math.min(ke.minX,H[W]),ke.minY=Math.min(ke.minY,H[W+1]),ke.maxX=Math.max(ke.maxX,H[W]),ke.maxY=Math.max(ke.maxY,H[W+1])}function at(ke,H,W,te){if(!H.geometry)return;const Se=H.geometry.coordinates;if(Se&&Se.length===0)return;const Ee=H.geometry.type,ze=Math.pow(W.tolerance/((1<<W.maxZoom)*W.extent),2);let ve=[],ye=H.id;if(W.promoteId?ye=H.properties[W.promoteId]:W.generateId&&(ye=te||0),Ee==="Point")zt(Se,ve);else if(Ee==="MultiPoint")for(const Ae of Se)zt(Ae,ve);else if(Ee==="LineString")rt(Se,ve,ze,!1);else if(Ee==="MultiLineString"){if(W.lineMetrics){for(const Ae of Se)ve=[],rt(Ae,ve,ze,!1),ke.push(Qe(ye,"LineString",ve,H.properties));return}ct(Se,ve,ze,!1)}else if(Ee==="Polygon")ct(Se,ve,ze,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(const Ae of H.geometry.geometries)at(ke,{id:ye,geometry:Ae,properties:H.properties},W,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ae of Se){const Xe=[];ct(Ae,Xe,ze,!0),ve.push(Xe)}}ke.push(Qe(ye,Ee,ve,H.properties))}function zt(ke,H){H.push(xt(ke[0]),vt(ke[1]),0)}function rt(ke,H,W,te){let Se,Ee,ze=0;for(let ye=0;ye<ke.length;ye++){const Ae=xt(ke[ye][0]),Xe=vt(ke[ye][1]);H.push(Ae,Xe,0),ye>0&&(ze+=te?(Se*Xe-Ae*Ee)/2:Math.sqrt(Math.pow(Ae-Se,2)+Math.pow(Xe-Ee,2))),Se=Ae,Ee=Xe}const ve=H.length-3;H[2]=1,Ie(H,0,ve,W),H[ve+2]=1,H.size=Math.abs(ze),H.start=0,H.end=H.size}function ct(ke,H,W,te){for(let Se=0;Se<ke.length;Se++){const Ee=[];rt(ke[Se],Ee,W,te),H.push(Ee)}}function xt(ke){return ke/360+.5}function vt(ke){const H=Math.sin(ke*Math.PI/180),W=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return W<0?0:W>1?1:W}function Pt(ke,H,W,te,Se,Ee,ze,ve){if(te/=H,Ee>=(W/=H)&&ze<te)return ke;if(ze<W||Ee>=te)return null;const ye=[];for(const Ae of ke){const Xe=Ae.geometry;let We=Ae.type;const ft=Se===0?Ae.minX:Ae.minY,Mt=Se===0?Ae.maxX:Ae.maxY;if(ft>=W&&Mt<te){ye.push(Ae);continue}if(Mt<W||ft>=te)continue;let jt=[];if(We==="Point"||We==="MultiPoint")pt(Xe,jt,W,te,Se);else if(We==="LineString")Et(Xe,jt,W,te,Se,!1,ve.lineMetrics);else if(We==="MultiLineString")ot(Xe,jt,W,te,Se,!1);else if(We==="Polygon")ot(Xe,jt,W,te,Se,!0);else if(We==="MultiPolygon")for(const Cn of Xe){const yn=[];ot(Cn,yn,W,te,Se,!0),yn.length&&jt.push(yn)}if(jt.length){if(ve.lineMetrics&&We==="LineString"){for(const Cn of jt)ye.push(Qe(Ae.id,We,Cn,Ae.tags));continue}We!=="LineString"&&We!=="MultiLineString"||(jt.length===1?(We="LineString",jt=jt[0]):We="MultiLineString"),We!=="Point"&&We!=="MultiPoint"||(We=jt.length===3?"Point":"MultiPoint"),ye.push(Qe(Ae.id,We,jt,Ae.tags))}}return ye.length?ye:null}function pt(ke,H,W,te,Se){for(let Ee=0;Ee<ke.length;Ee+=3){const ze=ke[Ee+Se];ze>=W&&ze<=te&&_t(H,ke[Ee],ke[Ee+1],ke[Ee+2])}}function Et(ke,H,W,te,Se,Ee,ze){let ve=Kt(ke);const ye=Se===0?Rt:Ze;let Ae,Xe,We=ke.start;for(let yn=0;yn<ke.length-3;yn+=3){const Fe=ke[yn],Ln=ke[yn+1],Nr=ke[yn+2],Ht=ke[yn+3],An=ke[yn+4],Vr=Se===0?Fe:Ln,$n=Se===0?Ht:An;let ar=!1;ze&&(Ae=Math.sqrt(Math.pow(Fe-Ht,2)+Math.pow(Ln-An,2))),Vr<W?$n>W&&(Xe=ye(ve,Fe,Ln,Ht,An,W),ze&&(ve.start=We+Ae*Xe)):Vr>te?$n<te&&(Xe=ye(ve,Fe,Ln,Ht,An,te),ze&&(ve.start=We+Ae*Xe)):_t(ve,Fe,Ln,Nr),$n<W&&Vr>=W&&(Xe=ye(ve,Fe,Ln,Ht,An,W),ar=!0),$n>te&&Vr<=te&&(Xe=ye(ve,Fe,Ln,Ht,An,te),ar=!0),!Ee&&ar&&(ze&&(ve.end=We+Ae*Xe),H.push(ve),ve=Kt(ke)),ze&&(We+=Ae)}let ft=ke.length-3;const Mt=ke[ft],jt=ke[ft+1],Cn=Se===0?Mt:jt;Cn>=W&&Cn<=te&&_t(ve,Mt,jt,ke[ft+2]),ft=ve.length-3,Ee&&ft>=3&&(ve[ft]!==ve[0]||ve[ft+1]!==ve[1])&&_t(ve,ve[0],ve[1],ve[2]),ve.length&&H.push(ve)}function Kt(ke){const H=[];return H.size=ke.size,H.start=ke.start,H.end=ke.end,H}function ot(ke,H,W,te,Se,Ee){for(const ze of ke)Et(ze,H,W,te,Se,Ee,!1)}function _t(ke,H,W,te){ke.push(H,W,te)}function Rt(ke,H,W,te,Se,Ee){const ze=(Ee-H)/(te-H);return _t(ke,Ee,W+(Se-W)*ze,1),ze}function Ze(ke,H,W,te,Se,Ee){const ze=(Ee-W)/(Se-W);return _t(ke,H+(te-H)*ze,Ee,1),ze}function Pn(ke,H){const W=[];for(let te=0;te<ke.length;te++){const Se=ke[te],Ee=Se.type;let ze;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")ze=Nt(Se.geometry,H);else if(Ee==="MultiLineString"||Ee==="Polygon"){ze=[];for(const ve of Se.geometry)ze.push(Nt(ve,H))}else if(Ee==="MultiPolygon"){ze=[];for(const ve of Se.geometry){const ye=[];for(const Ae of ve)ye.push(Nt(Ae,H));ze.push(ye)}}W.push(Qe(Se.id,Ee,ze,Se.tags))}return W}function Nt(ke,H){const W=[];W.size=ke.size,ke.start!==void 0&&(W.start=ke.start,W.end=ke.end);for(let te=0;te<ke.length;te+=3)W.push(ke[te]+H,ke[te+1],ke[te+2]);return W}function Jt(ke,H){if(ke.transformed)return ke;const W=1<<ke.z,te=ke.x,Se=ke.y;for(const Ee of ke.features){const ze=Ee.geometry,ve=Ee.type;if(Ee.geometry=[],ve===1)for(let ye=0;ye<ze.length;ye+=2)Ee.geometry.push(Ut(ze[ye],ze[ye+1],H,W,te,Se));else for(let ye=0;ye<ze.length;ye++){const Ae=[];for(let Xe=0;Xe<ze[ye].length;Xe+=2)Ae.push(Ut(ze[ye][Xe],ze[ye][Xe+1],H,W,te,Se));Ee.geometry.push(Ae)}}return ke.transformed=!0,ke}function Ut(ke,H,W,te,Se,Ee){return[Math.round(W*(ke*te-Se)),Math.round(W*(H*te-Ee))]}function qt(ke,H,W,te,Se){const Ee=H===Se.maxZoom?0:Se.tolerance/((1<<H)*Se.extent),ze={features:[],numPoints:0,numSimplified:0,numFeatures:ke.length,source:null,x:W,y:te,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ve of ke)cn(ze,ve,Ee,Se);return ze}function cn(ke,H,W,te){const Se=H.geometry,Ee=H.type,ze=[];if(ke.minX=Math.min(ke.minX,H.minX),ke.minY=Math.min(ke.minY,H.minY),ke.maxX=Math.max(ke.maxX,H.maxX),ke.maxY=Math.max(ke.maxY,H.maxY),Ee==="Point"||Ee==="MultiPoint")for(let ve=0;ve<Se.length;ve+=3)ze.push(Se[ve],Se[ve+1]),ke.numPoints++,ke.numSimplified++;else if(Ee==="LineString")Pr(ze,Se,ke,W,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(let ve=0;ve<Se.length;ve++)Pr(ze,Se[ve],ke,W,Ee==="Polygon",ve===0);else if(Ee==="MultiPolygon")for(let ve=0;ve<Se.length;ve++){const ye=Se[ve];for(let Ae=0;Ae<ye.length;Ae++)Pr(ze,ye[Ae],ke,W,!0,Ae===0)}if(ze.length){let ve=H.tags||null;if(Ee==="LineString"&&te.lineMetrics){ve={};for(const Ae in H.tags)ve[Ae]=H.tags[Ae];ve.mapbox_clip_start=Se.start/Se.size,ve.mapbox_clip_end=Se.end/Se.size}const ye={geometry:ze,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:ve};H.id!==null&&(ye.id=H.id),ke.features.push(ye)}}function Pr(ke,H,W,te,Se,Ee){const ze=te*te;if(te>0&&H.size<(Se?ze:te))return void(W.numPoints+=H.length/3);const ve=[];for(let ye=0;ye<H.length;ye+=3)(te===0||H[ye+2]>ze)&&(W.numSimplified++,ve.push(H[ye],H[ye+1])),W.numPoints++;Se&&(function(ye,Ae){let Xe=0;for(let We=0,ft=ye.length,Mt=ft-2;We<ft;Mt=We,We+=2)Xe+=(ye[We]-ye[Mt])*(ye[We+1]+ye[Mt+1]);if(Xe>0===Ae)for(let We=0,ft=ye.length;We<ft/2;We+=2){const Mt=ye[We],jt=ye[We+1];ye[We]=ye[ft-2-We],ye[We+1]=ye[ft-1-We],ye[ft-2-We]=Mt,ye[ft-1-We]=jt}})(ve,Ee),ke.push(ve)}const Xr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class oi{constructor(H,W){const te=(W=this.options=(function(Ee,ze){for(const ve in ze)Ee[ve]=ze[ve];return Ee})(Object.create(Xr),W)).debug;if(te&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");let Se=(function(Ee,ze){const ve=[];if(Ee.type==="FeatureCollection")for(let ye=0;ye<Ee.features.length;ye++)at(ve,Ee.features[ye],ze,ye);else at(ve,Ee.type==="Feature"?Ee:{geometry:Ee},ze);return ve})(H,W);this.tiles={},this.tileCoords=[],te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Se=(function(Ee,ze){const ve=ze.buffer/ze.extent;let ye=Ee;const Ae=Pt(Ee,1,-1-ve,ve,0,-1,2,ze),Xe=Pt(Ee,1,1-ve,2+ve,0,-1,2,ze);return(Ae||Xe)&&(ye=Pt(Ee,1,-ve,1+ve,0,-1,2,ze)||[],Ae&&(ye=Pn(Ae,1).concat(ye)),Xe&&(ye=ye.concat(Pn(Xe,-1)))),ye})(Se,W),Se.length&&this.splitTile(Se,0,0,0),te&&(Se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(H,W,te,Se,Ee,ze,ve){const ye=[H,W,te,Se],Ae=this.options,Xe=Ae.debug;for(;ye.length;){Se=ye.pop(),te=ye.pop(),W=ye.pop(),H=ye.pop();const We=1<<W,ft=Ar(W,te,Se);let Mt=this.tiles[ft];if(!Mt&&(Xe>1&&console.time("creation"),Mt=this.tiles[ft]=qt(H,W,te,Se,Ae),this.tileCoords.push({z:W,x:te,y:Se}),Xe)){Xe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,te,Se,Mt.numFeatures,Mt.numPoints,Mt.numSimplified),console.timeEnd("creation"));const ar=`z${W}`;this.stats[ar]=(this.stats[ar]||0)+1,this.total++}if(Mt.source=H,Ee==null){if(W===Ae.indexMaxZoom||Mt.numPoints<=Ae.indexMaxPoints)continue}else{if(W===Ae.maxZoom||W===Ee)continue;if(Ee!=null){const ar=Ee-W;if(te!==ze>>ar||Se!==ve>>ar)continue}}if(Mt.source=null,H.length===0)continue;Xe>1&&console.time("clipping");const jt=.5*Ae.buffer/Ae.extent,Cn=.5-jt,yn=.5+jt,Fe=1+jt;let Ln=null,Nr=null,Ht=null,An=null,Vr=Pt(H,We,te-jt,te+yn,0,Mt.minX,Mt.maxX,Ae),$n=Pt(H,We,te+Cn,te+Fe,0,Mt.minX,Mt.maxX,Ae);H=null,Vr&&(Ln=Pt(Vr,We,Se-jt,Se+yn,1,Mt.minY,Mt.maxY,Ae),Nr=Pt(Vr,We,Se+Cn,Se+Fe,1,Mt.minY,Mt.maxY,Ae),Vr=null),$n&&(Ht=Pt($n,We,Se-jt,Se+yn,1,Mt.minY,Mt.maxY,Ae),An=Pt($n,We,Se+Cn,Se+Fe,1,Mt.minY,Mt.maxY,Ae),$n=null),Xe>1&&console.timeEnd("clipping"),ye.push(Ln||[],W+1,2*te,2*Se),ye.push(Nr||[],W+1,2*te,2*Se+1),ye.push(Ht||[],W+1,2*te+1,2*Se),ye.push(An||[],W+1,2*te+1,2*Se+1)}}getTile(H,W,te){H=+H,W=+W,te=+te;const Se=this.options,{extent:Ee,debug:ze}=Se;if(H<0||H>24)return null;const ve=1<<H,ye=Ar(H,W=W+ve&ve-1,te);if(this.tiles[ye])return Jt(this.tiles[ye],Ee);ze>1&&console.log("drilling down to z%d-%d-%d",H,W,te);let Ae,Xe=H,We=W,ft=te;for(;!Ae&&Xe>0;)Xe--,We>>=1,ft>>=1,Ae=this.tiles[Ar(Xe,We,ft)];return Ae&&Ae.source?(ze>1&&(console.log("found parent tile z%d-%d-%d",Xe,We,ft),console.time("drilling down")),this.splitTile(Ae.source,Xe,We,ft,H,W,te),ze>1&&console.timeEnd("drilling down"),this.tiles[ye]?Jt(this.tiles[ye],Ee):null):null}}function Ar(ke,H,W){return 32*((1<<ke)*W+H)+ke}class ba extends U{constructor(H,W,te,Se=Oa){super(H,W,te),this._dataUpdateable=new Map,this._createGeoJSONIndex=Se}loadVectorTile(H,W){return v._(this,void 0,void 0,(function*(){const te=H.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Se=this._geoJSONIndex.getTile(te.z,te.x,te.y);return Se?Q(new v.d2(Se.features,{version:2,extent:v.a5})):null}))}loadData(H){return v._(this,void 0,void 0,(function*(){var W;(W=this._pendingRequest)===null||W===void 0||W.abort();const te=this._startPerformance(H);this._pendingRequest=new AbortController;try{(!this._pendingData||H.request||H.data||H.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(H,this._pendingRequest));const Se=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(Se,H),this.loaded={};const Ee={};return H.request&&(Ee.data=Se),this._finishPerformance(te,H,Ee),Ee}catch(Se){if(delete this._pendingRequest,v.Z(Se))return{abandoned:!0};throw Se}}))}_startPerformance(H){var W;if(!((W=H?.request)===null||W===void 0)&&W.collectResourceTiming)return new v.c_(H.request)}_finishPerformance(H,W,te){if(!H)return;const Se=H.finish();Se&&(te.resourceTiming={},te.resourceTiming[W.source]=JSON.parse(JSON.stringify(Se)))}getData(){return v._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(H){const W=this.loaded;return W&&W[H.uid]?super.reloadTile(H):this.loadTile(H)}loadAndProcessGeoJSON(H,W){return v._(this,void 0,void 0,(function*(){let te;if(H.request?te=yield this.loadGeoJSONFromUrl(H.request,H.promoteId,W):H.data?te=this._loadGeoJSONFromObject(H.data,H.promoteId):H.dataDiff&&(te=this._loadGeoJSONFromDiff(H.dataDiff,H.promoteId,H.source)),delete this._pendingRequest,typeof te!="object")throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`);return ce(te,!0),H.filter&&(te=this._filterGeoJSON(te,H.filter)),te}))}loadGeoJSONFromUrl(H,W,te){return v._(this,void 0,void 0,(function*(){const Se=yield v.j(H,te);return this._dataUpdateable=v.a7(Se.data,W),Se.data}))}_loadGeoJSONFromObject(H,W){return this._dataUpdateable=v.a7(H,W),H}_loadGeoJSONFromDiff(H,W,te){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${te}`);v.a8(this._dataUpdateable,H,W);const Se=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(Se)}_filterGeoJSON(H,W){const te=v.d3(W,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(te.result==="error")throw new Error(te.value.map((Ee=>`${Ee.key}: ${Ee.message}`)).join(", "));const Se=H.features.filter((Ee=>te.value.evaluate({zoom:0},Ee)));return this._toFeatureCollection(Se)}_toFeatureCollection(H){return{type:"FeatureCollection",features:H}}removeSource(H){return v._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(H){return this._geoJSONIndex.getClusterExpansionZoom(H.clusterId)}getClusterChildren(H){return this._geoJSONIndex.getChildren(H.clusterId)}getClusterLeaves(H){return this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset)}}function Oa(ke,H){return H.cluster?new be((function({superclusterOptions:W,clusterProperties:te}){if(!te||!W)return W;const Se={},Ee={},ze={accumulated:null,zoom:0},ve={properties:null},ye=Object.keys(te);for(const Ae of ye){const[Xe,We]=te[Ae],ft=v.d3(We),Mt=v.d3(typeof Xe=="string"?[Xe,["accumulated"],["get",Ae]]:Xe);Se[Ae]=ft.value,Ee[Ae]=Mt.value}return W.map=Ae=>{ve.properties=Ae;const Xe={};for(const We of ye)Xe[We]=Se[We].evaluate(ze,ve);return Xe},W.reduce=(Ae,Xe)=>{ve.properties=Xe;for(const We of ye)ze.accumulated=Ae[We],Ae[We]=Ee[We].evaluate(ze,ve)},W})(H)).load(ke.features):(function(W,te){return new oi(W,te)})(ke,H.geojsonVtOptions)}class gr{constructor(H){this.self=H,this.actor=new v.L(H),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(W,te)=>{if(this.externalWorkerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.externalWorkerSourceTypes[W]=te},this.self.addProtocol=v.cJ,this.self.removeProtocol=v.cK,this.self.registerRTLTextPlugin=W=>{v.d4.setMethods(W)},this.actor.registerMessageHandler("LDT",((W,te)=>this._getDEMWorkerSource(W,te.source).loadTile(te))),this.actor.registerMessageHandler("RDT",((W,te)=>v._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(W,te.source).removeTile(te)})))),this.actor.registerMessageHandler("GCEZ",((W,te)=>v._(this,void 0,void 0,(function*(){return this._getWorkerSource(W,te.type,te.source).getClusterExpansionZoom(te)})))),this.actor.registerMessageHandler("GCC",((W,te)=>v._(this,void 0,void 0,(function*(){return this._getWorkerSource(W,te.type,te.source).getClusterChildren(te)})))),this.actor.registerMessageHandler("GCL",((W,te)=>v._(this,void 0,void 0,(function*(){return this._getWorkerSource(W,te.type,te.source).getClusterLeaves(te)})))),this.actor.registerMessageHandler("LD",((W,te)=>this._getWorkerSource(W,te.type,te.source).loadData(te))),this.actor.registerMessageHandler("GD",((W,te)=>this._getWorkerSource(W,te.type,te.source).getData())),this.actor.registerMessageHandler("LT",((W,te)=>this._getWorkerSource(W,te.type,te.source).loadTile(te))),this.actor.registerMessageHandler("RT",((W,te)=>this._getWorkerSource(W,te.type,te.source).reloadTile(te))),this.actor.registerMessageHandler("AT",((W,te)=>this._getWorkerSource(W,te.type,te.source).abortTile(te))),this.actor.registerMessageHandler("RMT",((W,te)=>this._getWorkerSource(W,te.type,te.source).removeTile(te))),this.actor.registerMessageHandler("RS",((W,te)=>v._(this,void 0,void 0,(function*(){if(!this.workerSources[W]||!this.workerSources[W][te.type]||!this.workerSources[W][te.type][te.source])return;const Se=this.workerSources[W][te.type][te.source];delete this.workerSources[W][te.type][te.source],Se.removeSource!==void 0&&Se.removeSource(te)})))),this.actor.registerMessageHandler("RM",(W=>v._(this,void 0,void 0,(function*(){delete this.layerIndexes[W],delete this.availableImages[W],delete this.workerSources[W],delete this.demWorkerSources[W],this.globalStates.delete(W)})))),this.actor.registerMessageHandler("SR",((W,te)=>v._(this,void 0,void 0,(function*(){this.referrer=te})))),this.actor.registerMessageHandler("SRPS",((W,te)=>this._syncRTLPluginState(W,te))),this.actor.registerMessageHandler("IS",((W,te)=>v._(this,void 0,void 0,(function*(){this.self.importScripts(te)})))),this.actor.registerMessageHandler("SI",((W,te)=>this._setImages(W,te))),this.actor.registerMessageHandler("UL",((W,te)=>v._(this,void 0,void 0,(function*(){this._getLayerIndex(W).update(te.layers,te.removedIds,this._getGlobalState(W))})))),this.actor.registerMessageHandler("UGS",((W,te)=>v._(this,void 0,void 0,(function*(){const Se=this._getGlobalState(W);for(const Ee in te)Se[Ee]=te[Ee]})))),this.actor.registerMessageHandler("SL",((W,te)=>v._(this,void 0,void 0,(function*(){this._getLayerIndex(W).replace(te,this._getGlobalState(W))}))))}_getGlobalState(H){let W=this.globalStates.get(H);return W||(W={},this.globalStates.set(H,W)),W}_setImages(H,W){return v._(this,void 0,void 0,(function*(){this.availableImages[H]=W;for(const te in this.workerSources[H]){const Se=this.workerSources[H][te];for(const Ee in Se)Se[Ee].availableImages=W}}))}_syncRTLPluginState(H,W){return v._(this,void 0,void 0,(function*(){return yield v.d4.syncState(W,this.self.importScripts)}))}_getAvailableImages(H){let W=this.availableImages[H];return W||(W=[]),W}_getLayerIndex(H){let W=this.layerIndexes[H];return W||(W=this.layerIndexes[H]=new l),W}_getWorkerSource(H,W,te){if(this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][W]||(this.workerSources[H][W]={}),!this.workerSources[H][W][te]){const Se={sendAsync:(Ee,ze)=>(Ee.targetMapId=H,this.actor.sendAsync(Ee,ze))};switch(W){case"vector":this.workerSources[H][W][te]=new U(Se,this._getLayerIndex(H),this._getAvailableImages(H));break;case"geojson":this.workerSources[H][W][te]=new ba(Se,this._getLayerIndex(H),this._getAvailableImages(H));break;default:this.workerSources[H][W][te]=new this.externalWorkerSourceTypes[W](Se,this._getLayerIndex(H),this._getAvailableImages(H))}}return this.workerSources[H][W][te]}_getDEMWorkerSource(H,W){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][W]||(this.demWorkerSources[H][W]=new se),this.demWorkerSources[H][W]}}return v.i(self)&&(self.worker=new gr(self)),gr})),b("index",["exports","./shared"],(function(v,l){var C="5.16.0";function D(){var g=new l.A(4);return l.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}let z,B,V;const G={frame(g,t,a){const c=requestAnimationFrame((_=>{f(),t(_)})),{unsubscribe:f}=l.s(g.signal,"abort",(()=>{f(),cancelAnimationFrame(c),a(new l.a(g.signal.reason))}),!1)},frameAsync(g){return new Promise(((t,a)=>{this.frame(g,t,a)}))},getImageData(g,t=0){return this.getImageCanvasContext(g).getImageData(-t,-t,g.width+2*t,g.height+2*t)},getImageCanvasContext(g){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=g.width,t.height=g.height,a.drawImage(g,0,0,g.width,g.height),a},resolveURL:g=>(z||(z=document.createElement("a")),z.href=g,z.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return V!==void 0?V:!!matchMedia&&(B==null&&(B=matchMedia("(prefers-reduced-motion: reduce)")),B.matches)},set prefersReducedMotion(g){V=g}},Q=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(g){this._frozenAt=g}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function ee(){return Q.getCurrentTime()}class U{static testProp(t){if(!U.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in U.docStyle)return t[a];return t[0]}static create(t,a,c){const f=window.document.createElement(t);return a!==void 0&&(f.className=a),c&&c.appendChild(f),f}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){U.docStyle&&U.selectProp&&(U.userSelect=U.docStyle[U.selectProp],U.docStyle[U.selectProp]="none")}static enableDrag(){U.docStyle&&U.selectProp&&(U.docStyle[U.selectProp]=U.userSelect)}static setTransform(t,a){t.style[U.transformProp]=a}static addEventListener(t,a,c,f={}){t.addEventListener(a,c,"passive"in f?f:f.capture)}static removeEventListener(t,a,c,f={}){t.removeEventListener(a,c,"passive"in f?f:f.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",U.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",U.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",U.suppressClickInternal,!0)}),0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,c){const f=a.boundingClientRect;return new l.P((c.clientX-f.left)/a.x-t.clientLeft,(c.clientY-f.top)/a.y-t.clientTop)}static mousePos(t,a){const c=U.getScale(t);return U.getPoint(t,c,a)}static touchPos(t,a){const c=[],f=U.getScale(t);for(let _=0;_<a.length;_++)c.push(U.getPoint(t,f,a[_]));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const a=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),c=a.querySelectorAll("script");for(const f of c)f.remove();return U.clean(a),a.innerHTML}static isPossiblyDangerous(t,a){const c=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!c.includes("javascript:")&&!c.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const a=t.children;for(const c of a)U.removeAttributes(c),U.clean(c)}static removeAttributes(t){for(const{name:a,value:c}of t.attributes)U.isPossiblyDangerous(a,c)&&t.removeAttribute(a)}}U.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,U.selectProp=U.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),U.transformProp=U.testProp(["transform","WebkitTransform"]);const se={supported:!1,testSupport:function(g){!K&&me&&(ce?oe(g):Me=g)}};let Me,me,K=!1,ce=!1;function oe(g){const t=g.createTexture();g.bindTexture(g.TEXTURE_2D,t);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,me),g.isContextLost())return;se.supported=!0}catch{}g.deleteTexture(t),K=!0}var ue;typeof document<"u"&&(me=document.createElement("img"),me.onload=()=>{Me&&oe(Me),Me=null,ce=!0},me.onerror=()=>{K=!0,Me=null},me.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(g){let t,a,c,f;g.resetRequestQueue=()=>{t=[],a=0,c=0,f={}},g.addThrottleControl=E=>{const A=c++;return f[A]=E,A},g.removeThrottleControl=E=>{delete f[E],x()},g.getImage=(E,A,R=!0)=>new Promise(((N,O)=>{se.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*"),l.e(E,{type:"image"}),t.push({abortController:A,requestParameters:E,supportImageRefresh:R,state:"queued",onError:$=>{O($)},onSuccess:$=>{N($)}}),x()}));const _=E=>l._(this,void 0,void 0,(function*(){E.state="running";const{requestParameters:A,supportImageRefresh:R,onError:N,onSuccess:O,abortController:$}=E,X=R===!1&&!l.i(self)&&!l.g(A.url)&&(!A.headers||Object.keys(A.headers).reduce(((ie,pe)=>ie&&pe==="accept"),!0));a++;const re=X?S(A,$):l.m(A,$);try{const ie=yield re;delete E.abortController,E.state="completed",ie.data instanceof HTMLImageElement||l.b(ie.data)?O(ie):ie.data&&O({data:yield(ae=ie.data,typeof createImageBitmap=="function"?l.f(ae):l.h(ae)),cacheControl:ie.cacheControl,expires:ie.expires})}catch(ie){delete E.abortController,N(ie)}finally{a--,x()}var ae})),x=()=>{const E=(()=>{for(const A of Object.keys(f))if(f[A]())return!0;return!1})()?l.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=a;A<E&&t.length>0;A++){const R=t.shift();R.abortController.signal.aborted?A--:_(R)}},S=(E,A)=>new Promise(((R,N)=>{const O=new Image,$=E.url,X=E.credentials;X&&X==="include"?O.crossOrigin="use-credentials":(X&&X==="same-origin"||!l.d($))&&(O.crossOrigin="anonymous"),A.signal.addEventListener("abort",(()=>{O.src="",N(new l.a(A.signal.reason))})),O.fetchPriority="high",O.onload=()=>{O.onerror=O.onload=null,R({data:O})},O.onerror=()=>{O.onerror=O.onload=null,A.signal.aborted||N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},O.src=$}))})(ue||(ue={})),ue.resetRequestQueue();class de{constructor(t){this._transformRequestFn=t??null}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function be(g){const t=[];if(typeof g=="string")t.push({id:"default",url:g});else if(g&&g.length>0){const a=[];for(const{id:c,url:f}of g){const _=`${c}${f}`;a.indexOf(_)===-1&&(a.push(_),t.push({id:c,url:f}))}}return t}function Re(g,t,a){try{const c=new URL(g);return c.pathname+=`${t}${a}`,c.toString()}catch{throw new Error(`Invalid sprite URL "${g}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Ve(g){const{userImage:t}=g;return!!(t&&t.render&&t.render())&&(g.data.replace(new Uint8Array(t.data.buffer)),!0)}class qe extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:c}of this.requestors)c(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const c=a.spriteData;a.data=new l.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let c=!0;const f=a.data||a.spriteData;return this._validateStretch(a.stretchX,f&&f.width)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(a.stretchY,f&&f.height)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(a.content,a)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,a){if(!t)return!0;let c=0;for(const f of t){if(f[0]<c||f[1]<f[0]||a<f[1])return!1;c=f[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const c=a.spriteData,f=c&&c.width||a.data.width,_=c&&c.height||a.data.height;return!(t[0]<0||f<t[0]||t[1]<0||_<t[1]||t[2]<0||f<t[2]||t[3]<0||_<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,c=!0){const f=this.getImage(t);if(c&&(f.data.width!==a.data.width||f.data.height!==a.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=f.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((a,c)=>{let f=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(f=!1);this.isLoaded()||f?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})}))}_getImagesForIds(t){const a={};for(const c of t){let f=this.getImage(c);f||(this.fire(new l.l("styleimagemissing",{id:c})),f=this.getImage(c)),f?a[c]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,textFitWidth:f.textFitWidth,textFitHeight:f.textFitHeight,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:l.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],c=this.getImage(t);if(!c)return null;if(a&&a.position.version===c.version)return a.position;if(a)a.position.version=c.version;else{const f={w:c.data.width+2,h:c.data.height+2,x:0,y:0},_=new l.I(f,c);this.patterns[t]={bin:f,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.T(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:a,h:c}=l.p(t),f=this.atlasImage;f.resize({width:a||1,height:c||1});for(const _ in this.patterns){const{bin:x}=this.patterns[_],S=x.x+1,E=x.y+1,A=this.getImage(_).data,R=A.width,N=A.height;l.R.copy(A,f,{x:0,y:0},{x:S,y:E},{width:R,height:N}),l.R.copy(A,f,{x:0,y:N-1},{x:S,y:E-1},{width:R,height:1}),l.R.copy(A,f,{x:0,y:0},{x:S,y:E+N},{width:R,height:1}),l.R.copy(A,f,{x:R-1,y:0},{x:S-1,y:E},{width:1,height:N}),l.R.copy(A,f,{x:0,y:0},{x:S+R,y:E},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const c=this.getImage(a);c||l.w(`Image with ID: "${a}" was not found`),Ve(c)&&this.updateImage(a,c)}}cloneImages(){const t={};for(const a in this.images){const c=this.images[a];t[a]=Object.assign(Object.assign({},c),{data:c.data?c.data.clone():null})}return t}}const Ye=1e20;function et(g,t,a,c,f,_,x,S,E){for(let A=t;A<t+c;A++)Ie(g,a*_+A,_,f,x,S,E);for(let A=a;A<a+f;A++)Ie(g,A*_+t,1,c,x,S,E)}function Ie(g,t,a,c,f,_,x){_[0]=0,x[0]=-Ye,x[1]=Ye,f[0]=g[t];for(let S=1,E=0,A=0;S<c;S++){f[S]=g[t+S*a];const R=S*S;do{const N=_[E];A=(f[S]-f[N]+R-N*N)/(S-N)/2}while(A<=x[E]&&--E>-1);E++,_[E]=S,x[E]=A,x[E+1]=Ye}for(let S=0,E=0;S<c;S++){for(;x[E+1]<S;)E++;const A=_[E],R=S-A;g[t+S*a]=f[A]+R*R}}const Je=l.v.layout_symbol["text-font"].default.join(",");class Qe{constructor(t,a,c){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={},this.lang=c}setURL(t){this.url=t}getGlyphs(t){return l._(this,void 0,void 0,(function*(){const a=[];for(const _ in t)for(const x of t[_])a.push(this._getAndCacheGlyphsPromise(_,x));const c=yield Promise.all(a),f={};for(const{stack:_,id:x,glyph:S}of c)f[_]||(f[_]={}),f[_][x]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return f}))}_getAndCacheGlyphsPromise(t,a){return l._(this,void 0,void 0,(function*(){let c=this.entries[t];c||(c=this.entries[t]={glyphs:{},requests:{},ranges:{}});let f=c.glyphs[a];return f!==void 0?{stack:t,id:a,glyph:f}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(f=c.glyphs[a]=this._drawGlyph(c,t,a),{stack:t,id:a,glyph:f}):yield this._downloadAndCacheRangePromise(t,a)}))}_downloadAndCacheRangePromise(t,a){return l._(this,void 0,void 0,(function*(){const c=this.entries[t],f=Math.floor(a/256);if(c.ranges[f])return{stack:t,id:a,glyph:null};if(!c.requests[f]){const _=Qe.loadGlyphRange(t,f,this.url,this.requestManager);c.requests[f]=_}try{const _=yield c.requests[f];for(const x in _)c.glyphs[+x]=_[+x];return c.ranges[f]=!0,{stack:t,id:a,glyph:_[a]||null}}catch(_){const x=c.glyphs[a]=this._drawGlyph(c,t,a);return this._warnOnMissingGlyphRange(x,f,a,_),{stack:t,id:a,glyph:x}}}))}_warnOnMissingGlyphRange(t,a,c,f){const _=256*a,x=_+255,S=c.toString(16).padStart(4,"0").toUpperCase();l.w(`Unable to load glyph range ${a}, ${_}-${x}. Rendering codepoint U+${S} locally instead. ${f}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&l.q(t)}_drawGlyph(t,a,c){const f=a===Je&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(c),_=f?"ideographTinySDF":"tinySDF";t[_]||(t[_]=this._createTinySDF(f?this.localIdeographFontFamily:a));const x=t[_].draw(String.fromCodePoint(c)),S=new RegExp("^\\p{gc=Cf}+$","u").test(String.fromCodePoint(c));return{id:c,bitmap:new l.r({width:x.width||60,height:x.height||60},x.data),metrics:{width:S?0:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:S?0:x.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const a=t?t.split(","):[];a.push("sans-serif");const c=a.map((f=>/[-\w]+/.test(f)?f:`'${CSS.escape(f)}'`)).join(",");return new Qe.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let c;for(const[f,_]of Object.entries(a))new RegExp(`\\b${f}\\b`,"i").test(t)&&(c=`${_}`);return c}destroy(){for(const t in this.entries){const a=this.entries[t];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}Qe.loadGlyphRange=function(g,t,a,c){return l._(this,void 0,void 0,(function*(){const f=256*t,_=f+255,x=c.transformRequest(a.replace("{fontstack}",g).replace("{range}",`${f}-${_}`),"Glyphs"),S=yield l.n(x,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${t}, ${f}-${_}`);const E={};for(const A of l.o(S.data))E[A.id]=A;return E}))},Qe.TinySDF=class{constructor({fontSize:g=24,buffer:t=3,radius:a=8,cutoff:c=.25,fontFamily:f="sans-serif",fontWeight:_="normal",fontStyle:x="normal",lang:S=null}={}){this.buffer=t,this.cutoff=c,this.radius=a,this.lang=S;const E=this.size=g+4*t,A=this._createCanvas(E),R=this.ctx=A.getContext("2d",{willReadFrequently:!0});R.font=`${x} ${_} ${g}px ${f}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(g){const t=document.createElement("canvas");return t.width=t.height=g,t}draw(g){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:f,actualBoundingBoxRight:_}=this.ctx.measureText(g),x=Math.ceil(a),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-f))),E=Math.min(this.size-this.buffer,x+Math.ceil(c)),A=S+2*this.buffer,R=E+2*this.buffer,N=Math.max(A*R,0),O=new Uint8ClampedArray(N),$={data:O,width:A,height:R,glyphWidth:S,glyphHeight:E,glyphTop:x,glyphLeft:0,glyphAdvance:t};if(S===0||E===0)return $;const{ctx:X,buffer:re,gridInner:ae,gridOuter:ie}=this;this.lang&&(X.lang=this.lang),X.clearRect(re,re,S,E),X.fillText(g,re,re+x);const pe=X.getImageData(re,re,S,E);ie.fill(Ye,0,N),ae.fill(0,0,N);for(let Te=0;Te<E;Te++)for(let he=0;he<S;he++){const xe=pe.data[4*(Te*S+he)+3]/255;if(xe===0)continue;const Pe=(Te+re)*A+he+re;if(xe===1)ie[Pe]=0,ae[Pe]=Ye;else{const _e=.5-xe;ie[Pe]=_e>0?_e*_e:0,ae[Pe]=_e<0?_e*_e:0}}et(ie,0,0,A,R,A,this.f,this.v,this.z),et(ae,re,re,S,E,A,this.f,this.v,this.z);for(let Te=0;Te<N;Te++){const he=Math.sqrt(ie[Te])-Math.sqrt(ae[Te]);O[Te]=Math.round(255-255*(he/this.radius+this.cutoff))}return $}};class $e{constructor(){this.specification=l.u.light.position}possiblyEvaluate(t,a){return l.F(t.expression.evaluate(a))}interpolate(t,a,c){return{x:l.G.number(t.x,a.x,c),y:l.G.number(t.y,a.y,c),z:l.G.number(t.z,a.z,c)}}}let at;class zt extends l.E{constructor(t){super(),at=at||new l.t({anchor:new l.D(l.u.light.anchor),position:new $e,color:new l.D(l.u.light.color),intensity:new l.D(l.u.light.intensity)}),this._transitionable=new l.x(at,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(l.y,t,a))for(const c in t){const f=t[c];c.endsWith(l.z)?this._transitionable.setTransition(c.slice(0,-l.z.length),f):this._transitionable.setValue(c,f)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,c){return(!c||c.validate!==!1)&&l.B(this,t.call(l.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:l.u}))}}const rt=new l.t({"sky-color":new l.D(l.u.sky["sky-color"]),"horizon-color":new l.D(l.u.sky["horizon-color"]),"fog-color":new l.D(l.u.sky["fog-color"]),"fog-ground-blend":new l.D(l.u.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.u.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.u.sky["atmosphere-blend"])});class ct extends l.E{constructor(t){super(),this._transitionable=new l.x(rt,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.H(0))}setSky(t,a={}){if(!this._validate(l.J,t,a)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const c in t){const f=t[c];c.endsWith(l.z)?this._transitionable.setTransition(c.slice(0,-l.z.length),f):this._transitionable.setValue(c,f)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,c={}){return c?.validate!==!1&&l.B(this,t.call(l.C,l.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:l.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class xt{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const c=t.join(",")+String(a);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(t,a)),this.dashEntry[c]}getDashRanges(t,a,c){const f=[];let _=t.length%2==1?-t[t.length-1]*c:0,x=t[0]*c,S=!0;f.push({left:_,right:x,isDash:S,zeroLength:t[0]===0});let E=t[0];for(let A=1;A<t.length;A++){S=!S;const R=t[A];_=E*c,E+=R,x=E*c,f.push({left:_,right:x,isDash:S,zeroLength:R===0})}return f}addRoundDash(t,a,c){const f=a/2;for(let _=-c;_<=c;_++){const x=this.width*(this.nextRow+c+_);let S=0,E=t[S];for(let A=0;A<this.width;A++){A/E.right>1&&(E=t[++S]);const R=Math.abs(A-E.left),N=Math.abs(A-E.right),O=Math.min(R,N);let $;const X=_/c*(f+1);if(E.isDash){const re=f-Math.abs(X);$=Math.sqrt(O*O+re*re)}else $=f-Math.sqrt(O*O+X*X);this.data[x+A]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(t){for(let S=t.length-1;S>=0;--S){const E=t[S],A=t[S+1];E.zeroLength?t.splice(S,1):A&&A.isDash===E.isDash&&(A.left=E.left,t.splice(S,1))}const a=t[0],c=t[t.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const f=this.width*this.nextRow;let _=0,x=t[_];for(let S=0;S<this.width;S++){S/x.right>1&&(x=t[++_]);const E=Math.abs(S-x.left),A=Math.abs(S-x.right),R=Math.min(E,A);this.data[f+S]=Math.max(0,Math.min(255,(x.isDash?R:-R)+128))}}addDash(t,a){const c=a?7:0,f=2*c+1;if(this.nextRow+f>this.height)return l.w("LineAtlas out of space"),null;let _=0;for(let S=0;S<t.length;S++)_+=t[S];if(_!==0){const S=this.width/_,E=this.getDashRanges(t,this.width,S);a?this.addRoundDash(E,S,c):this.addRegularDash(E)}const x={y:this.nextRow+c,height:2*c,width:_};return this.nextRow+=f,this.dirty=!0,x}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const vt="maplibre_preloaded_worker_pool";class Pt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Pt.workerCount;)this.workers.push(new Worker(l.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[vt]}numActive(){return Object.keys(this.active).length}}const pt=Math.floor(G.hardwareConcurrency/2);let Et,Kt;function ot(){return Et||(Et=new Pt),Et}Pt.workerCount=l.K(globalThis)?Math.max(Math.min(pt,3),1):1;class _t{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const c=this.workerPool.acquire(a);for(let f=0;f<c.length;f++){const _=new l.L(c[f],a);_.name=`Worker ${f}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const c=[];for(const f of this.actors)c.push(f.sendAsync({type:t,data:a}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const c of this.actors)c.registerMessageHandler(t,a)}unregisterMessageHandler(t){for(const a of this.actors)a.unregisterMessageHandler(t)}}function Rt(){return Kt||(Kt=new _t(ot(),l.M),Kt.registerMessageHandler("GR",((g,t,a)=>l.m(t,a)))),Kt}function Ze(g,t){const a=l.N();return l.O(a,a,[1,1,0]),l.Q(a,a,[.5*g.width,.5*g.height,1]),g.calculatePosMatrix?l.S(a,a,g.calculatePosMatrix(t.toUnwrapped())):a}function Pn(g,t,a,c,f,_,x){var S;const E=(function(O,$,X){if(O)for(const re of O){const ae=$[re];if(ae&&ae.source===X&&ae.type==="fill-extrusion")return!0}else for(const re in $){const ae=$[re];if(ae.source===X&&ae.type==="fill-extrusion")return!0}return!1})((S=f?.layers)!==null&&S!==void 0?S:null,t,g.id),A=_.maxPitchScaleFactor(),R=g.tilesIn(c,A,E);R.sort(Nt);const N=[];for(const O of R)N.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(t,a,g.getState(),O.queryGeometry,O.cameraQueryGeometry,O.scale,f,_,A,Ze(_,O.tileID),x?($,X)=>x(O.tileID,$,X):void 0)});return(function(O,$){for(const X in O)for(const re of O[X])Jt(re,$);return O})((function(O){const $={},X={};for(const re of O){const ae=re.queryResults,ie=re.wrappedTileID,pe=X[ie]=X[ie]||{};for(const Te in ae){const he=ae[Te],xe=pe[Te]=pe[Te]||{},Pe=$[Te]=$[Te]||[];for(const _e of he)xe[_e.featureIndex]||(xe[_e.featureIndex]=!0,Pe.push(_e))}}return $})(N),g)}function Nt(g,t){const a=g.tileID,c=t.tileID;return a.overscaledZ-c.overscaledZ||a.canonical.y-c.canonical.y||a.wrap-c.wrap||a.canonical.x-c.canonical.x}function Jt(g,t){const a=g.feature,c=t.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=c}function Ut(g,t,a){return l._(this,void 0,void 0,(function*(){let c=g;if(g.url?c=(yield l.j(t.transformRequest(g.url,"Source"),a)).data:yield G.frameAsync(a),!c)return null;const f=l.U(l.e(c,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(f.vectorLayerIds=c.vector_layers.map((_=>_.id))),f}))}class qt{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof l.V?new l.V(t.lng,t.lat):l.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof l.V?new l.V(t.lng,t.lat):l.V.convert(t),this}extend(t){const a=this._sw,c=this._ne;let f,_;if(t instanceof l.V)f=t,_=t;else{if(!(t instanceof qt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(qt.convert(t)):this.extend(l.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(l.V.convert(t)):this;if(f=t._sw,_=t._ne,!f||!_)return this}return a||c?(a.lng=Math.min(f.lng,a.lng),a.lat=Math.min(f.lat,a.lat),c.lng=Math.max(_.lng,c.lng),c.lat=Math.max(_.lat,c.lat)):(this._sw=new l.V(f.lng,f.lat),this._ne=new l.V(_.lng,_.lat)),this}getCenter(){return new l.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.V(this.getWest(),this.getNorth())}getSouthEast(){return new l.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:c}=l.V.convert(t);let f=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&f}intersects(t){if(!((t=qt.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const a=Math.abs(this.getEast()-this.getWest()),c=Math.abs(t.getEast()-t.getWest());if(a>=360||c>=360)return!0;const f=l.W(this.getWest(),-180,180),_=l.W(this.getEast(),-180,180),x=l.W(t.getWest(),-180,180),S=l.W(t.getEast(),-180,180),E=f>=_,A=x>=S;return!(!E||!A)||(E?S>=f||x<=_:A?_>=x||f<=S:x<=_&&S>=f)}static convert(t){return t instanceof qt?t:t&&new qt(t)}static fromLngLat(t,a=0){const c=360*a/40075017,f=c/Math.cos(Math.PI/180*t.lat);return new qt(new l.V(t.lng-f,t.lat-c),new l.V(t.lng+f,t.lat+c))}adjustAntiMeridian(){const t=new l.V(this._sw.lng,this._sw.lat),a=new l.V(this._ne.lng,this._ne.lat);return new qt(t,t.lng>a.lng?new l.V(a.lng+360,a.lat):a)}}class cn{constructor(t,a,c){this.bounds=qt.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),c=Math.floor(l.Y(this.bounds.getWest())*a),f=Math.floor(l.X(this.bounds.getNorth())*a),_=Math.ceil(l.Y(this.bounds.getEast())*a),x=Math.ceil(l.X(this.bounds.getSouth())*a);return t.x>=c&&t.x<_&&t.y>=f&&t.y<x}}class Pr extends l.E{constructor(t,a,c,f){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=l.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Ut(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(l.e(this,t),t.bounds&&(this.tileBounds=new cn(t.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,l.Z(t)||this.fire(new l.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(a,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};c.request.collectResourceTiming=this._collectResourceTiming;let f="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((_,x)=>{t.reloadPromise={resolve:_,reject:x}}))}else t.actor=this.dispatcher.getActor(),f="LT";t.abortController=new AbortController;try{const _=yield t.actor.sendAsync({type:f,data:c},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,_)}catch(_){if(delete t.abortController,t.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const a=t.tileID.scaledTo(this.maxzoom).canonical,c=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(c,"Tile")}}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const c=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(c.resolve).catch(c.reject)}}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Xr extends l.E{constructor(t,a,c,f){super(),this.id=t,this.dispatcher=c,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},a),l.e(this,l.U(a,["url","scheme","tileSize"]))}load(){return l._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Ut(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(l.e(this,a),a.bounds&&(this.tileBounds=new cn(a.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,l.Z(a)||this.fire(new l.k(a))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return l.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const c=yield ue.getImage(this.map._requestManager.transformRequest(a,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&t.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const f=this.map.painter.context,_=f.gl,x=c.data;t.texture=this.map.painter.getTileTexture(x.width),t.texture?t.texture.update(x,{useMipmap:!0}):(t.texture=new l.T(f,x,_.RGBA,{useMipmap:!0}),t.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(c){if(delete t.abortController,t.aborted)t.state="unloaded";else if(c)throw t.state="errored",c}}))}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class oi extends Xr{constructor(t,a,c,f){super(t,a,c,f),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(a,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const f=yield ue.getImage(c,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(f&&f.data){const _=f.data;this.map._refreshExpiredTiles&&(f.cacheControl||f.expires)&&t.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const x=l.b(_)&&l.$()?_:yield this.readImageNow(_),S={type:this.type,uid:t.uid,source:this.id,rawImageData:x,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const E=yield t.actor.sendAsync({type:"LDT",data:S});t.dem=E,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(f){if(delete t.abortController,t.aborted)t.state="unloaded";else if(f)throw t.state="errored",f}}))}readImageNow(t){return l._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&l.a0()){const a=t.width+2,c=t.height+2;try{return new l.R({width:a,height:c},yield l.a1(t,-1,-1,a,c))}catch{}}return G.getImageData(t,1)}))}_getNeighboringTiles(t){const a=t.canonical,c=Math.pow(2,a.z),f=(a.x-1+c)%c,_=a.x===0?t.wrap-1:t.wrap,x=(a.x+1+c)%c,S=a.x+1===c?t.wrap+1:t.wrap,E={};return E[new l.a2(t.overscaledZ,_,a.z,f,a.y).key]={backfilled:!1},E[new l.a2(t.overscaledZ,S,a.z,x,a.y).key]={backfilled:!1},a.y>0&&(E[new l.a2(t.overscaledZ,_,a.z,f,a.y-1).key]={backfilled:!1},E[new l.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},E[new l.a2(t.overscaledZ,S,a.z,x,a.y-1).key]={backfilled:!1}),a.y+1<c&&(E[new l.a2(t.overscaledZ,_,a.z,f,a.y+1).key]={backfilled:!1},E[new l.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},E[new l.a2(t.overscaledZ,S,a.z,x,a.y+1).key]={backfilled:!1}),E}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Ar(g){return g.type==="GeometryCollection"?g.geometries.map((t=>t.coordinates)).flat(1/0):g.coordinates.flat(1/0)}function ba(g){const t=new qt;let a;switch(g.type){case"FeatureCollection":a=g.features.map((c=>Ar(c.geometry))).flat(1/0);break;case"Feature":a=Ar(g.geometry);break;default:a=Ar(g)}if(a.length==0)return t;for(let c=0;c<a.length-1;c+=2)t.extend([a[c],a[c+1]]);return t}class Oa extends l.E{constructor(t,a,c,f){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=c.getActor(),this.setEventedParent(f),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=l.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:l.a5,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:l.a5,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(l.a5/this.tileSize)}_getClusterMaxZoom(t){const a=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||l.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${a}"`),a}load(){return l._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,a){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const c=this._updateWorkerData();return a?c:this}updateData(t,a){this._pendingWorkerUpdate.diff=l.a6(this._pendingWorkerUpdate.diff,t);const c=this._updateWorkerData();return a?c:this}getData(){return l._(this,void 0,void 0,(function*(){const t=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return l._(this,void 0,void 0,(function*(){return ba(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:c}})}_updateWorkerData(){return l._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void l.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:a}=this._pendingWorkerUpdate,c=l.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(c.request=this.map._requestManager.transformRequest(G.resolveURL(t),"Source"),c.request.collectResourceTiming=this._collectResourceTiming):c.data=t,this._pendingWorkerUpdate.data=void 0):a&&(c.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new l.l("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:c});if(this._isUpdatingWorker=!1,this._removed||f.abandoned)return void this.fire(new l.l("dataabort",{dataType:"source"}));f.data&&(this._data={geojson:f.data});const _=this._applyDiffToSource(a),x=this._getShouldReloadTileOptions(_);let S=null;f.resourceTiming&&f.resourceTiming[this.id]&&(S=f.resourceTiming[this.id].slice(0));const E={dataType:"source"};this._collectResourceTiming&&S&&S.length>0&&l.e(E,{resourceTiming:S}),this.fire(new l.l("data",Object.assign(Object.assign({},E),{sourceDataType:"metadata"}))),this.fire(new l.l("data",Object.assign(Object.assign({},E),{sourceDataType:"content",shouldReloadTileOptions:x})))}catch(f){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new l.l("dataabort",{dataType:"source"}));this.fire(new l.k(f))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(t){if(!t)return;const a=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const f=l.a7(this._data.geojson,a);if(!f)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:f}}if(!this._data.updateable)return;const c=l.a8(this._data.updateable,t,a);return t.removeAll||this._options.cluster?void 0:c}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((a=>ba(a)))}}shouldReloadTile(t,{affectedBounds:a}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:c,extent:f}=this.workerOptions.geojsonVtOptions,_=(function({x,y:S,z:E},A=0){const R=l.a3((x-A)/Math.pow(2,E)),N=l.a4((S+1+A)/Math.pow(2,E)),O=l.a3((x+1+A)/Math.pow(2,E)),$=l.a4((S-A)/Math.pow(2,E));return new qt([R,N],[O,$])})(t.tileID.canonical,c/f);for(const x of a)if(_.intersects(x))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.actor?"RT":"LT";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const f=yield this.actor.sendAsync({type:a,data:c},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(f,this.map.painter,a==="RT")}))}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class gr extends l.E{constructor(t,a,c,f){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=c,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=a}load(t){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield ue.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,l.Z(a)||this.fire(new l.k(a))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(l.a9.fromLngLat);var c;return this.tileID=(function(f){const _=l.aa.fromPoints(f),x=_.width(),S=_.height(),E=Math.max(x,S),A=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),R=Math.pow(2,A);return new l.ac(A,Math.floor((_.minX+_.maxX)/2*R),Math.floor((_.minY+_.maxY)/2*R))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((f=>this.tileID.getTilePoint(f)._round())),this.flippedWindingOrder=((c=this.tileCoords)[1].x-c[0].x)*(c[2].y-c[0].y)-(c[1].y-c[0].y)*(c[2].x-c[0].x)<0,this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture||(this.texture=new l.T(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,c=!0)}c&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return l._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:a,minY:c,maxX:f,maxY:_}=l.aa.fromPoints(t),x={};for(let S=0;S<=l.ab;S++){const E=Math.pow(2,S),A=Math.floor(a*E),R=Math.floor(c*E),N=Math.floor(f*E),O=Math.floor(_*E),$=(A%E+E)%E,X=N%E,re=Math.floor(A/E),ae=Math.floor(N/E);x[S]={minWrap:re,maxWrap:ae,minTileXWrapped:$,maxTileXWrapped:X,minTileY:R,maxTileY:O}}return x}}class ke extends gr{constructor(t,a,c,f){super(t,a,c,f),this.roundZoom=!0,this.type="video",this.options=a}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield l.ad(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new l.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new l.k(new l.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new l.T(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,c=!0)}c&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class H extends gr{constructor(t,a,c,f){super(t,a,c,f),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((_=>!Array.isArray(_)||_.length!==2||_.some((x=>typeof x!="number"))))||this.fire(new l.k(new l.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.k(new l.ae(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new l.k(new l.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new l.k(new l.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.k(new l.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,c=a.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new l.T(a,this.canvas,c.RGBA,{premultiply:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let f=!1;for(const _ in this.tiles){const x=this.tiles[_];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,f=!0)}f&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const W={},te=g=>{switch(g){case"geojson":return Oa;case"image":return gr;case"raster":return Xr;case"raster-dem":return oi;case"vector":return Pr;case"video":return ke;case"canvas":return H}return W[g]},Se="RTLPluginLoaded";class Ee extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Rt()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return l._(this,arguments,void 0,(function*(a,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=G.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return l._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.l(Se))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ze=null;function ve(){return ze||(ze=new Ee),ze}var ye,Ae;(function(g){g[g.Base=0]="Base",g[g.Parent=1]="Parent"})(ye||(ye={})),(function(g){g[g.Departing=0]="Departing",g[g.Incoming=1]="Incoming"})(Ae||(Ae={}));class Xe{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=l.af(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:a,fadingParentID:c,fadeEndTime:f}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=a,this.fadingParentID=c,this.fadeEndTime=f}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=ee(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(f,_){const x={};if(!_)return x;for(const S of f){const E=S.layerIds.map((A=>_.getLayer(A))).filter(Boolean);if(E.length!==0){S.layers=E,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map((A=>E.filter((R=>R.id===A))[0])));for(const A of E)x[A.id]=S}}return x})(t.buckets,a?.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof l.ah){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof l.ah&&_.hasRTLText){this.hasRTLText=!0,ve().lazyLoad();break}}this.queryPadding=0;for(const f in this.buckets){const _=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(f).queryRadius(_))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new l.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const f=this.buckets[c];f.uploadPending()&&f.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new l.T(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new l.T(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,c,f,_,x,S,E,A,R,N){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:_,scale:x,tileSize:this.tileSize,pixelPosMatrix:R,transform:E,params:S,queryPadding:this.queryPadding*A,getElevation:N},t,a,c):{}}querySourceFeatures(t,a){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),_=a&&a.sourceLayer?a.sourceLayer:"",x=f[l.ai]||f[_];if(!x)return;const S=l.aj(a?.filter,a?.globalState),{z:E,x:A,y:R}=this.tileID.canonical,N={z:E,x:A,y:R};for(let O=0;O<x.length;O++){const $=x.feature(O);if(S.needGeometry){const ae=l.ak($,!0);if(!S.filter(new l.H(this.tileID.overscaledZ),ae,this.tileID.canonical))continue}else if(!S.filter(new l.H(this.tileID.overscaledZ),$))continue;const X=c.getId($,_),re=new l.al($,E,A,R,X);re.tile=N,t.push(re)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const c=l.am(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(a)if(this.expirationTime<a)f=!0;else{const _=this.expirationTime-a;_?this.expirationTime=c+Math.max(_,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!a.style.hasLayer(f))continue;const _=this.buckets[f],x=_.layers[0].sourceLayer||l.ai,S=c[x],E=t[x];if(!S||!E||Object.keys(E).length===0)continue;_.update(E,S,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const A=a&&a.style&&a.style.getLayer(f);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(_)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ee()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=ee()+t}setDependencies(t,a){const c={};for(const f of a)c[f]=!0;this.dependencies[t]=c}hasDependency(t,a){for(const c of t){const f=this.dependencies[c];if(f){for(const _ of a)if(f[_])return!0}}return!1}}class We{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,c){const f=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},l.e(this.stateChanges[t][f],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==f&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(const _ in this.state[t][f])c[_]||(this.deletedStates[t][f][_]=null)}else for(const _ in c)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][_]===null&&delete this.deletedStates[t][f][_]}removeFeatureState(t,a,c){if(this.deletedStates[t]===null)return;const f=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&a!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][c]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(c in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][c]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,a){const c=String(a),f=l.e({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const _=this.deletedStates[t][a];if(_===null)return{};for(const x in _)delete f[x]}return f}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const _={};for(const x in this.stateChanges[f])this.state[f][x]||(this.state[f][x]={}),l.e(this.state[f][x],this.stateChanges[f][x]),_[x]=this.state[f][x];c[f]=_}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const _={};if(this.deletedStates[f]===null)for(const x in this.state[f])_[x]={},this.state[f][x]={};else for(const x in this.deletedStates[f]){if(this.deletedStates[f][x]===null)this.state[f][x]={};else for(const S of Object.keys(this.deletedStates[f][x]))delete this.state[f][x][S];_[x]=this.state[f][x]}c[f]=c[f]||{},l.e(c[f],_)}this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0&&t.setFeatureState(c,a)}}const ft=89.25;function Mt(g,t){const a=l.an(t.lat,-l.ao,l.ao);return new l.P(l.Y(t.lng)*g,l.X(a)*g)}function jt(g,t){return new l.a9(t.x/g,t.y/g).toLngLat()}function Cn(g){return g.cameraToCenterDistance*Math.min(.85*Math.tan(l.ap(90-g.pitch)),Math.tan(l.ap(ft-g.pitch)))}function yn(g,t){const a=g.canonical,c=t/l.aq(a.z),f=a.x+Math.pow(2,a.z)*g.wrap,_=l.ar(new Float64Array(16));return l.O(_,_,[f*c,a.y*c,0]),l.Q(_,_,[c/l.a5,c/l.a5,1]),_}function Fe(g,t,a,c,f){const _=l.a9.fromLngLat(g,t),x=f*l.as(1,g.lat),{x:S,y:E,z:A}=Ln(a,c);return new l.a9(_.x+x*-S,_.y+x*-E,_.z+x*-A)}function Ln(g,t){const a=l.ap(g),c=l.ap(t),f=Math.cos(-a),_=Math.sin(a);return{x:_*Math.sin(c),y:-_*Math.cos(c),z:f}}function Nr(g,t,a){const c=t.intersectsFrustum(g);if(!a||c===0)return c;const f=t.intersectsPlane(a);return f===0?0:c===2&&f===2?2:1}function Ht(g,t,a){let c=0;const f=(a-t)/10;for(let _=0;_<10;_++)c+=f*Math.pow(Math.cos(t+(_+.5)/10*(a-t)),g);return c}function An(g,t){return function(a,c,f,_,x){const S=2*((g-1)/l.at(Math.cos(l.ap(ft-x))/Math.cos(l.ap(ft)))-1),E=Math.acos(f/_),A=2*Ht(S-1,0,l.ap(x/2)),R=Math.min(l.ap(ft),E+l.ap(x/2)),N=Ht(S-1,Math.min(R,E-l.ap(x/2)),R),O=Math.atan(c/f),$=Math.hypot(c,f);let X=a;return X+=l.at(_/$/Math.max(.5,Math.cos(l.ap(x/2)))),X+=S*l.at(Math.cos(O))/2,X-=l.at(Math.max(1,N/A/t))/2,X}}const Vr=An(9.314,3);function $n(g,t){const a=(t.roundZoom?Math.round:Math.floor)(g.zoom+l.at(g.tileSize/t.tileSize));return Math.max(0,a)}function ar(g,t){const a=g.getCameraFrustum(),c=g.getClippingPlane(),f=g.screenPointToMercatorCoordinate(g.getCameraPoint()),_=l.a9.fromLngLat(g.center,g.elevation);f.z=_.z+Math.cos(g.pitchInRadians)*g.cameraToCenterDistance/g.worldSize;const x=g.getCoveringTilesDetailsProvider(),S=x.allowVariableZoom(g,t),E=$n(g,t),A=t.minzoom||0,R=t.maxzoom!==void 0?t.maxzoom:g.maxZoom,N=Math.min(Math.max(0,E),R),O=Math.pow(2,N),$=[O*f.x,O*f.y,0],X=[O*_.x,O*_.y,0],re=Math.hypot(_.x-f.x,_.y-f.y),ae=Math.abs(_.z-f.z),ie=Math.hypot(re,ae),pe=xe=>({zoom:0,x:0,y:0,wrap:xe,fullyVisible:!1}),Te=[],he=[];if(g.renderWorldCopies&&x.allowWorldCopies())for(let xe=1;xe<=3;xe++)Te.push(pe(-xe)),Te.push(pe(xe));for(Te.push(pe(0));Te.length>0;){const xe=Te.pop(),Pe=xe.x,_e=xe.y;let Ce=xe.fullyVisible;const je={x:Pe,y:_e,z:xe.zoom},Le=x.getTileBoundingVolume(je,xe.wrap,g.elevation,t);if(!Ce){const ut=Nr(a,Le,c);if(ut===0)continue;Ce=ut===2}const Be=x.distanceToTile2d(f.x,f.y,je,Le);let Oe=E;S&&(Oe=(t.calculateTileZoom||Vr)(g.zoom+l.at(g.tileSize/t.tileSize),Be,ae,ie,g.fov)),Oe=(t.roundZoom?Math.round:Math.floor)(Oe),Oe=Math.max(0,Oe);const lt=Math.min(Oe,R);if(xe.wrap=x.getWrap(_,je,xe.wrap),xe.zoom>=lt){if(xe.zoom<A)continue;const ut=N-xe.zoom,nt=$[0]-.5-(Pe<<ut),dt=$[1]-.5-(_e<<ut),Xt=t.reparseOverscaled?Math.max(xe.zoom,Oe):xe.zoom;he.push({tileID:new l.a2(xe.zoom===R?Xt:xe.zoom,xe.wrap,xe.zoom,Pe,_e),distanceSq:l.au([X[0]-.5-Pe,X[1]-.5-_e]),tileDistanceToCamera:Math.sqrt(nt*nt+dt*dt)})}else for(let ut=0;ut<4;ut++)Te.push({zoom:xe.zoom+1,x:(Pe<<1)+ut%2,y:(_e<<1)+(ut>>1),wrap:xe.wrap,fullyVisible:Ce})}return he.sort(((xe,Pe)=>xe.distanceSq-Pe.distanceSq)).map((xe=>xe.tileID))}const Fn=l.aa.fromPoints([new l.P(0,0),new l.P(l.a5,l.a5)]);function xr(g){return g==="raster"||g==="image"||g==="video"}function Zs(g,t,a,c,f,_,x){if(!t.hasData())return!1;const{tileID:S,fadingRole:E,fadingDirection:A,fadingParentID:R}=t;if(E===ye.Base&&A===Ae.Incoming&&R)return a[R.key]=R,!0;const N=Math.max(S.overscaledZ-f,_);for(let O=S.overscaledZ-1;O>=N;O--){const $=S.scaledTo(O),X=g.getLoadedTile($);if(X)return t.setCrossFadeLogic({fadingRole:ye.Base,fadingDirection:Ae.Incoming,fadingParentID:X.tileID,fadeEndTime:c+x}),X.setCrossFadeLogic({fadingRole:ye.Parent,fadingDirection:Ae.Departing,fadeEndTime:c+x}),a[$.key]=$,!0}return!1}function Ws(g,t,a,c,f,_){if(!t.hasData())return!1;const x=t.tileID.children(f);let S=st(g,t,x,a,c,f,_);if(S)return!0;for(const E of x)st(g,t,E.children(f),a,c,f,_)&&(S=!0);return S}function st(g,t,a,c,f,_,x){if(a[0].overscaledZ>=_)return!1;let S=!1;for(const E of a){const A=g.getLoadedTile(E);if(!A)continue;const{fadingRole:R,fadingDirection:N,fadingParentID:O}=A;R===ye.Base&&N===Ae.Departing&&O||(A.setCrossFadeLogic({fadingRole:ye.Base,fadingDirection:Ae.Departing,fadingParentID:t.tileID,fadeEndTime:f+x}),t.setCrossFadeLogic({fadingRole:ye.Parent,fadingDirection:Ae.Incoming,fadeEndTime:f+x})),c[E.key]=E,S=!0}return S}function si(g,t,a,c){const f=g.tileID;return!!g.selfFading||!g.hasData()&&!!t.has(f)&&(g.setSelfFadeLogic(a+c),!0)}function li(g,t){var a;g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let c=t.tileID.canonical.x-g.tileID.canonical.x;const f=t.tileID.canonical.y-g.tileID.canonical.y,_=Math.pow(2,g.tileID.canonical.z),x=t.tileID.key;c===0&&f===0||Math.abs(f)>1||(Math.abs(c)>1&&(Math.abs(c+_)===1?c+=_:Math.abs(c-_)===1&&(c-=_)),t.dem&&g.dem&&(g.dem.backfillBorder(t.dem,c,f),!((a=g.neighboringTiles)===null||a===void 0)&&a[x]&&(g.neighboringTiles[x].backfilled=!0)))}class sc{constructor(){this._tiles={}}handleWrapJump(t){const a={};for(const c in this._tiles){const f=this._tiles[c];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+t),a[f.tileID.key]=f}this._tiles=a}setFeatureState(t,a){for(const c in this._tiles)this._tiles[c].setFeatureState(t,a)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((a=>a.tileID)).sort(l.aw).map((a=>a.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,a){this._tiles[t]=a}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const a=this.getTileById(t.key);return a?.hasData()?a:null}isIdRenderable(t,a=!1){var c;return(c=this.getTileById(t))===null||c===void 0?void 0:c.isRenderable(a)}getRenderableIds(t=0,a){const c=[];for(const f of this.getAllIds())this.isIdRenderable(f,a)&&c.push(this.getTileById(f));return a?c.sort(((f,_)=>{const x=f.tileID,S=_.tileID,E=new l.P(x.canonical.x,x.canonical.y)._rotate(-t),A=new l.P(S.canonical.x,S.canonical.y)._rotate(-t);return x.overscaledZ-S.overscaledZ||A.y-E.y||A.x-E.x})).map((f=>f.tileID.key)):c.map((f=>f.tileID)).sort(l.aw).map((f=>f.key))}}class zi extends l.E{constructor(t,a,c){super(),this.id=t,this.dispatcher=c,this.on("data",(f=>this._dataHandler(f))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((f,_,x,S)=>{const E=new(te(_.type))(f,_,x,S);if(E.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${E.id}`);return E})(t,a,c,this),this._inViewTiles=new sc,this._outOfViewCache=new l.ax(0,(f=>this._unloadTile(f))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new We,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const a of this._inViewTiles.getAllTiles())a.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new sc}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,c){return l._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,c)}catch(f){t.state="errored",f.status!==404?this._source.fire(new l.k(f,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new l.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const a of this._inViewTiles.getAllTiles())a.upload(t),a.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var a;return this._inViewTiles.getRenderableIds((a=this.transform)===null||a===void 0?void 0:a.bearingInRadians,t)}hasRenderableParent(t){const a=t.overscaledZ-1;if(a>=this._source.minzoom){const c=this.getLoadedTile(t.scaledTo(a));if(c)return this._inViewTiles.isIdRenderable(c.tileID.key)}return!1}reload(t,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const c of this._inViewTiles.getAllIds()){const f=this._inViewTiles.getTileById(c);a&&!this._source.shouldReloadTile(f,a)||(t?this._reloadTile(c,"expired"):f.state!=="errored"&&this._reloadTile(c,"reloading"))}}}_reloadTile(t,a){return l._(this,void 0,void 0,(function*(){const c=this._inViewTiles.getTileById(t);c&&(c.state!=="loading"&&(c.state=a),yield this._loadTile(c,t,a))}))}_tileLoaded(t,a,c){t.timeAdded=ee(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&(function(f,_){var x,S;const E=_.getRenderableIds();for(const A of E){if(!f.neighboringTiles||!f.neighboringTiles[A])continue;const R=_.getTileById(A);f.neighboringTiles[A].backfilled||li(f,R),!((S=(x=R.neighboringTiles)===null||x===void 0?void 0:x[f.tileID.key])===null||S===void 0)&&S.backfilled||li(R,f)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new l.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,a){const c=this._getLoadedDescendents(a),f=new Set;for(const _ of a){const x=c[_.key];if(!x?.length){f.add(_);continue}const S=_.overscaledZ+zi.maxOverzooming,E=x.filter((N=>N.tileID.overscaledZ<=S));if(!E.length){f.add(_);continue}const A=Math.min(...E.map((N=>N.tileID.overscaledZ))),R=E.filter((N=>N.tileID.overscaledZ===A)).map((N=>N.tileID));for(const N of R)t[N.key]=N;this._areDescendentsComplete(R,A,_.overscaledZ)||f.add(_)}return f}_getLoadedDescendents(t){var a;const c={};for(const f of this._inViewTiles.getAllTiles().filter((_=>_.hasData())))for(const _ of t)f.tileID.isChildOf(_)&&(c[a=_.key]||(c[a]=[])).push(f);return c}_areDescendentsComplete(t,a,c){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===a:Math.pow(4,a-c)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,c=Math.ceil(t.height/this._source.tileSize)+1,f=Math.floor(a*c*(this._maxTileCacheZoomLevels===null?l.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._outOfViewCache.setMaxSize(_)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,a&&(this._inViewTiles.handleWrapJump(a),this._resetTileReloadTimers())}update(t,a){if(!this._sourceLoaded||this._paused)return;let c;this.transform=t,this.terrain=a,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((E=>new l.a2(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y))):(c=ar(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(c=c.filter((E=>this._source.hasTile(E))))):c=[],this.usedForTerrain&&(c=this._addTerrainIdealTiles(c));const f=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,f&&this.fire(new l.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const _=$n(t,this._source),x=this._updateRetainedTiles(c,_),S=xr(this._source.type);S&&this._rasterFadeDuration>0&&!a&&(function(E,A,R,N,O,$,X){const re=ee(),ae=l.av(A);for(const ie of A){const pe=E.getTileById(ie.key);pe.fadingDirection!==Ae.Departing&&pe.fadeOpacity!==0||pe.resetFadeLogic(),Zs(E,pe,R,re,N,O,X)||Ws(E,pe,R,re,$,X)||si(pe,ae,re,X)||pe.resetFadeLogic()}})(this._inViewTiles,c,x,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),S?this._cleanUpRasterTiles(x):this._cleanUpVectorTiles(x)}_cleanUpRasterTiles(t){for(const a of this._inViewTiles.getAllIds())t[a]||this._removeTile(a)}_cleanUpVectorTiles(t){for(const a of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(a);t[a]?c.clearSymbolFadeHold():c.hasSymbolBuckets?c.holdingForSymbolFade()?c.symbolFadeFinished()&&this._removeTile(a):c.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(t){const a=[];for(const c of t)if(c.canonical.z>this._source.minzoom){const f=c.scaledTo(c.canonical.z-1);a.push(f);const _=c.scaledTo(Math.max(this._source.minzoom,Math.min(c.canonical.z,5)));a.push(_)}return t.concat(a)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){var c;const f=new Set;for(const A of t)this._addTile(A).hasData()||f.add(A);const _=t.reduce(((A,R)=>(A[R.key]=R,A)),{}),x=this._retainLoadedChildren(_,f),S={},E=Math.max(a-zi.maxUnderzooming,this._source.minzoom);for(const A of x){let R=this._inViewTiles.getTileById(A.key),N=R?.wasRequested();for(let O=A.overscaledZ-1;O>=E;--O){const $=A.scaledTo(O);if(S[$.key])break;if(S[$.key]=!0,R=this.getTile($),!R&&N&&(R=this._addTile($)),R){const X=R.hasData();if((X||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||N)&&(_[$.key]=$),N=R.wasRequested(),X)break}}}return _}_addTile(t){let a=this._inViewTiles.getTileById(t.key);if(a)return a;a=this._outOfViewCache.getAndRemove(t),a&&(a.resetFadeLogic(),this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null));const c=a;return a||(a=new Xe(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._inViewTiles.setTile(t.key,a),c||this._source.fire(new l.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){this._clearTileReloadTimer(t);const c=a.getExpiryTimeout();c&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),c))}_clearTileReloadTimer(t){const a=this._timers[t];a&&(clearTimeout(a),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const a=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,a)}}refreshTiles(t){for(const a of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(a);(this._inViewTiles.isIdRenderable(a)||c.state=="errored")&&t.some((f=>f.equals(c.tileID.canonical)))&&this._reloadTile(a,"expired")}}_removeTile(t){const a=this._inViewTiles.getTileById(t);a&&(a.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._outOfViewCache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,a,c){const f=[],_=this.transform;if(!_)return f;const x=_.getCoveringTilesDetailsProvider().allowWorldCopies(),S=c?_.getCameraQueryGeometry(t):t,E=$=>_.screenPointToMercatorCoordinate($,this.terrain),A=this.transformBbox(t,E,!x),R=this.transformBbox(S,E,!x),N=this.getIds(),O=l.aa.fromPoints(R);for(let $=0;$<N.length;$++){const X=this._inViewTiles.getTileById(N[$]);if(X.holdingForSymbolFade())continue;const re=x?[X.tileID]:[X.tileID.unwrapTo(-1),X.tileID.unwrapTo(0)],ae=Math.pow(2,_.zoom-X.tileID.overscaledZ),ie=a*X.queryPadding*l.a5/X.tileSize/ae;for(const pe of re){const Te=O.map((he=>pe.getTilePoint(new l.a9(he.x,he.y))));if(Te.expandBy(ie),Te.intersects(Fn)){const he=A.map((Pe=>pe.getTilePoint(Pe))),xe=R.map((Pe=>pe.getTilePoint(Pe)));f.push({tile:X,tileID:x?pe:pe.unwrapTo(0),queryGeometry:he,cameraQueryGeometry:xe,scale:ae})}}}return f}transformBbox(t,a,c){let f=t.map(a);if(c){const _=l.aa.fromPoints(t);_.shrinkBy(.001*Math.min(_.width(),_.height()));const x=_.map(a);l.aa.fromPoints(f).covers(x)||(f=f.map((S=>S.x>.5?new l.a9(S.x-1,S.y,S.z):S)))}return f}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map((c=>this._inViewTiles.getTileById(c).tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){return!!this._source.hasTransition()||!(!xr(this._source.type)||!(function(t,a){if(a<=0)return!1;const c=ee();for(const f of t.getAllTiles())if(f.fadeEndTime>=c)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,a,c){this._state.updateState(t=t||l.ai,a,c)}removeFeatureState(t,a,c){this._state.removeFeatureState(t=t||l.ai,a,c)}getFeatureState(t,a){return this._state.getState(t=t||l.ai,a)}setDependencies(t,a,c){const f=this._inViewTiles.getTileById(t);f&&f.setDependencies(a,c)}reloadTilesForDependencies(t,a){for(const c of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(c).hasDependency(t,a)&&this._reloadTile(c,"reloading");this._outOfViewCache.filter((c=>!c.hasDependency(t,a)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}zi.maxUnderzooming=10,zi.maxOverzooming=3;class gt{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.an(t,0,1);let a=1,c=this._distances[a];const f=t*this.paddedLength+this.padding;for(;c<f&&a<this._distances.length;)c=this._distances[++a];const _=a-1,x=this._distances[_],S=c-x,E=S>0?(f-x)/S:0;return this.points[_].mult(1-E).add(this.points[a].mult(E))}}function rn(g,t){let a=!0;return g==="always"||g!=="never"&&t!=="never"||(a=!1),a}class an{constructor(t,a,c){const f=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(a/c);for(let x=0;x<this.xCellCount*this.yCellCount;x++)f.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,c,f,_){this._forEachCell(a,c,f,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(_)}insertCircle(t,a,c,f){this._forEachCell(a-f,c-f,a+f,c+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(c),this.circles.push(f)}_insertBoxCell(t,a,c,f,_,x){this.boxCells[_].push(x)}_insertCircleCell(t,a,c,f,_,x){this.circleCells[_].push(x)}_query(t,a,c,f,_,x,S){if(c<0||t>this.width||f<0||a>this.height)return[];const E=[];if(t<=0&&a<=0&&this.width<=c&&this.height<=f){if(_)return[{key:null,x1:t,y1:a,x2:c,y2:f}];for(let A=0;A<this.boxKeys.length;A++)E.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const R=this.circles[3*A],N=this.circles[3*A+1],O=this.circles[3*A+2];E.push({key:this.circleKeys[A],x1:R-O,y1:N-O,x2:R+O,y2:N+O})}}else this._forEachCell(t,a,c,f,this._queryCell,E,{hitTest:_,overlapMode:x,seenUids:{box:{},circle:{}}},S);return E}query(t,a,c,f){return this._query(t,a,c,f,!1,null)}hitTest(t,a,c,f,_,x){return this._query(t,a,c,f,!0,_,x).length>0}hitTestCircle(t,a,c,f,_){const x=t-c,S=t+c,E=a-c,A=a+c;if(S<0||x>this.width||A<0||E>this.height)return!1;const R=[];return this._forEachCell(x,E,S,A,this._queryCellCircle,R,{hitTest:!0,overlapMode:f,circle:{x:t,y:a,radius:c},seenUids:{box:{},circle:{}}},_),R.length>0}_queryCell(t,a,c,f,_,x,S,E){const{seenUids:A,hitTest:R,overlapMode:N}=S,O=this.boxCells[_];if(O!==null){const X=this.bboxes;for(const re of O)if(!A.box[re]){A.box[re]=!0;const ae=4*re,ie=this.boxKeys[re];if(t<=X[ae+2]&&a<=X[ae+3]&&c>=X[ae+0]&&f>=X[ae+1]&&(!E||E(ie))&&(!R||!rn(N,ie.overlapMode))&&(x.push({key:ie,x1:X[ae],y1:X[ae+1],x2:X[ae+2],y2:X[ae+3]}),R))return!0}}const $=this.circleCells[_];if($!==null){const X=this.circles;for(const re of $)if(!A.circle[re]){A.circle[re]=!0;const ae=3*re,ie=this.circleKeys[re];if(this._circleAndRectCollide(X[ae],X[ae+1],X[ae+2],t,a,c,f)&&(!E||E(ie))&&(!R||!rn(N,ie.overlapMode))){const pe=X[ae],Te=X[ae+1],he=X[ae+2];if(x.push({key:ie,x1:pe-he,y1:Te-he,x2:pe+he,y2:Te+he}),R)return!0}}}return!1}_queryCellCircle(t,a,c,f,_,x,S,E){const{circle:A,seenUids:R,overlapMode:N}=S,O=this.boxCells[_];if(O!==null){const X=this.bboxes;for(const re of O)if(!R.box[re]){R.box[re]=!0;const ae=4*re,ie=this.boxKeys[re];if(this._circleAndRectCollide(A.x,A.y,A.radius,X[ae+0],X[ae+1],X[ae+2],X[ae+3])&&(!E||E(ie))&&!rn(N,ie.overlapMode))return x.push(!0),!0}}const $=this.circleCells[_];if($!==null){const X=this.circles;for(const re of $)if(!R.circle[re]){R.circle[re]=!0;const ae=3*re,ie=this.circleKeys[re];if(this._circlesCollide(X[ae],X[ae+1],X[ae+2],A.x,A.y,A.radius)&&(!E||E(ie))&&!rn(N,ie.overlapMode))return x.push(!0),!0}}}_forEachCell(t,a,c,f,_,x,S,E){const A=this._convertToXCellCoord(t),R=this._convertToYCellCoord(a),N=this._convertToXCellCoord(c),O=this._convertToYCellCoord(f);for(let $=A;$<=N;$++)for(let X=R;X<=O;X++)if(_.call(this,t,a,c,f,this.xCellCount*X+$,x,S,E))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,c,f,_,x){const S=f-t,E=_-a,A=c+x;return A*A>S*S+E*E}_circleAndRectCollide(t,a,c,f,_,x,S){const E=(x-f)/2,A=Math.abs(t-(f+E));if(A>E+c)return!1;const R=(S-_)/2,N=Math.abs(a-(_+R));if(N>R+c)return!1;if(A<=E||N<=R)return!0;const O=A-E,$=N-R;return O*O+$*$<=c*c}}function bi(g,t,a){const c=l.N();if(!g){const{vecSouth:N,vecEast:O}=wa(t),$=D();$[0]=O[0],$[1]=O[1],$[2]=N[0],$[3]=N[1],f=$,(R=(x=(_=$)[0])*(A=_[3])-(E=_[2])*(S=_[1]))&&(f[0]=A*(R=1/R),f[1]=-S*R,f[2]=-E*R,f[3]=x*R),c[0]=$[0],c[1]=$[1],c[4]=$[2],c[5]=$[3]}var f,_,x,S,E,A,R;return l.Q(c,c,[1/a,1/a,1]),c}function lc(g,t,a,c){if(g){const f=l.N();if(!t){const{vecSouth:_,vecEast:x}=wa(a);f[0]=x[0],f[1]=x[1],f[4]=_[0],f[5]=_[1]}return l.Q(f,f,[c,c,1]),f}return a.pixelsToClipSpaceMatrix}function wa(g){const t=Math.cos(g.rollInRadians),a=Math.sin(g.rollInRadians),c=Math.cos(g.pitchInRadians),f=Math.cos(g.bearingInRadians),_=Math.sin(g.bearingInRadians),x=l.aC();x[0]=-f*c*a-_*t,x[1]=-_*c*a+f*t;const S=l.aD(x);S<1e-9?l.aE(x):l.aF(x,x,1/S);const E=l.aC();E[0]=f*c*t-_*a,E[1]=_*c*t+f*a;const A=l.aD(E);return A<1e-9?l.aE(E):l.aF(E,E,1/A),{vecEast:E,vecSouth:x}}function Qt(g,t,a,c){let f;c?(f=[g,t,c(g,t),1],l.aH(f,f,a)):(f=[g,t,0,1],hc(f,f,a));const _=f[3];return{point:new l.P(f[0]/_,f[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}function Hs(g,t){return .5+g/t*.5}function Xs(g,t){return g.x>=-t[0]&&g.x<=t[0]&&g.y>=-t[1]&&g.y<=t[1]}function cc(g,t,a,c,f,_,x,S,E,A,R,N,O){const $=a?g.textSizeData:g.iconSizeData,X=l.ay($,t.transform.zoom),re=[256/t.width*2+1,256/t.height*2+1],ae=a?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;ae.clear();const ie=g.lineVertexArray,pe=a?g.text.placedSymbolArray:g.icon.placedSymbolArray,Te=t.transform.width/t.transform.height;let he=!1;for(let xe=0;xe<pe.length;xe++){const Pe=pe.get(xe);if(Pe.hidden||Pe.writingMode===l.az.vertical&&!he){fo(Pe.numGlyphs,ae);continue}he=!1;const _e=new l.P(Pe.anchorX,Pe.anchorY),Ce={getElevation:O,pitchedLabelPlaneMatrix:c,lineVertexArray:ie,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:_e,unwrappedTileID:E,width:A,height:R,translation:N},je=ns(Pe.anchorX,Pe.anchorY,Ce);if(!Xs(je.point,re)){fo(Pe.numGlyphs,ae);continue}const Le=Hs(t.transform.cameraToCenterDistance,je.signedDistanceFromCamera),Be=l.aA($,X,Pe),Oe=_?Be*t.transform.getPitchedTextCorrection(Pe.anchorX,Pe.anchorY,E)/Le:Be*Le,lt=ts({projectionContext:Ce,pitchedLabelPlaneMatrixInverse:f,symbol:Pe,fontSize:Oe,flip:!1,keepUpright:x,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:ae,aspectRatio:Te,rotateToLine:S});he=lt.useVertical,(lt.notEnoughRoom||he||lt.needsFlipping&&ts({projectionContext:Ce,pitchedLabelPlaneMatrixInverse:f,symbol:Pe,fontSize:Oe,flip:!0,keepUpright:x,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:ae,aspectRatio:Te,rotateToLine:S}).notEnoughRoom)&&fo(Pe.numGlyphs,ae)}a?g.text.dynamicLayoutVertexBuffer.updateData(ae):g.icon.dynamicLayoutVertexBuffer.updateData(ae)}function es(g,t,a,c,f,_,x,S){const E=_.glyphStartIndex+_.numGlyphs,A=_.lineStartIndex,R=_.lineStartIndex+_.lineLength,N=t.getoffsetX(_.glyphStartIndex),O=t.getoffsetX(E-1),$=Wi(g*N,a,c,f,_.segment,A,R,S,x);if(!$)return null;const X=Wi(g*O,a,c,f,_.segment,A,R,S,x);return X?S.projectionCache.anyProjectionOccluded?null:{first:$,last:X}:null}function Ys(g,t,a,c){return g===l.az.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*c?{useVertical:!0}:(g===l.az.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function ts(g){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:a,symbol:c,fontSize:f,flip:_,keepUpright:x,glyphOffsetArray:S,dynamicLayoutVertexArray:E,aspectRatio:A,rotateToLine:R}=g,N=f/24,O=c.lineOffsetX*N,$=c.lineOffsetY*N;let X;if(c.numGlyphs>1){const re=c.glyphStartIndex+c.numGlyphs,ae=c.lineStartIndex,ie=c.lineStartIndex+c.lineLength,pe=es(N,S,O,$,_,c,R,t);if(!pe)return{notEnoughRoom:!0};const Te=uc(pe.first.point.x,pe.first.point.y,t,a),he=uc(pe.last.point.x,pe.last.point.y,t,a);if(x&&!_){const xe=Ys(c.writingMode,Te,he,A);if(xe)return xe}X=[pe.first];for(let xe=c.glyphStartIndex+1;xe<re-1;xe++){const Pe=Wi(N*S.getoffsetX(xe),O,$,_,c.segment,ae,ie,t,R);if(!Pe)return{notEnoughRoom:!0};X.push(Pe)}X.push(pe.last)}else{if(x&&!_){const ae=kn(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,ie=c.lineStartIndex+c.segment+1,pe=new l.P(t.lineVertexArray.getx(ie),t.lineVertexArray.gety(ie)),Te=kn(pe.x,pe.y,t),he=Te.signedDistanceFromCamera>0?Te.point:Ks(t.tileAnchorPoint,pe,ae,1,t),xe=uc(ae.x,ae.y,t,a),Pe=uc(he.x,he.y,t,a),_e=Ys(c.writingMode,xe,Pe,A);if(_e)return _e}const re=Wi(N*S.getoffsetX(c.glyphStartIndex),O,$,_,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,t,R);if(!re||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};X=[re]}for(const re of X)l.aG(E,re.point,re.angle);return{}}function Ks(g,t,a,c,f){const _=g.add(g.sub(t)._unit()),x=kn(_.x,_.y,f).point,S=a.sub(x);return a.add(S._mult(c/S.mag()))}function ci(g,t,a){const c=t.projectionCache;if(c.projections[g])return c.projections[g];const f=new l.P(t.lineVertexArray.getx(g),t.lineVertexArray.gety(g)),_=kn(f.x,f.y,t);if(_.signedDistanceFromCamera>0)return c.projections[g]=_.point,c.anyProjectionOccluded=c.anyProjectionOccluded||_.isOccluded,_.point;const x=g-a.direction;return Ks(a.distanceFromAnchor===0?t.tileAnchorPoint:new l.P(t.lineVertexArray.getx(x),t.lineVertexArray.gety(x)),f,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,t)}function kn(g,t,a){const c=g+a.translation[0],f=t+a.translation[1];let _;return a.pitchWithMap?(_=Qt(c,f,a.pitchedLabelPlaneMatrix,a.getElevation),_.isOccluded=!1):(_=a.transform.projectTileCoordinates(c,f,a.unwrappedTileID,a.getElevation),_.point.x=(.5*_.point.x+.5)*a.width,_.point.y=(.5*-_.point.y+.5)*a.height),_}function uc(g,t,a,c){if(a.pitchWithMap){const f=[g,t,0,1];return l.aH(f,f,c),a.transform.projectTileCoordinates(f[0]/f[3],f[1]/f[3],a.unwrappedTileID,a.getElevation).point}return{x:g/a.width*2-1,y:1-t/a.height*2}}function ns(g,t,a){return a.transform.projectTileCoordinates(g,t,a.unwrappedTileID,a.getElevation)}function Js(g,t,a){return g._unit()._perp()._mult(t*a)}function ho(g,t,a,c,f,_,x,S,E){if(S.projectionCache.offsets[g])return S.projectionCache.offsets[g];const A=a.add(t);if(g+E.direction<c||g+E.direction>=f)return S.projectionCache.offsets[g]=A,A;const R=ci(g+E.direction,S,E),N=Js(R.sub(a),x,E.direction),O=a.add(N),$=R.add(N);return S.projectionCache.offsets[g]=l.aI(_,A,O,$)||A,S.projectionCache.offsets[g]}function Wi(g,t,a,c,f,_,x,S,E){const A=c?g-t:g+t;let R=A>0?1:-1,N=0;c&&(R*=-1,N=Math.PI),R<0&&(N+=Math.PI);let O,$=R>0?_+f:_+f+1;S.projectionCache.cachedAnchorPoint?O=S.projectionCache.cachedAnchorPoint:(O=kn(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=O);let X,re,ae=O,ie=O,pe=0,Te=0;const he=Math.abs(A),xe=[];let Pe;for(;pe+Te<=he;){if($+=R,$<_||$>=x)return null;pe+=Te,ie=ae,re=X;const je={absOffsetX:he,direction:R,distanceFromAnchor:pe,previousVertex:ie};if(ae=ci($,S,je),a===0)xe.push(ie),Pe=ae.sub(ie);else{let Le;const Be=ae.sub(ie);Le=Be.mag()===0?Js(ci($+R,S,je).sub(ae),a,R):Js(Be,a,R),re||(re=ie.add(Le)),X=ho($,Le,ae,_,x,re,a,S,je),xe.push(re),Pe=X.sub(re)}Te=Pe.mag()}const _e=Pe._mult((he-pe)/Te)._add(re||ie),Ce=N+Math.atan2(ae.y-ie.y,ae.x-ie.x);return xe.push(_e),{point:_e,angle:E?Ce:0,path:xe}}const Qf=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function fo(g,t){for(let a=0;a<g;a++){const c=t.length;t.resize(c+4),t.float32.set(Qf,3*c)}}function hc(g,t,a){const c=t[0],f=t[1];return g[0]=a[0]*c+a[4]*f+a[12],g[1]=a[1]*c+a[5]*f+a[13],g[3]=a[3]*c+a[7]*f+a[15],g}const or=100;class ed{constructor(t,a=new an(t.width+200,t.height+200,25),c=new an(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=c,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+or,this.screenBottomBoundary=t.height+or,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,c,f,_,x,S,E,A,R,N,O){const $=this.projectAndGetPerspectiveRatio(t.anchorPointX+E[0],t.anchorPointY+E[1],_,R,O),X=c*$.perspectiveRatio;let re;if(x||S)re=this._projectCollisionBox(t,X,f,_,x,S,E,$,R,N,O);else{const Pe=$.x+(N?N.x*X:0),_e=$.y+(N?N.y*X:0);re={allPointsOccluded:!1,box:[Pe+t.x1*X,_e+t.y1*X,Pe+t.x2*X,_e+t.y2*X]}}const[ae,ie,pe,Te]=re.box,he=x?re.allPointsOccluded:$.isOccluded;let xe=he;return xe||(xe=$.perspectiveRatio<this.perspectiveRatioCutoff),xe||(xe=!this.isInsideGrid(ae,ie,pe,Te)),xe||a!=="always"&&this.grid.hitTest(ae,ie,pe,Te,a,A)?{box:[ae,ie,pe,Te],placeable:!1,offscreen:!1,occluded:he}:{box:[ae,ie,pe,Te],placeable:!0,offscreen:this.isOffscreen(ae,ie,pe,Te),occluded:he}}placeCollisionCircles(t,a,c,f,_,x,S,E,A,R,N,O,$,X){const re=[],ae=new l.P(a.anchorX,a.anchorY),ie=this.getPerspectiveRatio(ae.x,ae.y,x,X),pe=(A?_*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,x)/ie:_*ie)/l.aM,Te={getElevation:X,pitchedLabelPlaneMatrix:S,lineVertexArray:c,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ae,unwrappedTileID:x,width:this.transform.width,height:this.transform.height,translation:$},he=es(pe,f,a.lineOffsetX*pe,a.lineOffsetY*pe,!1,a,!1,Te);let xe=!1,Pe=!1,_e=!0;if(he){const Ce=.5*N*ie+O,je=new l.P(-100,-100),Le=new l.P(this.screenRightBoundary,this.screenBottomBoundary),Be=new gt,Oe=he.first,lt=he.last;let ut=[];for(let Xt=Oe.path.length-1;Xt>=1;Xt--)ut.push(Oe.path[Xt]);for(let Xt=1;Xt<lt.path.length;Xt++)ut.push(lt.path[Xt]);const nt=2.5*Ce;if(A){const Xt=this.projectPathToScreenSpace(ut,Te);ut=Xt.some((In=>In.signedDistanceFromCamera<=0))?[]:Xt.map((In=>In.point))}let dt=[];if(ut.length>0){const Xt=ut[0].clone(),In=ut[0].clone();for(let Zn=1;Zn<ut.length;Zn++)Xt.x=Math.min(Xt.x,ut[Zn].x),Xt.y=Math.min(Xt.y,ut[Zn].y),In.x=Math.max(In.x,ut[Zn].x),In.y=Math.max(In.y,ut[Zn].y);dt=Xt.x>=je.x&&In.x<=Le.x&&Xt.y>=je.y&&In.y<=Le.y?[ut]:In.x<je.x||Xt.x>Le.x||In.y<je.y||Xt.y>Le.y?[]:l.aJ([ut],je.x,je.y,Le.x,Le.y)}for(const Xt of dt){Be.reset(Xt,.25*Ce);let In=0;In=Be.length<=.5*Ce?1:Math.ceil(Be.paddedLength/nt)+1;for(let Zn=0;Zn<In;Zn++){const Nn=Zn/Math.max(In-1,1),Xn=Be.lerp(Nn),Vn=Xn.x+or,lr=Xn.y+or;re.push(Vn,lr,Ce,0);const Yn=Vn-Ce,Dr=lr-Ce,_r=Vn+Ce,pr=lr+Ce;if(_e=_e&&this.isOffscreen(Yn,Dr,_r,pr),Pe=Pe||this.isInsideGrid(Yn,Dr,_r,pr),t!=="always"&&this.grid.hitTestCircle(Vn,lr,Ce,t,R)&&(xe=!0,!E))return{circles:[],offscreen:!1,collisionDetected:xe}}}}return{circles:!E&&xe||!Pe||ie<this.perspectiveRatioCutoff?[]:re,offscreen:_e,collisionDetected:xe}}projectPathToScreenSpace(t,a){const c=(function(f,_){const x=l.N();return l.aB(x,_.pitchedLabelPlaneMatrix),f.map((S=>{const E=Qt(S.x,S.y,x,_.getElevation),A=_.transform.projectTileCoordinates(E.point.x,E.point.y,_.unwrappedTileID,_.getElevation);return A.point.x=(.5*A.point.x+.5)*_.width,A.point.y=(.5*-A.point.y+.5)*_.height,A}))})(t,a);return(function(f){let _=0,x=0,S=0,E=0;for(let A=0;A<f.length;A++)f[A].isOccluded?(S=A+1,E=0):(E++,E>x&&(x=E,_=S));return f.slice(_,_+x)})(c)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],c=new l.aa;for(const N of t){const O=new l.P(N.x+or,N.y+or);c.extend(O),a.push(O)}const{minX:f,minY:_,maxX:x,maxY:S}=c,E=this.grid.query(f,_,x,S).concat(this.ignoredGrid.query(f,_,x,S)),A={},R={};for(const N of E){const O=N.key;if(A[O.bucketInstanceId]===void 0&&(A[O.bucketInstanceId]={}),A[O.bucketInstanceId][O.featureIndex])continue;const $=[new l.P(N.x1,N.y1),new l.P(N.x2,N.y1),new l.P(N.x2,N.y2),new l.P(N.x1,N.y2)];l.aK(a,$)&&(A[O.bucketInstanceId][O.featureIndex]=!0,R[O.bucketInstanceId]===void 0&&(R[O.bucketInstanceId]=[]),R[O.bucketInstanceId].push(O.featureIndex))}return R}insertCollisionBox(t,a,c,f,_,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:x,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,c,f,_,x){const S=c?this.ignoredGrid:this.grid,E={bucketInstanceId:f,featureIndex:_,collisionGroupID:x,overlapMode:a};for(let A=0;A<t.length;A+=4)S.insertCircle(E,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,a,c,f,_){if(_){let x;f?(x=[t,a,f(t,a),1],l.aH(x,x,_)):(x=[t,a,0,1],hc(x,x,_));const S=x[3];return{x:(x[0]/S+1)/2*this.transform.width+or,y:(-x[1]/S+1)/2*this.transform.height+or,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}{const x=this.transform.projectTileCoordinates(t,a,c,f);return{x:(x.point.x+1)/2*this.transform.width+or,y:(1-x.point.y)/2*this.transform.height+or,perspectiveRatio:.5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5,isOccluded:x.isOccluded,signedDistanceFromCamera:x.signedDistanceFromCamera}}}getPerspectiveRatio(t,a,c,f){const _=this.transform.projectTileCoordinates(t,a,c,f);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(t,a,c,f){return c<or||t>=this.screenRightBoundary||f<or||a>this.screenBottomBoundary}isInsideGrid(t,a,c,f){return c>=0&&t<this.gridRightBoundary&&f>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=l.ar([]);return l.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,a,c,f,_,x,S,E,A,R,N){let O=1,$=0,X=0,re=1;const ae=t.anchorPointX+S[0],ie=t.anchorPointY+S[1];if(x&&!_){const ut=this.projectAndGetPerspectiveRatio(ae+1,ie,f,A,N),nt=ut.x-E.x,dt=Math.atan((ut.y-E.y)/nt)+(nt<0?Math.PI:0),Xt=Math.sin(dt),In=Math.cos(dt);O=In,$=Xt,X=-Xt,re=In}else if(!x&&_){const ut=wa(this.transform);O=ut.vecEast[0],$=ut.vecEast[1],X=ut.vecSouth[0],re=ut.vecSouth[1]}let pe=E.x,Te=E.y,he=a;_&&(pe=ae,Te=ie,he=Math.pow(2,-(this.transform.zoom-c.overscaledZ)),he*=this.transform.getPitchedTextCorrection(ae,ie,f),R||(he*=l.an(.5+E.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),R&&(pe+=O*R.x*he+X*R.y*he,Te+=$*R.x*he+re*R.y*he);const xe=t.x1*he,Pe=t.x2*he,_e=(xe+Pe)/2,Ce=t.y1*he,je=t.y2*he,Le=(Ce+je)/2,Be=[{offsetX:xe,offsetY:Ce},{offsetX:_e,offsetY:Ce},{offsetX:Pe,offsetY:Ce},{offsetX:Pe,offsetY:Le},{offsetX:Pe,offsetY:je},{offsetX:_e,offsetY:je},{offsetX:xe,offsetY:je},{offsetX:xe,offsetY:Le}];let Oe=[];for(const{offsetX:ut,offsetY:nt}of Be)Oe.push(new l.P(pe+O*ut+X*nt,Te+$*ut+re*nt));let lt=!1;if(_){const ut=Oe.map((nt=>this.projectAndGetPerspectiveRatio(nt.x,nt.y,f,A,N)));lt=ut.some((nt=>!nt.isOccluded)),Oe=ut.map((nt=>new l.P(nt.x,nt.y)))}else lt=!0;return{box:l.aL(Oe),allPointsOccluded:!lt}}}class td{constructor(t,a,c,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):f&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Qs{constructor(t,a,c,f,_){this.text=new td(t?t.text:null,a,c,_),this.icon=new td(t?t.icon:null,a,f,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class nd{constructor(t,a,c){this.text=t,this.icon=a,this.skipFade=c}}class rd{constructor(t,a,c,f,_){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=c,this.bucketIndex=f,this.tileID=_}}class id{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:c=>c.collisionGroupID===a}}return this.collisionGroups[t]}}function fc(g,t,a,c,f){const{horizontalAlign:_,verticalAlign:x}=l.aS(g);return new l.P(-(_-.5)*t+c[0]*f,-(x-.5)*a+c[1]*f)}class ju{constructor(t,a,c,f,_){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new ed(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new id(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const a=this.terrain;return a?(c,f)=>a.getElevation(t,c,f):null}getBucketParts(t,a,c,f){const _=c.getBucket(a),x=c.latestFeatureIndex;if(!_||!x||a.id!==_.layerIds[0])return;const S=c.collisionBoxArray,E=_.layers[0].layout,A=_.layers[0].paint,R=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),N=c.tileSize/l.a5,O=c.tileID.toUnwrapped(),$=E.get("text-rotation-alignment")==="map",X=l.aN(c,1,this.transform.zoom),re=l.aO(this.collisionIndex.transform,c,A.get("text-translate"),A.get("text-translate-anchor")),ae=l.aO(this.collisionIndex.transform,c,A.get("icon-translate"),A.get("icon-translate-anchor")),ie=bi($,this.transform,X);this.retainedQueryData[_.bucketInstanceId]=new rd(_.bucketInstanceId,x,_.sourceLayerIndex,_.index,c.tileID);const pe={bucket:_,layout:E,translationText:re,translationIcon:ae,unwrappedTileID:O,pitchedLabelPlaneMatrix:ie,scale:R,textPixelRatio:N,holdingForFade:c.holdingForSymbolFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:l.ay(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(f)for(const Te of _.sortKeyRanges){const{sortKey:he,symbolInstanceStart:xe,symbolInstanceEnd:Pe}=Te;t.push({sortKey:he,symbolInstanceStart:xe,symbolInstanceEnd:Pe,parameters:pe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(t,a,c,f,_,x,S,E,A,R,N,O,$,X,re,ae,ie,pe,Te,he){const xe=l.aP[t.textAnchor],Pe=[t.textOffset0,t.textOffset1],_e=fc(xe,c,f,Pe,_),Ce=this.collisionIndex.placeCollisionBox(a,O,E,A,R,S,x,ae,N.predicate,Te,_e,he);if((!pe||this.collisionIndex.placeCollisionBox(pe,O,E,A,R,S,x,ie,N.predicate,Te,_e,he).placeable)&&Ce.placeable){let je;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(je=this.prevPlacement.variableOffsets[$.crossTileID].anchor),$.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[$.crossTileID]={textOffset:Pe,width:c,height:f,anchor:xe,textBoxScale:_,prevAnchor:je},this.markUsedJustification(X,xe,$,re),X.allowVerticalPlacement&&(this.markUsedOrientation(X,re,$),this.placedOrientations[$.crossTileID]=re),{shift:_e,placedGlyphBoxes:Ce}}}placeLayerBucketPart(t,a,c){const{bucket:f,layout:_,translationText:x,translationIcon:S,unwrappedTileID:E,pitchedLabelPlaneMatrix:A,textPixelRatio:R,holdingForFade:N,collisionBoxArray:O,partiallyEvaluatedTextSize:$,collisionGroup:X}=t.parameters,re=_.get("text-optional"),ae=_.get("icon-optional"),ie=l.aQ(_,"text-overlap","text-allow-overlap"),pe=ie==="always",Te=l.aQ(_,"icon-overlap","icon-allow-overlap"),he=Te==="always",xe=_.get("text-rotation-alignment")==="map",Pe=_.get("text-pitch-alignment")==="map",_e=_.get("icon-text-fit")!=="none",Ce=_.get("symbol-z-order")==="viewport-y",je=pe&&(he||!f.hasIconData()||ae),Le=he&&(pe||!f.hasTextData()||re);!f.collisionArrays&&O&&f.deserializeCollisionBoxes(O);const Be=this.retainedQueryData[f.bucketInstanceId].tileID,Oe=this._getTerrainElevationFunc(Be),lt=this.transform.getFastPathSimpleProjectionMatrix(Be),ut=(nt,dt,Xt)=>{var In,Zn;if(a[nt.crossTileID])return;if(N)return void(this.placements[nt.crossTileID]=new nd(!1,!1,!1));let Nn=!1,Xn=!1,Vn=!0,lr=null,Yn={box:null,placeable:!1,offscreen:null,occluded:!1},Dr={placeable:!1},_r=null,pr=null,jr=null,Ha=0,Ma=0,la=0;dt.textFeatureIndex?Ha=dt.textFeatureIndex:nt.useRuntimeCollisionCircles&&(Ha=nt.featureIndex),dt.verticalTextFeatureIndex&&(Ma=dt.verticalTextFeatureIndex);const _i=dt.textBox;if(_i){const Oi=Un=>{let jn=l.az.horizontal;if(f.allowVerticalPlacement&&!Un&&this.prevPlacement){const Er=this.prevPlacement.placedOrientations[nt.crossTileID];Er&&(this.placedOrientations[nt.crossTileID]=Er,jn=Er,this.markUsedOrientation(f,jn,nt))}return jn},ca=(Un,jn)=>{if(f.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&dt.verticalTextBox){for(const Er of f.writingModes)if(Er===l.az.vertical?(Yn=jn(),Dr=Yn):Yn=Un(),Yn&&Yn.placeable)break}else Yn=Un()},Qi=nt.textAnchorOffsetStartIndex,ea=nt.textAnchorOffsetEndIndex;if(ea===Qi){const Un=(jn,Er)=>{const Cr=this.collisionIndex.placeCollisionBox(jn,ie,R,Be,E,Pe,xe,x,X.predicate,Oe,void 0,lt);return Cr&&Cr.placeable&&(this.markUsedOrientation(f,Er,nt),this.placedOrientations[nt.crossTileID]=Er),Cr};ca((()=>Un(_i,l.az.horizontal)),(()=>{const jn=dt.verticalTextBox;return f.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&jn?Un(jn,l.az.vertical):{box:null,offscreen:null}})),Oi(Yn&&Yn.placeable)}else{let Un=l.aP[(Zn=(In=this.prevPlacement)===null||In===void 0?void 0:In.variableOffsets[nt.crossTileID])===null||Zn===void 0?void 0:Zn.anchor];const jn=(Cr,Qd,ep)=>{const ko=Cr.x2-Cr.x1,Rg=Cr.y2-Cr.y1,tp=nt.textBoxScale,Lh=_e&&Te==="never"?Qd:null;let Xa=null,Ya=ie==="never"?1:2,Ka="never";Un&&Ya++;for(let Fh=0;Fh<Ya;Fh++){for(let Bh=Qi;Bh<ea;Bh++){const Xc=f.textAnchorOffsets.get(Bh);if(Un&&Xc.textAnchor!==Un)continue;const Yc=this.attemptAnchorPlacement(Xc,Cr,ko,Rg,tp,xe,Pe,R,Be,E,X,Ka,nt,f,ep,x,S,Lh,Oe);if(Yc&&(Xa=Yc.placedGlyphBoxes,Xa&&Xa.placeable))return Nn=!0,lr=Yc.shift,Xa}Un?Un=null:Ka=ie}return c&&!Xa&&(Xa={box:this.collisionIndex.placeCollisionBox(_i,"always",R,Be,E,Pe,xe,x,X.predicate,Oe,void 0,lt).box,offscreen:!1,placeable:!1,occluded:!1}),Xa};ca((()=>jn(_i,dt.iconBox,l.az.horizontal)),(()=>{const Cr=dt.verticalTextBox;return f.allowVerticalPlacement&&(!Yn||!Yn.placeable)&&nt.numVerticalGlyphVertices>0&&Cr?jn(Cr,dt.verticalIconBox,l.az.vertical):{box:null,occluded:!0,offscreen:null}})),Yn&&(Nn=Yn.placeable,Vn=Yn.offscreen);const Er=Oi(Yn&&Yn.placeable);if(!Nn&&this.prevPlacement){const Cr=this.prevPlacement.variableOffsets[nt.crossTileID];Cr&&(this.variableOffsets[nt.crossTileID]=Cr,this.markUsedJustification(f,Cr.anchor,nt,Er))}}}if(_r=Yn,Nn=_r&&_r.placeable,Vn=_r&&_r.offscreen,nt.useRuntimeCollisionCircles&&nt.centerJustifiedTextSymbolIndex>=0){const Oi=f.text.placedSymbolArray.get(nt.centerJustifiedTextSymbolIndex),ca=l.aA(f.textSizeData,$,Oi),Qi=_.get("text-padding");pr=this.collisionIndex.placeCollisionCircles(ie,Oi,f.lineVertexArray,f.glyphOffsetArray,ca,E,A,c,Pe,X.predicate,nt.collisionCircleDiameter,Qi,x,Oe),pr.circles.length&&pr.collisionDetected&&!c&&l.w("Collisions detected, but collision boxes are not shown"),Nn=pe||pr.circles.length>0&&!pr.collisionDetected,Vn=Vn&&pr.offscreen}if(dt.iconFeatureIndex&&(la=dt.iconFeatureIndex),dt.iconBox){const Oi=ca=>this.collisionIndex.placeCollisionBox(ca,Te,R,Be,E,Pe,xe,S,X.predicate,Oe,_e&&lr?lr:void 0,lt);Dr&&Dr.placeable&&dt.verticalIconBox?(jr=Oi(dt.verticalIconBox),Xn=jr.placeable):(jr=Oi(dt.iconBox),Xn=jr.placeable),Vn=Vn&&jr.offscreen}const Io=re||nt.numHorizontalGlyphVertices===0&&nt.numVerticalGlyphVertices===0,zl=ae||nt.numIconVertices===0;Io||zl?zl?Io||(Xn=Xn&&Nn):Nn=Xn&&Nn:Xn=Nn=Xn&&Nn;const Ao=Xn&&jr.placeable;if(Nn&&_r.placeable&&this.collisionIndex.insertCollisionBox(_r.box,ie,_.get("text-ignore-placement"),f.bucketInstanceId,Dr&&Dr.placeable&&Ma?Ma:Ha,X.ID),Ao&&this.collisionIndex.insertCollisionBox(jr.box,Te,_.get("icon-ignore-placement"),f.bucketInstanceId,la,X.ID),pr&&Nn&&this.collisionIndex.insertCollisionCircles(pr.circles,ie,_.get("text-ignore-placement"),f.bucketInstanceId,Ha,X.ID),c&&this.storeCollisionData(f.bucketInstanceId,Xt,dt,_r,jr,pr),nt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[nt.crossTileID]=new nd((Nn||je)&&!_r?.occluded,(Xn||Le)&&!jr?.occluded,Vn||f.justReloaded),a[nt.crossTileID]=!0};if(Ce){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const nt=f.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let dt=nt.length-1;dt>=0;--dt){const Xt=nt[dt];ut(f.symbolInstances.get(Xt),f.collisionArrays[Xt],Xt)}}else for(let nt=t.symbolInstanceStart;nt<t.symbolInstanceEnd;nt++)ut(f.symbolInstances.get(nt),f.collisionArrays[nt],nt);f.justReloaded=!1}storeCollisionData(t,a,c,f,_,x){if(c.textBox||c.iconBox){let S,E;this.collisionBoxArrays.has(t)?S=this.collisionBoxArrays.get(t):(S=new Map,this.collisionBoxArrays.set(t,S)),S.has(a)?E=S.get(a):(E={text:null,icon:null},S.set(a,E)),c.textBox&&(E.text=f.box),c.iconBox&&(E.icon=_.box)}if(x){let S=this.collisionCircleArrays[t];S===void 0&&(S=this.collisionCircleArrays[t]=[]);for(let E=0;E<x.circles.length;E+=4)S.push(x.circles[E+0]-or),S.push(x.circles[E+1]-or),S.push(x.circles[E+2]),S.push(x.collisionDetected?1:0)}}markUsedJustification(t,a,c,f){let _;_=f===l.az.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[l.aR(a)];const x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const S of x)S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=_>=0&&S!==_?0:c.crossTileID)}markUsedOrientation(t,a,c){const f=a===l.az.horizontal||a===l.az.horizontalOnly?a:0,_=a===l.az.vertical?a:0,x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const S of x)t.text.placedSymbolArray.get(S).placedOrientation=f;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let c=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const f=a?a.symbolFadeChange(t):1,_=a?a.opacities:{},x=a?a.variableOffsets:{},S=a?a.placedOrientations:{};for(const E in this.placements){const A=this.placements[E],R=_[E];R?(this.opacities[E]=new Qs(R,f,A.text,A.icon),c=c||A.text!==R.text.placed||A.icon!==R.icon.placed):(this.opacities[E]=new Qs(null,f,A.text,A.icon,A.skipFade),c=c||A.text||A.icon)}for(const E in _){const A=_[E];if(!this.opacities[E]){const R=new Qs(A,f,!1,!1);R.isHidden()||(this.opacities[E]=R,c=c||A.text.placed||A.icon.placed)}}for(const E in x)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=x[E]);for(const E in S)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=S[E]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const c={};for(const f of a){const _=f.getBucket(t);_&&f.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,f.tileID,c,f.collisionBoxArray)}}updateBucketOpacities(t,a,c,f){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0],x=_.layout,S=new Qs(null,0,!1,!1,!0),E=x.get("text-allow-overlap"),A=x.get("icon-allow-overlap"),R=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),N=x.get("text-rotation-alignment")==="map",O=x.get("text-pitch-alignment")==="map",$=x.get("icon-text-fit")!=="none",X=new Qs(null,0,E&&(A||!t.hasIconData()||x.get("icon-optional")),A&&(E||!t.hasTextData()||x.get("text-optional")),!0);!t.collisionArrays&&f&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(f);const re=(ie,pe,Te)=>{for(let he=0;he<pe/4;he++)ie.opacityVertexArray.emplaceBack(Te);ie.hasVisibleVertices=ie.hasVisibleVertices||Te!==tl},ae=this.collisionBoxArrays.get(t.bucketInstanceId);for(let ie=0;ie<t.symbolInstances.length;ie++){const pe=t.symbolInstances.get(ie),{numHorizontalGlyphVertices:Te,numVerticalGlyphVertices:he,crossTileID:xe}=pe;let Pe=this.opacities[xe];c[xe]?Pe=S:Pe||(Pe=X,this.opacities[xe]=Pe),c[xe]=!0;const _e=pe.numIconVertices>0,Ce=this.placedOrientations[pe.crossTileID],je=Ce===l.az.vertical,Le=Ce===l.az.horizontal||Ce===l.az.horizontalOnly;if(Te>0||he>0){const Oe=$u(Pe.text);re(t.text,Te,je?tl:Oe),re(t.text,he,Le?tl:Oe);const lt=Pe.text.isHidden();[pe.rightJustifiedTextSymbolIndex,pe.centerJustifiedTextSymbolIndex,pe.leftJustifiedTextSymbolIndex].forEach((dt=>{dt>=0&&(t.text.placedSymbolArray.get(dt).hidden=lt||je?1:0)})),pe.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(pe.verticalPlacedTextSymbolIndex).hidden=lt||Le?1:0);const ut=this.variableOffsets[pe.crossTileID];ut&&this.markUsedJustification(t,ut.anchor,pe,Ce);const nt=this.placedOrientations[pe.crossTileID];nt&&(this.markUsedJustification(t,"left",pe,nt),this.markUsedOrientation(t,nt,pe))}if(_e){const Oe=$u(Pe.icon),lt=!($&&pe.verticalPlacedIconSymbolIndex&&je);pe.placedIconSymbolIndex>=0&&(re(t.icon,pe.numIconVertices,lt?Oe:tl),t.icon.placedSymbolArray.get(pe.placedIconSymbolIndex).hidden=Pe.icon.isHidden()),pe.verticalPlacedIconSymbolIndex>=0&&(re(t.icon,pe.numVerticalIconVertices,lt?tl:Oe),t.icon.placedSymbolArray.get(pe.verticalPlacedIconSymbolIndex).hidden=Pe.icon.isHidden())}const Be=ae&&ae.has(ie)?ae.get(ie):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Oe=t.collisionArrays[ie];if(Oe){let lt=new l.P(0,0);if(Oe.textBox||Oe.verticalTextBox){let ut=!0;if(R){const nt=this.variableOffsets[xe];nt?(lt=fc(nt.anchor,nt.width,nt.height,nt.textOffset,nt.textBoxScale),N&&lt._rotate(O?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ut=!1}if(Oe.textBox||Oe.verticalTextBox){let nt;Oe.textBox&&(nt=je),Oe.verticalTextBox&&(nt=Le),Uu(t.textCollisionBox.collisionVertexArray,Pe.text.placed,!ut||nt,Be.text,lt.x,lt.y)}}if(Oe.iconBox||Oe.verticalIconBox){const ut=!!(!Le&&Oe.verticalIconBox);let nt;Oe.iconBox&&(nt=ut),Oe.verticalIconBox&&(nt=!ut),Uu(t.iconCollisionBox.collisionVertexArray,Pe.icon.placed,nt,Be.icon,$?lt.x:0,$?lt.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const c=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function Uu(g,t,a,c,f,_){c&&c.length!==0||(c=[0,0,0,0]);const x=c[0]-or,S=c[1]-or,E=c[2]-or,A=c[3]-or;g.emplaceBack(t?1:0,a?1:0,f||0,_||0,x,S),g.emplaceBack(t?1:0,a?1:0,f||0,_||0,E,S),g.emplaceBack(t?1:0,a?1:0,f||0,_||0,E,A),g.emplaceBack(t?1:0,a?1:0,f||0,_||0,x,A)}const qu=Math.pow(2,25),Gu=Math.pow(2,24),cg=Math.pow(2,17),el=Math.pow(2,16),dc=Math.pow(2,9),ad=Math.pow(2,8),rs=Math.pow(2,1);function $u(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const t=g.placed?1:0,a=Math.floor(127*g.opacity);return a*qu+t*Gu+a*cg+t*el+a*dc+t*ad+a*rs+t}const tl=0;class Na{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,c,f,_){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(x,f,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort(((S,E)=>S.sortKey-E.sortKey)));this._currentPartIndex<x.length;)if(a.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,_())return!0;return!1}}class is{constructor(t,a,c,f,_,x,S,E){this.placement=new ju(t,a,x,S,E),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,a,c){const f=ee(),_=()=>!this._forceFullPlacement&&ee()-f>2;for(;this._currentPlacementIndex>=0;){const x=a[t[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=S)&&(!x.maxzoom||x.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Na(x)),this._inProgressLayer.continuePlacement(c[x.source],this.placement,this._showCollisionBoxes,x,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const on=512/l.a5/2;class Zu{constructor(t,a,c){this.tileID=t,this.bucketInstanceId=c,this._symbolsByKey={};const f=new Map;for(let _=0;_<a.length;_++){const x=a.get(_),S=x.key,E=f.get(S);E?E.push(x):f.set(S,[x])}for(const[_,x]of f){const S={positions:x.map((E=>({x:Math.floor(E.anchorX*on),y:Math.floor(E.anchorY*on)}))),crossTileIDs:x.map((E=>E.crossTileID))};if(S.positions.length>128){const E=new l.aT(S.positions.length,16,Uint16Array);for(const{x:A,y:R}of S.positions)E.add(A,R);E.finish(),delete S.positions,S.index=E}this._symbolsByKey[_]=S}}getScaledCoordinates(t,a){const{x:c,y:f,z:_}=this.tileID.canonical,{x,y:S,z:E}=a.canonical,A=on/Math.pow(2,E-_),R=(S*l.a5+t.anchorY)*A,N=f*l.a5*on;return{x:Math.floor((x*l.a5+t.anchorX)*A-c*l.a5*on),y:Math.floor(R-N)}}findMatches(t,a,c){const f=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let _=0;_<t.length;_++){const x=t.get(_);if(x.crossTileID)continue;const S=this._symbolsByKey[x.key];if(!S)continue;const E=this.getScaledCoordinates(x,a);if(S.index){const A=S.index.range(E.x-f,E.y-f,E.x+f,E.y+f).sort();for(const R of A){const N=S.crossTileIDs[R];if(!c[N]){c[N]=!0,x.crossTileID=N;break}}}else if(S.positions)for(let A=0;A<S.positions.length;A++){const R=S.positions[A],N=S.crossTileIDs[A];if(Math.abs(R.x-E.x)<=f&&Math.abs(R.y-E.y)<=f&&!c[N]){c[N]=!0,x.crossTileID=N;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class ug{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Wu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const c in this.indexes){const f=this.indexes[c],_={};for(const x in f){const S=f[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+a),_[S.tileID.key]=S}this.indexes[c]=_}this.lng=t}addBucket(t,a,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<a.symbolInstances.length;_++)a.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const f=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const x=this.indexes[_];if(Number(_)>t.overscaledZ)for(const S in x){const E=x[S];E.tileID.isChildOf(t)&&E.findMatches(a.symbolInstances,t,f)}else{const S=x[t.scaledTo(Number(_)).key];S&&S.findMatches(a.symbolInstances,t,f)}}for(let _=0;_<a.symbolInstances.length;_++){const x=a.symbolInstances.get(_);x.crossTileID||(x.crossTileID=c.generate(),f[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Zu(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const c of a.getCrossTileIDsLists())for(const f of c)delete this.usedCrossTileIDs[t][f]}removeStaleBuckets(t){let a=!1;for(const c in this.indexes){const f=this.indexes[c];for(const _ in f)t[f[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,f[_]),delete f[_],a=!0)}return a}}class mi{constructor(){this.layerIndexes={},this.crossTileIDs=new ug,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,c){let f=this.layerIndexes[t.id];f===void 0&&(f=this.layerIndexes[t.id]=new Wu);let _=!1;const x={};f.handleWrapJump(c);for(const S of a){const E=S.getBucket(t);E&&t.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(S.tileID,E,this.crossTileIDs)&&(_=!0),x[E.bucketInstanceId]=!0)}return f.removeStaleBuckets(x)&&(_=!0),_}pruneUnusedLayers(t){const a={};t.forEach((c=>{a[c]=!0}));for(const c in this.layerIndexes)a[c]||delete this.layerIndexes[c]}}var Yr="void main() {fragColor=vec4(1.0);}";const tr={prelude:Gt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Gt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Gt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Gt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Gt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Gt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Gt(Yr,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Gt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Gt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Gt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Gt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Gt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Gt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Gt(Yr,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Gt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Gt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Gt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Gt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Gt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Gt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Gt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Gt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Gt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Gt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Gt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Gt(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Gt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Gt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Gt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Gt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Gt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Gt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Gt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Gt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Gt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Gt(`#ifdef GL_ES
precision highp float;
#endif
in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Gt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Gt(g,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/in ([\w]+) ([\w]+)/g),f=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=_?_.concat(f):f,S={};return{fragmentSource:g=g.replace(a,((E,A,R,N,O)=>(S[O]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${O}
in ${R} ${N} ${O};
#else
uniform ${R} ${N} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${R} ${N} ${O} = u_${O};
#endif
`))),vertexSource:t=t.replace(a,((E,A,R,N,O)=>{const $=N==="float"?"vec2":"vec4",X=O.match(/color/)?"color":$;return S[O]?A==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${R} ${$} a_${O};
out ${R} ${N} ${O};
#else
uniform ${R} ${N} u_${O};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${R} ${N} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${X}(a_${O}, u_${O}_t);
#else
    ${R} ${N} ${O} = u_${O};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${R} ${$} a_${O};
#else
uniform ${R} ${N} u_${O};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${R} ${N} ${O} = a_${O};
#else
    ${R} ${N} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${R} ${N} ${O} = unpack_mix_${X}(a_${O}, u_${O}_t);
#else
    ${R} ${N} ${O} = u_${O};
#endif
`})),staticAttributes:c,staticUniforms:x}}class Bn{constructor(t,a,c){this.vertexBuffer=t,this.indexBuffer=a,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Va=l.aU([{name:"a_pos",type:"Int16",components:2}]);const ui="#define PROJECTION_MERCATOR",wi="mercator";class hi{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return wi}get shaderDefine(){return ui}get shaderPreludeCode(){return tr.projectionMercator}get vertexShaderPreludeCode(){return tr.projectionMercator.vertexSource}get subdivisionGranularity(){return l.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,a,c,f,_){if(this._cachedMesh)return this._cachedMesh;const x=new l.aW;x.emplaceBack(0,0),x.emplaceBack(l.a5,0),x.emplaceBack(0,l.a5),x.emplaceBack(l.a5,l.a5);const S=t.createVertexBuffer(x,Va.members),E=l.aX.simpleSegment(0,0,4,2),A=new l.aY;A.emplaceBack(1,0,2),A.emplaceBack(1,2,3);const R=t.createIndexBuffer(A);return this._cachedMesh=new Bn(S,R,E),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class as{constructor(t=0,a=0,c=0,f=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(c)||c<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=c,this.right=f}interpolate(t,a,c){return a.top!=null&&t.top!=null&&(this.top=l.G.number(t.top,a.top,c)),a.bottom!=null&&t.bottom!=null&&(this.bottom=l.G.number(t.bottom,a.bottom,c)),a.left!=null&&t.left!=null&&(this.left=l.G.number(t.left,a.left,c)),a.right!=null&&t.right!=null&&(this.right=l.G.number(t.right,a.right,c)),this}getCenter(t,a){const c=l.an((this.left+t-this.right)/2,0,t),f=l.an((this.top+a-this.bottom)/2,0,a);return new l.P(c,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new as(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ja(g,t){if(!g.renderWorldCopies||g.lngRange)return;const a=t.lng-g.center.lng;t.lng+=a>180?-360:a<-180?360:0}function hr(g){return Math.max(0,Math.floor(g))}class po{constructor(t,a){var c;this.applyConstrain=(f,_)=>this._constrainOverride!==null?this._constrainOverride(f,_):this._callbacks.defaultConstrain(f,_),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(c=a?.constrainOverride)!==null&&c!==void 0?c:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new l.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=hr(this._zoom),this._scale=l.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new as,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,a,c){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=hr(this._zoom),this._scale=l.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new as(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!c&&t.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const a=l.W(t,-180,180)*Math.PI/180;var c,f,_,x,S,E,A,R,N;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=D(),c=this._rotationMatrix,_=-this._bearingInRadians,x=(f=this._rotationMatrix)[0],S=f[1],E=f[2],A=f[3],R=Math.sin(_),N=Math.cos(_),c[0]=x*N+E*R,c[1]=S*N+A*R,c[2]=x*-R+E*N,c[3]=S*-R+A*N)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const a=l.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const a=t/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return l.aZ(this._fovInRadians)}setFov(t){t=l.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=l.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const a=this.applyConstrain(this._center,t).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=l.aq(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,a){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,c){this._unmodified=!1,this._edgeInsets.interpolate(t,a,c),this.constrainInternal(),this._calcMatrices()}resize(t,a,c=!0){this._width=t,this._height=a,c&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new qt([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-l.ao,l.ao])}getCameraQueryGeometry(t,a){if(a.length===1)return[a[0],t];{const{minX:c,minY:f,maxX:_,maxY:x}=l.aa.fromPoints(a).extend(t);return[new l.P(c,f),new l.P(_,f),new l.P(_,x),new l.P(c,x),new l.P(c,f)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:c}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(c),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=l.ar(new Float64Array(16));l.Q(t,t,[this._width/2,-this._height/2,1]),l.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=l.ar(new Float64Array(16)),l.Q(t,t,[1,-1,1]),l.O(t,t,[-1,-1,0]),l.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,a,c,f){const _=c!==void 0?c:this.bearing,x=f=f!==void 0?f:this.pitch,{distanceToCenter:S,clampedElevation:E}=this._distanceToCenterFromAltElevationPitch(a,this.elevation,x),{x:A,y:R}=Ln(x,_),N=l.a9.fromLngLat(t,a);let O,$,X=l.a_(1,N.y),re=0;do{if(re+=1,re>10)break;$=S/X,O=new l.a9(N.x+A*$,N.y+R*$),X=1/O.meterInMercatorCoordinateUnits()}while(Math.abs(S-$*X)>1e-12);return{center:O.toLngLat(),elevation:E,zoom:l.at(this.height/2/Math.tan(this.fovInRadians/2)/$/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const a=1/this.worldSize,c=l.as(1,this.center.lat)*this.worldSize,f=l.a9.fromLngLat(this.center,this.elevation),_=f.x/a,x=f.y/a,S=f.z/a,E=this.pitch,A=this.bearing,{x:R,y:N,z:O}=Ln(E,A),$=this.cameraToCenterDistance,X=_+$*-R,re=x+$*-N,ae=S+$*O,{distanceToCenter:ie,clampedElevation:pe}=this._distanceToCenterFromAltElevationPitch(ae/c,t,E),Te=ie*c,he=new l.a9((X+R*Te)*a,(re+N*Te)*a,0).toLngLat(),xe=l.as(1,he.lat),Pe=l.at(this.height/2/Math.tan(this.fovInRadians/2)/ie/xe/this.tileSize);this._elevation=pe,this._center=he,this.setZoom(Pe)}_distanceToCenterFromAltElevationPitch(t,a,c){const f=-Math.cos(l.ap(c)),_=t-a;let x,S=a;return f*_>=0||Math.abs(f)<.1?(x=1e4,S=t+x*f):x=-_/f,{distanceToCenter:x,clampedElevation:S}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=l.as(1,this.center.lat)*this.worldSize;return Fe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const a=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/a,t.canonical.y/a,1/a/l.a5,1/a/l.a5]}}class oa{constructor(t,a){this.min=t,this.max=a,this.center=l.a$([],l.b0([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],c=l.b1(this.min),f=l.b1(this.max);for(let _=0;_<a.length;_++)c[_]=a[_]?this.min[_]:this.center[_],f[_]=a[_]?this.center[_]:this.max[_];return f[2]=this.max[2],new oa(c,f)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let a=!0;for(let c=0;c<t.planes.length;c++){const f=this.intersectsPlane(t.planes[c]);if(f===0)return 0;f===1&&(a=!1)}return a?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let a=t[3],c=t[3];for(let f=0;f<3;f++)t[f]>0?(a+=t[f]*this.min[f],c+=t[f]*this.max[f]):(c+=t[f]*this.min[f],a+=t[f]*this.max[f]);return a>=0?2:c<0?0:1}}class pc{distanceToTile2d(t,a,c,f){const _=f.distanceX([t,a]),x=f.distanceY([t,a]);return Math.hypot(_,x)}getWrap(t,a,c){return c}getTileBoundingVolume(t,a,c,f){var _,x;let S=0,E=0;if(f?.terrain){const R=new l.a2(t.z,a,t.z,t.x,t.y),N=f.terrain.getMinMaxElevation(R);S=(_=N.minElevation)!==null&&_!==void 0?_:Math.min(0,c),E=(x=N.maxElevation)!==null&&x!==void 0?x:Math.max(0,c)}const A=1<<t.z;return new oa([a+t.x/A,t.y/A,S],[a+(t.x+1)/A,(t.y+1)/A,E])}allowVariableZoom(t,a){const c=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,f=l.an(78.5-c/2,0,60);return!!a.terrain||t.pitch>f}allowWorldCopies(){return!0}prepareNextFrame(){}}class gi{constructor(t,a,c){this.points=t,this.planes=a,this.aabb=c}static fromInvProjectionMatrix(t,a=1,c=0,f,_){const x=_?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],S=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((O=>(function($,X,re,ae){const ie=l.aH([],$,X),pe=1/ie[3]/re*ae;return l.b6(ie,ie,[pe,pe,1/ie[3],pe])})(O,t,a,S)));f&&(function(O,$,X,re){const ae=re?4:0,ie=re?0:4;let pe=0;const Te=[],he=[];for(let _e=0;_e<4;_e++){const Ce=l.b2([],O[_e+ie],O[_e+ae]),je=l.b7(Ce);l.a$(Ce,Ce,1/je),Te.push(je),he.push(Ce)}for(let _e=0;_e<4;_e++){const Ce=l.b8(O[_e+ae],he[_e],X);pe=Ce!==null&&Ce>=0?Math.max(pe,Ce):Math.max(pe,Te[_e])}const xe=(function(_e,Ce){const je=l.b2([],_e[Ce[0]],_e[Ce[1]]),Le=l.b2([],_e[Ce[2]],_e[Ce[1]]),Be=[0,0,0,0];return l.b3(Be,l.b4([],je,Le)),Be[3]=-l.b5(Be,_e[Ce[0]]),Be})(O,$),Pe=(function(_e,Ce){const je=l.b9(_e),Le=l.ba([],_e,1/je),Be=l.b2([],Ce,l.a$([],Le,l.b5(Ce,Le))),Oe=l.b9(Be);if(Oe>0){const lt=Math.sqrt(1-Le[3]*Le[3]),ut=l.a$([],Le,-Le[3]),nt=l.b0([],ut,l.a$([],Be,lt/Oe));return l.bb(Ce,nt)}return null})(X,xe);if(Pe!==null){const _e=Pe/l.b5(he[0],xe);pe=Math.min(pe,_e)}for(let _e=0;_e<4;_e++){const Ce=Math.min(pe,Te[_e]);O[_e+ie]=[O[_e+ae][0]+he[_e][0]*Ce,O[_e+ae][1]+he[_e][1]*Ce,O[_e+ae][2]+he[_e][2]*Ce,1]}})(E,x[0],f,_);const A=x.map((O=>{const $=l.b2([],E[O[0]],E[O[1]]),X=l.b2([],E[O[2]],E[O[1]]),re=l.b3([],l.b4([],$,X)),ae=-l.b5(re,E[O[1]]);return re.concat(ae)})),R=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],N=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const O of E)for(let $=0;$<3;$++)R[$]=Math.min(R[$],O[$]),N[$]=Math.max(N[$],O[$]);return new gi(E,A,new oa(R,N))}}class mo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,c=!0){this._helper.resize(t,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,a){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,c)=>{c=l.an(+c,this.minZoom,this.maxZoom);const f={center:new l.V(a.lng,a.lat),zoom:c};let _=this._helper._lngRange;if(!this._helper._renderWorldCopies&&_===null){const he=179.9999999999;_=[-he,he]}const x=this.tileSize*l.aq(f.zoom);let S=0,E=x,A=0,R=x,N=0,O=0;const{x:$,y:X}=this.size;if(this._helper._latRange){const he=this._helper._latRange;S=l.X(he[1])*x,E=l.X(he[0])*x,E-S<X&&(N=X/(E-S))}_&&(A=l.W(l.Y(_[0])*x,0,x),R=l.W(l.Y(_[1])*x,0,x),R<A&&(R+=x),R-A<$&&(O=$/(R-A)));const{x:re,y:ae}=Mt(x,a);let ie,pe;const Te=Math.max(O||0,N||0);if(Te){const he=new l.P(O?(R+A)/2:re,N?(E+S)/2:ae);return f.center=jt(x,he).wrap(),f.zoom+=l.at(Te),f}if(this._helper._latRange){const he=X/2;ae-he<S&&(pe=S+he),ae+he>E&&(pe=E-he)}if(_){const he=(A+R)/2;let xe=re;this._helper._renderWorldCopies&&(xe=l.W(re,he-x/2,he+x/2));const Pe=$/2;xe-Pe<A&&(ie=A+Pe),xe+Pe>R&&(ie=R-Pe)}if(ie!==void 0||pe!==void 0){const he=new l.P(ie??re,pe??ae);f.center=jt(x,he).wrap()}return f},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new po({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._coveringTilesDetailsProvider=new pc}clone(){const t=new mo;return t.apply(this,!1),t}apply(t,a,c){this._helper.apply(t,a,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const a=[new l.bc(0,t)];if(this._helper._renderWorldCopies){const c=this.screenPointToMercatorCoordinate(new l.P(0,0)),f=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,0)),_=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,this._helper._height)),x=this.screenPointToMercatorCoordinate(new l.P(0,this._helper._height)),S=Math.floor(Math.min(c.x,f.x,_.x,x.x)),E=Math.floor(Math.max(c.x,f.x,_.x,x.x)),A=1;for(let R=S-A;R<=E+A;R++)R!==0&&a.push(new l.bc(R,t))}return a}getCameraFrustum(){return gi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const a=this.screenPointToLocation(this.centerPoint,t),c=t?t.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(t,a){const c=l.as(this.elevation,this.center.lat),f=this.screenPointToMercatorCoordinateAtZ(a,c),_=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,c),x=l.a9.fromLngLat(t),S=new l.a9(x.x-(f.x-_.x),x.y-(f.y-_.y));this.setCenter(S?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,a){return a?this.coordinatePoint(l.a9.fromLngLat(t),a.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(l.a9.fromLngLat(t))}screenPointToLocation(t,a){var c;return(c=this.screenPointToMercatorCoordinate(t,a))===null||c===void 0?void 0:c.toLngLat()}screenPointToMercatorCoordinate(t,a){if(a){const c=a.pointCoordinate(t);if(c!=null)return c}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,a){const c=a||0,f=[t.x,t.y,0,1],_=[t.x,t.y,1,1];l.aH(f,f,this._pixelMatrixInverse),l.aH(_,_,this._pixelMatrixInverse);const x=f[3],S=_[3],E=f[1]/x,A=_[1]/S,R=f[2]/x,N=_[2]/S,O=R===N?0:(c-R)/(N-R);return new l.a9(l.G.number(f[0]/x,_[0]/S,O)/this.worldSize,l.G.number(E,A,O)/this.worldSize,c)}coordinatePoint(t,a=0,c=this._pixelMatrix){const f=[t.x*this.worldSize,t.y*this.worldSize,a,1];return l.aH(f,f,c),new l.P(f[0]/f[3],f[1]/f[3])}getBounds(){const t=Math.max(0,this._helper._height/2-Cn(this));return new qt().extend(this.screenPointToLocation(new l.P(0,t))).extend(this.screenPointToLocation(new l.P(this._helper._width,t))).extend(this.screenPointToLocation(new l.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new l.P(0,this._helper._height)))}isPointOnMapSurface(t,a){return a?a.pointCoordinate(t)!=null:t.y>this.height/2-Cn(this)}calculatePosMatrix(t,a=!1,c){var f;const _=(f=t.key)!==null&&f!==void 0?f:l.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),x=a?this._alignedPosMatrixCache:this._posMatrixCache;if(x.has(_)){const A=x.get(_);return c?A.f32:A.f64}const S=yn(t,this.worldSize);l.S(S,a?this._alignedProjMatrix:this._viewProjMatrix,S);const E={f64:S,f32:new Float32Array(S)};return x.set(_,E),c?E.f32:E.f64}calculateFogMatrix(t){const a=t.key,c=this._fogMatrixCacheF32;if(c.has(a))return c.get(a);const f=yn(t,this.worldSize);return l.S(f,this._fogMatrix,f),c.set(a,new Float32Array(f)),c.get(a)}calculateCenterFromCameraLngLatAlt(t,a,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,f)}_calculateNearFarZIfNeeded(t,a,c){if(!this._helper.autoCalculateNearFarZ)return;const f=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),_=t-f*this._helper._pixelPerMeter/Math.cos(a),x=f<0?_:t,S=Math.PI/2+this.pitchInRadians,E=l.ap(this.fov)*(Math.abs(Math.cos(l.ap(this.roll)))*this.height+Math.abs(Math.sin(l.ap(this.roll)))*this.width)/this.height*(.5+c.y/this.height),A=Math.sin(E)*x/Math.sin(l.an(Math.PI-S-E,.01,Math.PI-.01)),R=Cn(this),N=Math.atan(R/this._helper.cameraToCenterDistance),O=l.ap(.75),$=N>O?2*N*(.5+c.y/(2*R)):O,X=Math.sin($)*x/Math.sin(l.an(Math.PI-S-$,.01,Math.PI-.01)),re=Math.min(A,X);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*re+x),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,a=Mt(this.worldSize,this.center),c=a.x,f=a.y;this._helper._pixelPerMeter=l.as(1,this.center.lat)*this.worldSize;const _=l.ap(Math.min(this.pitch,ft)),x=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(_));let S;this._calculateNearFarZIfNeeded(x,_,t),S=new Float64Array(16),l.be(S,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),l.aB(this._invProjMatrix,S),S[8]=2*-t.x/this._helper._width,S[9]=2*t.y/this._helper._height,this._projectionMatrix=l.bf(S),l.Q(S,S,[1,-1,1]),l.O(S,S,[0,0,-this._helper.cameraToCenterDistance]),l.bg(S,S,-this.rollInRadians),l.bh(S,S,this.pitchInRadians),l.bg(S,S,-this.bearingInRadians),l.O(S,S,[-c,-f,0]),this._mercatorMatrix=l.Q([],S,[this.worldSize,this.worldSize,this.worldSize]),l.Q(S,S,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=l.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,S),l.O(S,S,[0,0,-this.elevation]),this._viewProjMatrix=S,this._invViewProjMatrix=l.aB([],S);const E=[0,0,-1,1];l.aH(E,E,this._invViewProjMatrix),this._cameraPosition=[E[0]/E[3],E[1]/E[3],E[2]/E[3]],this._fogMatrix=new Float64Array(16),l.be(this._fogMatrix,this.fovInRadians,this.width/this.height,x,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,l.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),l.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),l.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),l.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),l.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),l.O(this._fogMatrix,this._fogMatrix,[-c,-f,0]),l.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),l.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=l.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,S);const A=this._helper._width%2/2,R=this._helper._height%2/2,N=Math.cos(this.bearingInRadians),O=Math.sin(-this.bearingInRadians),$=c-Math.round(c)+N*A+O*R,X=f-Math.round(f)+N*R+O*A,re=new Float64Array(S);if(l.O(re,re,[$>.5?$-1:$,X>.5?X-1:X,0]),this._alignedProjMatrix=re,S=l.aB(new Float64Array(16),this._pixelMatrix),!S)throw new Error("failed to invert matrix");this._pixelMatrixInverse=S,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new l.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return l.aH(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=l.as(1,this.center.lat)*this.worldSize;return Fe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,a){const c=l.a9.fromLngLat(t),f=[c.x*this.worldSize,c.y*this.worldSize,a,1];return l.aH(f,f,this._viewProjMatrix),f[2]/f[3]}getProjectionData(t){const{overscaledTileID:a,aligned:c,applyTerrainMatrix:f}=t,_=this._helper.getMercatorTileCoordinates(a),x=a?this.calculatePosMatrix(a,c,!0):null;let S;return S=a&&a.terrainRttPosMatrix32f&&f?a.terrainRttPosMatrix32f:x||l.bi(),{mainMatrix:S,tileMercatorCoords:_,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:S}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,a,c){return 1}transformLightDirection(t){return l.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,a,c,f){const _=this.calculatePosMatrix(c);let x;f?(x=[t,a,f(t,a),1],l.aH(x,x,_)):(x=[t,a,0,1],hc(x,x,_));const S=x[3];return{point:new l.P(x[0]/S,x[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}populateCache(t){for(const a of t)this.calculatePosMatrix(a)}getMatrixForModel(t,a){const c=l.a9.fromLngLat(t,a),f=c.meterInMercatorCoordinateUnits(),_=l.bj();return l.O(_,_,[c.x,c.y,c.z]),l.bg(_,_,Math.PI),l.bh(_,_,Math.PI/2),l.Q(_,_,[-f,f,f]),_}getProjectionDataForCustomLayer(t=!0){const a=new l.a2(0,0,0,0,0),c=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:t}),f=yn(a,this.worldSize);l.S(f,this._viewProjMatrix,f),c.tileMercatorCoords=[0,0,1,1];const _=[l.a5,l.a5,this.worldSize/this._helper.pixelsPerMeter],x=l.bk();return l.Q(x,f,_),c.fallbackMatrix=x,c.mainMatrix=x,c}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Ta(){l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function od(g){if(g.useSlerp)if(g.k<1){const t=l.bl(g.startEulerAngles.roll,g.startEulerAngles.pitch,g.startEulerAngles.bearing),a=l.bl(g.endEulerAngles.roll,g.endEulerAngles.pitch,g.endEulerAngles.bearing),c=new Float64Array(4);l.bm(c,t,a,g.k);const f=l.bn(c);g.tr.setRoll(f.roll),g.tr.setPitch(f.pitch),g.tr.setBearing(f.bearing)}else g.tr.setRoll(g.endEulerAngles.roll),g.tr.setPitch(g.endEulerAngles.pitch),g.tr.setBearing(g.endEulerAngles.bearing);else g.tr.setRoll(l.G.number(g.startEulerAngles.roll,g.endEulerAngles.roll,g.k)),g.tr.setPitch(l.G.number(g.startEulerAngles.pitch,g.endEulerAngles.pitch,g.k)),g.tr.setBearing(l.G.number(g.startEulerAngles.bearing,g.endEulerAngles.bearing,g.k))}function Hu(g,t,a,c,f){const _=f.padding,x=Mt(f.worldSize,a.getNorthWest()),S=Mt(f.worldSize,a.getNorthEast()),E=Mt(f.worldSize,a.getSouthEast()),A=Mt(f.worldSize,a.getSouthWest()),R=l.ap(-c),N=x.rotate(R),O=S.rotate(R),$=E.rotate(R),X=A.rotate(R),re=new l.P(Math.max(N.x,O.x,X.x,$.x),Math.max(N.y,O.y,X.y,$.y)),ae=new l.P(Math.min(N.x,O.x,X.x,$.x),Math.min(N.y,O.y,X.y,$.y)),ie=re.sub(ae),pe=(f.width-(_.left+_.right+t.left+t.right))/ie.x,Te=(f.height-(_.top+_.bottom+t.top+t.bottom))/ie.y;if(Te<0||pe<0)return void Ta();const he=Math.min(l.at(f.scale*Math.min(pe,Te)),g.maxZoom),xe=l.P.convert(g.offset),Pe=new l.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(l.ap(c)),_e=xe.add(Pe).mult(f.scale/l.aq(he));return{center:jt(f.worldSize,x.add(E).div(2).sub(_e)),zoom:he,bearing:c}}class go{get useGlobeControls(){return!1}handlePanInertia(t,a){const c=t.mag(),f=Math.abs(Cn(a));return{easingOffset:t.mult(Math.min(.75*f/c,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(t,a){t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta),t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta)}handleMapControlsPan(t,a,c){t.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(c,t.around)}cameraForBoxAndBearing(t,a,c,f,_){return Hu(t,a,c,f,_)}handleJumpToCenterZoom(t,a){t.zoom!==(a.zoom!==void 0?+a.zoom:t.zoom)&&t.setZoom(+a.zoom),a.center!==void 0&&t.setCenter(l.V.convert(a.center))}handleEaseTo(t,a){const c=t.zoom,f=t.padding,_={roll:t.roll,pitch:t.pitch,bearing:t.bearing},x={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},S=a.zoom!==void 0,E=!t.isPaddingEqual(a.padding);let A=!1;const R=S?+a.zoom:t.zoom;let N=t.centerPoint.add(a.offsetAsPoint);const O=t.screenPointToLocation(N),{center:$,zoom:X}=t.applyConstrain(l.V.convert(a.center||O),R??c);ja(t,$);const re=Mt(t.worldSize,O),ae=Mt(t.worldSize,$).sub(re),ie=l.aq(X-c);return A=X!==c,{easeFunc:pe=>{if(A&&t.setZoom(l.G.number(c,X,pe)),l.bo(_,x)||od({startEulerAngles:_,endEulerAngles:x,tr:t,k:pe,useSlerp:_.roll!=x.roll}),E&&(t.interpolatePadding(f,a.padding,pe),N=t.centerPoint.add(a.offsetAsPoint)),a.around)t.setLocationAtPoint(a.around,a.aroundPoint);else{const Te=l.aq(t.zoom-c),he=X>c?Math.min(2,ie):Math.max(.5,ie),xe=Math.pow(he,1-pe),Pe=jt(t.worldSize,re.add(ae.mult(pe*xe)).mult(Te));t.setLocationAtPoint(t.renderWorldCopies?Pe.wrap():Pe,N)}},isZooming:A,elevationCenter:$}}handleFlyTo(t,a){const c=a.zoom!==void 0,f=t.zoom,_=t.applyConstrain(l.V.convert(a.center||a.locationAtOffset),c?+a.zoom:f),x=_.center,S=_.zoom;ja(t,x);const E=Mt(t.worldSize,a.locationAtOffset),A=Mt(t.worldSize,x).sub(E),R=A.mag(),N=l.aq(S-f);let O;if(a.minZoom!==void 0){const $=Math.min(+a.minZoom,f,S),X=t.applyConstrain(x,$).zoom;O=l.aq(X-f)}return{easeFunc:($,X,re,ae)=>{t.setZoom($===1?S:f+l.at(X));const ie=$===1?x:jt(t.worldSize,E.add(A.mult(re)).mult(X));t.setLocationAtPoint(t.renderWorldCopies?ie.wrap():ie,ae)},scaleOfZoom:N,targetCenter:x,scaleOfMinZoom:O,pixelPathLength:R}}}class On{constructor(t,a,c){this.blendFunction=t,this.blendColor=a,this.mask=c}}On.Replace=[1,0],On.disabled=new On(On.Replace,l.bp.transparent,[!1,!1,!1,!1]),On.unblended=new On(On.Replace,l.bp.transparent,[!0,!0,!0,!0]),On.alphaBlended=new On([1,771],l.bp.transparent,[!0,!0,!0,!0]);const os=2305;class vn{constructor(t,a,c){this.enable=t,this.mode=a,this.frontFace=c}}vn.disabled=new vn(!1,1029,os),vn.backCCW=new vn(!0,1029,os),vn.frontCCW=new vn(!0,1028,os);class en{constructor(t,a,c){this.func=t,this.mask=a,this.range=c}}en.ReadOnly=!1,en.ReadWrite=!0,en.disabled=new en(519,en.ReadOnly,[0,1]);const ss=7680;class wn{constructor(t,a,c,f,_,x){this.test=t,this.ref=a,this.mask=c,this.fail=f,this.depthFail=_,this.pass=x}}wn.disabled=new wn({func:519,mask:0},0,0,ss,ss,ss);const nl=new WeakMap;function Ri(g){var t;if(nl.has(g))return nl.get(g);{const a=(t=g.getParameter(g.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return nl.set(g,a),a}}class ls{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const a=t.context,c=a.gl;this._texFormat=c.RGBA,this._texType=c.UNSIGNED_BYTE;const f=new l.aW;f.emplaceBack(-1,-1),f.emplaceBack(2,-1),f.emplaceBack(-1,2);const _=new l.aY;_.emplaceBack(0,1,2),this._fullscreenTriangle=new Bn(a.createVertexBuffer(f,Va.members),a.createIndexBuffer(_),l.aX.simpleSegment(0,0,f.length,_.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(c.TEXTURE1);const x=c.createTexture();c.bindTexture(c.TEXTURE_2D,x),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(x),Ri(c)&&(this._pbo=c.createBuffer(),c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.bufferData(c.PIXEL_PACK_BUFFER,4,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,a){const c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,a=t.gl;t.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,a){const c=this._cachedRenderContext.context,f=c.gl;if(this._bindFramebuffer(),c.viewport.set([0,0,this._texWidth,this._texHeight]),c.clear({color:l.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(c,f.TRIANGLES,en.disabled,wn.disabled,On.unblended,vn.disabled,((_,x)=>({u_input:_,u_output_expected:x}))(t,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Ri(f)){f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.readBuffer(f.COLOR_ATTACHMENT0),f.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),f.bindBuffer(f.PIXEL_PACK_BUFFER,null);const _=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0);f.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:_}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Ri(t)){const a=t.clientWaitSync(this._readbackQueue.sync,0,0);if(a===t.WAIT_FAILED)return l.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ls._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let a=0;return a+=t[0]/256,a+=t[1]/65536,a+=t[2]/16777216,t[3]<127&&(a=-a),a/128}}const Ua=l.a5/128;function sd(g,t){const a=g.granularity!==void 0?Math.max(g.granularity,1):1,c=a+(g.generateBorders?2:0),f=a+(g.extendToNorthPole||g.generateBorders?1:0)+(g.extendToSouthPole||g.generateBorders?1:0),_=c+1,x=f+1,S=g.generateBorders?-1:0,E=g.generateBorders||g.extendToNorthPole?-1:0,A=a+(g.generateBorders?1:0),R=a+(g.generateBorders||g.extendToSouthPole?1:0),N=_*x,O=c*f*6,$=_*x>65536;if($&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const X=$||t==="32bit",re=new Int16Array(2*N);let ae=0;for(let Te=E;Te<=R;Te++)for(let he=S;he<=A;he++){let xe=he/a*l.a5;he===-1&&(xe=-Ua),he===a+1&&(xe=l.a5+Ua);let Pe=Te/a*l.a5;Te===-1&&(Pe=g.extendToNorthPole?l.br:-Ua),Te===a+1&&(Pe=g.extendToSouthPole?l.bs:l.a5+Ua),re[ae++]=xe,re[ae++]=Pe}const ie=X?new Uint32Array(O):new Uint16Array(O);let pe=0;for(let Te=0;Te<f;Te++)for(let he=0;he<c;he++){const xe=he+1+Te*_,Pe=he+(Te+1)*_,_e=he+1+(Te+1)*_;ie[pe++]=he+Te*_,ie[pe++]=Pe,ie[pe++]=xe,ie[pe++]=xe,ie[pe++]=Pe,ie[pe++]=_e}return{vertices:re.buffer.slice(0),indices:ie.buffer.slice(0),uses32bitIndices:X}}const rl=new l.aV({fill:new l.bt(128,2),line:new l.bt(512,0),tile:new l.bt(128,32),stencil:new l.bt(128,1),circle:3});class Xu{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return tr.projectionGlobe}get vertexShaderPreludeCode(){return tr.projectionMercator.vertexSource}get subdivisionGranularity(){return rl}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new ls(t));const a=l.X(this._errorQueryLatitudeDegrees),c=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,f=this._errorMeasurement.updateErrorLoop(a,c),_=ee();f!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=f,this._errorMeasurementLastChangeTime=_);const x=Math.min(Math.max((_-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=l.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,l.bv(x))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,a,c,f,_){const x=(_==="stencil"?rl.stencil:rl.tile).getGranularityForZoomLevel(a.z);return this._getMesh(t,{granularity:x,generateBorders:c,extendToNorthPole:a.y===0&&f,extendToSouthPole:a.y===(1<<a.z)-1&&f})}_getMesh(t,a){const c=this._getMeshKey(a);if(c in this._tileMeshCache)return this._tileMeshCache[c];const f=(function(_,x){const S=sd(x,"16bit"),E=l.aW.deserialize({arrayBuffer:S.vertices,length:S.vertices.byteLength/2/2}),A=l.aY.deserialize({arrayBuffer:S.indices,length:S.indices.byteLength/2/3});return new Bn(_.createVertexBuffer(E,Va.members),_.createIndexBuffer(A),l.aX.simpleSegment(0,0,E.length,A.length))})(t,a);return this._tileMeshCache[c]=f,f}recalculate(t){}hasTransition(){const t=ee();let a=!1;return a=a||(t-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const hg=new l.t({type:new l.D(l.u.projection.type)});class ld extends l.E{constructor(t){super(),this._transitionable=new l.x(hg,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.H(0)),this._mercatorProjection=new hi,this._verticalPerspectiveProjection=new Xu}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof l.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,a,c,f,_){return this.currentProjection.getMeshFromTileID(t,a,c,f,_)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function fi(g){const t=_o(g.worldSize,g.center.lat);return 2*Math.PI*t}function sa(g,t,a,c,f){const _=1/(1<<f),x=t/l.a5*_+c*_,S=l.by((g/l.a5*_+a*_)*Math.PI*2+Math.PI,2*Math.PI),E=2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI,A=Math.cos(E),R=new Float64Array(3);return R[0]=Math.sin(S)*A,R[1]=Math.sin(E),R[2]=Math.cos(S)*A,R}function Hn(g){return(function(t,a){const c=Math.cos(a),f=new Float64Array(3);return f[0]=Math.sin(t)*c,f[1]=Math.sin(a),f[2]=Math.cos(t)*c,f})(g.lng*Math.PI/180,g.lat*Math.PI/180)}function _o(g,t){return g/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Yu(g){const t=Math.asin(g[1])/Math.PI*180,a=Math.sqrt(g[0]*g[0]+g[2]*g[2]);if(a>1e-6){const c=g[0]/a,f=Math.acos(g[2]/a),_=(c>0?f:-f)/Math.PI*180;return new l.V(l.W(_,-180,180),t)}return new l.V(0,t)}function il(g){return Math.cos(g*Math.PI/180)}function sr(g,t){const a=il(g),c=il(t);return l.at(c/a)}function cd(g,t){const a=g.rotate(t.bearingInRadians),c=t.zoom+sr(t.center.lat,0),f=l.bu(1/il(t.center.lat),1/il(Math.min(Math.abs(t.center.lat),60)),l.bx(c,7,3,0,1)),_=360/fi({worldSize:t.worldSize,center:{lat:t.center.lat}});return new l.V(t.center.lng-a.x*_*f,l.an(t.center.lat+a.y*_,-l.ao,l.ao))}function Ku(g){const t=.5*g,a=Math.sin(t),c=Math.cos(t);return Math.log(a+c)-Math.log(c-a)}function ud(g,t,a,c){const f=g.lat+a*c;if(Math.abs(a)>1){const _=(Math.sign(g.lat+a)!==Math.sign(g.lat)?-Math.abs(g.lat):Math.abs(g.lat))*Math.PI/180,x=Math.abs(g.lat+a)*Math.PI/180,S=Ku(_+c*(x-_)),E=Ku(_),A=Ku(x);return new l.V(g.lng+t*((S-E)/(A-E)),f)}return new l.V(g.lng+t*c,f)}class fg{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,a,c,f){const _=`${t.z}_${t.x}_${t.y}_${f?.terrain?"t":""}`,x=this._cache.get(_);if(x)return x;const S=this._cachePrevious.get(_);if(S)return this._cache.set(_,S),S;const E=this._boundingVolumeFactory(t,a,c,f);return this._cache.set(_,E),this._hadAnyChanges=!0,E}}class cs{constructor(t,a,c,f){this.min=c,this.max=f,this.points=t,this.planes=a}static fromAabb(t,a){const c=[];for(let f=0;f<8;f++)c.push([1&~f?t[0]:a[0],(f>>1&1)==1?a[1]:t[1],(f>>2&1)==1?a[2]:t[2]]);return new cs(c,[[-1,0,0,a[0]],[1,0,0,-t[0]],[0,-1,0,a[1]],[0,1,0,-t[1]],[0,0,-1,a[2]],[0,0,1,-t[2]]],t,a)}static fromCenterSizeAngles(t,a,c){const f=l.bB([],c[0],c[1],c[2]),_=l.bC([],[a[0],0,0],f),x=l.bC([],[0,a[1],0],f),S=l.bC([],[0,0,a[2]],f),E=[...t],A=[...t];for(let N=0;N<8;N++)for(let O=0;O<3;O++){const $=t[O]+_[O]*(1&~N?-1:1)+x[O]*((N>>1&1)==1?1:-1)+S[O]*((N>>2&1)==1?1:-1);E[O]=Math.min(E[O],$),A[O]=Math.max(A[O],$)}const R=[];for(let N=0;N<8;N++){const O=[...t];l.b0(O,O,l.a$([],_,1&~N?-1:1)),l.b0(O,O,l.a$([],x,(N>>1&1)==1?1:-1)),l.b0(O,O,l.a$([],S,(N>>2&1)==1?1:-1)),R.push(O)}return new cs(R,[[..._,-l.b5(_,R[0])],[...x,-l.b5(x,R[0])],[...S,-l.b5(S,R[0])],[-_[0],-_[1],-_[2],-l.b5(_,R[7])],[-x[0],-x[1],-x[2],-l.b5(x,R[7])],[-S[0],-S[1],-S[2],-l.b5(S,R[7])]],E,A)}intersectsFrustum(t){let a=!0;const c=this.points.length,f=this.planes.length,_=t.planes.length,x=t.points.length;for(let S=0;S<_;S++){const E=t.planes[S];let A=0;for(let R=0;R<c;R++){const N=this.points[R];E[0]*N[0]+E[1]*N[1]+E[2]*N[2]+E[3]>=0&&A++}if(A===0)return 0;A<c&&(a=!1)}if(a)return 2;for(let S=0;S<f;S++){const E=this.planes[S];let A=0;for(let R=0;R<x;R++){const N=t.points[R];E[0]*N[0]+E[1]*N[1]+E[2]*N[2]+E[3]>=0&&A++}if(A===0)return 0}return 1}intersectsPlane(t){const a=this.points.length;let c=0;for(let f=0;f<a;f++){const _=this.points[f];t[0]*_[0]+t[1]*_[1]+t[2]*_[2]+t[3]>=0&&c++}return c===a?2:c===0?0:1}}function mc(g,t,a){const c=g-t;return c<0?-c:Math.max(0,c-a)}function us(g,t,a,c,f){const _=g-a;let x;return x=_<0?Math.min(-_,1+_-f):_>1?Math.min(Math.max(_-f,0),1-_):0,Math.max(x,mc(t,c,f))}class Ju{constructor(){this._boundingVolumeCache=new fg(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,a,c,f){const _=1<<c.z,x=1/_,S=c.x/_,E=c.y/_;let A=2;return A=Math.min(A,us(t,a,S,E,x)),A=Math.min(A,us(t,a,S+.5,-E-x,x)),A=Math.min(A,us(t,a,S+.5,2-E-x,x)),A}getWrap(t,a,c){const f=1<<a.z,_=1/f,x=a.x/f,S=mc(t.x,x,_),E=mc(t.x,x-1,_),A=mc(t.x,x+1,_),R=Math.min(S,E,A);return R===A?1:R===E?-1:0}allowVariableZoom(t,a){return $n(t,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,a,c,f){return this._boundingVolumeCache.getTileBoundingVolume(t,a,c,f)}_computeTileBoundingVolume(t,a,c,f){var _,x;let S=0,E=0;if(f?.terrain){const A=new l.a2(t.z,a,t.z,t.x,t.y),R=f.terrain.getMinMaxElevation(A);S=(_=R.minElevation)!==null&&_!==void 0?_:Math.min(0,c),E=(x=R.maxElevation)!==null&&x!==void 0?x:Math.max(0,c)}if(S/=l.bE,E/=l.bE,S+=1,E+=1,t.z<=0)return cs.fromAabb([-E,-E,-E],[E,E,E]);if(t.z===1)return cs.fromAabb([t.x===0?-E:0,t.y===0?0:-E,-E],[t.x===0?0:E,t.y===0?E:0,E]);{const A=[sa(0,0,t.x,t.y,t.z),sa(l.a5,0,t.x,t.y,t.z),sa(l.a5,l.a5,t.x,t.y,t.z),sa(0,l.a5,t.x,t.y,t.z)],R=[];for(const Be of A)R.push(l.a$([],Be,E));if(E!==S)for(const Be of A)R.push(l.a$([],Be,S));t.y===0&&R.push([0,1,0]),t.y===(1<<t.z)-1&&R.push([0,-1,0]);const N=[1,1,1],O=[-1,-1,-1];for(const Be of R)for(let Oe=0;Oe<3;Oe++)N[Oe]=Math.min(N[Oe],Be[Oe]),O[Oe]=Math.max(O[Oe],Be[Oe]);const $=sa(l.a5/2,l.a5/2,t.x,t.y,t.z),X=l.b4([],[0,1,0],$);l.b3(X,X);const re=l.b4([],$,X);l.b3(re,re);const ae=l.b4([],A[2],A[1]);l.b3(ae,ae);const ie=l.b4([],A[0],A[3]);l.b3(ie,ie),R.push(l.a$([],$,E)),t.y>=(1<<t.z)/2&&R.push(l.a$([],sa(l.a5/2,0,t.x,t.y,t.z),E)),t.y<(1<<t.z)/2&&R.push(l.a$([],sa(l.a5/2,l.a5,t.x,t.y,t.z),E));const pe=al($,R),Te=al(re,R),he=[-$[0],-$[1],-$[2],pe.max],xe=[$[0],$[1],$[2],-pe.min],Pe=[-re[0],-re[1],-re[2],Te.max],_e=[re[0],re[1],re[2],-Te.min],Ce=[...ae,0],je=[...ie,0],Le=[];return t.y===0?Le.push(l.bD(je,Ce,he),l.bD(je,Ce,xe)):Le.push(l.bD(Pe,Ce,he),l.bD(Pe,Ce,xe),l.bD(Pe,je,he),l.bD(Pe,je,xe)),t.y===(1<<t.z)-1?Le.push(l.bD(je,Ce,he),l.bD(je,Ce,xe)):Le.push(l.bD(_e,Ce,he),l.bD(_e,Ce,xe),l.bD(_e,je,he),l.bD(_e,je,xe)),new cs(Le,[he,xe,Pe,_e,Ce,je],N,O)}}}function al(g,t){let a=1/0,c=-1/0;for(const f of t){const _=l.b5(g,f);a=Math.min(a,_),c=Math.max(c,_)}return{min:a,max:c}}class hs{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a){this._helper.resize(t,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=l.bF(),this._projectionMatrix=l.bj(),this._globeViewProjMatrix32f=l.bi(),this._globeViewProjMatrixNoCorrection=l.bj(),this._globeViewProjMatrixNoCorrectionInverted=l.bj(),this._globeProjMatrixInverted=l.bj(),this._cameraPosition=l.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,c)=>{const f=l.an(a.lat,-l.ao,l.ao),_=l.an(+c,this.minZoom+sr(0,f),this.maxZoom);return{center:new l.V(a.lng,f),zoom:_}},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new po({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._coveringTilesDetailsProvider=new Ju}clone(){const t=new hs;return t.apply(this,!1),t}apply(t,a,c){this._globeLatitudeErrorCorrectionRadians=c||0,this._helper.apply(t,a)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=l.bz();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:a,applyGlobeMatrix:c}=t,f=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:f,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const a=this.pitchInRadians,c=this.cameraToCenterDistance/t,f=Math.sin(a)*c,_=Math.cos(a)*c+1,x=1/Math.sqrt(f*f+_*_)*1;let S=-f,E=_;const A=Math.sqrt(S*S+E*E);S/=A,E/=A;const R=[0,S,E];l.bG(R,R,[0,0,0],-this.bearingInRadians),l.bH(R,R,[0,0,0],-1*this.center.lat*Math.PI/180),l.bI(R,R,[0,0,0],this.center.lng*Math.PI/180);const N=1/l.b7(R);return l.a$(R,R,N),[...R,-x*N]}isLocationOccluded(t){return!this.isSurfacePointVisible(Hn(t))}transformLightDirection(t){const a=this._helper._center.lng*Math.PI/180,c=this._helper._center.lat*Math.PI/180,f=Math.cos(c),_=[Math.sin(a)*f,Math.sin(c),Math.cos(a)*f],x=[_[2],0,-_[0]],S=[0,0,0];l.b4(S,x,_),l.b3(x,x),l.b3(S,S);const E=[0,0,0];return l.b3(E,[x[0]*t[0]+S[0]*t[1]+_[0]*t[2],x[1]*t[0]+S[1]*t[1]+_[1]*t[2],x[2]*t[0]+S[2]*t[1]+_[2]*t[2]]),E}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,a,c){const f=(function(S,E,A){const R=1/(1<<A.z);return new l.a9(S/l.a5*R+A.x*R,E/l.a5*R+A.y*R)})(t,a,c.canonical),_=(x=f.y,[l.by(f.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI]);var x;return this.getCircleRadiusCorrection()/Math.cos(_[1])}projectTileCoordinates(t,a,c,f){const _=c.canonical,x=sa(t,a,_.x,_.y,_.z),S=1+(f?f(t,a):0)/l.bE,E=[x[0]*S,x[1]*S,x[2]*S,1];l.aH(E,E,this._globeViewProjMatrixNoCorrection);const A=this._cachedClippingPlane,R=A[0]*x[0]+A[1]*x[1]+A[2]*x[2]+A[3]<0;return{point:new l.P(E[0]/E[3],E[1]/E[3]),signedDistanceFromCamera:E[3],isOccluded:R}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=_o(this.worldSize,this.center.lat),a=l.bk(),c=l.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),l.be(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const f=this.centerOffset;a[8]=2*-f.x/this._helper._width,a[9]=2*f.y/this._helper._height,this._projectionMatrix=l.bf(a),this._globeProjMatrixInverted=l.bk(),l.aB(this._globeProjMatrixInverted,a),l.O(a,a,[0,0,-this.cameraToCenterDistance]),l.bg(a,a,this.rollInRadians),l.bh(a,a,-this.pitchInRadians),l.bg(a,a,this.bearingInRadians),l.O(a,a,[0,0,-t]);const _=l.bz();_[0]=t,_[1]=t,_[2]=t,l.bh(c,a,this.center.lat*Math.PI/180),l.bJ(c,c,-this.center.lng*Math.PI/180),l.Q(c,c,_),this._globeViewProjMatrixNoCorrection=c,l.bh(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),l.bJ(a,a,-this.center.lng*Math.PI/180),l.Q(a,a,_),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=l.bk(),l.aB(this._globeViewProjMatrixNoCorrectionInverted,c);const x=l.bz();this._cameraPosition=l.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/t,l.bG(this._cameraPosition,this._cameraPosition,x,-this.rollInRadians),l.bH(this._cameraPosition,this._cameraPosition,x,this.pitchInRadians),l.bG(this._cameraPosition,this._cameraPosition,x,-this.bearingInRadians),l.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),l.bH(this._cameraPosition,this._cameraPosition,x,-this.center.lat*Math.PI/180),l.bI(this._cameraPosition,this._cameraPosition,x,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const S=l.bf(this._globeViewProjMatrixNoCorrectionInverted);l.Q(S,S,[1,1,-1]),this._cachedFrustum=gi.fromInvProjectionMatrix(S,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){l.w("calculateFogMatrix is not supported on globe projection.");const a=l.bk();return l.ar(a),a}getVisibleUnwrappedCoordinates(t){return[new l.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&l.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const c=Hn(t);l.a$(c,c,1+a/l.bE);const f=l.bF();return l.aH(f,[c[0],c[1],c[2],1],this._globeViewProjMatrixNoCorrection),f[2]/f[3]}populateCache(t){}getBounds(){const t=.5*this.width,a=.5*this.height,c=[new l.P(0,0),new l.P(t,0),new l.P(this.width,0),new l.P(this.width,a),new l.P(this.width,this.height),new l.P(t,this.height),new l.P(0,this.height),new l.P(0,a)],f=[];for(const N of c)f.push(this.unprojectScreenPoint(N));let _=0,x=0,S=0,E=0;const A=this.center;for(const N of f){const O=l.bK(A.lng,N.lng),$=l.bK(A.lat,N.lat);O<x&&(x=O),O>_&&(_=O),$<E&&(E=$),$>S&&(S=$)}const R=[A.lng+x,A.lat+E,A.lng+_,A.lat+S];return this.isSurfacePointOnScreen([0,1,0])&&(R[3]=90,R[0]=-180,R[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(R[1]=-90,R[0]=-180,R[2]=180),new qt(R)}calculateCenterFromCameraLngLatAlt(t,a,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,f)}setLocationAtPoint(t,a){const c=Hn(this.unprojectScreenPoint(a)),f=Hn(t),_=l.bz();l.bL(_);const x=l.bz();l.bI(x,c,_,-this.center.lng*Math.PI/180),l.bH(x,x,_,this.center.lat*Math.PI/180);const S=f[0]*f[0]+f[2]*f[2],E=x[0]*x[0];if(S<E)return;const A=Math.sqrt(S-E),R=-A,N=l.bM(f[0],f[2],x[0],A),O=l.bM(f[0],f[2],x[0],R),$=l.bz();l.bI($,f,_,-N);const X=l.bM($[1],$[2],x[1],x[2]),re=l.bz();l.bI(re,f,_,-O);const ae=l.bM(re[1],re[2],x[1],x[2]),ie=.5*Math.PI,pe=X>=-ie&&X<=ie,Te=ae>=-ie&&ae<=ie;let he,xe;if(pe&&Te){const je=this.center.lng*Math.PI/180,Le=this.center.lat*Math.PI/180;l.bN(N,je)+l.bN(X,Le)<l.bN(O,je)+l.bN(ae,Le)?(he=N,xe=X):(he=O,xe=ae)}else if(pe)he=N,xe=X;else{if(!Te)return;he=O,xe=ae}const Pe=he/Math.PI*180,_e=xe/Math.PI*180,Ce=this.center.lat;this.setCenter(new l.V(Pe,l.an(_e,-90,90))),this.setZoom(this.zoom+sr(Ce,this.center.lat))}locationToScreenPoint(t,a){const c=Hn(t);if(a){const f=a.getElevationForLngLatZoom(t,this._helper._tileZoom);l.a$(c,c,1+f/l.bE)}return this._projectSurfacePointToScreen(c)}_projectSurfacePointToScreen(t){const a=l.bF();return l.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new l.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,a){if(a){const c=a.pointCoordinate(t);if(c)return c}return l.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,a){var c;return(c=this.screenPointToMercatorCoordinate(t,a))===null||c===void 0?void 0:c.toLngLat()}isPointOnMapSurface(t,a){const c=this._cameraPosition,f=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(c,f)}getRayDirectionFromPixel(t){const a=l.bF();a[0]=t.x/this.width*2-1,a[1]=-1*(t.y/this.height*2-1),a[2]=1,a[3]=1,l.aH(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const c=l.bz();c[0]=a[0]-this._cameraPosition[0],c[1]=a[1]-this._cameraPosition[1],c[2]=a[2]-this._cameraPosition[2];const f=l.bz();return l.b3(f,c),f}isSurfacePointVisible(t){const a=this._cachedClippingPlane;return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const a=l.bF();return l.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(t,a){const c=l.b5(t,a),f=l.bz(),_=l.bz();l.a$(_,a,c),l.b2(f,t,_);const x=1-l.b5(f,f);if(x<0)return null;const S=l.b5(t,t)-1,E=-c+(c<0?1:-1)*Math.sqrt(x),A=S/E,R=E;return{tMin:Math.min(A,R),tMax:Math.max(A,R)}}unprojectScreenPoint(t){const a=this._cameraPosition,c=this.getRayDirectionFromPixel(t),f=this.rayPlanetIntersection(a,c);if(f){const R=l.bz();l.b0(R,a,[c[0]*f.tMin,c[1]*f.tMin,c[2]*f.tMin]);const N=l.bz();return l.b3(N,R),Yu(N)}const _=this._cachedClippingPlane,x=_[0]*c[0]+_[1]*c[1]+_[2]*c[2],S=-l.bb(_,a)/x,E=l.bz();if(S>0)l.b0(E,a,[c[0]*S,c[1]*S,c[2]*S]);else{const R=l.bz();l.b0(R,a,[2*c[0],2*c[1],2*c[2]]);const N=l.bb(this._cachedClippingPlane,R);l.b2(E,R,[this._cachedClippingPlane[0]*N,this._cachedClippingPlane[1]*N,this._cachedClippingPlane[2]*N])}const A=(function(R){const N=l.bz();return N[0]=R[0]*-R[3],N[1]=R[1]*-R[3],N[2]=R[2]*-R[3],{center:N,radius:Math.sqrt(1-R[3]*R[3])}})(_);return Yu((function(R,N,O){const $=l.bz();l.b2($,O,R);const X=l.bz();return l.bA(X,R,$,N/l.b9($)),X})(A.center,A.radius,E))}getMatrixForModel(t,a){const c=l.V.convert(t),f=1/l.bE,_=l.bj();return l.bJ(_,_,c.lng/180*Math.PI),l.bh(_,_,-c.lat/180*Math.PI),l.O(_,_,[0,0,1+a/l.bE]),l.bh(_,_,.5*Math.PI),l.Q(_,_,[f,f,f]),_}getProjectionDataForCustomLayer(t=!0){const a=this.getProjectionData({overscaledTileID:new l.a2(0,0,0,0,0),applyGlobeMatrix:t});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(t){}}class fs{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,c=!0){this._helper.resize(t,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,a){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,c)=>this.currentTransform.defaultConstrain(a,c),this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new po({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._globeness=1,this._mercatorTransform=new mo,this._verticalPerspectiveTransform=new hs}clone(){const t=new fs;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this,!1),t}apply(t,a){this._helper.apply(t,a),this._mercatorTransform.apply(this,!1),this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const a=this._mercatorTransform.getProjectionData(t),c=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:a.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return l.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return l.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,a,c){const f=this._mercatorTransform.getPitchedTextCorrection(t,a,c),_=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,a,c);return l.bu(f,_,this._globeness)}projectTileCoordinates(t,a,c,f){return this.currentTransform.projectTileCoordinates(t,a,c,f)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){return this.currentTransform.lngLatToCameraDepth(t,a)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,a,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,f)}setLocationAtPoint(t,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,a),void this.apply(this._mercatorTransform,!1);this._verticalPerspectiveTransform.setLocationAtPoint(t,a),this.apply(this._verticalPerspectiveTransform,!1)}locationToScreenPoint(t,a){return this.currentTransform.locationToScreenPoint(t,a)}screenPointToMercatorCoordinate(t,a){return this.currentTransform.screenPointToMercatorCoordinate(t,a)}screenPointToLocation(t,a){return this.currentTransform.screenPointToLocation(t,a)}isPointOnMapSurface(t,a){return this.currentTransform.isPointOnMapSurface(t,a)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,a){return this.currentTransform.getMatrixForModel(t,a)}getProjectionDataForCustomLayer(t=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return a;const c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return c.fallbackMatrix=a.mainMatrix,c}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class br{get useGlobeControls(){return!0}handlePanInertia(t,a){const c=cd(t,a);return Math.abs(c.lng-a.center.lng)>180&&(c.lng=a.center.lng+179.5*Math.sign(c.lng-a.center.lng)),{easingCenter:c,easingOffset:new l.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,a){const c=t.around,f=a.screenPointToLocation(c);t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta);const _=a.zoom;t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta);const x=a.zoom-_;if(x===0)return;const S=l.bK(a.center.lng,f.lng),E=S/(Math.abs(S/180)+1),A=l.bK(a.center.lat,f.lat),R=a.getRayDirectionFromPixel(c),N=a.cameraPosition,O=-1*l.b5(N,R),$=l.bz();l.b0($,N,[R[0]*O,R[1]*O,R[2]*O]);const X=l.b7($)-1,re=Math.exp(.5*-Math.max(X-.3,0)),ae=_o(a.worldSize,a.center.lat)/Math.min(a.width,a.height),ie=l.bx(ae,.9,.5,1,.25),pe=(1-l.aq(-x))*Math.min(re,ie),Te=a.center.lat,he=a.zoom,xe=new l.V(a.center.lng+E*pe,l.an(a.center.lat+A*pe,-l.ao,l.ao));a.setLocationAtPoint(f,c);const Pe=a.center,_e=l.bx(Math.abs(S),45,85,0,1),Ce=l.bx(ae,.75,.35,0,1),je=Math.pow(Math.max(_e,Ce),.25),Le=l.bK(Pe.lng,xe.lng),Be=l.bK(Pe.lat,xe.lat);a.setCenter(new l.V(Pe.lng+Le*je,Pe.lat+Be*je).wrap()),a.setZoom(he+sr(Te,a.center.lat))}handleMapControlsPan(t,a,c){if(!t.panDelta)return;const f=a.center.lat,_=a.zoom;a.setCenter(cd(t.panDelta,a).wrap()),a.setZoom(_+sr(f,a.center.lat))}cameraForBoxAndBearing(t,a,c,f,_){const x=Hu(t,a,c,f,_),S=a.left/_.width*2-1,E=(_.width-a.right)/_.width*2-1,A=a.top/_.height*-2+1,R=(_.height-a.bottom)/_.height*-2+1,N=l.bK(c.getWest(),c.getEast())<0,O=N?c.getEast():c.getWest(),$=N?c.getWest():c.getEast(),X=Math.max(c.getNorth(),c.getSouth()),re=Math.min(c.getNorth(),c.getSouth()),ae=O+.5*l.bK(O,$),ie=X+.5*l.bK(X,re),pe=_.clone();pe.setCenter(x.center),pe.setBearing(x.bearing),pe.setPitch(0),pe.setRoll(0),pe.setZoom(x.zoom);const Te=pe.modelViewProjectionMatrix,he=[Hn(c.getNorthWest()),Hn(c.getNorthEast()),Hn(c.getSouthWest()),Hn(c.getSouthEast()),Hn(new l.V($,ie)),Hn(new l.V(O,ie)),Hn(new l.V(ae,X)),Hn(new l.V(ae,re))],xe=Hn(x.center);let Pe=Number.POSITIVE_INFINITY;for(const _e of he)S<0&&(Pe=br.getLesserNonNegativeNonNull(Pe,br.solveVectorScale(_e,xe,Te,"x",S))),E>0&&(Pe=br.getLesserNonNegativeNonNull(Pe,br.solveVectorScale(_e,xe,Te,"x",E))),A>0&&(Pe=br.getLesserNonNegativeNonNull(Pe,br.solveVectorScale(_e,xe,Te,"y",A))),R<0&&(Pe=br.getLesserNonNegativeNonNull(Pe,br.solveVectorScale(_e,xe,Te,"y",R)));if(Number.isFinite(Pe)&&Pe!==0)return x.zoom=pe.zoom+l.at(Pe),x;Ta()}handleJumpToCenterZoom(t,a){const c=t.center.lat,f=t.applyConstrain(a.center?l.V.convert(a.center):t.center,t.zoom).center;t.setCenter(f.wrap());const _=a.zoom!==void 0?+a.zoom:t.zoom+sr(c,f.lat);t.zoom!==_&&t.setZoom(_)}handleEaseTo(t,a){const c=t.zoom,f=t.center,_=t.padding,x={roll:t.roll,pitch:t.pitch,bearing:t.bearing},S={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},E=a.zoom!==void 0,A=!t.isPaddingEqual(a.padding);let R=!1;const N=a.center?l.V.convert(a.center):f,O=t.applyConstrain(N,c).center;ja(t,O);const $=t.clone();$.setCenter(O),$.setZoom(E?+a.zoom:c+sr(f.lat,N.lat)),$.setBearing(a.bearing);const X=new l.P(l.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),l.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));$.setLocationAtPoint(O,X);const re=(a.offset&&a.offsetAsPoint.mag())>0?$.center:O,ae=E?+a.zoom:c+sr(f.lat,re.lat),ie=c+sr(f.lat,0),pe=ae+sr(re.lat,0),Te=l.bK(f.lng,re.lng),he=l.bK(f.lat,re.lat),xe=l.aq(pe-ie);return R=ae!==c,{easeFunc:Pe=>{if(l.bo(x,S)||od({startEulerAngles:x,endEulerAngles:S,tr:t,k:Pe,useSlerp:x.roll!=S.roll}),A&&t.interpolatePadding(_,a.padding,Pe),a.around)l.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(a.around,a.aroundPoint);else{const _e=pe>ie?Math.min(2,xe):Math.max(.5,xe),Ce=Math.pow(_e,1-Pe),je=ud(f,Te,he,Pe*Ce);t.setCenter(je.wrap())}if(R){const _e=l.G.number(ie,pe,Pe)+sr(0,t.center.lat);t.setZoom(_e)}},isZooming:R,elevationCenter:re}}handleFlyTo(t,a){const c=a.zoom!==void 0,f=t.center,_=t.zoom,x=t.padding,S=!t.isPaddingEqual(a.padding),E=t.applyConstrain(l.V.convert(a.center||a.locationAtOffset),_).center,A=c?+a.zoom:t.zoom+sr(t.center.lat,E.lat),R=t.clone();R.setCenter(E),R.setZoom(A),R.setBearing(a.bearing);const N=new l.P(l.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),l.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));R.setLocationAtPoint(E,N);const O=R.center;ja(t,O);const $=(function(he,xe,Pe){const _e=Hn(xe),Ce=Hn(Pe),je=l.b5(_e,Ce),Le=Math.acos(je),Be=fi(he);return Le/(2*Math.PI)*Be})(t,f,O),X=_+sr(f.lat,0),re=A+sr(O.lat,0),ae=l.aq(re-X);let ie;if(typeof a.minZoom=="number"){const he=+a.minZoom+sr(O.lat,0),xe=Math.min(he,X,re)+sr(0,O.lat),Pe=t.applyConstrain(O,xe).zoom+sr(O.lat,0);ie=l.aq(Pe-X)}const pe=l.bK(f.lng,O.lng),Te=l.bK(f.lat,O.lat);return{easeFunc:(he,xe,Pe,_e)=>{const Ce=ud(f,pe,Te,Pe);S&&t.interpolatePadding(x,a.padding,he);const je=he===1?O:Ce;t.setCenter(je.wrap());const Le=X+l.at(xe);t.setZoom(he===1?A:Le+sr(0,je.lat))},scaleOfZoom:ae,targetCenter:O,scaleOfMinZoom:ie,pixelPathLength:$}}static solveVectorScale(t,a,c,f,_){const x=f==="x"?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],S=[c[3],c[7],c[11],c[15]],E=t[0]*x[0]+t[1]*x[1]+t[2]*x[2],A=t[0]*S[0]+t[1]*S[1]+t[2]*S[2],R=a[0]*x[0]+a[1]*x[1]+a[2]*x[2],N=a[0]*S[0]+a[1]*S[1]+a[2]*S[2];return R+_*A===E+_*N||S[3]*(E-R)+x[3]*(N-A)+E*N==R*A?null:(R+x[3]-_*N-_*S[3])/(R-E-_*N+_*A)}static getLesserNonNegativeNonNull(t,a){return a!==null&&a>=0&&a<t?a:t}}class hd{constructor(t){this._globe=t,this._mercatorCameraHelper=new go,this._verticalPerspectiveCameraHelper=new br}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,a){return this.currentHelper.handlePanInertia(t,a)}handleMapControlsRollPitchBearingZoom(t,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,a)}handleMapControlsPan(t,a,c){this.currentHelper.handleMapControlsPan(t,a,c)}cameraForBoxAndBearing(t,a,c,f,_){return this.currentHelper.cameraForBoxAndBearing(t,a,c,f,_)}handleJumpToCenterZoom(t,a){this.currentHelper.handleJumpToCenterZoom(t,a)}handleEaseTo(t,a){return this.currentHelper.handleEaseTo(t,a)}handleFlyTo(t,a){return this.currentHelper.handleFlyTo(t,a)}}const ds=(g,t)=>l.B(g,t&&t.filter((a=>a.identifier!=="source.canvas"))),ol=l.bO();class yo extends l.E{constructor(t,a={}){var c,f;super(),this._rtlPluginLoaded=()=>{for(const x in this.tileManagers){const S=this.tileManagers[x].getSource().type;S!=="vector"&&S!=="geojson"||this.tileManagers[x].reload()}},this.map=t,this.dispatcher=new _t(ot(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((x,S)=>this.getGlyphs(x,S))),this.dispatcher.registerMessageHandler("GI",((x,S)=>this.getImages(x,S))),this.dispatcher.registerMessageHandler("GDA",((x,S)=>this.getDashes(x,S))),this.imageManager=new qe,this.imageManager.setEventedParent(this);const _=((c=t._container)===null||c===void 0?void 0:c.lang)||typeof document<"u"&&((f=document.documentElement)===null||f===void 0?void 0:f.lang)||void 0;this.glyphManager=new Qe(t._requestManager,a.localIdeographFontFamily,_),this.lineAtlas=new xt(256,512),this.crossTileSymbolIndex=new mi,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",l.bP()),ve().on(Se,this._rtlPluginLoaded),this.on("data",(x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const S=this.tileManagers[x.sourceId];if(!S)return;const E=S.getSource();if(E&&E.vectorLayerIds)for(const A in this._layers){const R=this._layers[A];R.source===E.id&&this._validateLayer(R)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new l.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,a){var c,f,_;this._checkLoaded();const x=a===null?(_=(f=(c=this.stylesheet.state)===null||c===void 0?void 0:c[t])===null||f===void 0?void 0:f.default)!==null&&_!==void 0?_:null:a;if(l.bR(x,this._globalState[t]))return this;this._globalState[t]=x,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const a=[];for(const c in t)!l.bR(this._globalState[c],t[c].default)&&(a.push(c),this._globalState[c]=t[c].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(t){if(t.length===0)return;const a=new Set,c={};for(const f of t){c[f]=this._globalState[f];for(const _ in this._layers){const x=this._layers[_],S=x.getLayoutAffectingGlobalStateRefs(),E=x.getPaintAffectingGlobalStateRefs(),A=x.getVisibilityAffectingGlobalStateRefs();if(S.has(f)&&a.add(x.source),E.has(f))for(const{name:R,value:N}of E.get(f))this._updatePaintProperty(x,R,N);A?.has(f)&&(x.recalculateVisibility(),this._updateLayer(x))}}this.dispatcher.broadcast("UGS",c);for(const f in this.tileManagers)a.has(f)&&(this._reloadSource(f),this._changed=!0)}loadURL(t,a={},c){this.fire(new l.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const f=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const _=this._loadStyleRequest;l.j(f,this._loadStyleRequest).then((x=>{this._loadStyleRequest=null,this._load(x.data,a,c)})).catch((x=>{this._loadStyleRequest=null,x&&!_.signal.aborted&&this.fire(new l.k(x))}))}loadJSON(t,a={},c){this.fire(new l.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,G.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,c)})).catch((()=>{}))}loadEmpty(){this.fire(new l.l("dataloading",{dataType:"style"})),this._load(ol,{validate:!1})}_load(t,a,c){var f,_;let x=a.transformStyle?a.transformStyle(c,t):t;if(!a.validate||!ds(this,l.C(x))){x=Object.assign({},x),this._loaded=!0,this.stylesheet=x;for(const S in x.sources)this.addSource(S,x.sources[S],{validate:!1});x.sprite?this._loadSprite(x.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(x.glyphs),this._createLayers(),this.light=new zt(this.stylesheet.light),this._setProjectionInternal(((f=this.stylesheet.projection)===null||f===void 0?void 0:f.type)||"mercator"),this.sky=new ct(this.stylesheet.sky),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.fire(new l.l("data",{dataType:"style"})),this.fire(new l.l("style.load"))}}_createLayers(){var t,a,c;const f=l.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",f),this._order=f.map((_=>_.id)),this._layers={},this._serializedLayers=null;for(const _ of f){const x=l.bT(_,this._globalState);if(x.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=x,l.bU(x)&&this.tileManagers[x.source]){const S=(c=(a=_.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&c!==void 0?c:x.paint.get("raster-fade-duration");this.tileManagers[x.source].setRasterFadeDuration(S)}}}_loadSprite(t,a=!1,c=void 0){this.imageManager.setLoaded(!1);const f=new AbortController;let _;this._spriteRequest=f,(function(x,S,E,A){return l._(this,void 0,void 0,(function*(){const R=be(x),N=E>1?"@2x":"",O={},$={};for(const{id:X,url:re}of R){const ae=S.transformRequest(Re(re,N,".json"),"SpriteJSON");O[X]=l.j(ae,A);const ie=S.transformRequest(Re(re,N,".png"),"SpriteImage");$[X]=ue.getImage(ie,A)}return yield Promise.all([...Object.values(O),...Object.values($)]),(function(X,re){return l._(this,void 0,void 0,(function*(){const ae={};for(const ie in X){ae[ie]={};const pe=G.getImageCanvasContext((yield re[ie]).data),Te=(yield X[ie]).data;for(const he in Te){const{width:xe,height:Pe,x:_e,y:Ce,sdf:je,pixelRatio:Le,stretchX:Be,stretchY:Oe,content:lt,textFitWidth:ut,textFitHeight:nt}=Te[he];ae[ie][he]={data:null,pixelRatio:Le,sdf:je,stretchX:Be,stretchY:Oe,content:lt,textFitWidth:ut,textFitHeight:nt,spriteData:{width:xe,height:Pe,x:_e,y:Ce,context:pe}}}}return ae}))})(O,$)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((x=>{if(this._spriteRequest=null,x)for(const S in x){this._spritesImagesIds[S]=[];const E=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter((A=>!(A in x))):[];for(const A of E)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in x[S]){const R=S==="default"?A:`${S}:${A}`;this._spritesImagesIds[S].push(R),R in this.imageManager.images?this.imageManager.updateImage(R,x[S][A],!1):this.imageManager.addImage(R,x[S][A]),a&&(this._changedImages[R]=!0)}}})).catch((x=>{this._spriteRequest=null,_=x,f.signal.aborted||this.fire(new l.k(_))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"})),c&&c(_)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}_validateLayer(t){const a=this.tileManagers[t.source];if(!a)return;const c=t.sourceLayer;if(!c)return;const f=a.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(c)===-1)&&this.fire(new l.k(new Error(`Source layer "${c}" does not exist on source "${f.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,a=!1){const c=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a?l.bV(c):c);const f=[];for(const _ of t)if(c[_]){const x=a?l.bV(c[_]):c[_];f.push(x)}return f}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const c of a){const f=this._layers[c];f.type!=="custom"&&(t[c]=f.serialize())}return t}hasTransitions(){var t,a,c;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((c=this.projection)===null||c===void 0)&&c.hasTransition())return!0;for(const f in this.tileManagers)if(this.tileManagers[f].hasTransition())return!0;for(const f in this._layers)if(this._layers[f].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(a){const f=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(f.length||_.length)&&this._updateWorkerLayers(f,_);for(const x in this._updatedSources){const S=this._updatedSources[x];if(S==="reload")this._reloadSource(x);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const c={};for(const f in this.tileManagers){const _=this.tileManagers[f];c[f]=_.used,_.used=!1}for(const f of this._order){const _=this._layers[f];_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)&&_.source&&(this.tileManagers[_.source].used=!0)}for(const f in c){const _=this.tileManagers[f];!!c[f]!=!!_.used&&_.fire(new l.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,a&&this.fire(new l.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var c;this._checkLoaded();const f=this.serialize();if(t=a.transformStyle?a.transformStyle(f,t):t,((c=a.validate)===null||c===void 0||c)&&ds(this,l.C(t)))return!1;(t=l.bV(t)).layers=l.bS(t.layers);const _=l.bW(f,t),x=this._getOperationsToPerform(_);if(x.unimplemented.length>0)throw new Error(`Unimplemented: ${x.unimplemented.join(", ")}.`);if(x.operations.length===0)return!1;for(const S of x.operations)S();return this.stylesheet=t,this._serializedLayers=null,this.fire(new l.l("style.load",{style:this})),!0}_getOperationsToPerform(t){const a=[],c=[];for(const f of t)switch(f.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,f.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,f.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,f.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,f.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,f.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,f.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,f.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,f.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,f.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,f.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,f.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,f.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,f.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,f.args)));break;case"setProjection":this.setProjection.apply(this,f.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,f.args)));break;case"setTransition":a.push((()=>{}));break;default:c.push(f.command)}return{operations:a,unimplemented:c}}addImage(t,a){if(this.getImage(t))return this.fire(new l.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,c={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(l.C.source,`sources.${t}`,a,null,c))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const f=this.tileManagers[t]=new zi(t,a,this.dispatcher);f.style=this,f.setEventedParent(this,(()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:t}))),f.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===t)return this.fire(new l.k(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));const a=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],a.fire(new l.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const c=this.tileManagers[t].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(a),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,a,c={}){this._checkLoaded();const f=t.id;if(this.getLayer(f))return void this.fire(new l.k(new Error(`Layer "${f}" already exists on this map.`)));let _;if(t.type==="custom"){if(ds(this,l.bX(t)))return;_=l.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(f,t.source),t=l.bV(t),t=l.e(t,{source:f})),this._validate(l.C.layer,`layers.${f}`,t,{arrayIndex:-1},c))return;_=l.bT(t,this._globalState),this._validateLayer(_),_.setEventedParent(this,{layer:{id:f}})}const x=a?this._order.indexOf(a):this._order.length;if(a&&x===-1)this.fire(new l.k(new Error(`Cannot add layer "${f}" before non-existing layer "${a}".`)));else{if(this._order.splice(x,0,f),this._layerOrderChanged=!0,this._layers[f]=_,this._removedLayers[f]&&_.source&&_.type!=="custom"){const S=this._removedLayers[f];delete this._removedLayers[f],S.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.tileManagers[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const c=this._order.indexOf(t);this._order.splice(c,1);const f=a?this._order.indexOf(a):this._order.length;a&&f===-1?this.fire(new l.k(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(f,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new l.k(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,c){this._checkLoaded();const f=this.getLayer(t);f?f.minzoom===a&&f.maxzoom===c||(a!=null&&(f.minzoom=a),c!=null&&(f.maxzoom=c),this._updateLayer(f)):this.fire(new l.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,c={}){this._checkLoaded();const f=this.getLayer(t);if(f){if(!l.bR(f.filter,a))return a==null?(f.setFilter(void 0),void this._updateLayer(f)):void(this._validate(l.C.filter,`layers.${f.id}.filter`,a,null,c)||(f.setFilter(l.bV(a)),this._updateLayer(f)))}else this.fire(new l.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return l.bV(this.getLayer(t).filter)}setLayoutProperty(t,a,c,f={}){this._checkLoaded();const _=this.getLayer(t);_?l.bR(_.getLayoutProperty(a),c)||(_.setLayoutProperty(a,c,f),this._updateLayer(_)):this.fire(new l.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const c=this.getLayer(t);if(c)return c.getLayoutProperty(a);this.fire(new l.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,c,f={}){this._checkLoaded();const _=this.getLayer(t);_?l.bR(_.getPaintProperty(a),c)||this._updatePaintProperty(_,a,c,f):this.fire(new l.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,a,c,f={}){t.setPaintProperty(a,c,f)&&this._updateLayer(t),l.bU(t)&&a==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(c),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const c=t.source,f=t.sourceLayer,_=this.tileManagers[c];if(_===void 0)return void this.fire(new l.k(new Error(`The source '${c}' does not exist in the map's style.`)));const x=_.getSource().type;x==="geojson"&&f?this.fire(new l.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||f?(t.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),_.setFeatureState(f,t.id,a)):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const c=t.source,f=this.tileManagers[c];if(f===void 0)return void this.fire(new l.k(new Error(`The source '${c}' does not exist in the map's style.`)));const _=f.getSource().type,x=_==="vector"?t.sourceLayer:void 0;_!=="vector"||x?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new l.k(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(x,t.id,a):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,c=t.sourceLayer,f=this.tileManagers[a];if(f!==void 0)return f.getSource().type!=="vector"||c?(t.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),f.getFeatureState(c,t.id)):void this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=l.bY(this.tileManagers,(_=>_.serialize())),a=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,f=this.stylesheet;return l.bZ({version:f.version,name:f.name,metadata:f.metadata,light:f.light,sky:f.sky,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,projection:f.projection,sources:t,layers:a,terrain:c},(_=>_!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=x=>this._layers[x].type==="fill-extrusion",c={},f=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(a(S)){c[S]=x;for(const E of t){const A=E[S];if(A)for(const R of A)f.push(R)}}}f.sort(((x,S)=>S.intersectionZ-x.intersectionZ));const _=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(a(S))for(let E=f.length-1;E>=0;E--){const A=f[E].feature;if(c[A.layer.id]<x)break;_.push(A),f.pop()}else for(const E of t){const A=E[S];if(A)for(const R of A)_.push(R.feature)}}return _}queryRenderedFeatures(t,a,c){a&&a.filter&&this._validate(l.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);const f={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new l.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const A of a.layers){const R=this._layers[A];if(!R)return this.fire(new l.k(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];f[R.source]=!0}}const _=[];a.availableImages=this._availableImages;const x=this._serializedAllLayers(),S=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,E=Object.assign(Object.assign({},a),{layers:S,globalState:this._globalState});for(const A in this.tileManagers)a.layers&&!f[A]||_.push(Pn(this.tileManagers[A],this._layers,x,t,E,c,this.map.terrain?(R,N,O)=>this.map.terrain.getElevation(R,N,O):void 0));return this.placement&&_.push((function(A,R,N,O,$,X,re){const ae={},ie=X.queryRenderedSymbols(O),pe=[];for(const Te of Object.keys(ie).map(Number))pe.push(re[Te]);pe.sort(Nt);for(const Te of pe){const he=Te.featureIndex.lookupSymbolFeatures(ie[Te.bucketInstanceId],R,Te.bucketIndex,Te.sourceLayerIndex,{filterSpec:$.filter,globalState:$.globalState},$.layers,$.availableImages,A);for(const xe in he){const Pe=ae[xe]=ae[xe]||[],_e=he[xe];_e.sort(((Ce,je)=>{const Le=Te.featureSortOrder;if(Le){const Be=Le.indexOf(Ce.featureIndex);return Le.indexOf(je.featureIndex)-Be}return je.featureIndex-Ce.featureIndex}));for(const Ce of _e)Pe.push(Ce)}}return(function(Te,he,xe){for(const Pe in Te)for(const _e of Te[Pe])Jt(_e,xe[he[Pe].source]);return Te})(ae,A,N)})(this._layers,x,this.tileManagers,t,E,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,a){a?.filter&&this._validate(l.C.filter,"querySourceFeatures.filter",a.filter,null,a);const c=this.tileManagers[t];return c?(function(f,_){const x=f.getRenderableIds().map((A=>f.getTileByID(A))),S=[],E={};for(let A=0;A<x.length;A++){const R=x[A],N=R.tileID.canonical.key;E[N]||(E[N]=!0,R.querySourceFeatures(S,_))}return S})(c,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const c=this.light.getLight();let f=!1;for(const x in t)if(!l.bR(t[x],c[x])){f=!0;break}if(!f)return;const _={now:ee(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(_)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,a={}){this._checkLoaded();const c=this.getSky();let f=!1;if(!t&&!c)return;if(t&&!c)f=!0;else if(!t&&c)f=!0;else for(const x in t)if(!l.bR(t[x],c[x])){f=!0;break}if(!f)return;const _={now:ee(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,a),this.sky.updateTransitions(_)}_setProjectionInternal(t){const a=(function(c,f){const _={constrainOverride:f};if(Array.isArray(c)){const x=new ld({type:c});return{projection:x,transform:new fs(_),cameraHelper:new hd(x)}}switch(c){case"mercator":return{projection:new hi,transform:new mo(_),cameraHelper:new go};case"globe":{const x=new ld({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:x,transform:new fs(_),cameraHelper:new hd(x)}}case"vertical-perspective":return{projection:new Xu,transform:new hs(_),cameraHelper:new br};default:return l.w(`Unknown projection name: ${c}. Falling back to mercator projection.`),{projection:new hi,transform:new mo(_),cameraHelper:new go}}})(t,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const c in this.tileManagers)this.tileManagers[c].reload()}_validate(t,a,c,f,_={}){return(!_||_.validate!==!1)&&ds(this,t.call(l.C,l.e({key:a,style:this.serialize(),value:c,styleSpec:l.u},f)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ve().off(Se,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.tileManagers){const c=this.tileManagers[a];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const a in this.tileManagers)this.tileManagers[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,a,c,f,_=!1){let x=!1,S=!1;const E={};for(const A of this._order){const R=this._layers[A];if(R.type!=="symbol")continue;if(!E[R.source]){const O=this.tileManagers[R.source];E[R.source]=O.getRenderableIds(!0).map(($=>O.getTileByID($))).sort((($,X)=>X.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(X.tileID)?-1:1)))}const N=this.crossTileSymbolIndex.addLayer(R,E[R.source],t.center.lng);x=x||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ee(),t.zoom))&&(this.pauseablePlacement=new is(t,this.map.terrain,this._order,_,a,c,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ee()),S=!0),x&&this.pauseablePlacement.placement.setStale()),S||x)for(const A of this._order){const R=this._layers[A];R.type==="symbol"&&this.placement.updateLayerOpacities(R,E[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ee())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,a){return l._(this,void 0,void 0,(function*(){const c=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const f=this.tileManagers[a.source];return f&&f.setDependencies(a.tileID.key,a.type,a.icons),c}))}getGlyphs(t,a){return l._(this,void 0,void 0,(function*(){const c=yield this.glyphManager.getGlyphs(a.stacks),f=this.tileManagers[a.source];return f&&f.setDependencies(a.tileID.key,a.type,[""]),c}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(l.C.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,a){return l._(this,void 0,void 0,(function*(){const c={};for(const[f,_]of Object.entries(a.dashes))c[f]=this.lineAtlas.getDash(_.dasharray,_.round);return c}))}addSprite(t,a,c={},f){this._checkLoaded();const _=[{id:t,url:a}],x=[...be(this.stylesheet.sprite),..._];this._validate(l.C.sprite,"sprite",x,null,c)||(this.stylesheet.sprite=x,this._loadSprite(_,!0,f))}removeSprite(t){this._checkLoaded();const a=be(this.stylesheet.sprite);if(a.find((c=>c.id===t))){if(this._spritesImagesIds[t])for(const c of this._spritesImagesIds[t])this.imageManager.removeImage(c),this._changedImages[c]=!0;a.splice(a.findIndex((c=>c.id===t)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}else this.fire(new l.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return be(this.stylesheet.sprite)}setSprite(t,a={},c){this._checkLoaded(),t&&this._validate(l.C.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,c):(this._unloadSprite(),c&&c(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const a=this.tileManagers[t];a.setEventedParent(null),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const a=this._layers[t];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var dg=l.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class gc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,c,f,_,x,S,E,A){this.context=t;let R=this.boundPaintVertexBuffers.length!==f.length;for(let N=0;!R&&N<f.length;N++)this.boundPaintVertexBuffers[N]!==f[N]&&(R=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==c||R||this.boundIndexBuffer!==_||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==A?this.freshBind(a,c,f,_,x,S,E,A):(t.bindVertexArray.set(this.vao),S&&S.bind(),_&&_.dynamicDraw&&_.bind(),E&&E.bind(),A&&A.bind())}freshBind(t,a,c,f,_,x,S,E){const A=t.numAttributes,R=this.context,N=R.gl;this.vao&&this.destroy(),this.vao=R.createVertexArray(),R.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=f,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=E,a.enableAttributes(N,t);for(const O of c)O.enableAttributes(N,t);x&&x.enableAttributes(N,t),S&&S.enableAttributes(N,t),E&&E.enableAttributes(N,t),a.bind(),a.setVertexAttribPointers(N,t,_);for(const O of c)O.bind(),O.setVertexAttribPointers(N,t,_);x&&(x.bind(),x.setVertexAttribPointers(N,t,_)),f&&f.bind(),S&&(S.bind(),S.setVertexAttribPointers(N,t,_)),E&&(E.bind(),E.setVertexAttribPointers(N,t,_)),R.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const pg=(g,t,a,c,f)=>({u_texture:0,u_ele_delta:g,u_fog_matrix:t,u_fog_color:a?a.properties.get("fog-color"):l.bp.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:f?0:a?a.calculateFogBlendOpacity(c):0,u_horizon_color:a?a.properties.get("horizon-color"):l.bp.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:f?1:0}),ps={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function _c(g){const t=[];for(let a=0;a<g.length;a++){if(g[a]===null)continue;const c=g[a].split(" ");t.push(c.pop())}return t}class fd{constructor(t,a,c,f,_,x,S,E,A=[]){const R=t.gl;this.program=R.createProgram();const N=_c(a.staticAttributes),O=c?c.getBinderAttributes():[],$=N.concat(O),X=tr.prelude.staticUniforms?_c(tr.prelude.staticUniforms):[],re=S.staticUniforms?_c(S.staticUniforms):[],ae=a.staticUniforms?_c(a.staticUniforms):[],ie=c?c.getBinderUniforms():[],pe=X.concat(re).concat(ae).concat(ie),Te=[];for(const Le of pe)Te.indexOf(Le)<0&&Te.push(Le);const he=c?c.defines():[];Ri(R)&&he.unshift("#version 300 es"),_&&he.push("#define OVERDRAW_INSPECTOR;"),x&&he.push("#define TERRAIN3D;"),E&&he.push(E),A&&he.push(...A);let xe=he.concat(tr.prelude.fragmentSource,S.fragmentSource,a.fragmentSource).join(`
`),Pe=he.concat(tr.prelude.vertexSource,S.vertexSource,a.vertexSource).join(`
`);Ri(R)||(xe=(function(Le){return Le.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(xe),Pe=(function(Le){return Le.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Pe));const _e=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(_e,xe),R.compileShader(_e),!R.getShaderParameter(_e,R.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${R.getShaderInfoLog(_e)}`);R.attachShader(this.program,_e);const Ce=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(Ce,Pe),R.compileShader(Ce),!R.getShaderParameter(Ce,R.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${R.getShaderInfoLog(Ce)}`);R.attachShader(this.program,Ce),this.attributes={};const je={};this.numAttributes=$.length;for(let Le=0;Le<this.numAttributes;Le++)$[Le]&&(R.bindAttribLocation(this.program,Le,$[Le]),this.attributes[$[Le]]=Le);if(R.linkProgram(this.program),!R.getProgramParameter(this.program,R.LINK_STATUS))throw new Error(`Program failed to link: ${R.getProgramInfoLog(this.program)}`);R.deleteShader(Ce),R.deleteShader(_e);for(let Le=0;Le<Te.length;Le++){const Be=Te[Le];if(Be&&!je[Be]){const Oe=R.getUniformLocation(this.program,Be);Oe&&(je[Be]=Oe)}}this.fixedUniforms=f(t,je),this.terrainUniforms=((Le,Be)=>({u_depth:new l.b_(Le,Be.u_depth),u_terrain:new l.b_(Le,Be.u_terrain),u_terrain_dim:new l.bq(Le,Be.u_terrain_dim),u_terrain_matrix:new l.c0(Le,Be.u_terrain_matrix),u_terrain_unpack:new l.c1(Le,Be.u_terrain_unpack),u_terrain_exaggeration:new l.bq(Le,Be.u_terrain_exaggeration)}))(t,je),this.projectionUniforms=((Le,Be)=>({u_projection_matrix:new l.c0(Le,Be.u_projection_matrix),u_projection_tile_mercator_coords:new l.c1(Le,Be.u_projection_tile_mercator_coords),u_projection_clipping_plane:new l.c1(Le,Be.u_projection_clipping_plane),u_projection_transition:new l.bq(Le,Be.u_projection_transition),u_projection_fallback_matrix:new l.c0(Le,Be.u_projection_fallback_matrix)}))(t,je),this.binderUniforms=c?c.getUniforms(t,je):[]}draw(t,a,c,f,_,x,S,E,A,R,N,O,$,X,re,ae,ie,pe,Te){const he=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(f),t.setColorMode(_),t.setCullFace(x),E){t.activeTexture.set(he.TEXTURE2),he.bindTexture(he.TEXTURE_2D,E.depthTexture),t.activeTexture.set(he.TEXTURE3),he.bindTexture(he.TEXTURE_2D,E.texture);for(const Pe in this.terrainUniforms)this.terrainUniforms[Pe].set(E[Pe])}if(A)for(const Pe in A)this.projectionUniforms[ps[Pe]].set(A[Pe]);if(S)for(const Pe in this.fixedUniforms)this.fixedUniforms[Pe].set(S[Pe]);ae&&ae.setUniforms(t,this.binderUniforms,X,{zoom:re});let xe=0;switch(a){case he.LINES:xe=2;break;case he.TRIANGLES:xe=3;break;case he.LINE_STRIP:xe=1}for(const Pe of $.get()){const _e=Pe.vaos||(Pe.vaos={});(_e[R]||(_e[R]=new gc)).bind(t,this,N,ae?ae.getPaintVertexBuffers():[],O,Pe.vertexOffset,ie,pe,Te),he.drawElements(a,Pe.primitiveLength*xe,he.UNSIGNED_SHORT,Pe.primitiveOffset*xe*2)}}}function dd(g,t,a){const c=1/l.aN(a,1,t.transform.tileZoom),f=Math.pow(2,a.tileID.overscaledZ),_=a.tileSize*Math.pow(2,t.transform.tileZoom)/f,x=_*(a.tileID.canonical.x+a.tileID.wrap*f),S=_*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[c,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[x>>16,S>>16],u_pixel_coord_lower:[65535&x,65535&S]}}const Qu=(g,t,a,c)=>{const f=g.style.light,_=f.properties.get("position"),x=[_.x,_.y,_.z],S=l.c4();f.properties.get("anchor")==="viewport"&&l.c5(S,g.transform.bearingInRadians),l.c6(x,x,S);const E=g.transform.transformLightDirection(x),A=f.properties.get("color");return{u_lightpos:x,u_lightpos_globe:E,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+t,u_opacity:a,u_fill_translate:c}},eh=(g,t,a,c,f,_,x)=>l.e(Qu(g,t,a,c),dd(_,g,x),{u_height_factor:-Math.pow(2,f.overscaledZ)/x.tileSize/8}),th=(g,t,a,c)=>l.e(dd(t,g,a),{u_fill_translate:c}),pd=(g,t)=>({u_world:g,u_fill_translate:t}),md=(g,t,a,c,f)=>l.e(th(g,t,a,f),{u_world:c}),gd=(g,t,a,c,f)=>{const _=g.transform;let x,S,E=0;if(a.paint.get("circle-pitch-alignment")==="map"){const A=l.aN(t,1,_.zoom);x=!0,S=[A,A],E=A/(l.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*f}else x=!1,S=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+x,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:S,u_globe_extrude_scale:E,u_translate:c}},vo=g=>({u_pixel_extrude_scale:[1/g.width,1/g.height]}),_d=g=>({u_viewport_size:[g.width,g.height]}),nh=(g,t=1)=>({u_color:g,u_overlay:0,u_overlay_scale:t}),ms=(g,t,a,c)=>{const f=l.aN(g,1,t)/(l.a5*Math.pow(2,g.tileID.overscaledZ))*2*Math.PI*c;return{u_extrude_scale:l.aN(g,1,t),u_intensity:a,u_globe_extrude_scale:f}},yd=(g,t,a,c)=>{const f=l.N();l.c7(f,0,g.width,g.height,0,0,1);const _=g.context.gl;return{u_matrix:f,u_world:[_.drawingBufferWidth,_.drawingBufferHeight],u_image:a,u_color_ramp:c,u_opacity:t.paint.get("heatmap-opacity")}},yc=(g,t,a)=>{const c=a.paint.get("hillshade-accent-color");let f;switch(a.paint.get("hillshade-method")){case"basic":f=4;break;case"combined":f=1;break;case"igor":f=2;break;case"multidirectional":f=3;break;default:f=0}const _=a.getIlluminationProperties();for(let x=0;x<_.directionRadians.length;x++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(_.directionRadians[x]+=g.transform.bearingInRadians);return{u_image:0,u_latrange:gg(0,t.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:_.altitudeRadians,u_azimuths:_.directionRadians,u_accent:c,u_method:f,u_highlights:_.highlightColor,u_shadows:_.shadowColor}},mg=(g,t)=>{const a=t.stride,c=l.N();return l.c7(c,0,l.a5,-l.a5,0,0,1),l.O(c,c,[0,-l.a5,0]),{u_matrix:c,u_image:1,u_dimension:[a,a],u_zoom:g.overscaledZ,u_unpack:t.getUnpackVector()}};function gg(g,t){const a=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new l.a9(0,c/a).toLngLat().lat,new l.a9(0,(c+1)/a).toLngLat().lat]}const vd=(g,t,a=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:g.paint.get("color-relief-opacity")}),sl=(g,t,a,c)=>{const f=g.transform;return{u_translation:xc(g,t,a),u_ratio:c/l.aN(t,1,f.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},xd=(g,t,a,c,f)=>l.e(sl(g,t,a,c),{u_image:0,u_image_height:f}),rh=(g,t,a,c,f)=>{const _=g.transform,x=Hi(t,_);return{u_translation:xc(g,t,a),u_texsize:t.imageAtlasTexture.size,u_ratio:c/l.aN(t,1,_.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[x,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},bd=(g,t,a,c,f)=>{const _=Hi(t,g.transform);return l.e(sl(g,t,a,c),{u_tileratio:_,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image:0,u_mix:f.t,u_lineatlas_width:g.lineAtlas.width,u_lineatlas_height:g.lineAtlas.height})},vc=(g,t,a,c,f,_)=>{const x=Hi(t,g.transform);return l.e(sl(g,t,a,c),{u_image:0,u_image_height:_,u_tileratio:x,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image_dash:1,u_mix:f.t,u_lineatlas_width:g.lineAtlas.width,u_lineatlas_height:g.lineAtlas.height})};function Hi(g,t){return 1/l.aN(g,1,t.tileZoom)}function xc(g,t,a){return l.aO(g.transform,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const ih=(g,t,a,c,f)=>{return{u_tl_parent:g,u_scale_parent:t,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(x=c.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(_=c.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:ah(c.paint.get("raster-hue-rotate")),u_coords_top:[f[0].x,f[0].y,f[1].x,f[1].y],u_coords_bottom:[f[3].x,f[3].y,f[2].x,f[2].y]};var _,x};function ah(g){g*=Math.PI/180;const t=Math.sin(g),a=Math.cos(g);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const oh=(g,t,a,c,f,_,x,S,E,A,R,N,O)=>{const $=x.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:$.width/$.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_label_plane_matrix:S,u_coord_matrix:E,u_is_text:+R,u_pitch_with_map:+c,u_is_along_line:f,u_is_variable_anchor:_,u_texsize:N,u_texture:0,u_translation:A,u_pitched_scale:O}},bc=(g,t,a,c,f,_,x,S,E,A,R,N,O,$)=>{const X=x.transform;return l.e(oh(g,t,a,c,f,_,x,S,E,A,R,N,$),{u_gamma_scale:c?Math.cos(X.pitch*Math.PI/180)*X.cameraToCenterDistance:1,u_device_pixel_ratio:x.pixelRatio,u_is_halo:1})},xo=(g,t,a,c,f,_,x,S,E,A,R,N,O)=>l.e(bc(g,t,a,c,f,_,x,S,E,A,!0,R,0,O),{u_texsize_icon:N,u_texture_icon:1}),sh=(g,t)=>({u_opacity:g,u_color:t}),_g=(g,t,a,c,f)=>l.e((function(_,x,S,E){const A=S.imageManager.getPattern(_.from.toString()),R=S.imageManager.getPattern(_.to.toString()),{width:N,height:O}=S.imageManager.getPixelSize(),$=Math.pow(2,E.tileID.overscaledZ),X=E.tileSize*Math.pow(2,S.transform.tileZoom)/$,re=X*(E.tileID.canonical.x+E.tileID.wrap*$),ae=X*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[N,O],u_mix:x.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:x.fromScale,u_scale_b:x.toScale,u_tile_units_to_pixels:1/l.aN(E,1,S.transform.tileZoom),u_pixel_coord_upper:[re>>16,ae>>16],u_pixel_coord_lower:[65535&re,65535&ae]}})(a,f,t,c),{u_opacity:g}),wd=(g,t)=>{},yg={fillExtrusion:(g,t)=>({u_lightpos:new l.c2(g,t.u_lightpos),u_lightpos_globe:new l.c2(g,t.u_lightpos_globe),u_lightintensity:new l.bq(g,t.u_lightintensity),u_lightcolor:new l.c2(g,t.u_lightcolor),u_vertical_gradient:new l.bq(g,t.u_vertical_gradient),u_opacity:new l.bq(g,t.u_opacity),u_fill_translate:new l.c3(g,t.u_fill_translate)}),fillExtrusionPattern:(g,t)=>({u_lightpos:new l.c2(g,t.u_lightpos),u_lightpos_globe:new l.c2(g,t.u_lightpos_globe),u_lightintensity:new l.bq(g,t.u_lightintensity),u_lightcolor:new l.c2(g,t.u_lightcolor),u_vertical_gradient:new l.bq(g,t.u_vertical_gradient),u_height_factor:new l.bq(g,t.u_height_factor),u_opacity:new l.bq(g,t.u_opacity),u_fill_translate:new l.c3(g,t.u_fill_translate),u_image:new l.b_(g,t.u_image),u_texsize:new l.c3(g,t.u_texsize),u_pixel_coord_upper:new l.c3(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(g,t.u_pixel_coord_lower),u_scale:new l.c2(g,t.u_scale),u_fade:new l.bq(g,t.u_fade)}),fill:(g,t)=>({u_fill_translate:new l.c3(g,t.u_fill_translate)}),fillPattern:(g,t)=>({u_image:new l.b_(g,t.u_image),u_texsize:new l.c3(g,t.u_texsize),u_pixel_coord_upper:new l.c3(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(g,t.u_pixel_coord_lower),u_scale:new l.c2(g,t.u_scale),u_fade:new l.bq(g,t.u_fade),u_fill_translate:new l.c3(g,t.u_fill_translate)}),fillOutline:(g,t)=>({u_world:new l.c3(g,t.u_world),u_fill_translate:new l.c3(g,t.u_fill_translate)}),fillOutlinePattern:(g,t)=>({u_world:new l.c3(g,t.u_world),u_image:new l.b_(g,t.u_image),u_texsize:new l.c3(g,t.u_texsize),u_pixel_coord_upper:new l.c3(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(g,t.u_pixel_coord_lower),u_scale:new l.c2(g,t.u_scale),u_fade:new l.bq(g,t.u_fade),u_fill_translate:new l.c3(g,t.u_fill_translate)}),circle:(g,t)=>({u_camera_to_center_distance:new l.bq(g,t.u_camera_to_center_distance),u_scale_with_map:new l.b_(g,t.u_scale_with_map),u_pitch_with_map:new l.b_(g,t.u_pitch_with_map),u_extrude_scale:new l.c3(g,t.u_extrude_scale),u_device_pixel_ratio:new l.bq(g,t.u_device_pixel_ratio),u_globe_extrude_scale:new l.bq(g,t.u_globe_extrude_scale),u_translate:new l.c3(g,t.u_translate)}),collisionBox:(g,t)=>({u_pixel_extrude_scale:new l.c3(g,t.u_pixel_extrude_scale)}),collisionCircle:(g,t)=>({u_viewport_size:new l.c3(g,t.u_viewport_size)}),debug:(g,t)=>({u_color:new l.b$(g,t.u_color),u_overlay:new l.b_(g,t.u_overlay),u_overlay_scale:new l.bq(g,t.u_overlay_scale)}),depth:wd,clippingMask:wd,heatmap:(g,t)=>({u_extrude_scale:new l.bq(g,t.u_extrude_scale),u_intensity:new l.bq(g,t.u_intensity),u_globe_extrude_scale:new l.bq(g,t.u_globe_extrude_scale)}),heatmapTexture:(g,t)=>({u_matrix:new l.c0(g,t.u_matrix),u_world:new l.c3(g,t.u_world),u_image:new l.b_(g,t.u_image),u_color_ramp:new l.b_(g,t.u_color_ramp),u_opacity:new l.bq(g,t.u_opacity)}),hillshade:(g,t)=>({u_image:new l.b_(g,t.u_image),u_latrange:new l.c3(g,t.u_latrange),u_exaggeration:new l.bq(g,t.u_exaggeration),u_altitudes:new l.c9(g,t.u_altitudes),u_azimuths:new l.c9(g,t.u_azimuths),u_accent:new l.b$(g,t.u_accent),u_method:new l.b_(g,t.u_method),u_shadows:new l.c8(g,t.u_shadows),u_highlights:new l.c8(g,t.u_highlights)}),hillshadePrepare:(g,t)=>({u_matrix:new l.c0(g,t.u_matrix),u_image:new l.b_(g,t.u_image),u_dimension:new l.c3(g,t.u_dimension),u_zoom:new l.bq(g,t.u_zoom),u_unpack:new l.c1(g,t.u_unpack)}),colorRelief:(g,t)=>({u_image:new l.b_(g,t.u_image),u_unpack:new l.c1(g,t.u_unpack),u_dimension:new l.c3(g,t.u_dimension),u_elevation_stops:new l.b_(g,t.u_elevation_stops),u_color_stops:new l.b_(g,t.u_color_stops),u_color_ramp_size:new l.b_(g,t.u_color_ramp_size),u_opacity:new l.bq(g,t.u_opacity)}),line:(g,t)=>({u_translation:new l.c3(g,t.u_translation),u_ratio:new l.bq(g,t.u_ratio),u_device_pixel_ratio:new l.bq(g,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(g,t.u_units_to_pixels)}),lineGradient:(g,t)=>({u_translation:new l.c3(g,t.u_translation),u_ratio:new l.bq(g,t.u_ratio),u_device_pixel_ratio:new l.bq(g,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(g,t.u_units_to_pixels),u_image:new l.b_(g,t.u_image),u_image_height:new l.bq(g,t.u_image_height)}),linePattern:(g,t)=>({u_translation:new l.c3(g,t.u_translation),u_texsize:new l.c3(g,t.u_texsize),u_ratio:new l.bq(g,t.u_ratio),u_device_pixel_ratio:new l.bq(g,t.u_device_pixel_ratio),u_image:new l.b_(g,t.u_image),u_units_to_pixels:new l.c3(g,t.u_units_to_pixels),u_scale:new l.c2(g,t.u_scale),u_fade:new l.bq(g,t.u_fade)}),lineSDF:(g,t)=>({u_translation:new l.c3(g,t.u_translation),u_ratio:new l.bq(g,t.u_ratio),u_device_pixel_ratio:new l.bq(g,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(g,t.u_units_to_pixels),u_image:new l.b_(g,t.u_image),u_mix:new l.bq(g,t.u_mix),u_tileratio:new l.bq(g,t.u_tileratio),u_crossfade_from:new l.bq(g,t.u_crossfade_from),u_crossfade_to:new l.bq(g,t.u_crossfade_to),u_lineatlas_width:new l.bq(g,t.u_lineatlas_width),u_lineatlas_height:new l.bq(g,t.u_lineatlas_height)}),lineGradientSDF:(g,t)=>({u_translation:new l.c3(g,t.u_translation),u_ratio:new l.bq(g,t.u_ratio),u_device_pixel_ratio:new l.bq(g,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(g,t.u_units_to_pixels),u_image:new l.b_(g,t.u_image),u_image_height:new l.bq(g,t.u_image_height),u_tileratio:new l.bq(g,t.u_tileratio),u_crossfade_from:new l.bq(g,t.u_crossfade_from),u_crossfade_to:new l.bq(g,t.u_crossfade_to),u_image_dash:new l.b_(g,t.u_image_dash),u_mix:new l.bq(g,t.u_mix),u_lineatlas_width:new l.bq(g,t.u_lineatlas_width),u_lineatlas_height:new l.bq(g,t.u_lineatlas_height)}),raster:(g,t)=>({u_tl_parent:new l.c3(g,t.u_tl_parent),u_scale_parent:new l.bq(g,t.u_scale_parent),u_buffer_scale:new l.bq(g,t.u_buffer_scale),u_fade_t:new l.bq(g,t.u_fade_t),u_opacity:new l.bq(g,t.u_opacity),u_image0:new l.b_(g,t.u_image0),u_image1:new l.b_(g,t.u_image1),u_brightness_low:new l.bq(g,t.u_brightness_low),u_brightness_high:new l.bq(g,t.u_brightness_high),u_saturation_factor:new l.bq(g,t.u_saturation_factor),u_contrast_factor:new l.bq(g,t.u_contrast_factor),u_spin_weights:new l.c2(g,t.u_spin_weights),u_coords_top:new l.c1(g,t.u_coords_top),u_coords_bottom:new l.c1(g,t.u_coords_bottom)}),symbolIcon:(g,t)=>({u_is_size_zoom_constant:new l.b_(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(g,t.u_is_size_feature_constant),u_size_t:new l.bq(g,t.u_size_t),u_size:new l.bq(g,t.u_size),u_camera_to_center_distance:new l.bq(g,t.u_camera_to_center_distance),u_pitch:new l.bq(g,t.u_pitch),u_rotate_symbol:new l.b_(g,t.u_rotate_symbol),u_aspect_ratio:new l.bq(g,t.u_aspect_ratio),u_fade_change:new l.bq(g,t.u_fade_change),u_label_plane_matrix:new l.c0(g,t.u_label_plane_matrix),u_coord_matrix:new l.c0(g,t.u_coord_matrix),u_is_text:new l.b_(g,t.u_is_text),u_pitch_with_map:new l.b_(g,t.u_pitch_with_map),u_is_along_line:new l.b_(g,t.u_is_along_line),u_is_variable_anchor:new l.b_(g,t.u_is_variable_anchor),u_texsize:new l.c3(g,t.u_texsize),u_texture:new l.b_(g,t.u_texture),u_translation:new l.c3(g,t.u_translation),u_pitched_scale:new l.bq(g,t.u_pitched_scale)}),symbolSDF:(g,t)=>({u_is_size_zoom_constant:new l.b_(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(g,t.u_is_size_feature_constant),u_size_t:new l.bq(g,t.u_size_t),u_size:new l.bq(g,t.u_size),u_camera_to_center_distance:new l.bq(g,t.u_camera_to_center_distance),u_pitch:new l.bq(g,t.u_pitch),u_rotate_symbol:new l.b_(g,t.u_rotate_symbol),u_aspect_ratio:new l.bq(g,t.u_aspect_ratio),u_fade_change:new l.bq(g,t.u_fade_change),u_label_plane_matrix:new l.c0(g,t.u_label_plane_matrix),u_coord_matrix:new l.c0(g,t.u_coord_matrix),u_is_text:new l.b_(g,t.u_is_text),u_pitch_with_map:new l.b_(g,t.u_pitch_with_map),u_is_along_line:new l.b_(g,t.u_is_along_line),u_is_variable_anchor:new l.b_(g,t.u_is_variable_anchor),u_texsize:new l.c3(g,t.u_texsize),u_texture:new l.b_(g,t.u_texture),u_gamma_scale:new l.bq(g,t.u_gamma_scale),u_device_pixel_ratio:new l.bq(g,t.u_device_pixel_ratio),u_is_halo:new l.b_(g,t.u_is_halo),u_translation:new l.c3(g,t.u_translation),u_pitched_scale:new l.bq(g,t.u_pitched_scale)}),symbolTextAndIcon:(g,t)=>({u_is_size_zoom_constant:new l.b_(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(g,t.u_is_size_feature_constant),u_size_t:new l.bq(g,t.u_size_t),u_size:new l.bq(g,t.u_size),u_camera_to_center_distance:new l.bq(g,t.u_camera_to_center_distance),u_pitch:new l.bq(g,t.u_pitch),u_rotate_symbol:new l.b_(g,t.u_rotate_symbol),u_aspect_ratio:new l.bq(g,t.u_aspect_ratio),u_fade_change:new l.bq(g,t.u_fade_change),u_label_plane_matrix:new l.c0(g,t.u_label_plane_matrix),u_coord_matrix:new l.c0(g,t.u_coord_matrix),u_is_text:new l.b_(g,t.u_is_text),u_pitch_with_map:new l.b_(g,t.u_pitch_with_map),u_is_along_line:new l.b_(g,t.u_is_along_line),u_is_variable_anchor:new l.b_(g,t.u_is_variable_anchor),u_texsize:new l.c3(g,t.u_texsize),u_texsize_icon:new l.c3(g,t.u_texsize_icon),u_texture:new l.b_(g,t.u_texture),u_texture_icon:new l.b_(g,t.u_texture_icon),u_gamma_scale:new l.bq(g,t.u_gamma_scale),u_device_pixel_ratio:new l.bq(g,t.u_device_pixel_ratio),u_is_halo:new l.b_(g,t.u_is_halo),u_translation:new l.c3(g,t.u_translation),u_pitched_scale:new l.bq(g,t.u_pitched_scale)}),background:(g,t)=>({u_opacity:new l.bq(g,t.u_opacity),u_color:new l.b$(g,t.u_color)}),backgroundPattern:(g,t)=>({u_opacity:new l.bq(g,t.u_opacity),u_image:new l.b_(g,t.u_image),u_pattern_tl_a:new l.c3(g,t.u_pattern_tl_a),u_pattern_br_a:new l.c3(g,t.u_pattern_br_a),u_pattern_tl_b:new l.c3(g,t.u_pattern_tl_b),u_pattern_br_b:new l.c3(g,t.u_pattern_br_b),u_texsize:new l.c3(g,t.u_texsize),u_mix:new l.bq(g,t.u_mix),u_pattern_size_a:new l.c3(g,t.u_pattern_size_a),u_pattern_size_b:new l.c3(g,t.u_pattern_size_b),u_scale_a:new l.bq(g,t.u_scale_a),u_scale_b:new l.bq(g,t.u_scale_b),u_pixel_coord_upper:new l.c3(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(g,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.bq(g,t.u_tile_units_to_pixels)}),terrain:(g,t)=>({u_texture:new l.b_(g,t.u_texture),u_ele_delta:new l.bq(g,t.u_ele_delta),u_fog_matrix:new l.c0(g,t.u_fog_matrix),u_fog_color:new l.b$(g,t.u_fog_color),u_fog_ground_blend:new l.bq(g,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.bq(g,t.u_fog_ground_blend_opacity),u_horizon_color:new l.b$(g,t.u_horizon_color),u_horizon_fog_blend:new l.bq(g,t.u_horizon_fog_blend),u_is_globe_mode:new l.bq(g,t.u_is_globe_mode)}),terrainDepth:(g,t)=>({u_ele_delta:new l.bq(g,t.u_ele_delta)}),terrainCoords:(g,t)=>({u_texture:new l.b_(g,t.u_texture),u_terrain_coords_id:new l.bq(g,t.u_terrain_coords_id),u_ele_delta:new l.bq(g,t.u_ele_delta)}),projectionErrorMeasurement:(g,t)=>({u_input:new l.bq(g,t.u_input),u_output_expected:new l.bq(g,t.u_output_expected)}),atmosphere:(g,t)=>({u_sun_pos:new l.c2(g,t.u_sun_pos),u_atmosphere_blend:new l.bq(g,t.u_atmosphere_blend),u_globe_position:new l.c2(g,t.u_globe_position),u_globe_radius:new l.bq(g,t.u_globe_radius),u_inv_proj_matrix:new l.c0(g,t.u_inv_proj_matrix)}),sky:(g,t)=>({u_sky_color:new l.b$(g,t.u_sky_color),u_horizon_color:new l.b$(g,t.u_horizon_color),u_horizon:new l.c3(g,t.u_horizon),u_horizon_normal:new l.c3(g,t.u_horizon_normal),u_sky_horizon_blend:new l.bq(g,t.u_sky_horizon_blend),u_sky_blend:new l.bq(g,t.u_sky_blend)})};class vg{constructor(t,a,c){this.context=t;const f=t.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Td={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class xg{constructor(t,a,c,f){this.length=a.length,this.attributes=c,this.itemSize=a.bytesPerElement,this.dynamicDraw=f,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let c=0;c<this.attributes.length;c++){const f=a.attributes[this.attributes[c].name];f!==void 0&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,a,c){for(let f=0;f<this.attributes.length;f++){const _=this.attributes[f],x=a.attributes[_.name];x!==void 0&&t.vertexAttribPointer(x,_.components,t[Td[_.type]],!1,this.itemSize,_.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Mn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class wc extends Mn{getDefault(){return l.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Tc extends Mn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Sc extends Mn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class lh extends Mn{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class bo extends Mn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class ll extends Mn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class gs extends Mn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Li extends Mn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Sd extends Mn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class Md extends Mn{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ch extends Mn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class wo extends Mn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Mc extends Mn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class Pc extends Mn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class cl extends Mn{getDefault(){return l.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ec extends Mn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Pd extends Mn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class _s extends Mn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ys extends Mn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Ed extends Mn{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class uh extends Mn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class sn extends Mn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Cc extends Mn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class bg extends Mn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Cd extends Mn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ul extends Mn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class wg extends Mn{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Tg extends Mn{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const c=this.gl;Ri(c)?c.bindVertexArray(t):(a=c.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Id extends Mn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Sg extends Mn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class hh extends Mn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class vs extends Mn{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class hl extends vs{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ic extends vs{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class fh extends vs{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const dh="Framebuffer is not complete";class Ac{constructor(t,a,c,f,_){this.context=t,this.width=a,this.height=c;const x=t.gl,S=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new hl(t,S),f)this.depthAttachment=_?new fh(t,S):new Ic(t,S);else if(_)throw new Error("Stencil cannot be set without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error(dh)}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class kc{constructor(t){var a,c;if(this.gl=t,this.clearColor=new wc(this),this.clearDepth=new Tc(this),this.clearStencil=new Sc(this),this.colorMask=new lh(this),this.depthMask=new bo(this),this.stencilMask=new ll(this),this.stencilFunc=new gs(this),this.stencilOp=new Li(this),this.stencilTest=new Sd(this),this.depthRange=new Md(this),this.depthTest=new ch(this),this.depthFunc=new wo(this),this.blend=new Mc(this),this.blendFunc=new Pc(this),this.blendColor=new cl(this),this.blendEquation=new Ec(this),this.cullFace=new Pd(this),this.cullFaceSide=new _s(this),this.frontFace=new ys(this),this.program=new Ed(this),this.activeTexture=new uh(this),this.viewport=new sn(this),this.bindFramebuffer=new Cc(this),this.bindRenderbuffer=new bg(this),this.bindTexture=new Cd(this),this.bindVertexBuffer=new ul(this),this.bindElementBuffer=new wg(this),this.bindVertexArray=new Tg(this),this.pixelStoreUnpack=new Id(this),this.pixelStoreUnpackPremultiplyAlpha=new Sg(this),this.pixelStoreUnpackFlipY=new hh(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Ri(t)){this.HALF_FLOAT=t.HALF_FLOAT;const f=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:f?.RGBA16F_EXT,this.RGB16F=(c=t.RGB16F)!==null&&c!==void 0?c:f?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const f=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=f?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new vg(this,t,a)}createVertexBuffer(t,a,c){return new xg(this,t,a,c)}createRenderbuffer(t,a,c){const f=this.gl,_=f.createRenderbuffer();return this.bindRenderbuffer.set(_),f.renderbufferStorage(f.RENDERBUFFER,t,a,c),this.bindRenderbuffer.set(null),_}createFramebuffer(t,a,c,f){return new Ac(this,t,a,c,f)}clear({color:t,depth:a,stencil:c}){const f=this.gl;let _=0;t&&(_|=f.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(_|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),c!==void 0&&(_|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),f.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){l.bR(t.blendFunction,On.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Ri(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return Ri(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let qa;function To(g,t,a,c,f){const _=g.context,x=g.transform,S=_.gl,E=g.useProgram("collisionBox"),A=[];let R=0,N=0;for(let ie=0;ie<c.length;ie++){const pe=c[ie],Te=t.getTile(pe).getBucket(a);if(!Te)continue;const he=f?Te.textCollisionBox:Te.iconCollisionBox,xe=Te.collisionCircleArray;xe.length>0&&(A.push({circleArray:xe,circleOffset:N,coord:pe}),R+=xe.length/4,N=R),he&&E.draw(_,S.LINES,en.disabled,wn.disabled,g.colorModeForRenderPass(),vn.disabled,vo(g.transform),g.style.map.terrain&&g.style.map.terrain.getTerrainData(pe),x.getProjectionData({overscaledTileID:pe,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,null,g.transform.zoom,null,null,he.collisionVertexBuffer)}if(!f||!A.length)return;const O=g.useProgram("collisionCircle"),$=new l.ca;$.resize(4*R),$._trim();let X=0;for(const ie of A)for(let pe=0;pe<ie.circleArray.length/4;pe++){const Te=4*pe,he=ie.circleArray[Te+0],xe=ie.circleArray[Te+1],Pe=ie.circleArray[Te+2],_e=ie.circleArray[Te+3];$.emplace(X++,he,xe,Pe,_e,0),$.emplace(X++,he,xe,Pe,_e,1),$.emplace(X++,he,xe,Pe,_e,2),$.emplace(X++,he,xe,Pe,_e,3)}(!qa||qa.length<2*R)&&(qa=(function(ie){const pe=2*ie,Te=new l.cc;Te.resize(pe),Te._trim();for(let he=0;he<pe;he++){const xe=6*he;Te.uint16[xe+0]=4*he+0,Te.uint16[xe+1]=4*he+1,Te.uint16[xe+2]=4*he+2,Te.uint16[xe+3]=4*he+2,Te.uint16[xe+4]=4*he+3,Te.uint16[xe+5]=4*he+0}return Te})(R));const re=_.createIndexBuffer(qa,!0),ae=_.createVertexBuffer($,l.cb.members,!0);for(const ie of A){const pe=_d(g.transform);O.draw(_,S.TRIANGLES,en.disabled,wn.disabled,g.colorModeForRenderPass(),vn.disabled,pe,g.style.map.terrain&&g.style.map.terrain.getTerrainData(ie.coord),null,a.id,ae,re,l.aX.simpleSegment(0,2*ie.circleOffset,ie.circleArray.length,ie.circleArray.length/2),null,g.transform.zoom,null,null,null)}ae.destroy(),re.destroy()}const ph=l.ar(new Float32Array(16));function Mg(g,t,a,c,f,_){const{horizontalAlign:x,verticalAlign:S}=l.aS(g);return new l.P((-(x-.5)*t/f+c[0])*_,(-(S-.5)*a/f+c[1])*_)}function fl(g,t,a,c,f,_){const x=t.tileAnchorPoint.add(new l.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let S=c.mult(_);a||(S=S.rotate(-f));const E=x.add(S);return Qt(E.x,E.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(a){const S=kn(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(g),E=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return g.add(c.rotate(E))}return g.add(c)}function Pg(g,t,a,c,f,_,x,S,E,A,R,N){const O=g.text.placedSymbolArray,$=g.text.dynamicLayoutVertexArray,X=g.icon.dynamicLayoutVertexArray,re={};$.clear();for(let ae=0;ae<O.length;ae++){const ie=O.get(ae),pe=ie.hidden||!ie.crossTileID||g.allowVerticalPlacement&&!ie.placedOrientation?null:c[ie.crossTileID];if(pe){const Te=new l.P(ie.anchorX,ie.anchorY),he={getElevation:N,width:f.width,height:f.height,pitchedLabelPlaneMatrix:_,pitchWithMap:a,transform:f,tileAnchorPoint:Te,translation:A,unwrappedTileID:R},xe=a?ns(Te.x,Te.y,he):kn(Te.x,Te.y,he),Pe=Hs(f.cameraToCenterDistance,xe.signedDistanceFromCamera);let _e=l.aA(g.textSizeData,S,ie)*Pe/l.aM;a&&(_e*=g.tilePixelRatio/x);const{width:Ce,height:je,anchor:Le,textOffset:Be,textBoxScale:Oe}=pe,lt=Mg(Le,Ce,je,Be,Oe,_e),ut=f.getPitchedTextCorrection(Te.x+A[0],Te.y+A[1],R),nt=fl(xe.point,he,t,lt,-f.bearingInRadians,ut),dt=g.allowVerticalPlacement&&ie.placedOrientation===l.az.vertical?Math.PI/2:0;for(let Xt=0;Xt<ie.numGlyphs;Xt++)l.aG($,nt,dt);E&&ie.associatedIconIndex>=0&&(re[ie.associatedIconIndex]={shiftedAnchor:nt,angle:dt})}else fo(ie.numGlyphs,$)}if(E){X.clear();const ae=g.icon.placedSymbolArray;for(let ie=0;ie<ae.length;ie++){const pe=ae.get(ie);if(pe.hidden)fo(pe.numGlyphs,X);else{const Te=re[ie];if(Te)for(let he=0;he<pe.numGlyphs;he++)l.aG(X,Te.shiftedAnchor,Te.angle);else fo(pe.numGlyphs,X)}}g.icon.dynamicLayoutVertexBuffer.updateData(X)}g.text.dynamicLayoutVertexBuffer.updateData($)}function Ad(g,t,a){return a.iconsInText&&t?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function dl(g,t,a,c,f,_,x,S,E,A,R,N,O){const $=g.context,X=$.gl,re=g.transform,ae=S==="map",ie=E==="map",pe=S!=="viewport"&&a.layout.get("symbol-placement")!=="point",Te=ae&&!ie&&!pe,he=!a.layout.get("symbol-sort-key").isConstant();let xe=!1;const Pe=g.getDepthModeForSublayer(0,en.ReadOnly),_e=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ce=[],je=re.getCircleRadiusCorrection();for(const Le of c){const Be=t.getTile(Le),Oe=Be.getBucket(a);if(!Oe)continue;const lt=f?Oe.text:Oe.icon;if(!lt||!lt.segments.get().length||!lt.hasVisibleVertices)continue;const ut=lt.programConfigurations.get(a.id),nt=f||Oe.sdfIcons,dt=f?Oe.textSizeData:Oe.iconSizeData,Xt=ie||re.pitch!==0,In=g.useProgram(Ad(nt,f,Oe),ut),Zn=l.ay(dt,re.zoom),Nn=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Le);let Xn,Vn,lr,Yn,Dr=[0,0],_r=null;if(f)Vn=Be.glyphAtlasTexture,lr=X.LINEAR,Xn=Be.glyphAtlasTexture.size,Oe.iconsInText&&(Dr=Be.imageAtlasTexture.size,_r=Be.imageAtlasTexture,Yn=Xt||g.options.rotating||g.options.zooming||dt.kind==="composite"||dt.kind==="camera"?X.LINEAR:X.NEAREST);else{const Un=a.layout.get("icon-size").constantOr(0)!==1||Oe.iconsNeedLinear;Vn=Be.imageAtlasTexture,lr=nt||g.options.rotating||g.options.zooming||Un||Xt?X.LINEAR:X.NEAREST,Xn=Be.imageAtlasTexture.size}const pr=l.aN(Be,1,g.transform.zoom),jr=bi(ae,g.transform,pr),Ha=l.N();l.aB(Ha,jr);const Ma=lc(ie,ae,g.transform,pr),la=l.aO(re,Be,_,x),_i=re.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),Io=_e&&Oe.hasTextData(),zl=a.layout.get("icon-text-fit")!=="none"&&Io&&Oe.hasIconData();if(pe){const Un=g.style.map.terrain?(Er,Cr)=>g.style.map.terrain.getElevation(Le,Er,Cr):null,jn=a.layout.get("text-rotation-alignment")==="map";cc(Oe,g,f,jr,Ha,ie,A,jn,Le.toUnwrapped(),re.width,re.height,la,Un)}const Ao=f&&_e||zl,Oi=pe||Ao?ph:ie?jr:g.transform.clipSpaceToPixelsMatrix,ca=nt&&a.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Qi;Qi=nt?Oe.iconsInText?xo(dt.kind,Zn,Te,ie,pe,Ao,g,Oi,Ma,la,Xn,Dr,je):bc(dt.kind,Zn,Te,ie,pe,Ao,g,Oi,Ma,la,f,Xn,0,je):oh(dt.kind,Zn,Te,ie,pe,Ao,g,Oi,Ma,la,f,Xn,je);const ea={program:In,buffers:lt,uniformValues:Qi,projectionData:_i,atlasTexture:Vn,atlasTextureIcon:_r,atlasInterpolation:lr,atlasInterpolationIcon:Yn,isSDF:nt,hasHalo:ca};if(he&&Oe.canOverlap){xe=!0;const Un=lt.segments.get();for(const jn of Un)Ce.push({segments:new l.aX([jn]),sortKey:jn.sortKey,state:ea,terrainData:Nn})}else Ce.push({segments:lt.segments,sortKey:0,state:ea,terrainData:Nn})}xe&&Ce.sort(((Le,Be)=>Le.sortKey-Be.sortKey));for(const Le of Ce){const Be=Le.state;if($.activeTexture.set(X.TEXTURE0),Be.atlasTexture.bind(Be.atlasInterpolation,X.CLAMP_TO_EDGE),Be.atlasTextureIcon&&($.activeTexture.set(X.TEXTURE1),Be.atlasTextureIcon&&Be.atlasTextureIcon.bind(Be.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),Be.isSDF){const Oe=Be.uniformValues;Be.hasHalo&&(Oe.u_is_halo=1,Dc(Be.buffers,Le.segments,a,g,Be.program,Pe,R,N,Oe,Be.projectionData,Le.terrainData)),Oe.u_is_halo=0}Dc(Be.buffers,Le.segments,a,g,Be.program,Pe,R,N,Be.uniformValues,Be.projectionData,Le.terrainData)}}function Dc(g,t,a,c,f,_,x,S,E,A,R){const N=c.context;f.draw(N,N.gl.TRIANGLES,_,x,S,vn.backCCW,E,R,A,a.id,g.layoutVertexBuffer,g.indexBuffer,t,a.paint,c.transform.zoom,g.programConfigurations.get(a.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function kd(g,t,a,c,f){const _=g.context,x=_.gl,S=wn.disabled,E=new On([x.ONE,x.ONE],l.bp.transparent,[!0,!0,!0,!0]),A=t.getBucket(a);if(!A)return;const R=c.key;let N=a.heatmapFbos.get(R);N||(N=pl(_,t.tileSize,t.tileSize),a.heatmapFbos.set(R,N)),_.bindFramebuffer.set(N.framebuffer),_.viewport.set([0,0,t.tileSize,t.tileSize]),_.clear({color:l.bp.transparent});const O=A.programConfigurations.get(a.id),$=g.useProgram("heatmap",O,!f),X=g.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),re=g.style.map.terrain.getTerrainData(c);$.draw(_,x.TRIANGLES,en.disabled,S,E,vn.disabled,ms(t,g.transform.zoom,a.paint.get("heatmap-intensity"),1),re,X,a.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,a.paint,g.transform.zoom,O)}function Dd(g,t,a,c,f){const _=g.context,x=_.gl,S=g.transform;_.setColorMode(g.colorModeForRenderPass());const E=zc(_,t),A=a.key,R=t.heatmapFbos.get(A);if(!R)return;_.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,R.colorAttachment.get()),_.activeTexture.set(x.TEXTURE1),E.bind(x.LINEAR,x.CLAMP_TO_EDGE);const N=S.getProjectionData({overscaledTileID:a,applyTerrainMatrix:f,applyGlobeMatrix:!c});g.useProgram("heatmapTexture").draw(_,x.TRIANGLES,en.disabled,wn.disabled,g.colorModeForRenderPass(),vn.disabled,yd(g,t,0,1),null,N,t.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments,t.paint,S.zoom),R.destroy(),t.heatmapFbos.delete(A)}function pl(g,t,a){var c,f;const _=g.gl,x=_.createTexture();_.bindTexture(_.TEXTURE_2D,x),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR);const S=(c=g.HALF_FLOAT)!==null&&c!==void 0?c:_.UNSIGNED_BYTE,E=(f=g.RGBA16F)!==null&&f!==void 0?f:_.RGBA;_.texImage2D(_.TEXTURE_2D,0,E,t,a,0,_.RGBA,S,null);const A=g.createFramebuffer(t,a,!1,!1);return A.colorAttachment.set(x),A}function zc(g,t){return t.colorRampTexture||(t.colorRampTexture=new l.T(g,t.colorRamp,g.gl.RGBA)),t.colorRampTexture}function zd(g,t,a,c,f,_,x,S){let E=256;if(f.stepInterpolant){const A=t.getSource().maxzoom,R=x.canonical.z===A?Math.ceil(1<<g.transform.maxZoom-x.canonical.z):1;E=l.an(l.ce(_.maxLineLength/l.a5*1024*R),256,a.maxTextureSize)}return S.gradient=l.cf({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:E,image:S.gradient||void 0,clips:_.lineClipsArray}),S.texture?S.texture.update(S.gradient):S.texture=new l.T(a,S.gradient,c.RGBA),S.version=f.gradientVersion,S.texture}function Rd(g,t,a,c,f){g.activeTexture.set(t.TEXTURE0),a.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),c.updatePaintBuffers(f)}function fr(g,t,a,c,f,_){(f||g.lineAtlas.dirty)&&(t.activeTexture.set(a.TEXTURE0),g.lineAtlas.bind(t)),c.updatePaintBuffers(_)}function So(g,t,a,c,f,_,x){const S=_.gradients[f.id];let E=S.texture;f.gradientVersion!==S.version&&(E=zd(g,t,a,c,f,_,x,S)),a.activeTexture.set(c.TEXTURE0),E.bind(f.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE)}function Ti(g,t,a,c,f,_,x,S,E){const A=_.gradients[f.id];let R=A.texture;f.gradientVersion!==A.version&&(R=zd(g,t,a,c,f,_,x,A)),a.activeTexture.set(c.TEXTURE0),R.bind(f.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE),a.activeTexture.set(c.TEXTURE1),g.lineAtlas.bind(a),S.updatePaintBuffers(E)}function Rc(g,t,a,c,f){if(!a||!c||!c.imageAtlas)return;const _=c.imageAtlas.patternPositions;let x=_[a.to.toString()],S=_[a.from.toString()];if(!x&&S&&(x=S),!S&&x&&(S=x),!x||!S){const E=f.getPaintProperty(t);x=_[E],S=_[E]}x&&S&&g.setConstantPatternPositions(x,S)}function ml(g,t,a,c,f,_,x,S){const E=g.context.gl,A="fill-pattern",R=a.paint.get(A),N=R&&R.constantOr(1),O=a.getCrossfadeParameters();let $,X,re,ae,ie;const pe=g.transform,Te=a.paint.get("fill-translate"),he=a.paint.get("fill-translate-anchor");x?(X=N&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=E.LINES):(X=N?"fillPattern":"fill",$=E.TRIANGLES);const xe=R.constantOr(null);for(const Pe of c){const _e=t.getTile(Pe);if(N&&!_e.patternsLoaded())continue;const Ce=_e.getBucket(a);if(!Ce)continue;const je=Ce.programConfigurations.get(a.id),Le=g.useProgram(X,je),Be=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Pe);N&&(g.context.activeTexture.set(E.TEXTURE0),_e.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),je.updatePaintBuffers(O)),Rc(je,A,xe,_e,a);const Oe=pe.getProjectionData({overscaledTileID:Pe,applyGlobeMatrix:!S,applyTerrainMatrix:!0}),lt=l.aO(pe,_e,Te,he);if(x){ae=Ce.indexBuffer2,ie=Ce.segments2;const nt=[E.drawingBufferWidth,E.drawingBufferHeight];re=X==="fillOutlinePattern"&&N?md(g,O,_e,nt,lt):pd(nt,lt)}else ae=Ce.indexBuffer,ie=Ce.segments,re=N?th(g,O,_e,lt):{u_fill_translate:lt};const ut=g.stencilModeForClipping(Pe);Le.draw(g.context,$,f,ut,_,vn.backCCW,re,Be,Oe,a.id,Ce.layoutVertexBuffer,ae,ie,a.paint,g.transform.zoom,je)}}function Lc(g,t,a,c,f,_,x,S){const E=g.context,A=E.gl,R="fill-extrusion-pattern",N=a.paint.get(R),O=N.constantOr(1),$=a.getCrossfadeParameters(),X=a.paint.get("fill-extrusion-opacity"),re=N.constantOr(null),ae=g.transform;for(const ie of c){const pe=t.getTile(ie),Te=pe.getBucket(a);if(!Te)continue;const he=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ie),xe=Te.programConfigurations.get(a.id),Pe=g.useProgram(O?"fillExtrusionPattern":"fillExtrusion",xe);O&&(g.context.activeTexture.set(A.TEXTURE0),pe.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),xe.updatePaintBuffers($));const _e=ae.getProjectionData({overscaledTileID:ie,applyGlobeMatrix:!S,applyTerrainMatrix:!0});Rc(xe,R,re,pe,a);const Ce=l.aO(ae,pe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),je=a.paint.get("fill-extrusion-vertical-gradient"),Le=O?eh(g,je,X,Ce,ie,$,pe):Qu(g,je,X,Ce);Pe.draw(E,E.gl.TRIANGLES,f,_,x,vn.backCCW,Le,he,_e,a.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,a.paint,g.transform.zoom,xe,g.style.map.terrain&&Te.centroidVertexBuffer)}}function Ga(g,t,a,c,f,_,x,S,E){var A;const R=g.style.projection,N=g.context,O=g.transform,$=N.gl,X=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],re=g.useProgram("hillshade",null,!1,X),ae=!g.options.moving;for(const ie of c){const pe=t.getTile(ie),Te=pe.fbo;if(!Te)continue;const he=R.getMeshFromTileID(N,ie.canonical,S,!0,"raster"),xe=(A=g.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(ie);N.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,Te.colorAttachment.get());const Pe=O.getProjectionData({overscaledTileID:ie,aligned:ae,applyGlobeMatrix:!E,applyTerrainMatrix:!0});re.draw(N,$.TRIANGLES,_,f[ie.overscaledZ],x,vn.backCCW,yc(g,pe,a),xe,Pe,a.id,he.vertexBuffer,he.indexBuffer,he.segments)}}function gl(g,t,a,c,f,_,x,S,E){var A;const R=g.style.projection,N=g.context,O=g.transform,$=N.gl,X=g.useProgram("colorRelief"),re=!g.options.moving;let ae=!0,ie=0;for(const pe of c){const Te=t.getTile(pe),he=Te.dem;if(ae){const Le=$.getParameter($.MAX_TEXTURE_SIZE),{elevationTexture:Be,colorTexture:Oe}=a.getColorRampTextures(N,Le,he.getUnpackVector());N.activeTexture.set($.TEXTURE1),Be.bind($.NEAREST,$.CLAMP_TO_EDGE),N.activeTexture.set($.TEXTURE4),Oe.bind($.LINEAR,$.CLAMP_TO_EDGE),ae=!1,ie=Be.size[0]}if(!he||!he.data)continue;const xe=he.stride,Pe=he.getPixels();if(N.activeTexture.set($.TEXTURE0),N.pixelStoreUnpackPremultiplyAlpha.set(!1),Te.demTexture=Te.demTexture||g.getTileTexture(xe),Te.demTexture){const Le=Te.demTexture;Le.update(Pe,{premultiply:!1}),Le.bind($.LINEAR,$.CLAMP_TO_EDGE)}else Te.demTexture=new l.T(N,Pe,$.RGBA,{premultiply:!1}),Te.demTexture.bind($.LINEAR,$.CLAMP_TO_EDGE);const _e=R.getMeshFromTileID(N,pe.canonical,S,!0,"raster"),Ce=(A=g.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(pe),je=O.getProjectionData({overscaledTileID:pe,aligned:re,applyGlobeMatrix:!E,applyTerrainMatrix:!0});X.draw(N,$.TRIANGLES,_,f[pe.overscaledZ],x,vn.backCCW,vd(a,Te.dem,ie),Ce,je,a.id,_e.vertexBuffer,_e.indexBuffer,_e.segments)}}const Mo=[new l.P(0,0),new l.P(l.a5,0),new l.P(l.a5,l.a5),new l.P(0,l.a5)];function xs(g,t,a,c,f,_,x,S,E=!1,A=!1){const R=c[c.length-1].overscaledZ,N=g.context,O=N.gl,$=g.useProgram("raster"),X=g.transform,re=g.style.projection,ae=g.colorModeForRenderPass(),ie=!g.options.moving,pe=a.paint.get("raster-opacity"),Te=a.paint.get("raster-resampling"),he=a.paint.get("raster-fade-duration"),xe=!!g.style.map.terrain;for(const Pe of c){const _e=g.getDepthModeForSublayer(Pe.overscaledZ-R,pe===1?en.ReadWrite:en.ReadOnly,O.LESS),Ce=t.getTile(Pe),je=Te==="nearest"?O.NEAREST:O.LINEAR;N.activeTexture.set(O.TEXTURE0),Ce.texture.bind(je,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),N.activeTexture.set(O.TEXTURE1);const{parentTile:Le,parentScaleBy:Be,parentTopLeft:Oe,fadeValues:lt}=Ld(Ce,t,he,xe);Ce.fadeOpacity=lt.tileOpacity,Le?(Le.fadeOpacity=lt.parentTileOpacity,Le.texture.bind(je,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST)):Ce.texture.bind(je,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),Ce.texture.useMipmap&&N.extTextureFilterAnisotropic&&g.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const ut=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Pe),nt=X.getProjectionData({overscaledTileID:Pe,aligned:ie,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),dt=ih(Oe,Be,lt.fadeMix,a,S),Xt=re.getMeshFromTileID(N,Pe.canonical,_,x,"raster");$.draw(N,O.TRIANGLES,_e,f?f[Pe.overscaledZ]:wn.disabled,ae,E?vn.frontCCW:vn.backCCW,dt,ut,nt,a.id,Xt.vertexBuffer,Xt.indexBuffer,Xt.segments)}}function Ld(g,t,a,c){const f={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||c)return f;if(g.fadingParentID){const _=t.getLoadedTile(g.fadingParentID);if(!_)return f;const x=Math.pow(2,_.tileID.overscaledZ-g.tileID.overscaledZ),S=[g.tileID.canonical.x*x%1,g.tileID.canonical.y*x%1],E=(function(A,R,N){const O=ee(),$=(O-R.timeAdded)/N,X=A.fadingDirection===Ae.Incoming,re=l.an((O-A.timeAdded)/N,0,1),ae=l.an(1-$,0,1),ie=X?re:ae;return{tileOpacity:ie,parentTileOpacity:X?ae:re,fadeMix:{opacity:1,mix:1-ie}}})(g,_,a);return{parentTile:_,parentScaleBy:x,parentTopLeft:S,fadeValues:E}}if(g.selfFading){const _=(function(x,S){const E=(ee()-x.timeAdded)/S,A=l.an(E,0,1);return{tileOpacity:A,fadeMix:{opacity:A,mix:0}}})(g,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:_}}return f}const Fd=new l.bp(1,0,0,1),Bd=new l.bp(0,1,0,1),Od=new l.bp(0,0,1,1),Nd=new l.bp(1,0,1,1),$a=new l.bp(0,1,1,1);function mh(g,t,a,c){_l(g,0,t+a/2,g.transform.width,a,c)}function gh(g,t,a,c){_l(g,t-a/2,0,a,g.transform.height,c)}function _l(g,t,a,c,f,_){const x=g.context,S=x.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*g.pixelRatio,a*g.pixelRatio,c*g.pixelRatio,f*g.pixelRatio),x.clear({color:_}),S.disable(S.SCISSOR_TEST)}function Vd(g,t,a){const c=g.context,f=c.gl,_=g.useProgram("debug"),x=en.disabled,S=wn.disabled,E=g.colorModeForRenderPass(),A="$debug",R=g.style.map.terrain&&g.style.map.terrain.getTerrainData(a);c.activeTexture.set(f.TEXTURE0);const N=t.getTileByID(a.key).latestRawTileData,O=Math.floor((N&&N.byteLength||0)/1024),$=t.getTile(a).tileSize,X=512/Math.min($,512)*(a.overscaledZ/g.transform.zoom)*.5;let re=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(re+=` => ${a.overscaledZ}`),(function(ie,pe){ie.initDebugOverlayCanvas();const Te=ie.debugOverlayCanvas,he=ie.context.gl,xe=ie.debugOverlayCanvas.getContext("2d");xe.clearRect(0,0,Te.width,Te.height),xe.shadowColor="white",xe.shadowBlur=2,xe.lineWidth=1.5,xe.strokeStyle="white",xe.textBaseline="top",xe.font="bold 36px Open Sans, sans-serif",xe.fillText(pe,5,5),xe.strokeText(pe,5,5),ie.debugOverlayTexture.update(Te),ie.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)})(g,`${re} ${O}kB`);const ae=g.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(c,f.TRIANGLES,x,S,On.alphaBlended,vn.disabled,nh(l.bp.transparent,X),null,ae,A,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),_.draw(c,f.LINE_STRIP,x,S,E,vn.disabled,nh(l.bp.red),R,ae,A,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function _h(g,t,a,c){const{isRenderingGlobe:f}=c,_=g.context,x=_.gl,S=g.transform,E=g.colorModeForRenderPass(),A=g.getDepthModeFor3D(),R=g.useProgram("terrain");_.bindFramebuffer.set(null),_.viewport.set([0,0,g.width,g.height]);for(const N of a){const O=t.getTerrainMesh(N.tileID),$=g.renderToTexture.getTexture(N),X=t.getTerrainData(N.tileID);_.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,$.texture);const re=t.getMeshFrameDelta(S.zoom),ae=S.calculateFogMatrix(N.tileID.toUnwrapped()),ie=pg(re,ae,g.style.sky,S.pitch,f),pe=S.getProjectionData({overscaledTileID:N.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});R.draw(_,x.TRIANGLES,A,wn.disabled,E,vn.backCCW,ie,X,pe,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}}function yh(g,t){if(!t.mesh){const a=new l.aW;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const c=new l.aY;c.emplaceBack(0,1,2),c.emplaceBack(0,2,3),t.mesh=new Bn(g.createVertexBuffer(a,Va.members),g.createIndexBuffer(c),l.aX.simpleSegment(0,0,a.length,c.length))}return t.mesh}class jd{constructor(t,a){this.context=new kc(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=zi.maxOverzooming+zi.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new mi}resize(t,a,c){if(this.width=Math.floor(t*c),this.height=Math.floor(a*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const t=this.context,a=new l.aW;a.emplaceBack(0,0),a.emplaceBack(l.a5,0),a.emplaceBack(0,l.a5),a.emplaceBack(l.a5,l.a5),this.tileExtentBuffer=t.createVertexBuffer(a,Va.members),this.tileExtentSegments=l.aX.simpleSegment(0,0,4,2);const c=new l.aW;c.emplaceBack(0,0),c.emplaceBack(l.a5,0),c.emplaceBack(0,l.a5),c.emplaceBack(l.a5,l.a5),this.debugBuffer=t.createVertexBuffer(c,Va.members),this.debugSegments=l.aX.simpleSegment(0,0,4,5);const f=new l.ch;f.emplaceBack(0,0,0,0),f.emplaceBack(l.a5,0,l.a5,0),f.emplaceBack(0,l.a5,0,l.a5),f.emplaceBack(l.a5,l.a5,l.a5,l.a5),this.rasterBoundsBuffer=t.createVertexBuffer(f,dg.members),this.rasterBoundsSegments=l.aX.simpleSegment(0,0,4,2);const _=new l.aW;_.emplaceBack(0,0),_.emplaceBack(l.a5,0),_.emplaceBack(0,l.a5),_.emplaceBack(l.a5,l.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(_,Va.members),this.rasterBoundsSegmentsPosOnly=l.aX.simpleSegment(0,0,4,5);const x=new l.aW;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(x,Va.members),this.viewportSegments=l.aX.simpleSegment(0,0,4,2);const S=new l.ci;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(S);const E=new l.aY;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(E);const A=this.context.gl;this.stencilClearMode=new wn({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.tileExtentMesh=new Bn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=l.N();l.c7(c,0,this.width,this.height,0,0,1),l.Q(c,c,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const f={mainMatrix:c,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:c};this.useProgram("clippingMask",null,!0).draw(t,a.TRIANGLES,en.disabled,this.stencilClearMode,On.disabled,vn.disabled,null,null,f,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a,c){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source,this.nextStencilID+a.length>256&&this.clearStencil();const f=this.context;f.setColorMode(On.disabled),f.setDepthMode(en.disabled);const _={};for(const x of a)_[x.key]=this.nextStencilID++;this._renderTileMasks(_,a,c,!0),this._renderTileMasks(_,a,c,!1),this._tileClippingMaskIDs=_}_renderTileMasks(t,a,c,f){const _=this.context,x=_.gl,S=this.style.projection,E=this.transform,A=this.useProgram("clippingMask");for(const R of a){const N=t[R.key],O=this.style.map.terrain&&this.style.map.terrain.getTerrainData(R),$=S.getMeshFromTileID(this.context,R.canonical,f,!0,"stencil"),X=E.getProjectionData({overscaledTileID:R,applyGlobeMatrix:!c,applyTerrainMatrix:!0});A.draw(_,x.TRIANGLES,en.disabled,new wn({func:x.ALWAYS,mask:0},N,255,x.KEEP,x.KEEP,x.REPLACE),On.disabled,c?vn.disabled:vn.backCCW,null,O,X,"$clipping",$.vertexBuffer,$.indexBuffer,$.segments)}}_renderTilesDepthBuffer(){const t=this.context,a=t.gl,c=this.style.projection,f=this.transform,_=this.useProgram("depth"),x=this.getDepthModeFor3D(),S=ar(f,{tileSize:f.tileSize});for(const E of S){const A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E),R=c.getMeshFromTileID(this.context,E.canonical,!0,!0,"raster"),N=f.getProjectionData({overscaledTileID:E,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(t,a.TRIANGLES,x,wn.disabled,On.disabled,vn.backCCW,null,A,N,"$clipping",R.vertexBuffer,R.indexBuffer,R.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new wn({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new wn({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const a=this.context.gl,c=t.sort(((x,S)=>S.overscaledZ-x.overscaledZ)),f=c[c.length-1].overscaledZ,_=c[0].overscaledZ-f+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const x={};for(let S=0;S<_;S++)x[S+f]=new wn({func:a.GEQUAL,mask:255},S+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=_,[x,c]}return[{[f]:wn.disabled},c]}stencilConfigForOverlapTwoPass(t){const a=this.context.gl,c=t.sort(((x,S)=>S.overscaledZ-x.overscaledZ)),f=c[c.length-1].overscaledZ,_=c[0].overscaledZ-f+1;if(this.clearStencil(),_>1){const x={},S={};for(let E=0;E<_;E++)x[E+f]=new wn({func:a.GREATER,mask:255},_+1+E,255,a.KEEP,a.KEEP,a.REPLACE),S[E+f]=new wn({func:a.GREATER,mask:255},1+E,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*_+1,[x,S,c]}return this.nextStencilID=3,[{[f]:new wn({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[f]:new wn({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new On([t.CONSTANT_COLOR,t.ONE],new l.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?On.unblended:On.alphaBlended}getDepthModeForSublayer(t,a,c){if(!this.opaquePassEnabledForLayer())return en.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new en(c||this.context.gl.LEQUAL,a,[f,f])}getDepthModeFor3D(){return new en(this.context.gl.LEQUAL,en.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){var c,f;this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(ee()),this.imageManager.beginFrame();const _=this.style._order,x=this.style.tileManagers,S={},E={},A={},R={isRenderingToTexture:!1,isRenderingGlobe:((c=t.projection)===null||c===void 0?void 0:c.transitionState)>0};for(const O in x){const $=x[O];$.used&&$.prepare(this.context),S[O]=$.getVisibleCoordinates(!1),E[O]=S[O].slice().reverse(),A[O]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<_.length;O++)if(this.style._layers[_[O]].is3D()){this.opaquePassCutoff=O;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const O of _){const $=this.style._layers[O];if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const X=E[$.source];($.type==="custom"||X.length)&&this.renderLayer(this,x[$.source],$,X,R)}if((f=this.style.projection)===null||f===void 0||f.updateGPUdependent({context:this.context,useProgram:O=>this.useProgram(O)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?l.bp.black:l.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(O,$){const X=O.context,re=X.gl,ae=((Pe,_e,Ce)=>{const je=Math.cos(_e.rollInRadians),Le=Math.sin(_e.rollInRadians),Be=Cn(_e),Oe=_e.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Pe.properties.get("sky-color"),u_horizon_color:Pe.properties.get("horizon-color"),u_horizon:[(_e.width/2-Be*Le)*Ce,(_e.height/2+Be*je)*Ce],u_horizon_normal:[-Le,je],u_sky_horizon_blend:Pe.properties.get("sky-horizon-blend")*_e.height/2*Ce,u_sky_blend:Oe}})($,O.style.map.transform,O.pixelRatio),ie=new en(re.LEQUAL,en.ReadWrite,[0,1]),pe=wn.disabled,Te=O.colorModeForRenderPass(),he=O.useProgram("sky"),xe=yh(X,$);he.draw(X,re.TRIANGLES,ie,pe,Te,vn.disabled,ae,null,void 0,"sky",xe.vertexBuffer,xe.indexBuffer,xe.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const O=this.style._layers[_[this.currentLayer]],$=x[O.source],X=S[O.source];this._renderTileClippingMasks(O,X,!1),this.renderLayer(this,$,O,X,R)}this.renderPass="translucent";let N=!1;for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const O=this.style._layers[_[this.currentLayer]],$=x[O.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(O,R))continue;this.opaquePassEnabledForLayer()||N||(N=!0,R.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const X=(O.type==="symbol"?A:E)[O.source];this._renderTileClippingMasks(O,S[O.source],!!this.renderToTexture),this.renderLayer(this,$,O,X,R)}if(R.isRenderingGlobe&&(function(O,$,X){const re=O.context,ae=re.gl,ie=O.useProgram("atmosphere"),pe=new en(ae.LEQUAL,en.ReadOnly,[0,1]),Te=O.transform,he=(function(Oe,lt){const ut=Oe.properties.get("position"),nt=[-ut.x,-ut.y,-ut.z],dt=l.ar(new Float64Array(16));return Oe.properties.get("anchor")==="map"&&(l.bg(dt,dt,lt.rollInRadians),l.bh(dt,dt,-lt.pitchInRadians),l.bg(dt,dt,lt.bearingInRadians),l.bh(dt,dt,lt.center.lat*Math.PI/180),l.bJ(dt,dt,-lt.center.lng*Math.PI/180)),l.cg(nt,nt,dt),nt})(X,O.transform),xe=Te.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Pe=$.properties.get("atmosphere-blend")*xe.projectionTransition;if(Pe===0)return;const _e=_o(Te.worldSize,Te.center.lat),Ce=Te.inverseProjectionMatrix,je=new Float64Array(4);je[3]=1,l.aH(je,je,Te.modelViewProjectionMatrix),je[0]/=je[3],je[1]/=je[3],je[2]/=je[3],je[3]=1,l.aH(je,je,Ce),je[0]/=je[3],je[1]/=je[3],je[2]/=je[3],je[3]=1;const Le=((Oe,lt,ut,nt,dt)=>({u_sun_pos:Oe,u_atmosphere_blend:lt,u_globe_position:ut,u_globe_radius:nt,u_inv_proj_matrix:dt}))(he,Pe,[je[0],je[1],je[2]],_e,Ce),Be=yh(re,$);ie.draw(re,ae.TRIANGLES,pe,wn.disabled,On.alphaBlended,vn.disabled,Le,null,null,"atmosphere",Be.vertexBuffer,Be.indexBuffer,Be.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const O=(function($,X){let re=null;const ae=Object.values($._layers).flatMap((he=>he.source&&!he.isHidden(X)?[$.tileManagers[he.source]]:[])),ie=ae.filter((he=>he.getSource().type==="vector")),pe=ae.filter((he=>he.getSource().type!=="vector")),Te=he=>{(!re||re.getSource().maxzoom<he.getSource().maxzoom)&&(re=he)};return ie.forEach((he=>Te(he))),re||pe.forEach((he=>Te(he))),re})(this.style,this.transform.zoom);O&&(function($,X,re){for(let ae=0;ae<re.length;ae++)Vd($,X,re[ae])})(this,O,O.getVisibleCoordinates())}this.options.showPadding&&(function(O){const $=O.transform.padding;mh(O,O.transform.height-($.top||0),3,Fd),mh(O,$.bottom||0,3,Bd),gh(O,$.left||0,3,Od),gh(O,O.transform.width-($.right||0),3,Nd);const X=O.transform.centerPoint;(function(re,ae,ie,pe){_l(re,ae-1,ie-10,2,20,pe),_l(re,ae-10,ie-1,20,2,pe)})(O,X.x,O.transform.height-X.y,$a)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix;let f=this.terrainFacilitator.dirty;f||(f=t?!l.cj(a,c):!l.ck(a,c)),f||(f=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),f&&(l.cl(a,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(_,x){const S=_.context,E=S.gl,A=_.transform,R=On.unblended,N=new en(E.LEQUAL,en.ReadWrite,[0,1]),O=x.tileManager.getRenderableTiles(),$=_.useProgram("terrainDepth");S.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),S.clear({color:l.bp.transparent,depth:1});for(const X of O){const re=x.getTerrainMesh(X.tileID),ae=x.getTerrainData(X.tileID),ie=A.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),pe={u_ele_delta:x.getMeshFrameDelta(A.zoom)};$.draw(S,E.TRIANGLES,N,wn.disabled,R,vn.backCCW,pe,ae,ie,"terrain",re.vertexBuffer,re.indexBuffer,re.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain),(function(_,x){const S=_.context,E=S.gl,A=_.transform,R=On.unblended,N=new en(E.LEQUAL,en.ReadWrite,[0,1]),O=x.getCoordsTexture(),$=x.tileManager.getRenderableTiles(),X=_.useProgram("terrainCoords");S.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),S.clear({color:l.bp.transparent,depth:1}),x.coordsIndex=[];for(const re of $){const ae=x.getTerrainMesh(re.tileID),ie=x.getTerrainData(re.tileID);S.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,O.texture);const pe={u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(A.zoom)},Te=A.getProjectionData({overscaledTileID:re.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});X.draw(S,E.TRIANGLES,N,wn.disabled,R,vn.backCCW,pe,ie,Te,"terrain",ae.vertexBuffer,ae.indexBuffer,ae.segments),x.coordsIndex.push(re.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain))}renderLayer(t,a,c,f,_){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(f||[]).length)&&(this.id=c.id,l.cm(c)?(function(x,S,E,A,R,N){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:O}=N,$=wn.disabled,X=x.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(re,ae,ie,pe,Te,he,xe,Pe,_e){const Ce=ae.transform,je=ae.style.map.terrain,Le=Te==="map",Be=he==="map";for(const Oe of re){const lt=pe.getTile(Oe),ut=lt.getBucket(ie);if(!ut||!ut.text||!ut.text.segments.get().length)continue;const nt=l.ay(ut.textSizeData,Ce.zoom),dt=l.aN(lt,1,ae.transform.zoom),Xt=bi(Le,ae.transform,dt),In=ie.layout.get("icon-text-fit")!=="none"&&ut.hasIconData();if(nt){const Zn=Math.pow(2,Ce.zoom-lt.tileID.overscaledZ),Nn=je?(Xn,Vn)=>je.getElevation(Oe,Xn,Vn):null;Pg(ut,Le,Be,_e,Ce,Xt,Zn,nt,In,l.aO(Ce,lt,xe,Pe),Oe.toUnwrapped(),Nn)}}})(A,x,E,S,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),R),E.paint.get("icon-opacity").constantOr(1)!==0&&dl(x,S,E,A,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),$,X,O),E.paint.get("text-opacity").constantOr(1)!==0&&dl(x,S,E,A,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),$,X,O),S.map.showCollisionBoxes&&(To(x,S,E,A,!0),To(x,S,E,A,!1))})(t,a,c,f,this.style.placement.variableOffsets,_):l.cn(c)?(function(x,S,E,A,R){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:N}=R,O=E.paint.get("circle-opacity"),$=E.paint.get("circle-stroke-width"),X=E.paint.get("circle-stroke-opacity"),re=!E.layout.get("circle-sort-key").isConstant();if(O.constantOr(1)===0&&($.constantOr(1)===0||X.constantOr(1)===0))return;const ae=x.context,ie=ae.gl,pe=x.transform,Te=x.getDepthModeForSublayer(0,en.ReadOnly),he=wn.disabled,xe=x.colorModeForRenderPass(),Pe=[],_e=pe.getCircleRadiusCorrection();for(let Ce=0;Ce<A.length;Ce++){const je=A[Ce],Le=S.getTile(je),Be=Le.getBucket(E);if(!Be)continue;const Oe=E.paint.get("circle-translate"),lt=E.paint.get("circle-translate-anchor"),ut=l.aO(pe,Le,Oe,lt),nt=Be.programConfigurations.get(E.id),dt=x.useProgram("circle",nt),Xt=Be.layoutVertexBuffer,In=Be.indexBuffer,Zn=x.style.map.terrain&&x.style.map.terrain.getTerrainData(je),Nn={programConfiguration:nt,program:dt,layoutVertexBuffer:Xt,indexBuffer:In,uniformValues:gd(x,Le,E,ut,_e),terrainData:Zn,projectionData:pe.getProjectionData({overscaledTileID:je,applyGlobeMatrix:!N,applyTerrainMatrix:!0})};if(re){const Xn=Be.segments.get();for(const Vn of Xn)Pe.push({segments:new l.aX([Vn]),sortKey:Vn.sortKey,state:Nn})}else Pe.push({segments:Be.segments,sortKey:0,state:Nn})}re&&Pe.sort(((Ce,je)=>Ce.sortKey-je.sortKey));for(const Ce of Pe){const{programConfiguration:je,program:Le,layoutVertexBuffer:Be,indexBuffer:Oe,uniformValues:lt,terrainData:ut,projectionData:nt}=Ce.state;Le.draw(ae,ie.TRIANGLES,Te,he,xe,vn.backCCW,lt,ut,nt,E.id,Be,Oe,Ce.segments,E.paint,x.transform.zoom,je)}})(t,a,c,f,_):l.co(c)?(function(x,S,E,A,R){if(E.paint.get("heatmap-opacity")===0)return;const N=x.context,{isRenderingToTexture:O,isRenderingGlobe:$}=R;if(x.style.map.terrain){for(const X of A){const re=S.getTile(X);S.hasRenderableParent(X)||(x.renderPass==="offscreen"?kd(x,re,E,X,$):x.renderPass==="translucent"&&Dd(x,E,X,O,$))}N.viewport.set([0,0,x.width,x.height])}else x.renderPass==="offscreen"?(function(X,re,ae,ie){const pe=X.context,Te=pe.gl,he=X.transform,xe=wn.disabled,Pe=new On([Te.ONE,Te.ONE],l.bp.transparent,[!0,!0,!0,!0]);(function(_e,Ce,je){const Le=_e.gl;_e.activeTexture.set(Le.TEXTURE1),_e.viewport.set([0,0,Ce.width/4,Ce.height/4]);let Be=je.heatmapFbos.get(l.cd);Be?(Le.bindTexture(Le.TEXTURE_2D,Be.colorAttachment.get()),_e.bindFramebuffer.set(Be.framebuffer)):(Be=pl(_e,Ce.width/4,Ce.height/4),je.heatmapFbos.set(l.cd,Be))})(pe,X,ae),pe.clear({color:l.bp.transparent});for(let _e=0;_e<ie.length;_e++){const Ce=ie[_e];if(re.hasRenderableParent(Ce))continue;const je=re.getTile(Ce),Le=je.getBucket(ae);if(!Le)continue;const Be=Le.programConfigurations.get(ae.id),Oe=X.useProgram("heatmap",Be),lt=he.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ut=he.getCircleRadiusCorrection();Oe.draw(pe,Te.TRIANGLES,en.disabled,xe,Pe,vn.backCCW,ms(je,he.zoom,ae.paint.get("heatmap-intensity"),ut),null,lt,ae.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,ae.paint,he.zoom,Be)}pe.viewport.set([0,0,X.width,X.height])})(x,S,E,A):x.renderPass==="translucent"&&(function(X,re){const ae=X.context,ie=ae.gl;ae.setColorMode(X.colorModeForRenderPass());const pe=re.heatmapFbos.get(l.cd);pe&&(ae.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_2D,pe.colorAttachment.get()),ae.activeTexture.set(ie.TEXTURE1),zc(ae,re).bind(ie.LINEAR,ie.CLAMP_TO_EDGE),X.useProgram("heatmapTexture").draw(ae,ie.TRIANGLES,en.disabled,wn.disabled,X.colorModeForRenderPass(),vn.disabled,yd(X,re,0,1),null,null,re.id,X.viewportBuffer,X.quadTriangleIndexBuffer,X.viewportSegments,re.paint,X.transform.zoom))})(x,E)})(t,a,c,f,_):l.cp(c)?(function(x,S,E,A,R){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:N}=R,O=E.paint.get("line-opacity"),$=E.paint.get("line-width");if(O.constantOr(1)===0||$.constantOr(1)===0)return;const X=x.getDepthModeForSublayer(0,en.ReadOnly),re=x.colorModeForRenderPass(),ae=E.paint.get("line-dasharray"),ie=ae.constantOr(1),pe=E.paint.get("line-pattern"),Te=pe.constantOr(1),he=E.paint.get("line-gradient"),xe=E.getCrossfadeParameters();let Pe;Pe=Te?"linePattern":ie&&he?"lineGradientSDF":ie?"lineSDF":he?"lineGradient":"line";const _e=x.context,Ce=_e.gl,je=x.transform;let Le=!0;for(const Be of A){const Oe=S.getTile(Be);if(Te&&!Oe.patternsLoaded())continue;const lt=Oe.getBucket(E);if(!lt)continue;const ut=lt.programConfigurations.get(E.id),nt=x.context.program.get(),dt=x.useProgram(Pe,ut),Xt=Le||dt.program!==nt,In=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Be),Zn=pe.constantOr(null),Nn=ae&&ae.constantOr(null);if(Zn&&Oe.imageAtlas){const Dr=Oe.imageAtlas,_r=Dr.patternPositions[Zn.to.toString()],pr=Dr.patternPositions[Zn.from.toString()];_r&&pr&&ut.setConstantPatternPositions(_r,pr)}else if(Nn){const Dr=E.layout.get("line-cap")==="round",_r=x.lineAtlas.getDash(Nn.to,Dr),pr=x.lineAtlas.getDash(Nn.from,Dr);ut.setConstantDashPositions(_r,pr)}const Xn=je.getProjectionData({overscaledTileID:Be,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),Vn=je.getPixelScale();let lr;Te?(lr=rh(x,Oe,E,Vn,xe),Rd(_e,Ce,Oe,ut,xe)):ie&&he?(lr=vc(x,Oe,E,Vn,xe,lt.lineClipsArray.length),Ti(x,S,_e,Ce,E,lt,Be,ut,xe)):ie?(lr=bd(x,Oe,E,Vn,xe),fr(x,_e,Ce,ut,Xt,xe)):he?(lr=xd(x,Oe,E,Vn,lt.lineClipsArray.length),So(x,S,_e,Ce,E,lt,Be)):lr=sl(x,Oe,E,Vn);const Yn=x.stencilModeForClipping(Be);dt.draw(_e,Ce.TRIANGLES,X,Yn,re,vn.disabled,lr,In,Xn,E.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,E.paint,x.transform.zoom,ut,lt.layoutVertexBuffer2),Le=!1}})(t,a,c,f,_):l.cq(c)?(function(x,S,E,A,R){const N=E.paint.get("fill-color"),O=E.paint.get("fill-opacity");if(O.constantOr(1)===0)return;const{isRenderingToTexture:$}=R,X=x.colorModeForRenderPass(),re=E.paint.get("fill-pattern"),ae=x.opaquePassEnabledForLayer()&&!re.constantOr(1)&&N.constantOr(l.bp.transparent).a===1&&O.constantOr(0)===1?"opaque":"translucent";if(x.renderPass===ae){const ie=x.getDepthModeForSublayer(1,x.renderPass==="opaque"?en.ReadWrite:en.ReadOnly);ml(x,S,E,A,ie,X,!1,$)}if(x.renderPass==="translucent"&&E.paint.get("fill-antialias")){const ie=x.getDepthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,en.ReadOnly);ml(x,S,E,A,ie,X,!0,$)}})(t,a,c,f,_):l.cr(c)?(function(x,S,E,A,R){const N=E.paint.get("fill-extrusion-opacity");if(N===0)return;const{isRenderingToTexture:O}=R;if(x.renderPass==="translucent"){const $=new en(x.context.gl.LEQUAL,en.ReadWrite,x.depthRangeFor3D);if(N!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))Lc(x,S,E,A,$,wn.disabled,On.disabled,O),Lc(x,S,E,A,$,x.stencilModeFor3D(),x.colorModeForRenderPass(),O);else{const X=x.colorModeForRenderPass();Lc(x,S,E,A,$,wn.disabled,X,O)}}})(t,a,c,f,_):l.cs(c)?(function(x,S,E,A,R){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent")return;const{isRenderingToTexture:N}=R,O=x.context,$=x.style.projection.useSubdivision,X=x.getDepthModeForSublayer(0,en.ReadOnly),re=x.colorModeForRenderPass();if(x.renderPass==="offscreen")(function(ae,ie,pe,Te,he,xe,Pe){const _e=ae.context,Ce=_e.gl;for(const je of pe){const Le=ie.getTile(je),Be=Le.dem;if(!Be||!Be.data||!Le.needsHillshadePrepare)continue;const Oe=Be.dim,lt=Be.stride,ut=Be.getPixels();if(_e.activeTexture.set(Ce.TEXTURE1),_e.pixelStoreUnpackPremultiplyAlpha.set(!1),Le.demTexture=Le.demTexture||ae.getTileTexture(lt),Le.demTexture){const dt=Le.demTexture;dt.update(ut,{premultiply:!1}),dt.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE)}else Le.demTexture=new l.T(_e,ut,Ce.RGBA,{premultiply:!1}),Le.demTexture.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE);_e.activeTexture.set(Ce.TEXTURE0);let nt=Le.fbo;if(!nt){const dt=new l.T(_e,{width:Oe,height:Oe,data:null},Ce.RGBA);dt.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),nt=Le.fbo=_e.createFramebuffer(Oe,Oe,!0,!1),nt.colorAttachment.set(dt.texture)}_e.bindFramebuffer.set(nt.framebuffer),_e.viewport.set([0,0,Oe,Oe]),ae.useProgram("hillshadePrepare").draw(_e,Ce.TRIANGLES,he,xe,Pe,vn.disabled,mg(Le.tileID,Be),null,null,Te.id,ae.rasterBoundsBuffer,ae.quadTriangleIndexBuffer,ae.rasterBoundsSegments),Le.needsHillshadePrepare=!1}})(x,S,A,E,X,wn.disabled,re),O.viewport.set([0,0,x.width,x.height]);else if(x.renderPass==="translucent")if($){const[ae,ie,pe]=x.stencilConfigForOverlapTwoPass(A);Ga(x,S,E,pe,ae,X,re,!1,N),Ga(x,S,E,pe,ie,X,re,!0,N)}else{const[ae,ie]=x.getStencilConfigForOverlapAndUpdateStencilID(A);Ga(x,S,E,ie,ae,X,re,!1,N)}})(t,a,c,f,_):l.ct(c)?(function(x,S,E,A,R){if(x.renderPass!=="translucent"||!A.length)return;const{isRenderingToTexture:N}=R,O=x.style.projection.useSubdivision,$=x.getDepthModeForSublayer(0,en.ReadOnly),X=x.colorModeForRenderPass();if(O){const[re,ae,ie]=x.stencilConfigForOverlapTwoPass(A);gl(x,S,E,ie,re,$,X,!1,N),gl(x,S,E,ie,ae,$,X,!0,N)}else{const[re,ae]=x.getStencilConfigForOverlapAndUpdateStencilID(A);gl(x,S,E,ae,re,$,X,!1,N)}})(t,a,c,f,_):l.bU(c)?(function(x,S,E,A,R){if(x.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!A.length)return;const{isRenderingToTexture:N}=R,O=S.getSource(),$=x.style.projection.useSubdivision;if(O instanceof gr)xs(x,S,E,A,null,!1,!1,O.tileCoords,O.flippedWindingOrder,N);else if($){const[X,re,ae]=x.stencilConfigForOverlapTwoPass(A);xs(x,S,E,ae,X,!1,!0,Mo,!1,N),xs(x,S,E,ae,re,!0,!0,Mo,!1,N)}else{const[X,re]=x.getStencilConfigForOverlapAndUpdateStencilID(A);xs(x,S,E,re,X,!1,!0,Mo,!1,N)}})(t,a,c,f,_):l.cu(c)?(function(x,S,E,A,R){const N=E.paint.get("background-color"),O=E.paint.get("background-opacity");if(O===0)return;const{isRenderingToTexture:$}=R,X=x.context,re=X.gl,ae=x.style.projection,ie=x.transform,pe=ie.tileSize,Te=E.paint.get("background-pattern");if(x.isPatternMissing(Te))return;const he=!Te&&N.a===1&&O===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==he)return;const xe=wn.disabled,Pe=x.getDepthModeForSublayer(0,he==="opaque"?en.ReadWrite:en.ReadOnly),_e=x.colorModeForRenderPass(),Ce=x.useProgram(Te?"backgroundPattern":"background"),je=A||ar(ie,{tileSize:pe,terrain:x.style.map.terrain});Te&&(X.activeTexture.set(re.TEXTURE0),x.imageManager.bind(x.context));const Le=E.getCrossfadeParameters();for(const Be of je){const Oe=ie.getProjectionData({overscaledTileID:Be,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),lt=Te?_g(O,x,Te,{tileID:Be,tileSize:pe},Le):sh(O,N),ut=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Be),nt=ae.getMeshFromTileID(X,Be.canonical,!1,!0,"raster");Ce.draw(X,re.TRIANGLES,Pe,xe,_e,vn.backCCW,lt,ut,Oe,E.id,nt.vertexBuffer,nt.indexBuffer,nt.segments)}})(t,0,c,f,_):l.cv(c)&&(function(x,S,E,A){const{isRenderingGlobe:R}=A,N=x.context,O=E.implementation,$=x.style.projection,X=x.transform,re=X.getProjectionDataForCustomLayer(R),ae={farZ:X.farZ,nearZ:X.nearZ,fov:X.fov*Math.PI/180,modelViewProjectionMatrix:X.modelViewProjectionMatrix,projectionMatrix:X.projectionMatrix,shaderData:{variantName:$.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${$.shaderPreludeCode.vertexSource}`,define:$.shaderDefine},defaultProjectionData:re},ie=O.renderingMode?O.renderingMode:"2d";if(x.renderPass==="offscreen"){const pe=O.prerender;pe&&(x.setCustomLayerDefaults(),N.setColorMode(x.colorModeForRenderPass()),pe.call(O,N.gl,ae),N.setDirty(),x.setBaseState())}else if(x.renderPass==="translucent"){x.setCustomLayerDefaults(),N.setColorMode(x.colorModeForRenderPass()),N.setStencilMode(wn.disabled);const pe=ie==="3d"?x.getDepthModeFor3D():x.getDepthModeForSublayer(0,en.ReadOnly);N.setDepthMode(pe),O.render(N.gl,ae),N.setDirty(),x.setBaseState(),N.bindFramebuffer.set(null)}})(t,0,c,_))}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!a||!c}useProgram(t,a,c=!1,f=[]){this.cache=this.cache||{};const _=!!this.style.map.terrain,x=this.style.projection,S=c?tr.projectionMercator:x.shaderPreludeCode,E=c?ui:x.shaderDefine,A=t+(a?a.cacheKey:"")+`/${c?wi:x.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(_?"/terrain":"")+(f?`/${f.join("/")}`:"");return this.cache[A]||(this.cache[A]=new fd(this.context,tr[t],a,yg[t],this._showOverdrawInspector,_,S,E,f)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,a;if(this._tileTextures){for(const c in this._tileTextures){const f=this._tileTextures[c];if(f)for(const _ of f)_.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const c in this.cache){const f=this.cache[c];f&&f.program&&this.context.gl.deleteProgram(f.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}function vh(g,t){let a,c=!1,f=null,_=null;const x=()=>{f=null,c&&(g.apply(_,a),f=setTimeout(x,t),c=!1)};return(...S)=>(c=!0,_=this,a=S,f||x(),f)}class xh{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let c;return a.split("&").map((f=>f.split("="))).forEach((f=>{f[0]===this._hashName&&(c=f)})),(c&&c[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:c,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const c=a.join("/");let f=c;f.split("&").length>0&&(f=f.split("&")[0]),this._hashName&&(f=`${this._hashName}=${c}`);let _=window.location.hash.replace(f,"");_.startsWith("#&")?_=_.slice(0,1)+_.slice(2):_==="#"&&(_="");let x=window.location.href.replace(/(#.+)?$/,_);x=x.replace("&&","&"),window.history.replaceState(window.history.state,null,x)},this._updateHash=vh(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const a=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,f=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,f),x=Math.round(a.lng*_)/_,S=Math.round(a.lat*_)/_,E=this._map.getBearing(),A=this._map.getPitch();let R="";if(R+=t?`/${x}/${S}/${c}`:`${c}/${S}/${x}`,(E||A)&&(R+="/"+Math.round(10*E)/10),A&&(R+=`/${Math.round(A)}`),this._hashName){const N=this._hashName;let O=!1;const $=window.location.hash.slice(1).split("&").map((X=>{const re=X.split("=")[0];return re===N?(O=!0,`${re}=${R}`):X})).filter((X=>X));return O||$.push(`${N}=${R}`),`#${$.join("&")}`}return`#${R}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new l.V(+t[2],+t[1])}catch{return!1}const a=+t[0],c=+(t[3]||0),f=+(t[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&c>=-180&&c<=180&&f>=this._map.getMinPitch()&&f<=this._map.getMaxPitch()}}const Za={linearity:.3,easing:l.cw(0,0,.3,1)},Ud=l.e({deceleration:2500,maxSpeed:1400},Za),Fi=l.e({deceleration:20,maxSpeed:1400},Za),Xi=l.e({deceleration:1e3,maxSpeed:360},Za),qd=l.e({deceleration:1e3,maxSpeed:90},Za),Yi=l.e({deceleration:1e3,maxSpeed:360},Za);class Eg{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ee(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=ee();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)a.zoom+=_.zoomDelta||0,a.bearing+=_.bearingDelta||0,a.pitch+=_.pitchDelta||0,a.roll+=_.rollDelta||0,_.panDelta&&a.pan._add(_.panDelta),_.around&&(a.around=_.around),_.pinchAround&&(a.pinchAround=_.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(a.pan.mag()){const _=vl(a.pan.mag(),c,l.e({},Ud,t||{})),x=a.pan.mult(_.amount/a.pan.mag()),S=this._map.cameraHelper.handlePanInertia(x,this._map.transform);f.center=S.easingCenter,f.offset=S.easingOffset,yl(f,_)}if(a.zoom){const _=vl(a.zoom,c,Fi);f.zoom=this._map.transform.zoom+_.amount,yl(f,_)}if(a.bearing){const _=vl(a.bearing,c,Xi);f.bearing=this._map.transform.bearing+l.an(_.amount,-179,179),yl(f,_)}if(a.pitch){const _=vl(a.pitch,c,qd);f.pitch=this._map.transform.pitch+_.amount,yl(f,_)}if(a.roll){const _=vl(a.roll,c,Yi);f.roll=this._map.transform.roll+l.an(_.amount,-179,179),yl(f,_)}if(f.zoom||f.bearing){const _=a.pinchAround===void 0?a.around:a.pinchAround;f.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),l.e(f,{noMoveStart:!0})}}function yl(g,t){(!g.duration||g.duration<t.duration)&&(g.duration=t.duration,g.easing=t.easing)}function vl(g,t,a){const{maxSpeed:c,linearity:f,deceleration:_}=a,x=l.an(g*f/(t/1e3),-c,c),S=Math.abs(x)/(_*f);return{easing:a.easing,duration:1e3*S,amount:x*(S/2)}}class kr extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c,f={}){c=c instanceof MouseEvent?c:new MouseEvent(t,c);const _=U.mousePos(a.getCanvas(),c),x=a.unproject(_);super(t,l.e({point:_,lngLat:x,originalEvent:c},f)),this._defaultPrevented=!1,this.target=a}}class xl extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c){const f=t==="touchend"?c.changedTouches:c.touches,_=U.touchPos(a.getCanvasContainer(),f),x=_.map((E=>a.unproject(E))),S=_.reduce(((E,A,R,N)=>E.add(A.div(N.length))),new l.P(0,0));super(t,{points:_,point:S,lngLats:x,lngLat:a.unproject(S),originalEvent:c}),this._defaultPrevented=!1}}class Gd extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}}class Cg{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Gd(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new kr(t.type,this._map,t))}mouseup(t){this._map.fire(new kr(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new kr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new kr(t.type,this._map,t))}mouseover(t){this._map.fire(new kr(t.type,this._map,t))}mouseout(t){this._map.fire(new kr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new xl(t.type,this._map,t))}touchmove(t){this._map.fire(new xl(t.type,this._map,t))}touchend(t){this._map.fire(new xl(t.type,this._map,t))}touchcancel(t){this._map.fire(new xl(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ig{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new kr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new kr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new kr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bs{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(l.P.convert(t),this._map.terrain)}}class ws{constructor(t,a){this._map=t,this._tr=new bs(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(U.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const c=a;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=c,this._box||(this._box=U.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(f.x,c.x),x=Math.max(f.x,c.x),S=Math.min(f.y,c.y),E=Math.max(f.y,c.y);U.setTransform(this._box,`translate(${_}px,${S}px)`),this._box.style.width=x-_+"px",this._box.style.height=E-S+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const c=this._startPos,f=a;if(this.reset(),U.suppressClick(),c.x!==f.x||c.y!==f.y)return this._map.fire(new l.l("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(c,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(U.remove(this._box),this._box=null),U.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new l.l(t,{originalEvent:a}))}}function Ki(g,t){if(g.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${t.length}`);const a={};for(let c=0;c<g.length;c++)a[g[c].identifier]=t[c];return a}class wt{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=(function(f){const _=new l.P(0,0);for(const x of f)_._add(x);return _.div(f.length)})(a),this.touches=Ki(c,a)))}touchmove(t,a,c){if(this.aborted||!this.centroid)return;const f=Ki(c,a);for(const _ in this.touches){const x=f[_];(!x||x.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,a,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class Fc{constructor(t){this.singleTap=new wt(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,c){this.singleTap.touchstart(t,a,c)}touchmove(t,a,c){this.singleTap.touchmove(t,a,c)}touchend(t,a,c){const f=this.singleTap.touchend(t,a,c);if(f){const _=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(f)<30;if(_&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class bh{constructor(t){this._tr=new bs(t),this._zoomIn=new Fc({numTouches:1,numTaps:2}),this._zoomOut=new Fc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,c){this._zoomIn.touchstart(t,a,c),this._zoomOut.touchstart(t,a,c)}touchmove(t,a,c){this._zoomIn.touchmove(t,a,c),this._zoomOut.touchmove(t,a,c)}touchend(t,a,c){const f=this._zoomIn.touchend(t,a,c),_=this._zoomOut.touchend(t,a,c),x=this._tr;return f?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(f)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ts{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const f=Array.isArray(a)?a[0]:a;return!this._moved&&f.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(c,f))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&U.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const bl=0,wl=2,wh={[bl]:1,[wl]:2};class Tl{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=U.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(a,c){const f=wh[c];return a.buttons===void 0||(a.buttons&f)!==f})(t,this._eventButton)}isValidEndEvent(t){return U.mouseButton(t)===this._eventButton}}class Th{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class $d{constructor(t=new Tl({checkCorrectEvent:()=>!0}),a=new Th){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(t,a,c){return t instanceof MouseEvent?a(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?c(t):void 0}startMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const Ss=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=t=>{t.preventDefault()}};class Ag{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,a,c){return this._calculateTransform(t,a,c)}touchmove(t,a,c){if(this._active){if(!this._shouldBePrevented(c.length))return t.preventDefault(),this._calculateTransform(t,a,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,a,c){this._calculateTransform(t,a,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,c){c.length>0&&(this._active=!0);const f=Ki(c,a),_=new l.P(0,0),x=new l.P(0,0);let S=0;for(const A in f){const R=f[A],N=this._touches[A];N&&(_._add(R),x._add(R.sub(N)),S++,f[A]=R)}if(this._touches=f,this._shouldBePrevented(S)||!x.mag())return;const E=x.div(S);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(S),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,c){if(!this._firstTwoTouches)return;t.preventDefault();const[f,_]=this._firstTwoTouches,x=Oc(c,a,f),S=Oc(c,a,_);if(!x||!S)return;const E=this._aroundCenter?null:x.add(S).div(2);return this._move([x,S],E,t)}touchend(t,a,c){if(!this._firstTwoTouches)return;const[f,_]=this._firstTwoTouches,x=Oc(c,a,f),S=Oc(c,a,_);x&&S||(this._active&&U.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Oc(g,t,a){for(let c=0;c<g.length;c++)if(g[c].identifier===a)return t[c]}function Zd(g,t){return Math.log(g/t)/Math.LN2}class Sh extends Bc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Zd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Zd(this._distance,c),pinchAround:a}}}function Wd(g,t){return 180*g.angleWith(t)/Math.PI}class Mh extends Bc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,c){const f=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Wd(this._vector,f),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,c=Wd(t,this._startVector);return Math.abs(c)<a}}function Ph(g){return Math.abs(g.y)>Math.abs(g.x)}class Hd extends Bc{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,c){super.touchstart(t,a,c),this._currentTouchCount=c.length}_start(t){this._lastPoints=t,Ph(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const f=t[0].sub(this._lastPoints[0]),_=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,_,c.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(f.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,c){if(this._valid!==void 0)return this._valid;const f=t.mag()>=2,_=a.mag()>=2;if(!f&&!_)return;if(!f||!_)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const x=t.y>0==a.y>0;return Ph(t)&&Ph(a)&&x}}const Wa={panStep:100,bearingStep:15,pitchStep:10};class Rn{constructor(t){this._tr=new bs(t);const a=Wa;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,c=0,f=0,_=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(c=0,f=0),{cameraAnimation:S=>{const E=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:kg,zoom:a?Math.round(E.zoom)+a*(t.shiftKey?2:1):E.zoom,bearing:E.bearing+c*this._bearingStep,pitch:E.pitch+f*this._pitchStep,offset:[-_*this._panStep,-x*this._panStep],center:E.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kg(g){return g*(2-g)}const Sl=4.000244140625,Nc=1/450;class Vc{constructor(t,a){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=t,this._tr=new bs(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Nc}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=ee(),f=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,a!==0&&a%Sl==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=U.mousePos(this._map.getCanvas(),t),c=this._tr;this._aroundPoint=this._aroundCenter?c.transform.locationToScreenPoint(l.V.convert(c.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const S=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=S),typeof this._targetZoom=="number"&&(this._targetZoom+=S)}if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Sl?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&E!==0&&(E=1/E);const A=typeof this._targetZoom!="number"?t.scale:l.aq(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),l.at(A*E)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,c=this._startZoom,f=this._easing;let _,x=!1;if(this._type==="wheel"&&c&&f){const S=ee()-this._lastWheelEventTime,E=Math.min((S+5)/200,1),A=f(E);_=l.G.number(c,a,A),E<1?this._frameId||(this._frameId=!0):x=!0}else _=a,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=_,{noInertia:!0,needsRenderFrame:!x,zoomDelta:_-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=l.cy;if(this._prevEase){const c=this._prevEase,f=(ee()-c.start)/c.duration,_=c.easing(f+.01)-c.easing(f),x=.27/Math.sqrt(_*_+1e-4)*.01,S=Math.sqrt(.0729-x*x);a=l.cw(x,S,.25,1)}return this._prevEase={start:ee(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Eh{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Xd{constructor(t){this._tr=new bs(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yd{constructor(){this._tap=new Fc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,c){if(!this._swipePoint)if(this._tapTime){const f=a[0],_=t.timeStamp-this._tapTime<500,x=this._tapPoint.dist(f)<30;_&&x?c.length>0&&(this._swipePoint=f,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(t,a,c)}touchmove(t,a,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const f=a[0],_=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,a,c)}touchend(t,a,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const f=this._tap.touchend(t,a,c);f&&(this._tapTime=t.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kd{constructor(t,a,c){this._el=t,this._mousePan=a,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ji{constructor(t,a,c,f){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=a,this._mousePitch=c,this._mouseRoll=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Ml{constructor(t,a,c,f){this._el=t,this._touchZoom=a,this._touchRotate=c,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Dt{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=U.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),f=document.createElement("div");f.className="maplibregl-desktop-message",f.textContent=a,this._container.appendChild(f);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=c,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(U.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,a){this._enabled&&(this._map.fire(new l.l("cooperativegestureprevented",{gestureType:t,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Ot=g=>g.zoom||g.drag||g.roll||g.pitch||g.rotate;class Pl extends l.l{}function jc(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta||g.rollDelta}class Uc{constructor(t,a){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,_)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=f.type==="renderFrame"?void 0:f,S={needsRenderFrame:!1},E={},A={};for(const{handlerName:O,handler:$,allowed:X}of this._handlers){if(!$.isEnabled())continue;let re;if(this._blockedByActive(A,X,O))$.reset();else if($[_||f.type]){if(l.cz(f,_||f.type)){const ae=U.mousePos(this._map.getCanvas(),f);re=$[_||f.type](f,ae)}else if(l.cA(f,_||f.type)){const ae=this._getMapTouches(f.touches),ie=U.touchPos(this._map.getCanvas(),ae);re=$[_||f.type](f,ie,ae)}else l.cB(_||f.type)||(re=$[_||f.type](f));this.mergeHandlerResult(S,E,re,O,x),re&&re.needsRenderFrame&&this._triggerRenderFrame()}(re||$.isActive())&&(A[O]=$)}const R={};for(const O in this._previousActiveHandlers)A[O]||(R[O]=x);this._previousActiveHandlers=A,(Object.keys(R).length||jc(S))&&(this._changes.push([S,E,R]),this._triggerRenderFrame()),(Object.keys(A).length||jc(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=S;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Eg(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,_,x]of this._listeners)U.addEventListener(f,_,f===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,a,c]of this._listeners)U.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const a=this._map,c=a.getCanvasContainer();this._add("mapEvent",new Cg(a,t));const f=a.boxZoom=new ws(a,t);this._add("boxZoom",f),t.interactive&&t.boxZoom&&f.enable();const _=a.cooperativeGestures=new Dt(a,t.cooperativeGestures);this._add("cooperativeGestures",_),t.cooperativeGestures&&_.enable();const x=new bh(a),S=new Xd(a);a.doubleClickZoom=new Eh(S,x),this._add("tapZoom",x),this._add("clickZoom",S),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const E=new Yd;this._add("tapDragZoom",E);const A=a.touchPitch=new Hd(a);this._add("touchPitch",A),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const R=()=>a.project(a.getCenter()),N=(function({enable:he,clickTolerance:xe,aroundCenter:Pe=!0,minPixelCenterThreshold:_e=100,rotateDegreesPerPixelMoved:Ce=.8},je){const Le=new Tl({checkCorrectEvent:Be=>U.mouseButton(Be)===0&&Be.ctrlKey||U.mouseButton(Be)===2&&!Be.ctrlKey});return new Ts({clickTolerance:xe,move:(Be,Oe)=>{const lt=je();if(Pe&&Math.abs(lt.y-Be.y)>_e)return{bearingDelta:l.cx(new l.P(Be.x,Oe.y),Oe,lt)};let ut=(Oe.x-Be.x)*Ce;return Pe&&Oe.y<lt.y&&(ut=-ut),{bearingDelta:ut}},moveStateManager:Le,enable:he,assignEvents:Ss})})(t,R),O=(function({enable:he,clickTolerance:xe,pitchDegreesPerPixelMoved:Pe=-.5}){const _e=new Tl({checkCorrectEvent:Ce=>U.mouseButton(Ce)===0&&Ce.ctrlKey||U.mouseButton(Ce)===2});return new Ts({clickTolerance:xe,move:(Ce,je)=>({pitchDelta:(je.y-Ce.y)*Pe}),moveStateManager:_e,enable:he,assignEvents:Ss})})(t),$=(function({enable:he,clickTolerance:xe,rollDegreesPerPixelMoved:Pe=.3},_e){const Ce=new Tl({checkCorrectEvent:je=>U.mouseButton(je)===2&&je.ctrlKey});return new Ts({clickTolerance:xe,move:(je,Le)=>{const Be=_e();let Oe=(Le.x-je.x)*Pe;return Le.y<Be.y&&(Oe=-Oe),{rollDelta:Oe}},moveStateManager:Ce,enable:he,assignEvents:Ss})})(t,R);a.dragRotate=new Ji(t,N,O,$),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",O,["mouseRotate","mouseRoll"]),this._add("mouseRoll",$,["mousePitch"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const X=(function({enable:he,clickTolerance:xe}){const Pe=new Tl({checkCorrectEvent:_e=>U.mouseButton(_e)===0&&!_e.ctrlKey});return new Ts({clickTolerance:xe,move:(_e,Ce)=>({around:Ce,panDelta:Ce.sub(_e)}),activateOnStart:!0,moveStateManager:Pe,enable:he,assignEvents:Ss})})(t),re=new Ag(t,a);a.dragPan=new Kd(c,X,re),this._add("mousePan",X),this._add("touchPan",re,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const ae=new Mh,ie=new Sh;a.touchZoomRotate=new Ml(c,ie,ae,E),this._add("touchRotate",ae,["touchPan","touchZoom"]),this._add("touchZoom",ie,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new Ig(a));const pe=a.scrollZoom=new Vc(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",pe,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const Te=a.keyboard=new Rn(a);this._add("keyboard",Te),t.interactive&&t.keyboard&&a.keyboard.enable()}_add(t,a,c){this._handlers.push({handlerName:t,handler:a,allowed:c}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ot(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,c){for(const f in t)if(f!==c&&(!a||a.indexOf(f)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const c of t)this._el.contains(c.target)&&a.push(c);return a}mergeHandlerResult(t,a,c,f,_){if(!c)return;l.e(t,c);const x={handlerName:f,originalEvent:c.originalEvent||_};c.zoomDelta!==void 0&&(a.zoom=x),c.panDelta!==void 0&&(a.drag=x),c.rollDelta!==void 0&&(a.roll=x),c.pitchDelta!==void 0&&(a.pitch=x),c.bearingDelta!==void 0&&(a.rotate=x)}_applyChanges(){const t={},a={},c={};for(const[f,_,x]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new l.P(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.rollDelta&&(t.rollDelta=(t.rollDelta||0)+f.rollDelta),f.around!==void 0&&(t.around=f.around),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),l.e(a,_),l.e(c,x);this._updateMapTransform(t,a,c),this._changes=[]}_updateMapTransform(t,a,c){const f=this._map,_=f._getTransformForUpdate(),x=f.terrain;if(!(jc(t)||x&&this._terrainMovement))return this._fireEvents(a,c,!0);f._stop(!0);let{panDelta:S,zoomDelta:E,bearingDelta:A,pitchDelta:R,rollDelta:N,around:O,pinchAround:$}=t;$!==void 0&&(O=$),O=O||f.transform.centerPoint,x&&!_.isPointOnMapSurface(O)&&(O=_.centerPoint);const X={panDelta:S,zoomDelta:E,rollDelta:N,pitchDelta:R,bearingDelta:A,around:O};this._map.cameraHelper.useGlobeControls&&!_.isPointOnMapSurface(O)&&(O=_.centerPoint);const re=O.distSqr(_.centerPoint)<.01?_.center:_.screenPointToLocation(S?O.sub(S):O);this._handleMapControls({terrain:x,tr:_,deltasForHelper:X,preZoomAroundLoc:re,combinedEventsInProgress:a,panDelta:S}),f._applyUpdatedTransform(_),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,c,!0)}_handleMapControls({terrain:t,tr:a,deltasForHelper:c,preZoomAroundLoc:f,combinedEventsInProgress:_,panDelta:x}){const S=this._map.cameraHelper;if(S.handleMapControlsRollPitchBearingZoom(c,a),t)return S.useGlobeControls?(this._terrainMovement||!_.drag&&!_.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void S.handleMapControlsPan(c,a,f)):this._terrainMovement||!_.drag&&!_.zoom?void(_.drag&&this._terrainMovement&&x?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(x))):S.handleMapControlsPan(c,a,f)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void S.handleMapControlsPan(c,a,f));S.handleMapControlsPan(c,a,f)}_fireEvents(t,a,c){const f=Ot(this._eventsInProgress),_=Ot(t),x={};for(const N in t){const{originalEvent:O}=t[N];this._eventsInProgress[N]||(x[`${N}start`]=O),this._eventsInProgress[N]=t[N]}!f&&_&&this._fireEvent("movestart",_.originalEvent);for(const N in x)this._fireEvent(N,x[N]);_&&this._fireEvent("move",_.originalEvent);for(const N in t){const{originalEvent:O}=t[N];this._fireEvent(N,O)}const S={};let E;for(const N in this._eventsInProgress){const{handlerName:O,originalEvent:$}=this._eventsInProgress[N];this._handlersById[O].isActive()||(delete this._eventsInProgress[N],E=a[O]||$,S[`${N}end`]=E)}for(const N in S)this._fireEvent(N,S[N]);const A=Ot(this._eventsInProgress),R=(f||_)&&!A;if(R&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const N=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&N.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(N)}if(c&&R){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;!N||!N.essential&&G.prefersReducedMotion?(this._map.fire(new l.l("moveend",{originalEvent:E})),O(this._map.getBearing())&&this._map.resetNorth()):(O(N.bearing||this._map.getBearing())&&(N.bearing=0),N.freezeElevation=!0,this._map.easeTo(N,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new l.l(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new Pl("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class di extends l.E{constructor(t,a,c){super(),this._renderFrameCallback=()=>{const f=Math.min((ee()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=c.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,a){t.apply(this.transform,!0),this.transform=t,this.cameraHelper=a}getCenter(){return new l.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,a){return this.jumpTo({elevation:t},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,a,c){return t=l.P.convert(t).mult(-1),this.panTo(this.transform.center,l.e({offset:t},a),c)}panTo(t,a,c){return this.easeTo(l.e({center:t},a),c)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,c){return this.easeTo(l.e({zoom:t},a),c)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,a){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new l.l("movestart",a)).fire(new l.l("move",a)).fire(new l.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,c){return this.easeTo(l.e({bearing:t},a),c)}resetNorth(t,a){return this.rotateTo(0,l.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(l.e({bearing:0,pitch:0,roll:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}getRoll(){return this.transform.roll}setRoll(t,a){return this.jumpTo({roll:t},a),this}cameraForBounds(t,a){t=qt.convert(t).adjustAntiMeridian();const c=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,a)}_cameraForBoxAndBearing(t,a,c,f){const _={top:0,bottom:0,right:0,left:0};if(typeof(f=l.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const A=f.padding;f.padding={top:A,bottom:A,right:A,left:A}}const x=l.e(_,f.padding);f.padding=x;const S=this.transform,E=new qt(t,a);return this.cameraHelper.cameraForBoxAndBearing(f,x,E,c,S)}fitBounds(t,a,c){return this._fitInternal(this.cameraForBounds(t,a),a,c)}fitScreenCoordinates(t,a,c,f,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(l.P.convert(t)),this.transform.screenPointToLocation(l.P.convert(a)),c,f),f,_)}_fitInternal(t,a,c){return t?(delete(a=l.e(t,a)).padding,a.linear?this.easeTo(a,c):this.flyTo(a,c)):this}jumpTo(t,a){this.stop();const c=this._getTransformForUpdate();let f=!1,_=!1,x=!1;const S=c.zoom;this.cameraHelper.handleJumpToCenterZoom(c,t);const E=c.zoom!==S;return"elevation"in t&&c.elevation!==+t.elevation&&c.setElevation(+t.elevation),"bearing"in t&&c.bearing!==+t.bearing&&(f=!0,c.setBearing(+t.bearing)),"pitch"in t&&c.pitch!==+t.pitch&&(_=!0,c.setPitch(+t.pitch)),"roll"in t&&c.roll!==+t.roll&&(x=!0,c.setRoll(+t.roll)),t.padding==null||c.isPaddingEqual(t.padding)||c.setPadding(t.padding),this._applyUpdatedTransform(c),this.fire(new l.l("movestart",a)).fire(new l.l("move",a)),E&&this.fire(new l.l("zoomstart",a)).fire(new l.l("zoom",a)).fire(new l.l("zoomend",a)),f&&this.fire(new l.l("rotatestart",a)).fire(new l.l("rotate",a)).fire(new l.l("rotateend",a)),_&&this.fire(new l.l("pitchstart",a)).fire(new l.l("pitch",a)).fire(new l.l("pitchend",a)),x&&this.fire(new l.l("rollstart",a)).fire(new l.l("roll",a)).fire(new l.l("rollend",a)),this.fire(new l.l("moveend",a))}calculateCameraOptionsFromTo(t,a,c,f=0){const _=l.a9.fromLngLat(t,a),x=l.a9.fromLngLat(c,f),S=x.x-_.x,E=x.y-_.y,A=x.z-_.z,R=Math.hypot(S,E,A);if(R===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(S,E),O=l.at(this.transform.cameraToCenterDistance/R/this.transform.tileSize),$=180*Math.atan2(S,-E)/Math.PI;let X=180*Math.acos(N/R)/Math.PI;return X=A<0?90-X:90+X,{center:x.toLngLat(),elevation:f,zoom:O,pitch:X,bearing:$}}calculateCameraOptionsFromCameraLngLatAltRotation(t,a,c,f,_){const x=this.transform.calculateCenterFromCameraLngLatAlt(t,a,c,f);return{center:x.center,elevation:x.elevation,zoom:x.zoom,bearing:c,pitch:f,roll:_}}easeTo(t,a){this._stop(!1,t.easeId),((t=l.e({offset:[0,0],duration:500,easing:l.cy},t)).animate===!1||!t.essential&&G.prefersReducedMotion)&&(t.duration=0);const c=this._getTransformForUpdate(),f=this.getBearing(),_=c.pitch,x=c.roll,S="bearing"in t?this._normalizeBearing(t.bearing,f):f,E="pitch"in t?+t.pitch:_,A="roll"in t?this._normalizeBearing(t.roll,x):x,R="padding"in t?t.padding:c.padding,N=l.P.convert(t.offset);let O,$;t.around&&(O=l.V.convert(t.around),$=c.locationToScreenPoint(O));const X={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},re=this.cameraHelper.handleEaseTo(c,{bearing:S,pitch:E,roll:A,padding:R,around:O,aroundPoint:$,offsetAsPoint:N,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||f!==S,this._pitching=this._pitching||E!==_,this._rolling=this._rolling||A!==x,this._padding=!c.isPaddingEqual(R),this._zooming=this._zooming||re.isZooming,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,X),this.terrain&&this._prepareElevation(re.elevationCenter),this._ease((ae=>{re.easeFunc(ae),this.terrain&&!t.freezeElevation&&this._updateElevation(ae),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(ae=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a,ae)}),t),this}_prepareEase(t,a,c={}){this._moving=!0,a||c.moving||this.fire(new l.l("movestart",t)),this._zooming&&!c.zooming&&this.fire(new l.l("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new l.l("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new l.l("pitchstart",t)),this._rolling&&!c.rolling&&this.fire(new l.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(c-(a-(c*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.setElevation(l.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const a=t.getCameraLngLat(),c=t.getCameraAltitude(),f=this.terrain?this.terrain.getElevationForLngLatZoom(a,t.zoom):0;if(c<f){const _=this.calculateCameraOptionsFromTo(a,f,t.center,t.elevation);return{pitch:_.pitch,zoom:_.zoom}}return{}}_applyUpdatedTransform(t){const a=[];if(a.push((f=>this._elevateCameraIfInsideTerrain(f))),this.transformCameraUpdate&&a.push((f=>this.transformCameraUpdate(f))),!a.length)return;const c=t.clone();for(const f of a){const _=c.clone(),{center:x,zoom:S,roll:E,pitch:A,bearing:R,elevation:N}=f(_);x&&_.setCenter(x),N!==void 0&&_.setElevation(N),S!==void 0&&_.setZoom(S),E!==void 0&&_.setRoll(E),A!==void 0&&_.setPitch(A),R!==void 0&&_.setBearing(R),c.apply(_,!1)}this.transform.apply(c,!1)}_fireMoveEvents(t){this.fire(new l.l("move",t)),this._zooming&&this.fire(new l.l("zoom",t)),this._rotating&&this.fire(new l.l("rotate",t)),this._pitching&&this.fire(new l.l("pitch",t)),this._rolling&&this.fire(new l.l("roll",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const c=this._zooming,f=this._rotating,_=this._pitching,x=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,c&&this.fire(new l.l("zoomend",t)),f&&this.fire(new l.l("rotateend",t)),_&&this.fire(new l.l("pitchend",t)),x&&this.fire(new l.l("rollend",t)),this.fire(new l.l("moveend",t))}flyTo(t,a){if(!t.essential&&G.prefersReducedMotion){const Oe=l.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Oe,a)}this.stop(),t=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.cy},t);const c=this._getTransformForUpdate(),f=c.bearing,_=c.pitch,x=c.roll,S=c.padding,E="bearing"in t?this._normalizeBearing(t.bearing,f):f,A="pitch"in t?+t.pitch:_,R="roll"in t?this._normalizeBearing(t.roll,x):x,N="padding"in t?t.padding:c.padding,O=l.P.convert(t.offset);let $=c.centerPoint.add(O);const X=c.screenPointToLocation($),re=this.cameraHelper.handleFlyTo(c,{bearing:E,pitch:A,roll:R,padding:N,locationAtOffset:X,offsetAsPoint:O,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let ae=t.curve;const ie=Math.max(c.width,c.height),pe=ie/re.scaleOfZoom,Te=re.pixelPathLength;typeof re.scaleOfMinZoom=="number"&&(ae=Math.sqrt(ie/re.scaleOfMinZoom/Te*2));const he=ae*ae;function xe(Oe){const lt=(pe*pe-ie*ie+(Oe?-1:1)*he*he*Te*Te)/(2*(Oe?pe:ie)*he*Te);return Math.log(Math.sqrt(lt*lt+1)-lt)}function Pe(Oe){return(Math.exp(Oe)-Math.exp(-Oe))/2}function _e(Oe){return(Math.exp(Oe)+Math.exp(-Oe))/2}const Ce=xe(!1);let je=function(Oe){return _e(Ce)/_e(Ce+ae*Oe)},Le=function(Oe){return ie*((_e(Ce)*(Pe(lt=Ce+ae*Oe)/_e(lt))-Pe(Ce))/he)/Te;var lt},Be=(xe(!0)-Ce)/ae;if(Math.abs(Te)<2e-6||!isFinite(Be)){if(Math.abs(ie-pe)<1e-6)return this.easeTo(t,a);const Oe=pe<ie?-1:1;Be=Math.abs(Math.log(pe/ie))/ae,Le=()=>0,je=lt=>Math.exp(Oe*ae*lt)}return t.duration="duration"in t?+t.duration:1e3*Be/("screenSpeed"in t?+t.screenSpeed/ae:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=f!==E,this._pitching=A!==_,this._rolling=R!==x,this._padding=!c.isPaddingEqual(N),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(re.targetCenter),this._ease((Oe=>{const lt=Oe*Be,ut=1/je(lt),nt=Le(lt);this._rotating&&c.setBearing(l.G.number(f,E,Oe)),this._pitching&&c.setPitch(l.G.number(_,A,Oe)),this._rolling&&c.setRoll(l.G.number(x,R,Oe)),this._padding&&(c.interpolatePadding(S,N,Oe),$=c.centerPoint.add(O)),re.easeFunc(Oe,ut,nt,$),this.terrain&&!t.freezeElevation&&this._updateElevation(Oe),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,a)}return t||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(t,a,c){c.animate===!1||c.duration===0?(t(1),a()):(this._easeStart=ee(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=l.W(t,-180,180);const c=Math.abs(t-a);return Math.abs(t-360-a)<c&&(t-=360),Math.abs(t+360-a)<c&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(l.V.convert(t),this.transform):null}}const Bi={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ch{constructor(t=Bi){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=U.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=U.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){U.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const c=this._map._getUIString(`AttributionControl.${a}`);t.title=c,t.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((f=>typeof f!="string"?"":f))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const a=this._map.style.tileManagers;for(const f in a){const _=a[f];if(_.used||_.usedForTerrain){const x=_.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t=t.filter((f=>String(f).trim())),t.sort(((f,_)=>f.length-_.length)),t=t.filter(((f,_)=>{for(let x=_+1;x<t.length;x++)if(t[x].indexOf(f)>=0)return!1;return!0}));const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=U.sanitize(c),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Jd{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const c=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=U.create("div","maplibregl-ctrl");const a=U.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){U.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Dg{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,c=a?this._queue.concat(a):this._queue;for(const f of c)if(f.id===t)return void(f.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const c of a)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var zg=l.aU([{name:"a_pos3d",type:"Int16",components:3}]);class El extends l.E{constructor(t){super(),this._lastTilesetChange=ee(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,a){this.tileManager.update(t,a),this._renderableTilesKeys=[];const c={};for(const f of ar(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))c[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.terrainRttPosMatrix32f=new Float64Array(16),l.c7(f.terrainRttPosMatrix32f,0,l.a5,l.a5,0,0,1),this._tiles[f.key]=new Xe(f,this.tileSize),this._lastTilesetChange=ee());for(const f in this._tiles)c[f]||delete this._tiles[f]}freeRtt(t){for(const a in this._tiles){const c=this._tiles[a];(!t||c.tileID.equals(t)||c.tileID.isChildOf(t)||t.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,a){return a?this._getTerrainCoordsForTileRanges(t,a):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const a={};for(const c of this._renderableTilesKeys){const f=this._tiles[c].tileID,_=t.clone(),x=l.bk();if(f.canonical.equals(t.canonical))l.c7(x,0,l.a5,l.a5,0,0,1);else if(f.canonical.isChildOf(t.canonical)){const S=f.canonical.z-t.canonical.z,E=f.canonical.x-(f.canonical.x>>S<<S),A=f.canonical.y-(f.canonical.y>>S<<S),R=l.a5>>S;l.c7(x,0,R,R,0,0,1),l.O(x,x,[-E*R,-A*R,0])}else{if(!t.canonical.isChildOf(f.canonical))continue;{const S=t.canonical.z-f.canonical.z,E=t.canonical.x-(t.canonical.x>>S<<S),A=t.canonical.y-(t.canonical.y>>S<<S),R=l.a5>>S;l.c7(x,0,l.a5,l.a5,0,0,1),l.O(x,x,[E*R,A*R,0]),l.Q(x,x,[1/2**S,1/2**S,0])}}_.terrainRttPosMatrix32f=new Float32Array(x),a[c]=_}return a}_getTerrainCoordsForTileRanges(t,a){const c={};for(const f of this._renderableTilesKeys){const _=this._tiles[f].tileID;if(!this._isWithinTileRanges(_,a))continue;const x=t.clone(),S=l.bk();if(_.canonical.z===t.canonical.z){const E=t.canonical.x-_.canonical.x+t.wrap*(1<<t.canonical.z),A=t.canonical.y-_.canonical.y;l.c7(S,0,l.a5,l.a5,0,0,1),l.O(S,S,[E*l.a5,A*l.a5,0])}else if(_.canonical.z>t.canonical.z){const E=_.canonical.z-t.canonical.z,A=_.canonical.x-(_.canonical.x>>E<<E)+t.wrap*(1<<_.canonical.z),R=_.canonical.y-(_.canonical.y>>E<<E),N=t.canonical.x-(_.canonical.x>>E),O=t.canonical.y-(_.canonical.y>>E),$=l.a5>>E;l.c7(S,0,$,$,0,0,1),l.O(S,S,[-A*$+N*l.a5,-R*$+O*l.a5,0])}else{const E=t.canonical.z-_.canonical.z,A=t.canonical.x-(t.canonical.x>>E<<E)+t.wrap*(1<<t.canonical.z),R=t.canonical.y-(t.canonical.y>>E<<E),N=(t.canonical.x>>E)-_.canonical.x,O=(t.canonical.y>>E)-_.canonical.y,$=l.a5<<E;l.c7(S,0,$,$,0,0,1),l.O(S,S,[A*l.a5+N*$,R*l.a5+O*$,0])}x.terrainRttPosMatrix32f=new Float32Array(S),c[f]=x}return c}getSourceTile(t,a){const c=this.tileManager._source;let f=t.overscaledZ-this.deltaZoom;if(f>c.maxzoom&&(f=c.maxzoom),f<c.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(f).key);let _=this.findTileInCaches(this._sourceTileCache[t.key]);if(!_?.dem&&a)for(;f>=c.minzoom&&!_?.dem;)_=this.findTileInCaches(t.scaledTo(f--).key);return _}findTileInCaches(t){let a=this.tileManager.getTileByID(t);return a||(a=this.tileManager._outOfViewCache.getByKey(t),a)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,a){const c=a[t.canonical.z];return!!c&&(t.wrap>c.minWrap||t.wrap<c.maxWrap||t.canonical.x>=c.minTileXWrapped&&t.canonical.x<=c.maxTileXWrapped&&t.canonical.y>=c.minTileY&&t.canonical.y<=c.maxTileY)}}class nr{constructor(t,a,c){this._meshCache={},this.painter=t,this.tileManager=new El(a),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,c,f=l.a5){var _;if(!(a>=0&&a<f&&c>=0&&c<f))return 0;const x=this.getTerrainData(t),S=(_=x.tile)===null||_===void 0?void 0:_.dem;if(!S)return 0;const E=l.cC([],[a/f*l.a5,c/f*l.a5],x.u_terrain_matrix),A=[E[0]*S.dim,E[1]*S.dim],R=Math.floor(A[0]),N=Math.floor(A[1]),O=A[0]-R,$=A[1]-N;return S.get(R,N)*(1-O)*(1-$)+S.get(R+1,N)*O*(1-$)+S.get(R,N+1)*(1-O)*$+S.get(R+1,N+1)*O*$}getElevationForLngLatZoom(t,a){if(!l.cD(a,t.wrap()))return 0;const{tileID:c,mercatorX:f,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(c,f%l.a5,_%l.a5,l.a5)}getElevationForLngLat(t,a){const c=ar(a,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let f=0;for(const _ of c)_.canonical.z>f&&(f=Math.min(_.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,f)}getElevation(t,a,c,f=l.a5){return this.getDEMElevation(t,a,c,f)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const f=this.painter.context,_=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new l.T(f,_,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new l.T(f,new l.R({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ar([])}const a=this.tileManager.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const f=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new l.T(f,a.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),a.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const c=a&&a.toString()+a.tileID.key+t.key;if(c&&!this._demMatrixCache[c]){const f=this.tileManager.getSource().maxzoom;let _=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=f?_=t.canonical.z-f:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=t.canonical.x-(t.canonical.x>>_<<_),S=t.canonical.y-(t.canonical.y>>_<<_),E=l.cE(new Float64Array(16),[1/(l.a5<<_),1/(l.a5<<_),0]);l.O(E,E,[x*l.a5,S*l.a5,0]),this._demMatrixCache[t.key]={matrix:E,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,c=a.width/devicePixelRatio,f=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new l.T(a.context,{width:c,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new l.T(a.context,{width:c,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(c,f,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,c,f))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,x=0;_<this._coordsTextureSize;_++)for(let S=0;S<this._coordsTextureSize;S++,x+=4)a[x+0]=255&S,a[x+1]=255&_,a[x+2]=S>>8<<4|_>>8,a[x+3]=0;const c=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),f=new l.T(t,c,t.gl.RGBA,{premultiply:!1});return f.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),c=this.painter.context,f=c.gl,_=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),x=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(_,S-x-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null);const E=a[0]+(a[2]>>4<<8),A=a[1]+((15&a[2])<<8),R=this.coordsIndex[255-a[3]],N=R&&this.tileManager.getTileByID(R);if(!N)return null;const O=this._coordsTextureSize,$=(1<<N.tileID.canonical.z)*O;return new l.a9((N.tileID.canonical.x*O+E)/$+N.tileID.wrap,(N.tileID.canonical.y*O+A)/$,this.getElevation(N.tileID,E,A,O))}depthAtPoint(t){const a=new Uint8Array(4),c=this.painter.context,f=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),f.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(t){var a;const c=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,f=c&&t.canonical.y===0,_=c&&t.canonical.y===(1<<t.canonical.z)-1,x=`m_${f?"n":""}_${_?"s":""}`;if(this._meshCache[x])return this._meshCache[x];const S=this.painter.context,E=new l.cF,A=new l.aY,R=this.meshSize,N=l.a5/R,O=R*R;for(let _e=0;_e<=R;_e++)for(let Ce=0;Ce<=R;Ce++)E.emplaceBack(Ce*N,_e*N,0);for(let _e=0;_e<O;_e+=R+1)for(let Ce=0;Ce<R;Ce++)A.emplaceBack(Ce+_e,R+Ce+_e+1,R+Ce+_e+2),A.emplaceBack(Ce+_e,R+Ce+_e+2,Ce+_e+1);const $=E.length,X=$+(R+1),re=(R+1)*R,ae=f?l.br:0,ie=f?0:1,pe=_?l.bs:l.a5,Te=_?0:1;for(let _e=0;_e<=R;_e++)E.emplaceBack(_e*N,ae,ie);for(let _e=0;_e<=R;_e++)E.emplaceBack(_e*N,pe,Te);for(let _e=0;_e<R;_e++)A.emplaceBack(re+_e,X+_e,X+_e+1),A.emplaceBack(re+_e,X+_e+1,re+_e+1),A.emplaceBack(0+_e,$+_e+1,$+_e),A.emplaceBack(0+_e,0+_e+1,$+_e+1);const he=E.length,xe=he+2*(R+1);for(const _e of[0,1])for(let Ce=0;Ce<=R;Ce++)for(const je of[0,1])E.emplaceBack(_e*l.a5,Ce*N,je);for(let _e=0;_e<2*R;_e+=2)A.emplaceBack(he+_e,he+_e+1,he+_e+3),A.emplaceBack(he+_e,he+_e+3,he+_e+2),A.emplaceBack(xe+_e,xe+_e+3,xe+_e+1),A.emplaceBack(xe+_e,xe+_e+2,xe+_e+3);const Pe=new Bn(S.createVertexBuffer(E,zg.members),S.createIndexBuffer(A),l.aX.simpleSegment(0,0,E.length,A.length));return this._meshCache[x]=Pe,Pe}getMeshFrameDelta(t){return 2*Math.PI*l.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,a){var c;if(!l.cD(a,t.wrap()))return 0;const{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(c=this.getMinMaxElevation(f).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,c={minElevation:null,maxElevation:null};return a&&a.dem&&(c.minElevation=a.dem.min*this.exaggeration,c.maxElevation=a.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(t,a){const c=l.a9.fromLngLat(t.wrap()),f=(1<<a)*l.a5,_=c.x*f,x=c.y*f,S=Math.floor(_/l.a5),E=Math.floor(x/l.a5);return{tileID:new l.a2(a,0,a,S,E),mercatorX:_,mercatorY:x}}}class dr{constructor(t,a,c){this._context=t,this._size=a,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new l.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(c.texture),{id:t,fbo:a,texture:c,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>t.id!==a)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const Po={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Cl{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new dr(t.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((c=>!t._layers[c].isHidden(a))),this._coordsAscending={};for(const c in t.tileManagers){this._coordsAscending[c]={};const f=t.tileManagers[c].getVisibleCoordinates(),_=t.tileManagers[c].getSource(),x=_ instanceof gr?_.terrainTileRanges:null;for(const S of f){const E=this.terrain.tileManager.getTerrainCoords(S,x);for(const A in E)this._coordsAscending[c][A]||(this._coordsAscending[c][A]=[]),this._coordsAscending[c][A].push(E[A])}}this._coordsAscendingStr={};for(const c of t._order){const f=t._layers[c],_=f.source;if(Po[f.type]&&!this._coordsAscendingStr[_]){this._coordsAscendingStr[_]={};for(const x in this._coordsAscending[_])this._coordsAscendingStr[_][x]=this._coordsAscending[_][x].map((S=>S.key)).sort().join()}}for(const c of this._renderableTiles)for(const f in this._coordsAscendingStr){const _=this._coordsAscendingStr[f][c.tileID.key];_&&_!==c.rttCoords[f]&&(c.rtt=[])}}renderLayer(t,a){if(t.isHidden(this.painter.transform.zoom))return!1;const c=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),f=t.type,_=this.painter,x=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Po[f]&&(this._prevType&&Po[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(t.id),!x))return!0;if(Po[this._prevType]||Po[f]&&x){this._prevType=f;const S=this._stacks.length-1,E=this._stacks[S]||[];for(const A of this._renderableTiles){if(this.pool.isFull()&&(_h(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(A),A.rtt[S]){const N=this.pool.getObjectForId(A.rtt[S].id);if(N.stamp===A.rtt[S].stamp){this.pool.useObject(N);continue}}const R=this.pool.getOrCreateFreeObject();this.pool.useObject(R),this.pool.stampObject(R),A.rtt[S]={id:R.id,stamp:R.stamp},_.context.bindFramebuffer.set(R.fbo.framebuffer),_.context.clear({color:l.bp.transparent,stencil:0}),_.currentStencilSource=void 0;for(let N=0;N<E.length;N++){const O=_.style._layers[E[N]],$=O.source?this._coordsAscending[O.source][A.tileID.key]:[A.tileID];_.context.viewport.set([0,0,R.fbo.width,R.fbo.height]),_._renderTileClippingMasks(O,$,!0),_.renderLayer(_,_.style.tileManagers[O.source],O,$,c),O.source&&(A.rttCoords[O.source]=this._coordsAscendingStr[O.source][A.tileID.key])}}return _h(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects(),Po[f]}return!1}}const qc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ih=C,Gc={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Bi,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Ah={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Il{constructor(t,a,c=!1){this.mousedown=_=>{this.startMove(_,U.mousePos(this.element,_)),U.addEventListener(window,"mousemove",this.mousemove),U.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.move(_,U.mousePos(this.element,_))},this.mouseup=_=>{this._rotatePitchHandler.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=U.touchPos(this.element,_.targetTouches)[0],this.startMove(_,this._startPos),U.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=U.touchPos(this.element,_.targetTouches)[0],this.move(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const f=new $d;this._rotatePitchHandler=new Ts({clickTolerance:3,move:(_,x)=>{const S=a.getBoundingClientRect(),E=new l.P((S.bottom-S.top)/2,(S.right-S.left)/2);return{bearingDelta:l.cx(new l.P(_.x,x.y),x,E),pitchDelta:c?-.5*(x.y-_.y):void 0}},moveStateManager:f,enable:!0,assignEvents:()=>{}}),this.map=t,U.addEventListener(a,"mousedown",this.mousedown),U.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),U.addEventListener(a,"touchcancel",this.reset)}startMove(t,a){this._rotatePitchHandler.dragStart(t,a),U.disableDrag()}move(t,a){const c=this.map,{bearingDelta:f,pitchDelta:_}=this._rotatePitchHandler.dragMove(t,a)||{};f&&c.setBearing(c.getBearing()+f),_&&c.setPitch(c.getPitch()+_)}off(){const t=this.element;U.removeEventListener(t,"mousedown",this.mousedown),U.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend),U.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){U.enableDrag(),U.removeEventListener(window,"mousemove",this.mousemove),U.removeEventListener(window,"mouseup",this.mouseup),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend)}}let Sa;function $c(g,t,a,c=!1){if(c||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return g?.wrap();const f=new l.V(g.lng,g.lat);if(g=new l.V(g.lng,g.lat),t){const _=new l.V(g.lng-360,g.lat),x=new l.V(g.lng+360,g.lat),S=a.locationToScreenPoint(g).distSqr(t);a.locationToScreenPoint(_).distSqr(t)<S?g=_:a.locationToScreenPoint(x).distSqr(t)<S&&(g=x)}for(;Math.abs(g.lng-a.center.lng)>180;){const _=a.locationToScreenPoint(g);if(_.x>=0&&_.y>=0&&_.x<=a.width&&_.y<=a.height)break;g.lng>a.center.lng?g.lng-=360:g.lng+=360}return g.lng!==f.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(g))?g:f}const Al={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Zc(g,t,a){const c=g.classList;for(const f in Al)c.remove(`maplibregl-${a}-anchor-${f}`);c.add(`maplibregl-${a}-anchor-${t}`)}class kl extends l.E{constructor(t){if(super(),this._onKeyPress=a=>{const c=a.code,f=a.charCode||a.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=a=>{const c=a.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=$c(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),U.setTransform(this._element,`${Al[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${f}`),G.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.l("dragstart"))),this.fire(new l.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=l.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=U.create("div");const a=U.createNS("http://www.w3.org/2000/svg","svg"),c=41,f=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${c}px`),a.setAttributeNS(null,"width",`${f}px`),a.setAttributeNS(null,"viewBox",`0 0 ${f} ${c}`);const _=U.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const x=U.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const S=U.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ie of E){const pe=U.createNS("http://www.w3.org/2000/svg","ellipse");pe.setAttributeNS(null,"opacity","0.04"),pe.setAttributeNS(null,"cx","10.5"),pe.setAttributeNS(null,"cy","5.80029008"),pe.setAttributeNS(null,"rx",ie.rx),pe.setAttributeNS(null,"ry",ie.ry),S.appendChild(pe)}const A=U.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const R=U.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(R);const N=U.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"fill","#000000");const O=U.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),N.appendChild(O);const $=U.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");const X=U.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(8.0, 8.0)");const re=U.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#000000"),re.setAttributeNS(null,"opacity","0.25"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962");const ae=U.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#FFFFFF"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962"),X.appendChild(re),X.appendChild(ae),x.appendChild(S),x.appendChild(A),x.appendChild(N),x.appendChild($),x.appendChild(X),a.appendChild(x),a.setAttributeNS(null,"height",c*this._scale+"px"),a.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(a),this._offset=l.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),Zc(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),U.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const f=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,c;const f=(a=this._map)===null||a===void 0?void 0:a.terrain,_=this._map.transform.isLocationOccluded(this._lngLat);if(!f||_){const $=_?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==$&&(this._element.style.opacity=$))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const x=this._map,S=x.terrain.depthAtPoint(this._pos),E=x.terrain.getElevationForLngLat(this._lngLat,x.transform);if(x.transform.lngLatToCameraDepth(this._lngLat,E)-S<.006)return void(this._element.style.opacity=this._opacity);const A=-this._offset.y/x.transform.pixelsPerMeter,R=Math.sin(x.getPitch()*Math.PI/180)*A,N=x.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),O=x.transform.lngLatToCameraDepth(this._lngLat,E+R)-N>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&O&&this._popup.remove(),this._element.style.opacity=O?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=l.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return(this._opacity===void 0||t===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const kh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ms=0,Eo=!1;const Dh={maxWidth:100,unit:"metric"};function Dl(g,t,a){const c=a&&a.maxWidth||100,f=g._container.clientHeight/2,_=g._container.clientWidth/2,x=g.unproject([_-c/2,f]),S=g.unproject([_+c/2,f]),E=Math.round(g.project(S).x-g.project(x).x),A=Math.min(c,E,g._container.clientWidth),R=x.distanceTo(S);if(a&&a.unit==="imperial"){const N=3.2808*R;N>5280?Co(t,A,N/5280,g._getUIString("ScaleControl.Miles")):Co(t,A,N,g._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Co(t,A,R/1852,g._getUIString("ScaleControl.NauticalMiles")):R>=1e3?Co(t,A,R/1e3,g._getUIString("ScaleControl.Kilometers")):Co(t,A,R,g._getUIString("ScaleControl.Meters"))}function Co(g,t,a,c){const f=(function(_){const x=Math.pow(10,`${Math.floor(_)}`.length-1);let S=_/x;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:(function(E){const A=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*A)/A})(S),x*S})(a);g.style.width=t*(f/a)+"px",g.innerHTML=`${f}&nbsp;${c}`}const zh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0,padding:void 0},Wc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Hc(g){if(g){if(typeof g=="number"){const t=Math.round(Math.abs(g)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,g),"top-left":new l.P(t,t),"top-right":new l.P(-t,t),bottom:new l.P(0,-g),"bottom-left":new l.P(t,-t),"bottom-right":new l.P(-t,-t),left:new l.P(g,0),right:new l.P(-g,0)}}if(g instanceof l.P||Array.isArray(g)){const t=l.P.convert(g);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:l.P.convert(g.center||[0,0]),top:l.P.convert(g.top||[0,0]),"top-left":l.P.convert(g["top-left"]||[0,0]),"top-right":l.P.convert(g["top-right"]||[0,0]),bottom:l.P.convert(g.bottom||[0,0]),"bottom-left":l.P.convert(g["bottom-left"]||[0,0]),"bottom-right":l.P.convert(g["bottom-right"]||[0,0]),left:l.P.convert(g.left||[0,0]),right:l.P.convert(g.right||[0,0])}}return Hc(new l.P(0,0))}const Rh=C;v.AJAXError=l.cI,v.Event=l.l,v.Evented=l.E,v.LngLat=l.V,v.MercatorCoordinate=l.a9,v.Point=l.P,v.addProtocol=l.cJ,v.config=l.c,v.removeProtocol=l.cK,v.AttributionControl=Ch,v.BoxZoomHandler=ws,v.CanvasSource=H,v.CooperativeGesturesHandler=Dt,v.DoubleClickZoomHandler=Eh,v.DragPanHandler=Kd,v.DragRotateHandler=Ji,v.EdgeInsets=as,v.FullscreenControl=class extends l.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var t;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=a?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){U.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=U.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);U.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},v.GeoJSONSource=Oa,v.GeolocateControl=class extends l.E{constructor(g){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new l.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new l.V(t.coords.longitude,t.coords.latitude),c=t.coords.accuracy,f=this._map.getBearing(),_=l.e({bearing:f},this.options.fitBoundsOptions),x=qt.fromLngLat(a,c);this._map.fitBounds(x,_,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new l.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Eo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=U.create("button","maplibregl-ctrl-geolocate",this._container),U.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new kl({element:this._dotElement}),this._circleElement=U.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new kl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const c=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.l("trackuserlocationend")),this.fire(new l.l("userlocationlostfocus")))}))}},this.options=l.e({},kh,g)}onAdd(g){return this._map=g,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return l._(this,arguments,void 0,(function*(t=!1){if(Sa!==void 0&&!t)return Sa;if(window.navigator.permissions===void 0)return Sa=!!window.navigator.geolocation,Sa;try{Sa=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Sa=!!window.navigator.geolocation}return Sa}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),U.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Ms=0,Eo=!1}_isOutOfMapMaxBounds(g){const t=this._map.getMaxBounds(),a=g.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const g=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&g))return;const t=this._map.project(g),a=this._map.unproject([t.x+100,t.y]),c=g.distanceTo(a)/100,f=2*this._accuracy/c;this._circleElement.style.width=`${f.toFixed(2)}px`,this._circleElement.style.height=`${f.toFixed(2)}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ms--,Eo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.l("trackuserlocationstart")),this.fire(new l.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ms++,Ms>1?(g={maximumAge:6e5,timeout:0},Eo=!0):(g=this.options.positionOptions,Eo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},v.GlobeControl=class{constructor(){this._toggleProjection=()=>{var g;const t=(g=this._map.getProjection())===null||g===void 0?void 0:g.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var g;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((g=this._map.getProjection())===null||g===void 0?void 0:g.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(g){return this._map=g,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=U.create("button","maplibregl-ctrl-globe",this._container),U.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){U.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},v.Hash=xh,v.ImageSource=gr,v.KeyboardHandler=Rn,v.LngLatBounds=qt,v.LogoControl=Jd,v.Map=class extends di{constructor(g){var t,a;l.cG.mark(l.cH.create);const c=Object.assign(Object.assign(Object.assign({},Gc),g),{canvasContextAttributes:Object.assign(Object.assign({},Gc.canvasContextAttributes),g.canvasContextAttributes)});if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const f=new mo,_=new go;if(c.minZoom!==void 0&&f.setMinZoom(c.minZoom),c.maxZoom!==void 0&&f.setMaxZoom(c.maxZoom),c.minPitch!==void 0&&f.setMinPitch(c.minPitch),c.maxPitch!==void 0&&f.setMaxPitch(c.maxPitch),c.renderWorldCopies!==void 0&&f.setRenderWorldCopies(c.renderWorldCopies),c.transformConstrain!==null&&f.setConstrainOverride(c.transformConstrain),super(f,_,{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Dg,this._controls=[],this._mapId=l.af(),this._lostContextStyle={style:null,images:null},this._contextLost=S=>{S.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const E of Object.values(this.style._layers))if(E.type==="custom"&&console.warn(`Custom layer with id '${E.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),E._listeners)for(const[A]of Object.entries(E._listeners))console.warn(`Custom layer with id '${E.id}' had event listeners for event '${A}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new l.l("webglcontextlost",{originalEvent:S}))},this._contextRestored=S=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._lostContextStyle={style:null,images:null},this._setupPainter(),this.resize(),this._update(),this._resizeInternal(),this.fire(new l.l("webglcontextrestored",{originalEvent:S}))},this._onMapScroll=S=>{if(S.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},c.canvasContextAttributes),this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._centerClampedToGround=c.centerClampedToGround,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},qc),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this._zoomLevelsToOverscale=c.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=c.transformCameraUpdate,this.transformConstrain=c.transformConstrain,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,c.reduceMotion!==void 0&&(G.prefersReducedMotion=c.reduceMotion),this._imageQueueHandle=ue.addThrottleControl((()=>this.isMoving())),this._requestManager=new de(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let S=!1;const E=vh((A=>{this._trackResize&&!this._removed&&(this.resize(A),this.redraw())}),50);this._resizeObserver=new ResizeObserver((A=>{S?E(A):S=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Uc(this,c),this._hash=c.hash&&new xh(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,elevation:c.elevation,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,roll:c.roll}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,l.e({},c.fitBoundsOptions,{duration:0}))));const x=typeof c.style=="string"||((a=(t=c.style)===null||t===void 0?void 0:t.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,x),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new Ch(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new Jd,c.logoPosition),this.on("style.load",(()=>{if(x||this._resizeTransform(),this.transform.unmodified){const S=l.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(S)}})),this.on("data",(S=>{this._update(S.dataType==="style"),this.fire(new l.l(`${S.dataType}data`,S))})),this.on("dataloading",(S=>{this.fire(new l.l(`${S.dataType}dataloading`,S))})),this.on("dataabort",(S=>{this.fire(new l.l("sourcedataabort",S))}))}_getMapId(){return this._mapId}setGlobalStateProperty(g,t){return this.style.setGlobalStateProperty(g,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(g,t){if(t===void 0&&(t=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new l.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=g.onAdd(this);this._controls.push(g);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(a,c.firstChild):c.appendChild(a),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new l.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(g);return t>-1&&this._controls.splice(t,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}coveringTiles(g){return ar(this.transform,g)}calculateCameraOptionsFromTo(g,t,a,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLat(a,this.transform)),super.calculateCameraOptionsFromTo(g,t,a,c)}resize(g,t=!0){if(this._lostContextStyle.style!==null)return this;this._resizeInternal(t);const a=!this._moving;return a&&(this.stop(),this.fire(new l.l("movestart",g)).fire(new l.l("move",g))),this.fire(new l.l("resize",g)),a&&this.fire(new l.l("moveend",g)),this}_resizeInternal(g=!0){const[t,a]=this._containerDimensions(),c=this._getClampedPixelRatio(t,a);if(this._resizeCanvas(t,a,c),this.painter.resize(t,a,c),this.painter.overLimit()){const f=this.painter.context.gl;this._maxCanvasSize=[f.drawingBufferWidth,f.drawingBufferHeight];const _=this._getClampedPixelRatio(t,a);this._resizeCanvas(t,a,_),this.painter.resize(t,a,_)}this._resizeTransform(g)}_resizeTransform(g=!0){var t;const[a,c]=this._containerDimensions();this.transform.resize(a,c,g),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,c,g)}_getClampedPixelRatio(g,t){const{0:a,1:c}=this._maxCanvasSize,f=this.getPixelRatio(),_=g*f,x=t*f;return Math.min(_>a?a/_:1,x>c?c/x:1)*f}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(qt.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom){const t=this._getTransformForUpdate();return t.setMinZoom(g),this._applyUpdatedTransform(t),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom){const t=this._getTransformForUpdate();return t.setMaxZoom(g),this._applyUpdatedTransform(t),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.setMinPitch(g),this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(g>=this.transform.minPitch)return this.transform.setMaxPitch(g),this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.setRenderWorldCopies(g),this._update()}setTransformConstrain(g){return this.transform.setConstrainOverride(g),this._update()}project(g){return this.transform.locationToScreenPoint(l.V.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.screenPointToLocation(l.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,t,a){if(g==="mouseenter"||g==="mouseover"){let c=!1;return{layers:t,listener:a,delegates:{mousemove:_=>{const x=t.filter((E=>this.getLayer(E))),S=x.length!==0?this.queryRenderedFeatures(_.point,{layers:x}):[];S.length?c||(c=!0,a.call(this,new kr(g,this,_.originalEvent,{features:S}))):c=!1},mouseout:()=>{c=!1}}}}if(g==="mouseleave"||g==="mouseout"){let c=!1;return{layers:t,listener:a,delegates:{mousemove:x=>{const S=t.filter((E=>this.getLayer(E)));(S.length!==0?this.queryRenderedFeatures(x.point,{layers:S}):[]).length?c=!0:c&&(c=!1,a.call(this,new kr(g,this,x.originalEvent)))},mouseout:x=>{c&&(c=!1,a.call(this,new kr(g,this,x.originalEvent)))}}}}{const c=f=>{const _=t.filter((S=>this.getLayer(S))),x=_.length!==0?this.queryRenderedFeatures(f.point,{layers:_}):[];x.length&&(f.features=x,a.call(this,f),delete f.features)};return{layers:t,listener:a,delegates:{[g]:c}}}}_saveDelegatedListener(g,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(t)}_removeDelegatedListener(g,t,a){if(!this._delegatedListeners||!this._delegatedListeners[g])return;const c=this._delegatedListeners[g];for(let f=0;f<c.length;f++){const _=c[f];if(_.listener===a&&_.layers.length===t.length&&_.layers.every((x=>t.includes(x)))){for(const x in _.delegates)this.off(x,_.delegates[x]);return void c.splice(f,1)}}}on(g,t,a){if(a===void 0)return super.on(g,t);const c=typeof t=="string"?[t]:t,f=this._createDelegatedListener(g,c,a);this._saveDelegatedListener(g,f);for(const _ in f.delegates)this.on(_,f.delegates[_]);return{unsubscribe:()=>{this._removeDelegatedListener(g,c,a)}}}once(g,t,a){if(a===void 0)return super.once(g,t);const c=typeof t=="string"?[t]:t,f=this._createDelegatedListener(g,c,a);for(const _ in f.delegates){const x=f.delegates[_];f.delegates[_]=(...S)=>{this._removeDelegatedListener(g,c,a),x(...S)}}this._saveDelegatedListener(g,f);for(const _ in f.delegates)this.once(_,f.delegates[_]);return this}off(g,t,a){return a===void 0?super.off(g,t):(this._removeDelegatedListener(g,typeof t=="string"?[t]:t,a),this)}queryRenderedFeatures(g,t){if(!this.style)return[];let a;const c=g instanceof l.P||Array.isArray(g),f=c?g:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(c?{}:g)||{},f instanceof l.P||typeof f[0]=="number")a=[l.P.convert(f)];else{const _=l.P.convert(f[0]),x=l.P.convert(f[1]);a=[_,new l.P(x.x,_.y),x,new l.P(_.x,x.y),_]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(g,t){return this.style.querySourceFeatures(g,t)}setStyle(g,t){return(t=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(g,t))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const t=this._locale[g];if(t==null)throw new Error(`Missing UI string '${g}'`);return t}_updateStyle(g,t){var a,c;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(g,t)));const f=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new yo(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,t,f):this.style.loadJSON(g,t,f),this):((c=(a=this.style)===null||a===void 0?void 0:a.projection)===null||c===void 0||c.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new yo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,t){if(typeof g=="string"){const a=this._requestManager.transformRequest(g,"Style");l.j(a,new AbortController).then((c=>{this._updateDiff(c.data,t)})).catch((c=>{c&&this.fire(new l.k(c))}))}else typeof g=="object"&&this._updateDiff(g,t)}_updateDiff(g,t){try{this.style.setState(g,t)&&this._update(!0)}catch(a){l.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(g,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(g,t){return this._lazyInitEmptyStyle(),this.style.addSource(g,t),this._update(!0)}isSourceLoaded(g){const t=this.style&&this.style.tileManagers[g];if(t!==void 0)return t.loaded();this.fire(new l.k(new Error(`There is no tile manager with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const t=this.style.tileManagers[g.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const c=this.style._layers[a];c.type==="hillshade"&&c.source===g.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),c.type==="color-relief"&&c.source===g.source&&l.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new nr(this.painter,t,g),this.painter.renderToTexture=new Cl(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var c;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==g.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((c=a.source)===null||c===void 0?void 0:c.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new l.l("terrain",{terrain:g})),this}getTerrain(){var g,t;return(t=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const g=this.style&&this.style.tileManagers;for(const t of Object.values(g))if(!t.areTilesLoaded())return!1;return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}setSourceTileLodParams(g,t,a){if(a){const c=this.getSource(a);if(!c)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);c.calculateTileZoom=An(Math.max(1,g),Math.max(1,t))}else for(const c in this.style.tileManagers)this.style.tileManagers[c].getSource().calculateTileZoom=An(Math.max(1,g),Math.max(1,t));return this._update(!0),this}refreshTiles(g,t){const a=this.style.tileManagers[g];if(!a)throw new Error(`There is no tile manager with ID "${g}", cannot refresh tile`);t===void 0?a.reload(!0):a.refreshTiles(t.map((c=>new l.ac(c.z,c.x,c.y))))}addImage(g,t,a={}){const{pixelRatio:c=1,sdf:f=!1,stretchX:_,stretchY:x,content:S,textFitWidth:E,textFitHeight:A}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||l.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:R,height:N,data:O}=t,$=t;return this.style.addImage(g,{data:new l.R({width:R,height:N},new Uint8Array(O)),pixelRatio:c,stretchX:_,stretchY:x,content:S,textFitWidth:E,textFitHeight:A,sdf:f,version:0,userImage:$}),$.onAdd&&$.onAdd(this,g),this}}{const{width:R,height:N,data:O}=G.getImageData(t);this.style.addImage(g,{data:new l.R({width:R,height:N},O),pixelRatio:c,stretchX:_,stretchY:x,content:S,textFitWidth:E,textFitHeight:A,sdf:f,version:0})}}updateImage(g,t){const a=this.style.getImage(g);if(!a)return this.fire(new l.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||l.b(t)?G.getImageData(t):t,{width:f,height:_,data:x}=c;if(f===void 0||_===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==a.data.width||_!==a.data.height)return this.fire(new l.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(t instanceof HTMLImageElement||l.b(t));return a.data.replace(x,S),this.style.updateImage(g,a),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new l.k(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return ue.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,t){return this._lazyInitEmptyStyle(),this.style.addLayer(g,t),this._update(!0)}moveLayer(g,t){return this.style.moveLayer(g,t),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,t,a){return this.style.setLayerZoomRange(g,t,a),this._update(!0)}setFilter(g,t,a={}){return this.style.setFilter(g,t,a),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,t,a,c={}){return this.style.setPaintProperty(g,t,a,c),this._update(!0)}getPaintProperty(g,t){return this.style.getPaintProperty(g,t)}setLayoutProperty(g,t,a,c={}){return this.style.setLayoutProperty(g,t,a,c),this._update(!0)}getLayoutProperty(g,t){return this.style.getLayoutProperty(g,t)}setGlyphs(g,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,t,a,(c=>{c||this._update(!0)})),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,t,(a=>{a||this._update(!0)})),this}setLight(g,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(g,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(g,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(g,t){return this.style.setFeatureState(g,t),this._update()}removeFeatureState(g,t){return this.style.removeFeatureState(g,t),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,t=0;return this._container&&(g=this._container.clientWidth||400,t=this._container.clientHeight||300),[g,t]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const t=this._canvasContainer=U.create("div","maplibregl-canvas-container",g);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=U.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),c=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],c);const f=this._controlContainer=U.create("div","maplibregl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((x=>{_[x]=U.create("div",`maplibregl-ctrl-${x} `,f)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,t,a){this._canvas.width=Math.floor(a*g),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const g=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(c=>{t={requestedAttributes:g},c&&(t.statusMessage=c.statusMessage,t.type=c.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,g):this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g),!a){const c="Failed to initialize WebGL";throw t?(t.message=c,new Error(JSON.stringify(t))):new Error(c)}this.painter=new jd(a,this.transform),se.testSupport(a)}migrateProjection(g,t){super.migrateProjection(g,t),this.painter.transform=g,this.fire(new l.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){var t,a,c,f,_;const x=this._idleTriggered?this._fadeDuration:0,S=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let E=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const N=this.transform.zoom,O=ee();this.style.zoomHistory.update(N,O);const $=new l.H(N,{now:O,fadeDuration:x,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),X=$.crossFadingFactor();X===1&&X===this._crossFadingFactor||(E=!0,this._crossFadingFactor=X),this.style.update($)}const A=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==S;(c=this.style.projection)===null||c===void 0||c.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((f=this.style.projection)===null||f===void 0?void 0:f.transitionState,(_=this.style.projection)===null||_===void 0?void 0:_.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||A)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,A),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,showPadding:this.showPadding}),this.fire(new l.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.cG.mark(l.cH.load),this.fire(new l.l("load"))),this.style&&(this.style.hasTransitions()||E)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const R=this._sourcesDirty||this._styleDirty||this._placementDirty;return R||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.l("idle")),!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,l.cG.mark(l.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ue.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),U.remove(this._canvasContainer),U.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),l.cG.clearMetrics(),this._removed=!0,this.fire(new l.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,G.frame(this._frameRequest,(g=>{l.cG.frame(g),this._frameRequest=null;try{this._render(g)}catch(t){if(!l.Z(t)&&!(function(a){return a.message===dh})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return Ih}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(g){return this._lazyInitEmptyStyle(),this.style.setProjection(g),this._update(!0)}},v.MapMouseEvent=kr,v.MapTouchEvent=xl,v.MapWheelEvent=Gd,v.Marker=kl,v.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),c=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,a)=>{const c=this._map._getUIString(`NavigationControl.${a}`);t.title=c,t.setAttribute("aria-label",c)},this.options=l.e({},Ah,g),this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),U.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),U.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=U.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Il(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){U.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,t){const a=U.create("button",g,this._container);return a.type="button",a.addEventListener("click",t),a}},v.Popup=class extends l.E{constructor(g){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&U.remove(this._content),this._container&&(U.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=U.create("div","maplibregl-popup",this._map.getContainer()),this._tip=U.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const x of this.options.className.split(" "))this._container.classList.add(x);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=$c(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor;const f=Hc(this.options.offset);if(!c){const x=this._container.offsetWidth,S=this._container.offsetHeight,E=(function(R){var N,O,$,X;return R?{top:(N=R.top)!==null&&N!==void 0?N:0,right:(O=R.right)!==null&&O!==void 0?O:0,bottom:($=R.bottom)!==null&&$!==void 0?$:0,left:(X=R.left)!==null&&X!==void 0?X:0}:{top:0,right:0,bottom:0,left:0}})(this.options.padding);let A;A=a.y+f.bottom.y<S+E.top?["top"]:a.y>this._map.transform.height-S-E.bottom?["bottom"]:[],a.x<x/2+E.left?A.push("left"):a.x>this._map.transform.width-x/2-E.right&&A.push("right"),c=A.length===0?"bottom":A.join("-")}let _=a.add(f[c]);this.options.subpixelPositioning||(_=_.round()),U.setTransform(this._container,`${Al[c]} translate(${_.x}px,${_.y}px)`),Zc(this._container,c,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(zh),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=l.V.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const t=document.createDocumentFragment(),a=document.createElement("body");let c;for(a.innerHTML=g;c=a.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=U.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._container&&this._container.classList.add(g),this}removeClassName(g){return this._container&&this._container.classList.remove(g),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}setPadding(g){this.options.padding=g,this._update()}_createCloseButton(){this.options.closeButton&&(this._closeButton=U.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Wc);g&&g.focus()}},v.RasterDEMTileSource=oi,v.RasterTileSource=Xr,v.ScaleControl=class{constructor(g){this._onMove=()=>{Dl(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Dl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Dh),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){U.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},v.ScrollZoomHandler=Vc,v.Style=yo,v.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=U.create("button","maplibregl-ctrl-terrain",this._container),U.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){U.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},v.TwoFingersTouchPitchHandler=Hd,v.TwoFingersTouchRotateHandler=Mh,v.TwoFingersTouchZoomHandler=Sh,v.TwoFingersTouchZoomRotateHandler=Ml,v.VectorTileSource=Pr,v.VideoSource=ke,v.addSourceType=(g,t)=>l._(void 0,void 0,void 0,(function*(){if(te(g))throw new Error(`A source type called "${g}" already exists.`);((a,c)=>{W[a]=c})(g,t)})),v.clearPrewarmedResources=function(){const g=Et;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(vt),Et=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},v.createTileMesh=sd,v.getMaxParallelImageRequests=function(){return l.c.MAX_PARALLEL_IMAGE_REQUESTS},v.getRTLTextPluginStatus=function(){return ve().getRTLTextPluginStatus()},v.getVersion=function(){return Rh},v.getWorkerCount=function(){return Pt.workerCount},v.getWorkerUrl=function(){return l.c.WORKER_URL},v.importScriptInWorkers=function(g){return Rt().broadcast("IS",g)},v.isTimeFrozen=function(){return Q.isFrozen()},v.now=ee,v.prewarm=function(){ot().acquire(vt)},v.restoreNow=function(){Q.restoreNow()},v.setMaxParallelImageRequests=function(g){l.c.MAX_PARALLEL_IMAGE_REQUESTS=g},v.setNow=function(g){Q.setNow(g)},v.setRTLTextPlugin=function(g,t){return ve().setRTLTextPlugin(g,t)},v.setWorkerCount=function(g){Pt.workerCount=g},v.setWorkerUrl=function(g){l.c.WORKER_URL=g}}));var T=h;return T}))})(Hp)),Hp.exports}var fI=hI();const v0=Vw(fI);var dI=Wt('<div class="absolute inset-0 flex items-center justify-center"><div class="flex gap-1"><span class="bg-muted-foreground/60 size-1.5 animate-pulse rounded-full"></span> <span class="bg-muted-foreground/60 size-1.5 animate-pulse rounded-full [animation-delay:150ms]"></span> <span class="bg-muted-foreground/60 size-1.5 animate-pulse rounded-full [animation-delay:300ms]"></span></div></div>'),pI=Wt('<div class="relative h-full w-full"><!> <!></div>');function mI(n,o){dn(o,!0);let h=hn("light");const p={dark:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",light:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json"};tn(o,"theme",3,"light");let b=tn(o,"center",19,()=>[13.405,52.52]),T=tn(o,"zoom",3,11),v=tn(o,"options",19,()=>({})),l,C=hn(null),D=hn(!1),z=hn(!1),B=hn(!1),V=!1;const G=le(()=>({dark:o.styles?.dark??p.dark,light:o.styles?.light??p.light})),Q=le(()=>P(h)==="dark"?P(G).dark:P(G).light),ee=le(()=>P(D)&&P(z)&&P(B));Mu("map",{getMap:()=>P(C),isLoaded:()=>P(ee)}),kw(()=>{Vt(D,!0);{const oe=document.documentElement,ue=()=>{Vt(h,oe.classList.contains("dark")?"dark":"light",!0)};ue();const de=new MutationObserver(ue);de.observe(oe,{attributes:!0,attributeFilter:["class"]}),yb(()=>de.disconnect())}const ce=new v0.Map({container:l,style:P(Q),center:b(),zoom:T(),attributionControl:!1,...v()});ce.on("load",()=>{Vt(z,!0)}),ce.on("styledata",()=>{Vt(B,!0),V=!0}),Vt(C,ce,!0)}),Ir(()=>{const ce=P(Q);!P(C)||!V||pa(()=>{Vt(B,!1),P(C).setStyle(ce,{diff:!0})})}),Ir(()=>{if(!P(C)||!P(ee))return;const[ce,oe]=b();pa(()=>{P(C).easeTo({center:[ce,oe],zoom:T()})})}),yb(()=>{P(C)?.remove(),Vt(C,null),Vt(z,!1),Vt(B,!1)});var U=pI(),se=At(U);{var Me=ce=>{var oe=dI();Ue(ce,oe)};It(se,ce=>{P(ee)||ce(Me)})}var me=$t(se,2);{var K=ce=>{var oe=Yt(),ue=kt(oe);Dn(ue,()=>o.children??Qn),Ue(ce,oe)};It(me,ce=>{P(ee)&&ce(K)})}Tt(U),xa(U,ce=>l=ce,()=>l),Ue(n,U),pn()}function gI(n,o){dn(o,!0);let h=tn(o,"draggable",3,!1),p=tn(o,"anchor",3,"bottom");const b=xi("map");let T=hn(null),v=hn(null),l=hn(!1);Mu("marker",{getMarker:()=>P(T),getElement:()=>P(v),getMap:()=>b.getMap(),isReady:()=>P(l)}),Ir(()=>{const z=b.getMap(),B=b.isLoaded();if(!z||!B||typeof o.longitude!="number"||typeof o.latitude!="number"||Number.isNaN(o.longitude)||Number.isNaN(o.latitude))return;const V=document.createElement("div");V.className="cursor-pointer",Vt(v,V,!0);const G={element:V,draggable:h(),anchor:p()};o.offset!==void 0&&(G.offset=o.offset),o.rotation!==void 0&&(G.rotation=o.rotation),o.pitchAlignment!==void 0&&(G.pitchAlignment=o.pitchAlignment),o.rotationAlignment!==void 0&&(G.rotationAlignment=o.rotationAlignment);const Q=new v0.Marker(G).setLngLat([o.longitude,o.latitude]).addTo(z);Vt(T,Q,!0),o.onclick&&V.addEventListener("click",o.onclick),o.onmouseenter&&V.addEventListener("mouseenter",o.onmouseenter),o.onmouseleave&&V.addEventListener("mouseleave",o.onmouseleave);const ee=()=>{const Me=Q.getLngLat();o.ondragstart?.({lng:Me.lng,lat:Me.lat})},U=()=>{const Me=Q.getLngLat();o.ondrag?.({lng:Me.lng,lat:Me.lat})},se=()=>{const Me=Q.getLngLat();o.ondragend?.({lng:Me.lng,lat:Me.lat})};return h()&&(Q.on("dragstart",ee),Q.on("drag",U),Q.on("dragend",se)),Vt(l,!0),()=>{o.onclick&&V.removeEventListener("click",o.onclick),o.onmouseenter&&V.removeEventListener("mouseenter",o.onmouseenter),o.onmouseleave&&V.removeEventListener("mouseleave",o.onmouseleave),h()&&(Q.off("dragstart",ee),Q.off("drag",U),Q.off("dragend",se)),Q.remove(),Vt(T,null),Vt(v,null),Vt(l,!1)}}),Ir(()=>{P(T)&&typeof o.longitude=="number"&&typeof o.latitude=="number"&&!Number.isNaN(o.longitude)&&!Number.isNaN(o.latitude)&&P(T).setLngLat([o.longitude,o.latitude])}),Ir(()=>{P(T)?.setDraggable(h())});var C=Yt(),D=kt(C);Dn(D,()=>o.children??Qn),Ue(n,C),pn()}const _I=(n,o)=>{const h=new Array(n.length+o.length);for(let p=0;p<n.length;p++)h[p]=n[p];for(let p=0;p<o.length;p++)h[n.length+p]=o[p];return h},yI=(n,o)=>({classGroupId:n,validator:o}),Uw=(n=new Map,o=null,h)=>({nextPart:n,validators:o,classGroupId:h}),tm="-",Pb=[],vI="arbitrary..",xI=n=>{const o=wI(n),{conflictingClassGroups:h,conflictingClassGroupModifiers:p}=n;return{getClassGroupId:v=>{if(v.startsWith("[")&&v.endsWith("]"))return bI(v);const l=v.split(tm),C=l[0]===""&&l.length>1?1:0;return qw(l,C,o)},getConflictingClassGroupIds:(v,l)=>{if(l){const C=p[v],D=h[v];return C?D?_I(D,C):C:D||Pb}return h[v]||Pb}}},qw=(n,o,h)=>{if(n.length-o===0)return h.classGroupId;const b=n[o],T=h.nextPart.get(b);if(T){const D=qw(n,o+1,T);if(D)return D}const v=h.validators;if(v===null)return;const l=o===0?n.join(tm):n.slice(o).join(tm),C=v.length;for(let D=0;D<C;D++){const z=v[D];if(z.validator(l))return z.classGroupId}},bI=n=>n.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const o=n.slice(1,-1),h=o.indexOf(":"),p=o.slice(0,h);return p?vI+p:void 0})(),wI=n=>{const{theme:o,classGroups:h}=n;return TI(h,o)},TI=(n,o)=>{const h=Uw();for(const p in n){const b=n[p];x0(b,h,p,o)}return h},x0=(n,o,h,p)=>{const b=n.length;for(let T=0;T<b;T++){const v=n[T];SI(v,o,h,p)}},SI=(n,o,h,p)=>{if(typeof n=="string"){MI(n,o,h);return}if(typeof n=="function"){PI(n,o,h,p);return}EI(n,o,h,p)},MI=(n,o,h)=>{const p=n===""?o:Gw(o,n);p.classGroupId=h},PI=(n,o,h,p)=>{if(CI(n)){x0(n(p),o,h,p);return}o.validators===null&&(o.validators=[]),o.validators.push(yI(h,n))},EI=(n,o,h,p)=>{const b=Object.entries(n),T=b.length;for(let v=0;v<T;v++){const[l,C]=b[v];x0(C,Gw(o,l),h,p)}},Gw=(n,o)=>{let h=n;const p=o.split(tm),b=p.length;for(let T=0;T<b;T++){const v=p[T];let l=h.nextPart.get(v);l||(l=Uw(),h.nextPart.set(v,l)),h=l}return h},CI=n=>"isThemeGetter"in n&&n.isThemeGetter===!0,II=n=>{if(n<1)return{get:()=>{},set:()=>{}};let o=0,h=Object.create(null),p=Object.create(null);const b=(T,v)=>{h[T]=v,o++,o>n&&(o=0,p=h,h=Object.create(null))};return{get(T){let v=h[T];if(v!==void 0)return v;if((v=p[T])!==void 0)return b(T,v),v},set(T,v){T in h?h[T]=v:b(T,v)}}},by="!",Eb=":",AI=[],Cb=(n,o,h,p,b)=>({modifiers:n,hasImportantModifier:o,baseClassName:h,maybePostfixModifierPosition:p,isExternal:b}),kI=n=>{const{prefix:o,experimentalParseClassName:h}=n;let p=b=>{const T=[];let v=0,l=0,C=0,D;const z=b.length;for(let ee=0;ee<z;ee++){const U=b[ee];if(v===0&&l===0){if(U===Eb){T.push(b.slice(C,ee)),C=ee+1;continue}if(U==="/"){D=ee;continue}}U==="["?v++:U==="]"?v--:U==="("?l++:U===")"&&l--}const B=T.length===0?b:b.slice(C);let V=B,G=!1;B.endsWith(by)?(V=B.slice(0,-1),G=!0):B.startsWith(by)&&(V=B.slice(1),G=!0);const Q=D&&D>C?D-C:void 0;return Cb(T,G,V,Q)};if(o){const b=o+Eb,T=p;p=v=>v.startsWith(b)?T(v.slice(b.length)):Cb(AI,!1,v,void 0,!0)}if(h){const b=p;p=T=>h({className:T,parseClassName:b})}return p},DI=n=>{const o=new Map;return n.orderSensitiveModifiers.forEach((h,p)=>{o.set(h,1e6+p)}),h=>{const p=[];let b=[];for(let T=0;T<h.length;T++){const v=h[T],l=v[0]==="[",C=o.has(v);l||C?(b.length>0&&(b.sort(),p.push(...b),b=[]),p.push(v)):b.push(v)}return b.length>0&&(b.sort(),p.push(...b)),p}},zI=n=>({cache:II(n.cacheSize),parseClassName:kI(n),sortModifiers:DI(n),...xI(n)}),RI=/\s+/,LI=(n,o)=>{const{parseClassName:h,getClassGroupId:p,getConflictingClassGroupIds:b,sortModifiers:T}=o,v=[],l=n.trim().split(RI);let C="";for(let D=l.length-1;D>=0;D-=1){const z=l[D],{isExternal:B,modifiers:V,hasImportantModifier:G,baseClassName:Q,maybePostfixModifierPosition:ee}=h(z);if(B){C=z+(C.length>0?" "+C:C);continue}let U=!!ee,se=p(U?Q.substring(0,ee):Q);if(!se){if(!U){C=z+(C.length>0?" "+C:C);continue}if(se=p(Q),!se){C=z+(C.length>0?" "+C:C);continue}U=!1}const Me=V.length===0?"":V.length===1?V[0]:T(V).join(":"),me=G?Me+by:Me,K=me+se;if(v.indexOf(K)>-1)continue;v.push(K);const ce=b(se,U);for(let oe=0;oe<ce.length;++oe){const ue=ce[oe];v.push(me+ue)}C=z+(C.length>0?" "+C:C)}return C},FI=(...n)=>{let o=0,h,p,b="";for(;o<n.length;)(h=n[o++])&&(p=$w(h))&&(b&&(b+=" "),b+=p);return b},$w=n=>{if(typeof n=="string")return n;let o,h="";for(let p=0;p<n.length;p++)n[p]&&(o=$w(n[p]))&&(h&&(h+=" "),h+=o);return h},BI=(n,...o)=>{let h,p,b,T;const v=C=>{const D=o.reduce((z,B)=>B(z),n());return h=zI(D),p=h.cache.get,b=h.cache.set,T=l,l(C)},l=C=>{const D=p(C);if(D)return D;const z=LI(C,h);return b(C,z),z};return T=v,(...C)=>T(FI(...C))},OI=[],qr=n=>{const o=h=>h[n]||OI;return o.isThemeGetter=!0,o},Zw=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,Ww=/^\((?:(\w[\w-]*):)?(.+)\)$/i,NI=/^\d+\/\d+$/,VI=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,jI=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,UI=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,qI=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,GI=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,pu=n=>NI.test(n),xn=n=>!!n&&!Number.isNaN(Number(n)),zs=n=>!!n&&Number.isInteger(Number(n)),L_=n=>n.endsWith("%")&&xn(n.slice(0,-1)),Fo=n=>VI.test(n),$I=()=>!0,ZI=n=>jI.test(n)&&!UI.test(n),Hw=()=>!1,WI=n=>qI.test(n),HI=n=>GI.test(n),XI=n=>!Ft(n)&&!Bt(n),YI=n=>Ru(n,Kw,Hw),Ft=n=>Zw.test(n),Ul=n=>Ru(n,Jw,ZI),F_=n=>Ru(n,tA,xn),Ib=n=>Ru(n,Xw,Hw),KI=n=>Ru(n,Yw,HI),Ip=n=>Ru(n,Qw,WI),Bt=n=>Ww.test(n),rf=n=>Lu(n,Jw),JI=n=>Lu(n,nA),Ab=n=>Lu(n,Xw),QI=n=>Lu(n,Kw),eA=n=>Lu(n,Yw),Ap=n=>Lu(n,Qw,!0),Ru=(n,o,h)=>{const p=Zw.exec(n);return p?p[1]?o(p[1]):h(p[2]):!1},Lu=(n,o,h=!1)=>{const p=Ww.exec(n);return p?p[1]?o(p[1]):h:!1},Xw=n=>n==="position"||n==="percentage",Yw=n=>n==="image"||n==="url",Kw=n=>n==="length"||n==="size"||n==="bg-size",Jw=n=>n==="length",tA=n=>n==="number",nA=n=>n==="family-name",Qw=n=>n==="shadow",rA=()=>{const n=qr("color"),o=qr("font"),h=qr("text"),p=qr("font-weight"),b=qr("tracking"),T=qr("leading"),v=qr("breakpoint"),l=qr("container"),C=qr("spacing"),D=qr("radius"),z=qr("shadow"),B=qr("inset-shadow"),V=qr("text-shadow"),G=qr("drop-shadow"),Q=qr("blur"),ee=qr("perspective"),U=qr("aspect"),se=qr("ease"),Me=qr("animate"),me=()=>["auto","avoid","all","avoid-page","page","left","right","column"],K=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],ce=()=>[...K(),Bt,Ft],oe=()=>["auto","hidden","clip","visible","scroll"],ue=()=>["auto","contain","none"],de=()=>[Bt,Ft,C],be=()=>[pu,"full","auto",...de()],Re=()=>[zs,"none","subgrid",Bt,Ft],Ve=()=>["auto",{span:["full",zs,Bt,Ft]},zs,Bt,Ft],qe=()=>[zs,"auto",Bt,Ft],Ye=()=>["auto","min","max","fr",Bt,Ft],et=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],Ie=()=>["start","end","center","stretch","center-safe","end-safe"],Je=()=>["auto",...de()],Qe=()=>[pu,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...de()],$e=()=>[n,Bt,Ft],at=()=>[...K(),Ab,Ib,{position:[Bt,Ft]}],zt=()=>["no-repeat",{repeat:["","x","y","space","round"]}],rt=()=>["auto","cover","contain",QI,YI,{size:[Bt,Ft]}],ct=()=>[L_,rf,Ul],xt=()=>["","none","full",D,Bt,Ft],vt=()=>["",xn,rf,Ul],Pt=()=>["solid","dashed","dotted","double"],pt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Et=()=>[xn,L_,Ab,Ib],Kt=()=>["","none",Q,Bt,Ft],ot=()=>["none",xn,Bt,Ft],_t=()=>["none",xn,Bt,Ft],Rt=()=>[xn,Bt,Ft],Ze=()=>[pu,"full",...de()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Fo],breakpoint:[Fo],color:[$I],container:[Fo],"drop-shadow":[Fo],ease:["in","out","in-out"],font:[XI],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Fo],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Fo],shadow:[Fo],spacing:["px",xn],text:[Fo],"text-shadow":[Fo],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",pu,Ft,Bt,U]}],container:["container"],columns:[{columns:[xn,Ft,Bt,l]}],"break-after":[{"break-after":me()}],"break-before":[{"break-before":me()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:ce()}],overflow:[{overflow:oe()}],"overflow-x":[{"overflow-x":oe()}],"overflow-y":[{"overflow-y":oe()}],overscroll:[{overscroll:ue()}],"overscroll-x":[{"overscroll-x":ue()}],"overscroll-y":[{"overscroll-y":ue()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:be()}],"inset-x":[{"inset-x":be()}],"inset-y":[{"inset-y":be()}],start:[{start:be()}],end:[{end:be()}],top:[{top:be()}],right:[{right:be()}],bottom:[{bottom:be()}],left:[{left:be()}],visibility:["visible","invisible","collapse"],z:[{z:[zs,"auto",Bt,Ft]}],basis:[{basis:[pu,"full","auto",l,...de()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[xn,pu,"auto","initial","none",Ft]}],grow:[{grow:["",xn,Bt,Ft]}],shrink:[{shrink:["",xn,Bt,Ft]}],order:[{order:[zs,"first","last","none",Bt,Ft]}],"grid-cols":[{"grid-cols":Re()}],"col-start-end":[{col:Ve()}],"col-start":[{"col-start":qe()}],"col-end":[{"col-end":qe()}],"grid-rows":[{"grid-rows":Re()}],"row-start-end":[{row:Ve()}],"row-start":[{"row-start":qe()}],"row-end":[{"row-end":qe()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":Ye()}],"auto-rows":[{"auto-rows":Ye()}],gap:[{gap:de()}],"gap-x":[{"gap-x":de()}],"gap-y":[{"gap-y":de()}],"justify-content":[{justify:[...et(),"normal"]}],"justify-items":[{"justify-items":[...Ie(),"normal"]}],"justify-self":[{"justify-self":["auto",...Ie()]}],"align-content":[{content:["normal",...et()]}],"align-items":[{items:[...Ie(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...Ie(),{baseline:["","last"]}]}],"place-content":[{"place-content":et()}],"place-items":[{"place-items":[...Ie(),"baseline"]}],"place-self":[{"place-self":["auto",...Ie()]}],p:[{p:de()}],px:[{px:de()}],py:[{py:de()}],ps:[{ps:de()}],pe:[{pe:de()}],pt:[{pt:de()}],pr:[{pr:de()}],pb:[{pb:de()}],pl:[{pl:de()}],m:[{m:Je()}],mx:[{mx:Je()}],my:[{my:Je()}],ms:[{ms:Je()}],me:[{me:Je()}],mt:[{mt:Je()}],mr:[{mr:Je()}],mb:[{mb:Je()}],ml:[{ml:Je()}],"space-x":[{"space-x":de()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":de()}],"space-y-reverse":["space-y-reverse"],size:[{size:Qe()}],w:[{w:[l,"screen",...Qe()]}],"min-w":[{"min-w":[l,"screen","none",...Qe()]}],"max-w":[{"max-w":[l,"screen","none","prose",{screen:[v]},...Qe()]}],h:[{h:["screen","lh",...Qe()]}],"min-h":[{"min-h":["screen","lh","none",...Qe()]}],"max-h":[{"max-h":["screen","lh",...Qe()]}],"font-size":[{text:["base",h,rf,Ul]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[p,Bt,F_]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",L_,Ft]}],"font-family":[{font:[JI,Ft,o]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[b,Bt,Ft]}],"line-clamp":[{"line-clamp":[xn,"none",Bt,F_]}],leading:[{leading:[T,...de()]}],"list-image":[{"list-image":["none",Bt,Ft]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Bt,Ft]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:$e()}],"text-color":[{text:$e()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Pt(),"wavy"]}],"text-decoration-thickness":[{decoration:[xn,"from-font","auto",Bt,Ul]}],"text-decoration-color":[{decoration:$e()}],"underline-offset":[{"underline-offset":[xn,"auto",Bt,Ft]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:de()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Bt,Ft]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Bt,Ft]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:at()}],"bg-repeat":[{bg:zt()}],"bg-size":[{bg:rt()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},zs,Bt,Ft],radial:["",Bt,Ft],conic:[zs,Bt,Ft]},eA,KI]}],"bg-color":[{bg:$e()}],"gradient-from-pos":[{from:ct()}],"gradient-via-pos":[{via:ct()}],"gradient-to-pos":[{to:ct()}],"gradient-from":[{from:$e()}],"gradient-via":[{via:$e()}],"gradient-to":[{to:$e()}],rounded:[{rounded:xt()}],"rounded-s":[{"rounded-s":xt()}],"rounded-e":[{"rounded-e":xt()}],"rounded-t":[{"rounded-t":xt()}],"rounded-r":[{"rounded-r":xt()}],"rounded-b":[{"rounded-b":xt()}],"rounded-l":[{"rounded-l":xt()}],"rounded-ss":[{"rounded-ss":xt()}],"rounded-se":[{"rounded-se":xt()}],"rounded-ee":[{"rounded-ee":xt()}],"rounded-es":[{"rounded-es":xt()}],"rounded-tl":[{"rounded-tl":xt()}],"rounded-tr":[{"rounded-tr":xt()}],"rounded-br":[{"rounded-br":xt()}],"rounded-bl":[{"rounded-bl":xt()}],"border-w":[{border:vt()}],"border-w-x":[{"border-x":vt()}],"border-w-y":[{"border-y":vt()}],"border-w-s":[{"border-s":vt()}],"border-w-e":[{"border-e":vt()}],"border-w-t":[{"border-t":vt()}],"border-w-r":[{"border-r":vt()}],"border-w-b":[{"border-b":vt()}],"border-w-l":[{"border-l":vt()}],"divide-x":[{"divide-x":vt()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":vt()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Pt(),"hidden","none"]}],"divide-style":[{divide:[...Pt(),"hidden","none"]}],"border-color":[{border:$e()}],"border-color-x":[{"border-x":$e()}],"border-color-y":[{"border-y":$e()}],"border-color-s":[{"border-s":$e()}],"border-color-e":[{"border-e":$e()}],"border-color-t":[{"border-t":$e()}],"border-color-r":[{"border-r":$e()}],"border-color-b":[{"border-b":$e()}],"border-color-l":[{"border-l":$e()}],"divide-color":[{divide:$e()}],"outline-style":[{outline:[...Pt(),"none","hidden"]}],"outline-offset":[{"outline-offset":[xn,Bt,Ft]}],"outline-w":[{outline:["",xn,rf,Ul]}],"outline-color":[{outline:$e()}],shadow:[{shadow:["","none",z,Ap,Ip]}],"shadow-color":[{shadow:$e()}],"inset-shadow":[{"inset-shadow":["none",B,Ap,Ip]}],"inset-shadow-color":[{"inset-shadow":$e()}],"ring-w":[{ring:vt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:$e()}],"ring-offset-w":[{"ring-offset":[xn,Ul]}],"ring-offset-color":[{"ring-offset":$e()}],"inset-ring-w":[{"inset-ring":vt()}],"inset-ring-color":[{"inset-ring":$e()}],"text-shadow":[{"text-shadow":["none",V,Ap,Ip]}],"text-shadow-color":[{"text-shadow":$e()}],opacity:[{opacity:[xn,Bt,Ft]}],"mix-blend":[{"mix-blend":[...pt(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":pt()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[xn]}],"mask-image-linear-from-pos":[{"mask-linear-from":Et()}],"mask-image-linear-to-pos":[{"mask-linear-to":Et()}],"mask-image-linear-from-color":[{"mask-linear-from":$e()}],"mask-image-linear-to-color":[{"mask-linear-to":$e()}],"mask-image-t-from-pos":[{"mask-t-from":Et()}],"mask-image-t-to-pos":[{"mask-t-to":Et()}],"mask-image-t-from-color":[{"mask-t-from":$e()}],"mask-image-t-to-color":[{"mask-t-to":$e()}],"mask-image-r-from-pos":[{"mask-r-from":Et()}],"mask-image-r-to-pos":[{"mask-r-to":Et()}],"mask-image-r-from-color":[{"mask-r-from":$e()}],"mask-image-r-to-color":[{"mask-r-to":$e()}],"mask-image-b-from-pos":[{"mask-b-from":Et()}],"mask-image-b-to-pos":[{"mask-b-to":Et()}],"mask-image-b-from-color":[{"mask-b-from":$e()}],"mask-image-b-to-color":[{"mask-b-to":$e()}],"mask-image-l-from-pos":[{"mask-l-from":Et()}],"mask-image-l-to-pos":[{"mask-l-to":Et()}],"mask-image-l-from-color":[{"mask-l-from":$e()}],"mask-image-l-to-color":[{"mask-l-to":$e()}],"mask-image-x-from-pos":[{"mask-x-from":Et()}],"mask-image-x-to-pos":[{"mask-x-to":Et()}],"mask-image-x-from-color":[{"mask-x-from":$e()}],"mask-image-x-to-color":[{"mask-x-to":$e()}],"mask-image-y-from-pos":[{"mask-y-from":Et()}],"mask-image-y-to-pos":[{"mask-y-to":Et()}],"mask-image-y-from-color":[{"mask-y-from":$e()}],"mask-image-y-to-color":[{"mask-y-to":$e()}],"mask-image-radial":[{"mask-radial":[Bt,Ft]}],"mask-image-radial-from-pos":[{"mask-radial-from":Et()}],"mask-image-radial-to-pos":[{"mask-radial-to":Et()}],"mask-image-radial-from-color":[{"mask-radial-from":$e()}],"mask-image-radial-to-color":[{"mask-radial-to":$e()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":K()}],"mask-image-conic-pos":[{"mask-conic":[xn]}],"mask-image-conic-from-pos":[{"mask-conic-from":Et()}],"mask-image-conic-to-pos":[{"mask-conic-to":Et()}],"mask-image-conic-from-color":[{"mask-conic-from":$e()}],"mask-image-conic-to-color":[{"mask-conic-to":$e()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:at()}],"mask-repeat":[{mask:zt()}],"mask-size":[{mask:rt()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Bt,Ft]}],filter:[{filter:["","none",Bt,Ft]}],blur:[{blur:Kt()}],brightness:[{brightness:[xn,Bt,Ft]}],contrast:[{contrast:[xn,Bt,Ft]}],"drop-shadow":[{"drop-shadow":["","none",G,Ap,Ip]}],"drop-shadow-color":[{"drop-shadow":$e()}],grayscale:[{grayscale:["",xn,Bt,Ft]}],"hue-rotate":[{"hue-rotate":[xn,Bt,Ft]}],invert:[{invert:["",xn,Bt,Ft]}],saturate:[{saturate:[xn,Bt,Ft]}],sepia:[{sepia:["",xn,Bt,Ft]}],"backdrop-filter":[{"backdrop-filter":["","none",Bt,Ft]}],"backdrop-blur":[{"backdrop-blur":Kt()}],"backdrop-brightness":[{"backdrop-brightness":[xn,Bt,Ft]}],"backdrop-contrast":[{"backdrop-contrast":[xn,Bt,Ft]}],"backdrop-grayscale":[{"backdrop-grayscale":["",xn,Bt,Ft]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[xn,Bt,Ft]}],"backdrop-invert":[{"backdrop-invert":["",xn,Bt,Ft]}],"backdrop-opacity":[{"backdrop-opacity":[xn,Bt,Ft]}],"backdrop-saturate":[{"backdrop-saturate":[xn,Bt,Ft]}],"backdrop-sepia":[{"backdrop-sepia":["",xn,Bt,Ft]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":de()}],"border-spacing-x":[{"border-spacing-x":de()}],"border-spacing-y":[{"border-spacing-y":de()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Bt,Ft]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[xn,"initial",Bt,Ft]}],ease:[{ease:["linear","initial",se,Bt,Ft]}],delay:[{delay:[xn,Bt,Ft]}],animate:[{animate:["none",Me,Bt,Ft]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[ee,Bt,Ft]}],"perspective-origin":[{"perspective-origin":ce()}],rotate:[{rotate:ot()}],"rotate-x":[{"rotate-x":ot()}],"rotate-y":[{"rotate-y":ot()}],"rotate-z":[{"rotate-z":ot()}],scale:[{scale:_t()}],"scale-x":[{"scale-x":_t()}],"scale-y":[{"scale-y":_t()}],"scale-z":[{"scale-z":_t()}],"scale-3d":["scale-3d"],skew:[{skew:Rt()}],"skew-x":[{"skew-x":Rt()}],"skew-y":[{"skew-y":Rt()}],transform:[{transform:[Bt,Ft,"","none","gpu","cpu"]}],"transform-origin":[{origin:ce()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Ze()}],"translate-x":[{"translate-x":Ze()}],"translate-y":[{"translate-y":Ze()}],"translate-z":[{"translate-z":Ze()}],"translate-none":["translate-none"],accent:[{accent:$e()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:$e()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Bt,Ft]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":de()}],"scroll-mx":[{"scroll-mx":de()}],"scroll-my":[{"scroll-my":de()}],"scroll-ms":[{"scroll-ms":de()}],"scroll-me":[{"scroll-me":de()}],"scroll-mt":[{"scroll-mt":de()}],"scroll-mr":[{"scroll-mr":de()}],"scroll-mb":[{"scroll-mb":de()}],"scroll-ml":[{"scroll-ml":de()}],"scroll-p":[{"scroll-p":de()}],"scroll-px":[{"scroll-px":de()}],"scroll-py":[{"scroll-py":de()}],"scroll-ps":[{"scroll-ps":de()}],"scroll-pe":[{"scroll-pe":de()}],"scroll-pt":[{"scroll-pt":de()}],"scroll-pr":[{"scroll-pr":de()}],"scroll-pb":[{"scroll-pb":de()}],"scroll-pl":[{"scroll-pl":de()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Bt,Ft]}],fill:[{fill:["none",...$e()]}],"stroke-w":[{stroke:[xn,rf,Ul,F_]}],stroke:[{stroke:["none",...$e()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},iA=BI(rA);function Xo(...n){return iA(nI(n))}var aA=Wt('<div class="relative h-4 w-4 rounded-full border-2 border-white bg-blue-500 shadow-lg"></div>'),oA=Wt('<div style="display: contents;"><div><!></div></div>');function sA(n,o){dn(o,!0);const h=xi("marker");let p=hn(null),b=[];Ir(()=>{const z=h.getElement();if(!(!h.isReady()||!z||!P(p)))return b=Array.from(P(p).childNodes),b.forEach(V=>z.appendChild(V)),()=>{b.forEach(V=>{P(p)&&V.parentNode===z&&P(p).appendChild(V)}),b=[]}});var T=oA(),v=At(T),l=At(v);{var C=z=>{var B=Yt(),V=kt(B);Dn(V,()=>o.children),Ue(z,B)},D=z=>{var B=aA();Ue(z,B)};It(l,z=>{o.children?z(C):z(D,!1)})}Tt(v),Tt(T),xa(T,z=>Vt(p,z),()=>P(p)),Zt(z=>ir(v,1,z),[()=>ri(Xo("relative cursor-pointer",o.class))]),Ue(n,T),pn()}const lA={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var cA=nn("<svg><!><!></svg>");function Gf(n,o){dn(o,!0);const h=tn(o,"color",3,"currentColor"),p=tn(o,"size",3,24),b=tn(o,"strokeWidth",3,2),T=tn(o,"absoluteStrokeWidth",3,!1),v=tn(o,"iconNode",19,()=>[]),l=vr(o,["$$slots","$$events","$$legacy","name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","children"]);var C=cA();La(C,B=>({...lA,...l,width:p(),height:p(),stroke:h(),"stroke-width":B,class:["lucide-icon lucide",o.name&&`lucide-${o.name}`,o.class]}),[()=>T()?Number(b())*24/Number(p()):b()]);var D=At(C);ii(D,17,v,ya,(B,V)=>{var G=le(()=>g0(P(V),2));let Q=()=>P(G)[0],ee=()=>P(G)[1];var U=Yt(),se=kt(U);Nw(se,Q,!0,(Me,me)=>{La(Me,()=>({...ee()}))}),Ue(B,U)});var z=$t(D);Dn(z,()=>o.children??Qn),Tt(C),Ue(n,C),pn()}qf(["click"]);var uA=Wt('<div style="display: contents;"><div><!></div></div>');function hA(n,o){dn(o,!0);let h=tn(o,"offset",3,16);const p=xi("marker");let b=hn(null);Ir(()=>{const C=p.getMarker(),D=p.getElement(),z=p.getMap();if(!p.isReady()||!C||!D||!z||!P(b))return;const V=document.createElement("div"),G={offset:h(),closeOnClick:!0,closeButton:!1,className:"maplibre-popup-transparent"};o.anchor!==void 0&&(G.anchor=o.anchor);const Q=new v0.Popup(G).setMaxWidth("none").setDOMContent(V);for(;P(b).firstChild;)V.appendChild(P(b).firstChild);const ee=()=>{Q.setLngLat(C.getLngLat()).addTo(z)},U=()=>{Q.remove()};return D.addEventListener("mouseenter",ee),D.addEventListener("mouseleave",U),()=>{for(D.removeEventListener("mouseenter",ee),D.removeEventListener("mouseleave",U);V.firstChild;)P(b)?.appendChild(V.firstChild);Q.remove()}});var T=uA(),v=At(T),l=At(v);Dn(l,()=>o.children??Qn),Tt(v),Tt(T),xa(T,C=>Vt(b,C),()=>P(b)),Zt(C=>ir(v,1,C),[()=>ri(Xo("animate-in fade-in-0 zoom-in-95 bg-foreground text-background rounded-md px-2 py-1 text-xs shadow-md",o.class))]),Ue(n,T),pn()}function fA(n,o){dn(o,!0);let h=vr(o,["$$slots","$$events","$$legacy"]);const p=[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]];Gf(n,Gi({name:"plus"},()=>h,{get iconNode(){return p},children:(b,T)=>{var v=Yt(),l=kt(v);Dn(l,()=>o.children??Qn),Ue(b,v)},$$slots:{default:!0}})),pn()}function dA(n,o){dn(o,!0);let h=vr(o,["$$slots","$$events","$$legacy"]);const p=[["path",{d:"M5 12h14"}]];Gf(n,Gi({name:"minus"},()=>h,{get iconNode(){return p},children:(b,T)=>{var v=Yt(),l=kt(v);Dn(l,()=>o.children??Qn),Ue(b,v)},$$slots:{default:!0}})),pn()}function pA(n,o){dn(o,!0);let h=vr(o,["$$slots","$$events","$$legacy"]);const p=[["line",{x1:"2",x2:"5",y1:"12",y2:"12"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}],["circle",{cx:"12",cy:"12",r:"7"}]];Gf(n,Gi({name:"locate"},()=>h,{get iconNode(){return p},children:(b,T)=>{var v=Yt(),l=kt(v);Dn(l,()=>o.children??Qn),Ue(b,v)},$$slots:{default:!0}})),pn()}function mA(n,o){dn(o,!0);let h=vr(o,["$$slots","$$events","$$legacy"]);const p=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3"}]];Gf(n,Gi({name:"maximize"},()=>h,{get iconNode(){return p},children:(b,T)=>{var v=Yt(),l=kt(v);Dn(l,()=>o.children??Qn),Ue(b,v)},$$slots:{default:!0}})),pn()}function gA(n,o){dn(o,!0);let h=vr(o,["$$slots","$$events","$$legacy"]);const p=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]];Gf(n,Gi({name:"loader-circle"},()=>h,{get iconNode(){return p},children:(b,T)=>{var v=Yt(),l=kt(v);Dn(l,()=>o.children??Qn),Ue(b,v)},$$slots:{default:!0}})),pn()}var _A=Wt('<div class="border-border bg-background [&amp;>button:not(:last-child)]:border-border flex flex-col overflow-hidden rounded-md border shadow-sm [&amp;>button:not(:last-child)]:border-b"><button aria-label="Zoom in" type="button" class="hover:bg-accent dark:hover:bg-accent/40 flex size-8 items-center justify-center transition-colors"><!></button> <button aria-label="Zoom out" type="button" class="hover:bg-accent dark:hover:bg-accent/40 flex size-8 items-center justify-center transition-colors"><!></button></div>'),yA=Wt('<div class="border-border bg-background flex flex-col overflow-hidden rounded-md border shadow-sm"><button aria-label="Reset bearing to north" type="button" class="hover:bg-accent flex size-8 items-center justify-center transition-colors"><svg viewBox="0 0 24 24" class="size-5 transition-transform duration-200" style="transform-style: preserve-3d;"><path d="M12 2L16 12H12V2Z" class="fill-red-500"></path><path d="M12 2L8 12H12V2Z" class="fill-red-300"></path><path d="M12 22L16 12H12V22Z" class="fill-muted-foreground/60"></path><path d="M12 22L8 12H12V22Z" class="fill-muted-foreground/30"></path></svg></button></div>'),vA=Wt('<div class="border-border bg-background flex flex-col overflow-hidden rounded-md border shadow-sm"><button aria-label="Find my location" type="button"><!></button></div>'),xA=Wt('<div class="border-border bg-background flex flex-col overflow-hidden rounded-md border shadow-sm"><button aria-label="Toggle fullscreen" type="button" class="hover:bg-accent dark:hover:bg-accent/40 flex size-8 items-center justify-center transition-colors"><!></button></div>'),bA=Wt("<div><!> <!> <!> <!></div>");function wA(n,o){dn(o,!0);let h=tn(o,"position",3,"bottom-right"),p=tn(o,"showZoom",3,!0),b=tn(o,"showCompass",3,!1),T=tn(o,"showLocate",3,!1),v=tn(o,"showFullscreen",3,!1);const l=xi("map");let C=hn(!1),D=hn(null);const z={"top-left":"top-2 left-2","top-right":"top-2 right-2","bottom-left":"bottom-2 left-2","bottom-right":"bottom-2 right-2"};Ir(()=>{const me=l.getMap();if(!l.isLoaded()||!me||!P(D))return;const ce=()=>{if(!P(D))return;const oe=me.getBearing(),ue=me.getPitch();P(D).style.transform=`rotateX(${ue}deg) rotateZ(${-oe}deg)`};return me.on("rotate",ce),me.on("pitch",ce),ce(),()=>{me.off("rotate",ce),me.off("pitch",ce)}});function B(){const me=l.getMap();me?.zoomTo(me.getZoom()+1,{duration:300})}function V(){const me=l.getMap();me?.zoomTo(me.getZoom()-1,{duration:300})}function G(){l.getMap()?.resetNorthPitch({duration:300})}function Q(){const me=l.getMap();me&&(Vt(C,!0),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(K=>{const ce={longitude:K.coords.longitude,latitude:K.coords.latitude};me.flyTo({center:[ce.longitude,ce.latitude],zoom:14,duration:1500}),o.onlocate?.(ce),Vt(C,!1)},K=>{console.error("Error getting location:",K),Vt(C,!1)}))}function ee(){const K=l.getMap()?.getContainer();K&&(document.fullscreenElement?document.exitFullscreen():K.requestFullscreen())}var U=Yt(),se=kt(U);{var Me=me=>{var K=bA(),ce=At(K);{var oe=Ye=>{var et=_A(),Ie=At(et);Ie.__click=B;var Je=At(Ie);fA(Je,{class:"size-4"}),Tt(Ie);var Qe=$t(Ie,2);Qe.__click=V;var $e=At(Qe);dA($e,{class:"size-4"}),Tt(Qe),Tt(et),Ue(Ye,et)};It(ce,Ye=>{p()&&Ye(oe)})}var ue=$t(ce,2);{var de=Ye=>{var et=yA(),Ie=At(et);Ie.__click=G;var Je=At(Ie);xa(Je,Qe=>Vt(D,Qe),()=>P(D)),Tt(Ie),Tt(et),Ue(Ye,et)};It(ue,Ye=>{b()&&Ye(de)})}var be=$t(ue,2);{var Re=Ye=>{var et=vA(),Ie=At(et);Ie.__click=Q;var Je=At(Ie);{var Qe=at=>{gA(at,{class:"size-4 animate-spin"})},$e=at=>{pA(at,{class:"size-4"})};It(Je,at=>{P(C)?at(Qe):at($e,!1)})}Tt(Ie),Tt(et),Zt(at=>{ir(Ie,1,at),Ie.disabled=P(C)},[()=>ri(Xo("hover:bg-accent dark:hover:bg-accent/40 flex size-8 items-center justify-center transition-colors",P(C)&&"pointer-events-none cursor-not-allowed opacity-50"))]),Ue(Ye,et)};It(be,Ye=>{T()&&Ye(Re)})}var Ve=$t(be,2);{var qe=Ye=>{var et=xA(),Ie=At(et);Ie.__click=ee;var Je=At(Ie);mA(Je,{class:"size-4"}),Tt(Ie),Tt(et),Ue(Ye,et)};It(Ve,Ye=>{v()&&Ye(qe)})}Tt(K),Zt(Ye=>ir(K,1,Ye),[()=>ri(Xo("absolute z-10 flex flex-col gap-1.5",z[h()],o.class))]),Ue(me,K)};It(se,me=>{l.isLoaded()&&me(Me)})}Ue(n,U),pn()}qf(["click"]);qf(["click"]);var TA=Wt("<button></button>"),SA=Wt('<div class="font-semibold"> </div> <div class="text-sm text-gray-600"> </div>',1),MA=Wt("<!> <!>",1),PA=Wt("<!> <!>",1),EA=Wt('<div class="h-full"><!></div>');function CA(n,o){dn(o,!0);let h=tn(o,"selectedPark",3,null),p=tn(o,"center",19,()=>[-119.5383,37.8651]),b=tn(o,"zoom",3,4);var T=EA(),v=At(T);mI(v,{get center(){return p()},get zoom(){return b()},children:(l,C)=>{var D=PA(),z=kt(D);wA(z,{});var B=$t(z,2);ii(B,17,()=>o.parks,ya,(V,G)=>{gI(V,{get longitude(){return P(G).long},get latitude(){return P(G).lat},children:(Q,ee)=>{var U=MA(),se=kt(U);sA(se,{children:(me,K)=>{var ce=TA();ce.__click=()=>o.onParkClick?.(P(G)),Zt(()=>ir(ce,1,`rounded-full w-3 h-3 ${h()?.Code===P(G).Code?"bg-red-500":"bg-blue-500"} hover:scale-125 transition-transform`)),Ue(me,ce)},$$slots:{default:!0}});var Me=$t(se,2);hA(Me,{children:(me,K)=>{var ce=SA(),oe=kt(ce),ue=At(oe,!0);Tt(oe);var de=$t(oe,2),be=At(de,!0);Tt(de),Zt(()=>{$r(ue,P(G).Name),$r(be,P(G).Code)}),Ue(me,ce)},$$slots:{default:!0}}),Ue(Q,U)},$$slots:{default:!0}})}),Ue(l,D)},$$slots:{default:!0}}),Tt(T),Ue(n,T),pn()}qf(["click"]);class kp extends Map{#e=new Map;#t=hn(0);#n=hn(0);#r=bb||-1;constructor(o){if(super(),o){for(var[h,p]of o)super.set(h,p);this.#n.v=super.size}}#i(o){return bb===this.#r?hn(o):em(o)}has(o){var h=this.#e,p=h.get(o);if(p===void 0){var b=super.get(o);if(b!==void 0)p=this.#i(0),h.set(o,p);else return P(this.#t),!1}return P(p),!0}forEach(o,h){this.#a(),super.forEach(o,h)}get(o){var h=this.#e,p=h.get(o);if(p===void 0){var b=super.get(o);if(b!==void 0)p=this.#i(0),h.set(o,p);else{P(this.#t);return}}return P(p),super.get(o)}set(o,h){var p=this.#e,b=p.get(o),T=super.get(o),v=super.set(o,h),l=this.#t;if(b===void 0)b=this.#i(0),p.set(o,b),Vt(this.#n,super.size),nf(l);else if(T!==h){nf(b);var C=l.reactions===null?null:new Set(l.reactions),D=C===null||!b.reactions?.every(z=>C.has(z));D&&nf(l)}return v}delete(o){var h=this.#e,p=h.get(o),b=super.delete(o);return p!==void 0&&(h.delete(o),Vt(this.#n,super.size),Vt(p,-1),nf(this.#t)),b}clear(){if(super.size!==0){super.clear();var o=this.#e;Vt(this.#n,0);for(var h of o.values())Vt(h,-1);nf(this.#t),o.clear()}}#a(){P(this.#t);var o=this.#e;if(this.#n.v!==o.size){for(var h of super.keys())if(!o.has(h)){var p=this.#i(0);o.set(h,p)}}for([,p]of this.#e)P(p)}keys(){return P(this.#t),super.keys()}values(){return this.#a(),super.values()}entries(){return this.#a(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return P(this.#n),super.size}}class IA{#e;#t;constructor(o,h){this.#e=o,this.#t=tI(h)}get current(){return this.#t(),this.#e()}}const AA=/\(.+\)/,kA=new Set(["all","print","screen","and","or","not","only"]);class DA extends IA{constructor(o,h){let p=AA.test(o)||o.split(/[\s,]+/).some(T=>kA.has(T.trim()))?o:`(${o})`;const b=window.matchMedia(p);super(()=>b.matches,T=>Aw(b,"change",T))}}function Ho(n,o){return n==null||o==null?NaN:n<o?-1:n>o?1:n>=o?0:NaN}function zA(n,o){return n==null||o==null?NaN:o<n?-1:o>n?1:o>=n?0:NaN}function b0(n){let o,h,p;n.length!==2?(o=Ho,h=(l,C)=>Ho(n(l),C),p=(l,C)=>n(l)-C):(o=n===Ho||n===zA?n:RA,h=n,p=n);function b(l,C,D=0,z=l.length){if(D<z){if(o(C,C)!==0)return z;do{const B=D+z>>>1;h(l[B],C)<0?D=B+1:z=B}while(D<z)}return D}function T(l,C,D=0,z=l.length){if(D<z){if(o(C,C)!==0)return z;do{const B=D+z>>>1;h(l[B],C)<=0?D=B+1:z=B}while(D<z)}return D}function v(l,C,D=0,z=l.length){const B=b(l,C,D,z-1);return B>D&&p(l[B-1],C)>-p(l[B],C)?B-1:B}return{left:b,center:v,right:T}}function RA(){return 0}function e2(n){return n===null?NaN:+n}function*LA(n,o){if(o===void 0)for(let h of n)h!=null&&(h=+h)>=h&&(yield h);else{let h=-1;for(let p of n)(p=o(p,++h,n))!=null&&(p=+p)>=p&&(yield p)}}const FA=b0(Ho),$f=FA.right;b0(e2).center;function t2(n,o){let h=0,p,b=0,T=0;if(o===void 0)for(let v of n)v!=null&&(v=+v)>=v&&(p=v-b,b+=p/++h,T+=p*(v-b));else{let v=-1;for(let l of n)(l=o(l,++v,n))!=null&&(l=+l)>=l&&(p=l-b,b+=p/++h,T+=p*(l-b))}if(h>1)return T/(h-1)}function BA(n,o){const h=t2(n,o);return h&&Math.sqrt(h)}function Os(n,o){let h,p;for(const b of n)b!=null&&(h===void 0?b>=b&&(h=p=b):(h>b&&(h=b),p<b&&(p=b)));return[h,p]}class Yl{constructor(){this._partials=new Float64Array(32),this._n=0}add(o){const h=this._partials;let p=0;for(let b=0;b<this._n&&b<32;b++){const T=h[b],v=o+T,l=Math.abs(o)<Math.abs(T)?o-(v-T):T-(v-o);l&&(h[p++]=l),o=v}return h[p]=o,this._n=p+1,this}valueOf(){const o=this._partials;let h=this._n,p,b,T,v=0;if(h>0){for(v=o[--h];h>0&&(p=v,b=o[--h],v=p+b,T=b-(v-p),!T););h>0&&(T<0&&o[h-1]<0||T>0&&o[h-1]>0)&&(b=T*2,p=v+b,b==p-v&&(v=p))}return v}}class nm extends Map{constructor(o,h=VA){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:h}}),o!=null)for(const[p,b]of o)this.set(p,b)}get(o){return super.get(kb(this,o))}has(o){return super.has(kb(this,o))}set(o,h){return super.set(OA(this,o),h)}delete(o){return super.delete(NA(this,o))}}function kb({_intern:n,_key:o},h){const p=o(h);return n.has(p)?n.get(p):h}function OA({_intern:n,_key:o},h){const p=o(h);return n.has(p)?n.get(p):(n.set(p,h),h)}function NA({_intern:n,_key:o},h){const p=o(h);return n.has(p)&&(h=n.get(p),n.delete(p)),h}function VA(n){return n!==null&&typeof n=="object"?n.valueOf():n}function jA(n){return n}function UA(n,...o){return qA(n,Array.from,jA,o)}function qA(n,o,h,p){return(function b(T,v){if(v>=p.length)return h(T);const l=new nm,C=p[v++];let D=-1;for(const z of T){const B=C(z,++D,T),V=l.get(B);V?V.push(z):l.set(B,[z])}for(const[z,B]of l)l.set(z,b(B,v));return o(l)})(n,0)}function GA(n=Ho){if(n===Ho)return n2;if(typeof n!="function")throw new TypeError("compare is not a function");return(o,h)=>{const p=n(o,h);return p||p===0?p:(n(h,h)===0)-(n(o,o)===0)}}function n2(n,o){return(n==null||!(n>=n))-(o==null||!(o>=o))||(n<o?-1:n>o?1:0)}const $A=Math.sqrt(50),ZA=Math.sqrt(10),WA=Math.sqrt(2);function rm(n,o,h){const p=(o-n)/Math.max(0,h),b=Math.floor(Math.log10(p)),T=p/Math.pow(10,b),v=T>=$A?10:T>=ZA?5:T>=WA?2:1;let l,C,D;return b<0?(D=Math.pow(10,-b)/v,l=Math.round(n*D),C=Math.round(o*D),l/D<n&&++l,C/D>o&&--C,D=-D):(D=Math.pow(10,b)*v,l=Math.round(n/D),C=Math.round(o/D),l*D<n&&++l,C*D>o&&--C),C<l&&.5<=h&&h<2?rm(n,o,h*2):[l,C,D]}function If(n,o,h){if(o=+o,n=+n,h=+h,!(h>0))return[];if(n===o)return[n];const p=o<n,[b,T,v]=p?rm(o,n,h):rm(n,o,h);if(!(T>=b))return[];const l=T-b+1,C=new Array(l);if(p)if(v<0)for(let D=0;D<l;++D)C[D]=(T-D)/-v;else for(let D=0;D<l;++D)C[D]=(T-D)*v;else if(v<0)for(let D=0;D<l;++D)C[D]=(b+D)/-v;else for(let D=0;D<l;++D)C[D]=(b+D)*v;return C}function wy(n,o,h){return o=+o,n=+n,h=+h,rm(n,o,h)[2]}function Ty(n,o,h){o=+o,n=+n,h=+h;const p=o<n,b=p?wy(o,n,h):wy(n,o,h);return(p?-1:1)*(b<0?1/-b:b)}function Af(n,o){let h;if(o===void 0)for(const p of n)p!=null&&(h<p||h===void 0&&p>=p)&&(h=p);else{let p=-1;for(let b of n)(b=o(b,++p,n))!=null&&(h<b||h===void 0&&b>=b)&&(h=b)}return h}function Sy(n,o){let h;if(o===void 0)for(const p of n)p!=null&&(h>p||h===void 0&&p>=p)&&(h=p);else{let p=-1;for(let b of n)(b=o(b,++p,n))!=null&&(h>b||h===void 0&&b>=b)&&(h=b)}return h}function r2(n,o,h=0,p=1/0,b){if(o=Math.floor(o),h=Math.floor(Math.max(0,h)),p=Math.floor(Math.min(n.length-1,p)),!(h<=o&&o<=p))return n;for(b=b===void 0?n2:GA(b);p>h;){if(p-h>600){const C=p-h+1,D=o-h+1,z=Math.log(C),B=.5*Math.exp(2*z/3),V=.5*Math.sqrt(z*B*(C-B)/C)*(D-C/2<0?-1:1),G=Math.max(h,Math.floor(o-D*B/C+V)),Q=Math.min(p,Math.floor(o+(C-D)*B/C+V));r2(n,o,G,Q,b)}const T=n[o];let v=h,l=p;for(af(n,h,o),b(n[p],T)>0&&af(n,h,p);v<l;){for(af(n,v,l),++v,--l;b(n[v],T)<0;)++v;for(;b(n[l],T)>0;)--l}b(n[h],T)===0?af(n,h,l):(++l,af(n,l,p)),l<=o&&(h=l+1),o<=l&&(p=l-1)}return n}function af(n,o,h){const p=n[o];n[o]=n[h],n[h]=p}function w0(n,o,h){if(n=Float64Array.from(LA(n,h)),!(!(p=n.length)||isNaN(o=+o))){if(o<=0||p<2)return Sy(n);if(o>=1)return Af(n);var p,b=(p-1)*o,T=Math.floor(b),v=Af(r2(n,T).subarray(0,T+1)),l=Sy(n.subarray(T+1));return v+(l-v)*(b-T)}}function HA(n,o,h=e2){if(!(!(p=n.length)||isNaN(o=+o))){if(o<=0||p<2)return+h(n[0],0,n);if(o>=1)return+h(n[p-1],p-1,n);var p,b=(p-1)*o,T=Math.floor(b),v=+h(n[T],T,n),l=+h(n[T+1],T+1,n);return v+(l-v)*(b-T)}}function XA(n,o){let h=0,p=0;if(o===void 0)for(let b of n)b!=null&&(b=+b)>=b&&(++h,p+=b);else{let b=-1;for(let T of n)(T=o(T,++b,n))!=null&&(T=+T)>=T&&(++h,p+=T)}if(h)return p/h}function YA(n,o){return w0(n,.5,o)}function*KA(n){for(const o of n)yield*o}function i2(n){return Array.from(KA(n))}function JA(n,o){const h=new nm;if(o===void 0)for(let T of n)T!=null&&T>=T&&h.set(T,(h.get(T)||0)+1);else{let T=-1;for(let v of n)(v=o(v,++T,n))!=null&&v>=v&&h.set(v,(h.get(v)||0)+1)}let p,b=0;for(const[T,v]of h)v>b&&(b=v,p=T);return p}function Bs(n,o,h){n=+n,o=+o,h=(b=arguments.length)<2?(o=n,n=0,1):b<3?1:+h;for(var p=-1,b=Math.max(0,Math.ceil((o-n)/h))|0,T=new Array(b);++p<b;)T[p]=n+p*h;return T}function a2(n,o){let h=0;if(o===void 0)for(let p of n)(p=+p)&&(h+=p);else{let p=-1;for(let b of n)(b=+o(b,++p,n))&&(h+=b)}return h}function co(n,o){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(o).domain(n);break}return this}function Qo(n,o){switch(arguments.length){case 0:break;case 1:{typeof n=="function"?this.interpolator(n):this.range(n);break}default:{this.domain(n),typeof o=="function"?this.interpolator(o):this.range(o);break}}return this}const Db=Symbol("implicit");function Um(){var n=new nm,o=[],h=[],p=Db;function b(T){let v=n.get(T);if(v===void 0){if(p!==Db)return p;n.set(T,v=o.push(T)-1)}return h[v%h.length]}return b.domain=function(T){if(!arguments.length)return o.slice();o=[],n=new nm;for(const v of T)n.has(v)||n.set(v,o.push(v)-1);return b},b.range=function(T){return arguments.length?(h=Array.from(T),b):h.slice()},b.unknown=function(T){return arguments.length?(p=T,b):p},b.copy=function(){return Um(o,h).unknown(p)},co.apply(b,arguments),b}function Kl(){var n=Um().unknown(void 0),o=n.domain,h=n.range,p=0,b=1,T,v,l=!1,C=0,D=0,z=.5;delete n.unknown;function B(){var V=o().length,G=b<p,Q=G?b:p,ee=G?p:b;T=(ee-Q)/Math.max(1,V-C+D*2),l&&(T=Math.floor(T)),Q+=(ee-Q-T*(V-C))*z,v=T*(1-C),l&&(Q=Math.round(Q),v=Math.round(v));var U=Bs(V).map(function(se){return Q+T*se});return h(G?U.reverse():U)}return n.domain=function(V){return arguments.length?(o(V),B()):o()},n.range=function(V){return arguments.length?([p,b]=V,p=+p,b=+b,B()):[p,b]},n.rangeRound=function(V){return[p,b]=V,p=+p,b=+b,l=!0,B()},n.bandwidth=function(){return v},n.step=function(){return T},n.round=function(V){return arguments.length?(l=!!V,B()):l},n.padding=function(V){return arguments.length?(C=Math.min(1,D=+V),B()):C},n.paddingInner=function(V){return arguments.length?(C=Math.min(1,V),B()):C},n.paddingOuter=function(V){return arguments.length?(D=+V,B()):D},n.align=function(V){return arguments.length?(z=Math.max(0,Math.min(1,V)),B()):z},n.copy=function(){return Kl(o(),[p,b]).round(l).paddingInner(C).paddingOuter(D).align(z)},co.apply(B(),arguments)}function o2(n){var o=n.copy;return n.padding=n.paddingOuter,delete n.paddingInner,delete n.paddingOuter,n.copy=function(){return o2(o())},n}function QA(){return o2(Kl.apply(null,arguments).paddingInner(1))}function Fu(n,o,h){n.prototype=o.prototype=h,h.constructor=n}function Zf(n,o){var h=Object.create(n.prototype);for(var p in o)h[p]=o[p];return h}function qs(){}var Jl=.7,Pu=1/Jl,bu="\\s*([+-]?\\d+)\\s*",kf="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ro="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",e3=/^#([0-9a-f]{3,8})$/,t3=new RegExp(`^rgb\\(${bu},${bu},${bu}\\)$`),n3=new RegExp(`^rgb\\(${ro},${ro},${ro}\\)$`),r3=new RegExp(`^rgba\\(${bu},${bu},${bu},${kf}\\)$`),i3=new RegExp(`^rgba\\(${ro},${ro},${ro},${kf}\\)$`),a3=new RegExp(`^hsl\\(${kf},${ro},${ro}\\)$`),o3=new RegExp(`^hsla\\(${kf},${ro},${ro},${kf}\\)$`),zb={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Fu(qs,Eu,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:Rb,formatHex:Rb,formatHex8:s3,formatHsl:l3,formatRgb:Lb,toString:Lb});function Rb(){return this.rgb().formatHex()}function s3(){return this.rgb().formatHex8()}function l3(){return s2(this).formatHsl()}function Lb(){return this.rgb().formatRgb()}function Eu(n){var o,h;return n=(n+"").trim().toLowerCase(),(o=e3.exec(n))?(h=o[1].length,o=parseInt(o[1],16),h===6?Fb(o):h===3?new ni(o>>8&15|o>>4&240,o>>4&15|o&240,(o&15)<<4|o&15,1):h===8?Dp(o>>24&255,o>>16&255,o>>8&255,(o&255)/255):h===4?Dp(o>>12&15|o>>8&240,o>>8&15|o>>4&240,o>>4&15|o&240,((o&15)<<4|o&15)/255):null):(o=t3.exec(n))?new ni(o[1],o[2],o[3],1):(o=n3.exec(n))?new ni(o[1]*255/100,o[2]*255/100,o[3]*255/100,1):(o=r3.exec(n))?Dp(o[1],o[2],o[3],o[4]):(o=i3.exec(n))?Dp(o[1]*255/100,o[2]*255/100,o[3]*255/100,o[4]):(o=a3.exec(n))?Nb(o[1],o[2]/100,o[3]/100,1):(o=o3.exec(n))?Nb(o[1],o[2]/100,o[3]/100,o[4]):zb.hasOwnProperty(n)?Fb(zb[n]):n==="transparent"?new ni(NaN,NaN,NaN,0):null}function Fb(n){return new ni(n>>16&255,n>>8&255,n&255,1)}function Dp(n,o,h,p){return p<=0&&(n=o=h=NaN),new ni(n,o,h,p)}function T0(n){return n instanceof qs||(n=Eu(n)),n?(n=n.rgb(),new ni(n.r,n.g,n.b,n.opacity)):new ni}function Df(n,o,h,p){return arguments.length===1?T0(n):new ni(n,o,h,p??1)}function ni(n,o,h,p){this.r=+n,this.g=+o,this.b=+h,this.opacity=+p}Fu(ni,Df,Zf(qs,{brighter(n){return n=n==null?Pu:Math.pow(Pu,n),new ni(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Jl:Math.pow(Jl,n),new ni(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new ni(Wl(this.r),Wl(this.g),Wl(this.b),im(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Bb,formatHex:Bb,formatHex8:c3,formatRgb:Ob,toString:Ob}));function Bb(){return`#${Gl(this.r)}${Gl(this.g)}${Gl(this.b)}`}function c3(){return`#${Gl(this.r)}${Gl(this.g)}${Gl(this.b)}${Gl((isNaN(this.opacity)?1:this.opacity)*255)}`}function Ob(){const n=im(this.opacity);return`${n===1?"rgb(":"rgba("}${Wl(this.r)}, ${Wl(this.g)}, ${Wl(this.b)}${n===1?")":`, ${n})`}`}function im(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Wl(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Gl(n){return n=Wl(n),(n<16?"0":"")+n.toString(16)}function Nb(n,o,h,p){return p<=0?n=o=h=NaN:h<=0||h>=1?n=o=NaN:o<=0&&(n=NaN),new Da(n,o,h,p)}function s2(n){if(n instanceof Da)return new Da(n.h,n.s,n.l,n.opacity);if(n instanceof qs||(n=Eu(n)),!n)return new Da;if(n instanceof Da)return n;n=n.rgb();var o=n.r/255,h=n.g/255,p=n.b/255,b=Math.min(o,h,p),T=Math.max(o,h,p),v=NaN,l=T-b,C=(T+b)/2;return l?(o===T?v=(h-p)/l+(h<p)*6:h===T?v=(p-o)/l+2:v=(o-h)/l+4,l/=C<.5?T+b:2-T-b,v*=60):l=C>0&&C<1?0:v,new Da(v,l,C,n.opacity)}function u3(n,o,h,p){return arguments.length===1?s2(n):new Da(n,o,h,p??1)}function Da(n,o,h,p){this.h=+n,this.s=+o,this.l=+h,this.opacity=+p}Fu(Da,u3,Zf(qs,{brighter(n){return n=n==null?Pu:Math.pow(Pu,n),new Da(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Jl:Math.pow(Jl,n),new Da(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,o=isNaN(n)||isNaN(this.s)?0:this.s,h=this.l,p=h+(h<.5?h:1-h)*o,b=2*h-p;return new ni(B_(n>=240?n-240:n+120,b,p),B_(n,b,p),B_(n<120?n+240:n-120,b,p),this.opacity)},clamp(){return new Da(Vb(this.h),zp(this.s),zp(this.l),im(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=im(this.opacity);return`${n===1?"hsl(":"hsla("}${Vb(this.h)}, ${zp(this.s)*100}%, ${zp(this.l)*100}%${n===1?")":`, ${n})`}`}}));function Vb(n){return n=(n||0)%360,n<0?n+360:n}function zp(n){return Math.max(0,Math.min(1,n||0))}function B_(n,o,h){return(n<60?o+(h-o)*n/60:n<180?h:n<240?o+(h-o)*(240-n)/60:o)*255}const l2=Math.PI/180,c2=180/Math.PI,am=18,u2=.96422,h2=1,f2=.82521,d2=4/29,wu=6/29,p2=3*wu*wu,h3=wu*wu*wu;function m2(n){if(n instanceof io)return new io(n.l,n.a,n.b,n.opacity);if(n instanceof $o)return g2(n);n instanceof ni||(n=T0(n));var o=j_(n.r),h=j_(n.g),p=j_(n.b),b=O_((.2225045*o+.7168786*h+.0606169*p)/h2),T,v;return o===h&&h===p?T=v=b:(T=O_((.4360747*o+.3850649*h+.1430804*p)/u2),v=O_((.0139322*o+.0971045*h+.7141733*p)/f2)),new io(116*b-16,500*(T-b),200*(b-v),n.opacity)}function My(n,o,h,p){return arguments.length===1?m2(n):new io(n,o,h,p??1)}function io(n,o,h,p){this.l=+n,this.a=+o,this.b=+h,this.opacity=+p}Fu(io,My,Zf(qs,{brighter(n){return new io(this.l+am*(n??1),this.a,this.b,this.opacity)},darker(n){return new io(this.l-am*(n??1),this.a,this.b,this.opacity)},rgb(){var n=(this.l+16)/116,o=isNaN(this.a)?n:n+this.a/500,h=isNaN(this.b)?n:n-this.b/200;return o=u2*N_(o),n=h2*N_(n),h=f2*N_(h),new ni(V_(3.1338561*o-1.6168667*n-.4906146*h),V_(-.9787684*o+1.9161415*n+.033454*h),V_(.0719453*o-.2289914*n+1.4052427*h),this.opacity)}}));function O_(n){return n>h3?Math.pow(n,1/3):n/p2+d2}function N_(n){return n>wu?n*n*n:p2*(n-d2)}function V_(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function j_(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function f3(n){if(n instanceof $o)return new $o(n.h,n.c,n.l,n.opacity);if(n instanceof io||(n=m2(n)),n.a===0&&n.b===0)return new $o(NaN,0<n.l&&n.l<100?0:NaN,n.l,n.opacity);var o=Math.atan2(n.b,n.a)*c2;return new $o(o<0?o+360:o,Math.sqrt(n.a*n.a+n.b*n.b),n.l,n.opacity)}function d3(n,o,h,p){return arguments.length===1?f3(n):new $o(n,o,h,p??1)}function $o(n,o,h,p){this.h=+n,this.c=+o,this.l=+h,this.opacity=+p}function g2(n){if(isNaN(n.h))return new io(n.l,0,0,n.opacity);var o=n.h*l2;return new io(n.l,Math.cos(o)*n.c,Math.sin(o)*n.c,n.opacity)}Fu($o,d3,Zf(qs,{brighter(n){return new $o(this.h,this.c,this.l+am*(n??1),this.opacity)},darker(n){return new $o(this.h,this.c,this.l-am*(n??1),this.opacity)},rgb(){return g2(this).rgb()}}));var _2=-.14861,S0=1.78277,M0=-.29227,qm=-.90649,zf=1.97294,jb=zf*qm,Ub=zf*S0,qb=S0*M0-qm*_2;function p3(n){if(n instanceof Hl)return new Hl(n.h,n.s,n.l,n.opacity);n instanceof ni||(n=T0(n));var o=n.r/255,h=n.g/255,p=n.b/255,b=(qb*p+jb*o-Ub*h)/(qb+jb-Ub),T=p-b,v=(zf*(h-b)-M0*T)/qm,l=Math.sqrt(v*v+T*T)/(zf*b*(1-b)),C=l?Math.atan2(v,T)*c2-120:NaN;return new Hl(C<0?C+360:C,l,b,n.opacity)}function so(n,o,h,p){return arguments.length===1?p3(n):new Hl(n,o,h,p??1)}function Hl(n,o,h,p){this.h=+n,this.s=+o,this.l=+h,this.opacity=+p}Fu(Hl,so,Zf(qs,{brighter(n){return n=n==null?Pu:Math.pow(Pu,n),new Hl(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Jl:Math.pow(Jl,n),new Hl(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=isNaN(this.h)?0:(this.h+120)*l2,o=+this.l,h=isNaN(this.s)?0:this.s*o*(1-o),p=Math.cos(n),b=Math.sin(n);return new ni(255*(o+h*(_2*p+S0*b)),255*(o+h*(M0*p+qm*b)),255*(o+h*(zf*p)),this.opacity)}}));function m3(n,o,h,p,b){var T=n*n,v=T*n;return((1-3*n+3*T-v)*o+(4-6*T+3*v)*h+(1+3*n+3*T-3*v)*p+v*b)/6}function g3(n){var o=n.length-1;return function(h){var p=h<=0?h=0:h>=1?(h=1,o-1):Math.floor(h*o),b=n[p],T=n[p+1],v=p>0?n[p-1]:2*b-T,l=p<o-1?n[p+2]:2*T-b;return m3((h-p/o)*o,v,b,T,l)}}const Gm=n=>()=>n;function y2(n,o){return function(h){return n+h*o}}function _3(n,o,h){return n=Math.pow(n,h),o=Math.pow(o,h)-n,h=1/h,function(p){return Math.pow(n+p*o,h)}}function y3(n,o){var h=o-n;return h?y2(n,h>180||h<-180?h-360*Math.round(h/360):h):Gm(isNaN(n)?o:n)}function v3(n){return(n=+n)==1?no:function(o,h){return h-o?_3(o,h,n):Gm(isNaN(o)?h:o)}}function no(n,o){var h=o-n;return h?y2(n,h):Gm(isNaN(n)?o:n)}const Gb=(function n(o){var h=v3(o);function p(b,T){var v=h((b=Df(b)).r,(T=Df(T)).r),l=h(b.g,T.g),C=h(b.b,T.b),D=no(b.opacity,T.opacity);return function(z){return b.r=v(z),b.g=l(z),b.b=C(z),b.opacity=D(z),b+""}}return p.gamma=n,p})(1);function x3(n){return function(o){var h=o.length,p=new Array(h),b=new Array(h),T=new Array(h),v,l;for(v=0;v<h;++v)l=Df(o[v]),p[v]=l.r||0,b[v]=l.g||0,T[v]=l.b||0;return p=n(p),b=n(b),T=n(T),l.opacity=1,function(C){return l.r=p(C),l.g=b(C),l.b=T(C),l+""}}}var b3=x3(g3);function w3(n,o){o||(o=[]);var h=n?Math.min(o.length,n.length):0,p=o.slice(),b;return function(T){for(b=0;b<h;++b)p[b]=n[b]*(1-T)+o[b]*T;return p}}function T3(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function S3(n,o){var h=o?o.length:0,p=n?Math.min(h,n.length):0,b=new Array(p),T=new Array(h),v;for(v=0;v<p;++v)b[v]=Bu(n[v],o[v]);for(;v<h;++v)T[v]=o[v];return function(l){for(v=0;v<p;++v)T[v]=b[v](l);return T}}function M3(n,o){var h=new Date;return n=+n,o=+o,function(p){return h.setTime(n*(1-p)+o*p),h}}function om(n,o){return n=+n,o=+o,function(h){return n*(1-h)+o*h}}function P3(n,o){var h={},p={},b;(n===null||typeof n!="object")&&(n={}),(o===null||typeof o!="object")&&(o={});for(b in o)b in n?h[b]=Bu(n[b],o[b]):p[b]=o[b];return function(T){for(b in h)p[b]=h[b](T);return p}}var Py=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,U_=new RegExp(Py.source,"g");function E3(n){return function(){return n}}function C3(n){return function(o){return n(o)+""}}function I3(n,o){var h=Py.lastIndex=U_.lastIndex=0,p,b,T,v=-1,l=[],C=[];for(n=n+"",o=o+"";(p=Py.exec(n))&&(b=U_.exec(o));)(T=b.index)>h&&(T=o.slice(h,T),l[v]?l[v]+=T:l[++v]=T),(p=p[0])===(b=b[0])?l[v]?l[v]+=b:l[++v]=b:(l[++v]=null,C.push({i:v,x:om(p,b)})),h=U_.lastIndex;return h<o.length&&(T=o.slice(h),l[v]?l[v]+=T:l[++v]=T),l.length<2?C[0]?C3(C[0].x):E3(o):(o=C.length,function(D){for(var z=0,B;z<o;++z)l[(B=C[z]).i]=B.x(D);return l.join("")})}function Bu(n,o){var h=typeof o,p;return o==null||h==="boolean"?Gm(o):(h==="number"?om:h==="string"?(p=Eu(o))?(o=p,Gb):I3:o instanceof Eu?Gb:o instanceof Date?M3:T3(o)?w3:Array.isArray(o)?S3:typeof o.valueOf!="function"&&typeof o.toString!="function"||isNaN(o)?P3:om)(n,o)}function $m(n,o){return n=+n,o=+o,function(h){return Math.round(n*(1-h)+o*h)}}function $b(n,o){var h=no((n=My(n)).l,(o=My(o)).l),p=no(n.a,o.a),b=no(n.b,o.b),T=no(n.opacity,o.opacity);return function(v){return n.l=h(v),n.a=p(v),n.b=b(v),n.opacity=T(v),n+""}}function v2(n){return(function o(h){h=+h;function p(b,T){var v=n((b=so(b)).h,(T=so(T)).h),l=no(b.s,T.s),C=no(b.l,T.l),D=no(b.opacity,T.opacity);return function(z){return b.h=v(z),b.s=l(z),b.l=C(Math.pow(z,h)),b.opacity=D(z),b+""}}return p.gamma=o,p})(1)}v2(y3);var P0=v2(no);function A3(n,o){o===void 0&&(o=n,n=Bu);for(var h=0,p=o.length-1,b=o[0],T=new Array(p<0?0:p);h<p;)T[h]=n(b,b=o[++h]);return function(v){var l=Math.max(0,Math.min(p-1,Math.floor(v*=p)));return T[l](v-l)}}function Wf(n,o){for(var h=new Array(o),p=0;p<o;++p)h[p]=n(p/(o-1));return h}function k3(n){return function(){return n}}function D3(n){return+n}var Zb=[0,1];function Ii(n){return n}function Ey(n,o){return(o-=n=+n)?function(h){return(h-n)/o}:k3(isNaN(o)?NaN:.5)}function z3(n,o){var h;return n>o&&(h=n,n=o,o=h),function(p){return Math.max(n,Math.min(o,p))}}function R3(n,o,h){var p=n[0],b=n[1],T=o[0],v=o[1];return b<p?(p=Ey(b,p),T=h(v,T)):(p=Ey(p,b),T=h(T,v)),function(l){return T(p(l))}}function L3(n,o,h){var p=Math.min(n.length,o.length)-1,b=new Array(p),T=new Array(p),v=-1;for(n[p]<n[0]&&(n=n.slice().reverse(),o=o.slice().reverse());++v<p;)b[v]=Ey(n[v],n[v+1]),T[v]=h(o[v],o[v+1]);return function(l){var C=$f(n,l,1,p)-1;return T[C](b[C](l))}}function Hf(n,o){return o.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function Zm(){var n=Zb,o=Zb,h=Bu,p,b,T,v=Ii,l,C,D;function z(){var V=Math.min(n.length,o.length);return v!==Ii&&(v=z3(n[0],n[V-1])),l=V>2?L3:R3,C=D=null,B}function B(V){return V==null||isNaN(V=+V)?T:(C||(C=l(n.map(p),o,h)))(p(v(V)))}return B.invert=function(V){return v(b((D||(D=l(o,n.map(p),om)))(V)))},B.domain=function(V){return arguments.length?(n=Array.from(V,D3),z()):n.slice()},B.range=function(V){return arguments.length?(o=Array.from(V),z()):o.slice()},B.rangeRound=function(V){return o=Array.from(V),h=$m,z()},B.clamp=function(V){return arguments.length?(v=V?!0:Ii,z()):v!==Ii},B.interpolate=function(V){return arguments.length?(h=V,z()):h},B.unknown=function(V){return arguments.length?(T=V,B):T},function(V,G){return p=V,b=G,z()}}function x2(){return Zm()(Ii,Ii)}function F3(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function sm(n,o){if(!isFinite(n)||n===0)return null;var h=(n=o?n.toExponential(o-1):n.toExponential()).indexOf("e"),p=n.slice(0,h);return[p.length>1?p[0]+p.slice(2):p,+n.slice(h+1)]}function Cu(n){return n=sm(Math.abs(n)),n?n[1]:NaN}function B3(n,o){return function(h,p){for(var b=h.length,T=[],v=0,l=n[0],C=0;b>0&&l>0&&(C+l+1>p&&(l=Math.max(1,p-C)),T.push(h.substring(b-=l,b+l)),!((C+=l+1)>p));)l=n[v=(v+1)%n.length];return T.reverse().join(o)}}function O3(n){return function(o){return o.replace(/[0-9]/g,function(h){return n[+h]})}}var N3=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Rf(n){if(!(o=N3.exec(n)))throw new Error("invalid format: "+n);var o;return new E0({fill:o[1],align:o[2],sign:o[3],symbol:o[4],zero:o[5],width:o[6],comma:o[7],precision:o[8]&&o[8].slice(1),trim:o[9],type:o[10]})}Rf.prototype=E0.prototype;function E0(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}E0.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function V3(n){e:for(var o=n.length,h=1,p=-1,b;h<o;++h)switch(n[h]){case".":p=b=h;break;case"0":p===0&&(p=h),b=h;break;default:if(!+n[h])break e;p>0&&(p=0);break}return p>0?n.slice(0,p)+n.slice(b+1):n}var lm;function j3(n,o){var h=sm(n,o);if(!h)return lm=void 0,n.toPrecision(o);var p=h[0],b=h[1],T=b-(lm=Math.max(-8,Math.min(8,Math.floor(b/3)))*3)+1,v=p.length;return T===v?p:T>v?p+new Array(T-v+1).join("0"):T>0?p.slice(0,T)+"."+p.slice(T):"0."+new Array(1-T).join("0")+sm(n,Math.max(0,o+T-1))[0]}function Wb(n,o){var h=sm(n,o);if(!h)return n+"";var p=h[0],b=h[1];return b<0?"0."+new Array(-b).join("0")+p:p.length>b+1?p.slice(0,b+1)+"."+p.slice(b+1):p+new Array(b-p.length+2).join("0")}const Hb={"%":(n,o)=>(n*100).toFixed(o),b:n=>Math.round(n).toString(2),c:n=>n+"",d:F3,e:(n,o)=>n.toExponential(o),f:(n,o)=>n.toFixed(o),g:(n,o)=>n.toPrecision(o),o:n=>Math.round(n).toString(8),p:(n,o)=>Wb(n*100,o),r:Wb,s:j3,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function Xb(n){return n}var Yb=Array.prototype.map,Kb=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function U3(n){var o=n.grouping===void 0||n.thousands===void 0?Xb:B3(Yb.call(n.grouping,Number),n.thousands+""),h=n.currency===void 0?"":n.currency[0]+"",p=n.currency===void 0?"":n.currency[1]+"",b=n.decimal===void 0?".":n.decimal+"",T=n.numerals===void 0?Xb:O3(Yb.call(n.numerals,String)),v=n.percent===void 0?"%":n.percent+"",l=n.minus===void 0?"":n.minus+"",C=n.nan===void 0?"NaN":n.nan+"";function D(B,V){B=Rf(B);var G=B.fill,Q=B.align,ee=B.sign,U=B.symbol,se=B.zero,Me=B.width,me=B.comma,K=B.precision,ce=B.trim,oe=B.type;oe==="n"?(me=!0,oe="g"):Hb[oe]||(K===void 0&&(K=12),ce=!0,oe="g"),(se||G==="0"&&Q==="=")&&(se=!0,G="0",Q="=");var ue=(V&&V.prefix!==void 0?V.prefix:"")+(U==="$"?h:U==="#"&&/[boxX]/.test(oe)?"0"+oe.toLowerCase():""),de=(U==="$"?p:/[%p]/.test(oe)?v:"")+(V&&V.suffix!==void 0?V.suffix:""),be=Hb[oe],Re=/[defgprs%]/.test(oe);K=K===void 0?6:/[gprs]/.test(oe)?Math.max(1,Math.min(21,K)):Math.max(0,Math.min(20,K));function Ve(qe){var Ye=ue,et=de,Ie,Je,Qe;if(oe==="c")et=be(qe)+et,qe="";else{qe=+qe;var $e=qe<0||1/qe<0;if(qe=isNaN(qe)?C:be(Math.abs(qe),K),ce&&(qe=V3(qe)),$e&&+qe==0&&ee!=="+"&&($e=!1),Ye=($e?ee==="("?ee:l:ee==="-"||ee==="("?"":ee)+Ye,et=(oe==="s"&&!isNaN(qe)&&lm!==void 0?Kb[8+lm/3]:"")+et+($e&&ee==="("?")":""),Re){for(Ie=-1,Je=qe.length;++Ie<Je;)if(Qe=qe.charCodeAt(Ie),48>Qe||Qe>57){et=(Qe===46?b+qe.slice(Ie+1):qe.slice(Ie))+et,qe=qe.slice(0,Ie);break}}}me&&!se&&(qe=o(qe,1/0));var at=Ye.length+qe.length+et.length,zt=at<Me?new Array(Me-at+1).join(G):"";switch(me&&se&&(qe=o(zt+qe,zt.length?Me-et.length:1/0),zt=""),Q){case"<":qe=Ye+qe+et+zt;break;case"=":qe=Ye+zt+qe+et;break;case"^":qe=zt.slice(0,at=zt.length>>1)+Ye+qe+et+zt.slice(at);break;default:qe=zt+Ye+qe+et;break}return T(qe)}return Ve.toString=function(){return B+""},Ve}function z(B,V){var G=Math.max(-8,Math.min(8,Math.floor(Cu(V)/3)))*3,Q=Math.pow(10,-G),ee=D((B=Rf(B),B.type="f",B),{suffix:Kb[8+G/3]});return function(U){return ee(Q*U)}}return{format:D,formatPrefix:z}}var Rp,C0,b2;q3({thousands:",",grouping:[3],currency:["$",""]});function q3(n){return Rp=U3(n),C0=Rp.format,b2=Rp.formatPrefix,Rp}function G3(n){return Math.max(0,-Cu(Math.abs(n)))}function $3(n,o){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Cu(o)/3)))*3-Cu(Math.abs(n)))}function Z3(n,o){return n=Math.abs(n),o=Math.abs(o)-n,Math.max(0,Cu(o)-Cu(n))+1}function W3(n,o,h,p){var b=Ty(n,o,h),T;switch(p=Rf(p??",f"),p.type){case"s":{var v=Math.max(Math.abs(n),Math.abs(o));return p.precision==null&&!isNaN(T=$3(b,v))&&(p.precision=T),b2(p,v)}case"":case"e":case"g":case"p":case"r":{p.precision==null&&!isNaN(T=Z3(b,Math.max(Math.abs(n),Math.abs(o))))&&(p.precision=T-(p.type==="e"));break}case"f":case"%":{p.precision==null&&!isNaN(T=G3(b))&&(p.precision=T-(p.type==="%")*2);break}}return C0(p)}function Ou(n){var o=n.domain;return n.ticks=function(h){var p=o();return If(p[0],p[p.length-1],h??10)},n.tickFormat=function(h,p){var b=o();return W3(b[0],b[b.length-1],h??10,p)},n.nice=function(h){h==null&&(h=10);var p=o(),b=0,T=p.length-1,v=p[b],l=p[T],C,D,z=10;for(l<v&&(D=v,v=l,l=D,D=b,b=T,T=D);z-- >0;){if(D=wy(v,l,h),D===C)return p[b]=v,p[T]=l,o(p);if(D>0)v=Math.floor(v/D)*D,l=Math.ceil(l/D)*D;else if(D<0)v=Math.ceil(v*D)/D,l=Math.floor(l*D)/D;else break;C=D}return n},n}function cm(){var n=x2();return n.copy=function(){return Hf(n,cm())},co.apply(n,arguments),Ou(n)}function w2(n,o){n=n.slice();var h=0,p=n.length-1,b=n[h],T=n[p],v;return T<b&&(v=h,h=p,p=v,v=b,b=T,T=v),n[h]=o.floor(b),n[p]=o.ceil(T),n}function Jb(n){return Math.log(n)}function Qb(n){return Math.exp(n)}function H3(n){return-Math.log(-n)}function X3(n){return-Math.exp(-n)}function Y3(n){return isFinite(n)?+("1e"+n):n<0?0:n}function K3(n){return n===10?Y3:n===Math.E?Math.exp:o=>Math.pow(n,o)}function J3(n){return n===Math.E?Math.log:n===10&&Math.log10||n===2&&Math.log2||(n=Math.log(n),o=>Math.log(o)/n)}function e1(n){return(o,h)=>-n(-o,h)}function I0(n){const o=n(Jb,Qb),h=o.domain;let p=10,b,T;function v(){return b=J3(p),T=K3(p),h()[0]<0?(b=e1(b),T=e1(T),n(H3,X3)):n(Jb,Qb),o}return o.base=function(l){return arguments.length?(p=+l,v()):p},o.domain=function(l){return arguments.length?(h(l),v()):h()},o.ticks=l=>{const C=h();let D=C[0],z=C[C.length-1];const B=z<D;B&&([D,z]=[z,D]);let V=b(D),G=b(z),Q,ee;const U=l==null?10:+l;let se=[];if(!(p%1)&&G-V<U){if(V=Math.floor(V),G=Math.ceil(G),D>0){for(;V<=G;++V)for(Q=1;Q<p;++Q)if(ee=V<0?Q/T(-V):Q*T(V),!(ee<D)){if(ee>z)break;se.push(ee)}}else for(;V<=G;++V)for(Q=p-1;Q>=1;--Q)if(ee=V>0?Q/T(-V):Q*T(V),!(ee<D)){if(ee>z)break;se.push(ee)}se.length*2<U&&(se=If(D,z,U))}else se=If(V,G,Math.min(G-V,U)).map(T);return B?se.reverse():se},o.tickFormat=(l,C)=>{if(l==null&&(l=10),C==null&&(C=p===10?"s":","),typeof C!="function"&&(!(p%1)&&(C=Rf(C)).precision==null&&(C.trim=!0),C=C0(C)),l===1/0)return C;const D=Math.max(1,p*l/o.ticks().length);return z=>{let B=z/T(Math.round(b(z)));return B*p<p-.5&&(B*=p),B<=D?C(z):""}},o.nice=()=>h(w2(h(),{floor:l=>T(Math.floor(b(l))),ceil:l=>T(Math.ceil(b(l)))})),o}function A0(){const n=I0(Zm()).domain([1,10]);return n.copy=()=>Hf(n,A0()).base(n.base()),co.apply(n,arguments),n}function t1(n){return function(o){return Math.sign(o)*Math.log1p(Math.abs(o/n))}}function n1(n){return function(o){return Math.sign(o)*Math.expm1(Math.abs(o))*n}}function k0(n){var o=1,h=n(t1(o),n1(o));return h.constant=function(p){return arguments.length?n(t1(o=+p),n1(o)):o},Ou(h)}function T2(){var n=k0(Zm());return n.copy=function(){return Hf(n,T2()).constant(n.constant())},co.apply(n,arguments)}function r1(n){return function(o){return o<0?-Math.pow(-o,n):Math.pow(o,n)}}function Q3(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function ek(n){return n<0?-n*n:n*n}function D0(n){var o=n(Ii,Ii),h=1;function p(){return h===1?n(Ii,Ii):h===.5?n(Q3,ek):n(r1(h),r1(1/h))}return o.exponent=function(b){return arguments.length?(h=+b,p()):h},Ou(o)}function z0(){var n=D0(Zm());return n.copy=function(){return Hf(n,z0()).exponent(n.exponent())},co.apply(n,arguments),n}function tk(){return z0.apply(null,arguments).exponent(.5)}function S2(){var n=[],o=[],h=[],p;function b(){var v=0,l=Math.max(1,o.length);for(h=new Array(l-1);++v<l;)h[v-1]=HA(n,v/l);return T}function T(v){return v==null||isNaN(v=+v)?p:o[$f(h,v)]}return T.invertExtent=function(v){var l=o.indexOf(v);return l<0?[NaN,NaN]:[l>0?h[l-1]:n[0],l<h.length?h[l]:n[n.length-1]]},T.domain=function(v){if(!arguments.length)return n.slice();n=[];for(let l of v)l!=null&&!isNaN(l=+l)&&n.push(l);return n.sort(Ho),b()},T.range=function(v){return arguments.length?(o=Array.from(v),b()):o.slice()},T.unknown=function(v){return arguments.length?(p=v,T):p},T.quantiles=function(){return h.slice()},T.copy=function(){return S2().domain(n).range(o).unknown(p)},co.apply(T,arguments)}function M2(){var n=0,o=1,h=1,p=[.5],b=[0,1],T;function v(C){return C!=null&&C<=C?b[$f(p,C,0,h)]:T}function l(){var C=-1;for(p=new Array(h);++C<h;)p[C]=((C+1)*o-(C-h)*n)/(h+1);return v}return v.domain=function(C){return arguments.length?([n,o]=C,n=+n,o=+o,l()):[n,o]},v.range=function(C){return arguments.length?(h=(b=Array.from(C)).length-1,l()):b.slice()},v.invertExtent=function(C){var D=b.indexOf(C);return D<0?[NaN,NaN]:D<1?[n,p[0]]:D>=h?[p[h-1],o]:[p[D-1],p[D]]},v.unknown=function(C){return arguments.length&&(T=C),v},v.thresholds=function(){return p.slice()},v.copy=function(){return M2().domain([n,o]).range(b).unknown(T)},co.apply(Ou(v),arguments)}function P2(){var n=[.5],o=[0,1],h,p=1;function b(T){return T!=null&&T<=T?o[$f(n,T,0,p)]:h}return b.domain=function(T){return arguments.length?(n=Array.from(T),p=Math.min(n.length,o.length-1),b):n.slice()},b.range=function(T){return arguments.length?(o=Array.from(T),p=Math.min(n.length,o.length-1),b):o.slice()},b.invertExtent=function(T){var v=o.indexOf(T);return[n[v-1],n[v]]},b.unknown=function(T){return arguments.length?(h=T,b):h},b.copy=function(){return P2().domain(n).range(o).unknown(h)},co.apply(b,arguments)}const q_=new Date,G_=new Date;function Wr(n,o,h,p){function b(T){return n(T=arguments.length===0?new Date:new Date(+T)),T}return b.floor=T=>(n(T=new Date(+T)),T),b.ceil=T=>(n(T=new Date(T-1)),o(T,1),n(T),T),b.round=T=>{const v=b(T),l=b.ceil(T);return T-v<l-T?v:l},b.offset=(T,v)=>(o(T=new Date(+T),v==null?1:Math.floor(v)),T),b.range=(T,v,l)=>{const C=[];if(T=b.ceil(T),l=l==null?1:Math.floor(l),!(T<v)||!(l>0))return C;let D;do C.push(D=new Date(+T)),o(T,l),n(T);while(D<T&&T<v);return C},b.filter=T=>Wr(v=>{if(v>=v)for(;n(v),!T(v);)v.setTime(v-1)},(v,l)=>{if(v>=v)if(l<0)for(;++l<=0;)for(;o(v,-1),!T(v););else for(;--l>=0;)for(;o(v,1),!T(v););}),h&&(b.count=(T,v)=>(q_.setTime(+T),G_.setTime(+v),n(q_),n(G_),Math.floor(h(q_,G_))),b.every=T=>(T=Math.floor(T),!isFinite(T)||!(T>0)?null:T>1?b.filter(p?v=>p(v)%T===0:v=>b.count(0,v)%T===0):b)),b}const um=Wr(()=>{},(n,o)=>{n.setTime(+n+o)},(n,o)=>o-n);um.every=n=>(n=Math.floor(n),!isFinite(n)||!(n>0)?null:n>1?Wr(o=>{o.setTime(Math.floor(o/n)*n)},(o,h)=>{o.setTime(+o+h*n)},(o,h)=>(h-o)/n):um);um.range;const Zo=1e3,ma=Zo*60,Wo=ma*60,Yo=Wo*24,R0=Yo*7,i1=Yo*30,$_=Yo*365,Fs=Wr(n=>{n.setTime(n-n.getMilliseconds())},(n,o)=>{n.setTime(+n+o*Zo)},(n,o)=>(o-n)/Zo,n=>n.getUTCSeconds());Fs.range;const Wm=Wr(n=>{n.setTime(n-n.getMilliseconds()-n.getSeconds()*Zo)},(n,o)=>{n.setTime(+n+o*ma)},(n,o)=>(o-n)/ma,n=>n.getMinutes());Wm.range;const E2=Wr(n=>{n.setUTCSeconds(0,0)},(n,o)=>{n.setTime(+n+o*ma)},(n,o)=>(o-n)/ma,n=>n.getUTCMinutes());E2.range;const Hm=Wr(n=>{n.setTime(n-n.getMilliseconds()-n.getSeconds()*Zo-n.getMinutes()*ma)},(n,o)=>{n.setTime(+n+o*Wo)},(n,o)=>(o-n)/Wo,n=>n.getHours());Hm.range;const C2=Wr(n=>{n.setUTCMinutes(0,0,0)},(n,o)=>{n.setTime(+n+o*Wo)},(n,o)=>(o-n)/Wo,n=>n.getUTCHours());C2.range;const Nu=Wr(n=>n.setHours(0,0,0,0),(n,o)=>n.setDate(n.getDate()+o),(n,o)=>(o-n-(o.getTimezoneOffset()-n.getTimezoneOffset())*ma)/Yo,n=>n.getDate()-1);Nu.range;const L0=Wr(n=>{n.setUTCHours(0,0,0,0)},(n,o)=>{n.setUTCDate(n.getUTCDate()+o)},(n,o)=>(o-n)/Yo,n=>n.getUTCDate()-1);L0.range;const I2=Wr(n=>{n.setUTCHours(0,0,0,0)},(n,o)=>{n.setUTCDate(n.getUTCDate()+o)},(n,o)=>(o-n)/Yo,n=>Math.floor(n/Yo));I2.range;function ic(n){return Wr(o=>{o.setDate(o.getDate()-(o.getDay()+7-n)%7),o.setHours(0,0,0,0)},(o,h)=>{o.setDate(o.getDate()+h*7)},(o,h)=>(h-o-(h.getTimezoneOffset()-o.getTimezoneOffset())*ma)/R0)}const Iu=ic(0),Lf=ic(1),A2=ic(2),k2=ic(3),Ql=ic(4),D2=ic(5),z2=ic(6);Iu.range;Lf.range;A2.range;k2.range;Ql.range;D2.range;z2.range;function ac(n){return Wr(o=>{o.setUTCDate(o.getUTCDate()-(o.getUTCDay()+7-n)%7),o.setUTCHours(0,0,0,0)},(o,h)=>{o.setUTCDate(o.getUTCDate()+h*7)},(o,h)=>(h-o)/R0)}const hm=ac(0),Ff=ac(1),R2=ac(2),L2=ac(3),ec=ac(4),F2=ac(5),B2=ac(6);hm.range;Ff.range;R2.range;L2.range;ec.range;F2.range;B2.range;const Xm=Wr(n=>{n.setDate(1),n.setHours(0,0,0,0)},(n,o)=>{n.setMonth(n.getMonth()+o)},(n,o)=>o.getMonth()-n.getMonth()+(o.getFullYear()-n.getFullYear())*12,n=>n.getMonth());Xm.range;const O2=Wr(n=>{n.setUTCDate(1),n.setUTCHours(0,0,0,0)},(n,o)=>{n.setUTCMonth(n.getUTCMonth()+o)},(n,o)=>o.getUTCMonth()-n.getUTCMonth()+(o.getUTCFullYear()-n.getUTCFullYear())*12,n=>n.getUTCMonth());O2.range;const lo=Wr(n=>{n.setMonth(0,1),n.setHours(0,0,0,0)},(n,o)=>{n.setFullYear(n.getFullYear()+o)},(n,o)=>o.getFullYear()-n.getFullYear(),n=>n.getFullYear());lo.every=n=>!isFinite(n=Math.floor(n))||!(n>0)?null:Wr(o=>{o.setFullYear(Math.floor(o.getFullYear()/n)*n),o.setMonth(0,1),o.setHours(0,0,0,0)},(o,h)=>{o.setFullYear(o.getFullYear()+h*n)});lo.range;const Ns=Wr(n=>{n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},(n,o)=>{n.setUTCFullYear(n.getUTCFullYear()+o)},(n,o)=>o.getUTCFullYear()-n.getUTCFullYear(),n=>n.getUTCFullYear());Ns.every=n=>!isFinite(n=Math.floor(n))||!(n>0)?null:Wr(o=>{o.setUTCFullYear(Math.floor(o.getUTCFullYear()/n)*n),o.setUTCMonth(0,1),o.setUTCHours(0,0,0,0)},(o,h)=>{o.setUTCFullYear(o.getUTCFullYear()+h*n)});Ns.range;function nk(n,o,h,p,b,T){const v=[[Fs,1,Zo],[Fs,5,5*Zo],[Fs,15,15*Zo],[Fs,30,30*Zo],[T,1,ma],[T,5,5*ma],[T,15,15*ma],[T,30,30*ma],[b,1,Wo],[b,3,3*Wo],[b,6,6*Wo],[b,12,12*Wo],[p,1,Yo],[p,2,2*Yo],[h,1,R0],[o,1,i1],[o,3,3*i1],[n,1,$_]];function l(D,z,B){const V=z<D;V&&([D,z]=[z,D]);const G=B&&typeof B.range=="function"?B:C(D,z,B),Q=G?G.range(D,+z+1):[];return V?Q.reverse():Q}function C(D,z,B){const V=Math.abs(z-D)/B,G=b0(([,,U])=>U).right(v,V);if(G===v.length)return n.every(Ty(D/$_,z/$_,B));if(G===0)return um.every(Math.max(Ty(D,z,B),1));const[Q,ee]=v[V/v[G-1][2]<v[G][2]/V?G-1:G];return Q.every(ee)}return[l,C]}const[rk,ik]=nk(lo,Xm,Iu,Nu,Hm,Wm);function Z_(n){if(0<=n.y&&n.y<100){var o=new Date(-1,n.m,n.d,n.H,n.M,n.S,n.L);return o.setFullYear(n.y),o}return new Date(n.y,n.m,n.d,n.H,n.M,n.S,n.L)}function W_(n){if(0<=n.y&&n.y<100){var o=new Date(Date.UTC(-1,n.m,n.d,n.H,n.M,n.S,n.L));return o.setUTCFullYear(n.y),o}return new Date(Date.UTC(n.y,n.m,n.d,n.H,n.M,n.S,n.L))}function of(n,o,h){return{y:n,m:o,d:h,H:0,M:0,S:0,L:0}}function ak(n){var o=n.dateTime,h=n.date,p=n.time,b=n.periods,T=n.days,v=n.shortDays,l=n.months,C=n.shortMonths,D=sf(b),z=lf(b),B=sf(T),V=lf(T),G=sf(v),Q=lf(v),ee=sf(l),U=lf(l),se=sf(C),Me=lf(C),me={a:Qe,A:$e,b:at,B:zt,c:null,d:u1,e:u1,f:Ck,g:Ok,G:Vk,H:Mk,I:Pk,j:Ek,L:N2,m:Ik,M:Ak,p:rt,q:ct,Q:d1,s:p1,S:kk,u:Dk,U:zk,V:Rk,w:Lk,W:Fk,x:null,X:null,y:Bk,Y:Nk,Z:jk,"%":f1},K={a:xt,A:vt,b:Pt,B:pt,c:null,d:h1,e:h1,f:$k,g:t5,G:r5,H:Uk,I:qk,j:Gk,L:j2,m:Zk,M:Wk,p:Et,q:Kt,Q:d1,s:p1,S:Hk,u:Xk,U:Yk,V:Kk,w:Jk,W:Qk,x:null,X:null,y:e5,Y:n5,Z:i5,"%":f1},ce={a:Re,A:Ve,b:qe,B:Ye,c:et,d:l1,e:l1,f:bk,g:s1,G:o1,H:c1,I:c1,j:_k,L:xk,m:gk,M:yk,p:be,q:mk,Q:Tk,s:Sk,S:vk,u:uk,U:hk,V:fk,w:ck,W:dk,x:Ie,X:Je,y:s1,Y:o1,Z:pk,"%":wk};me.x=oe(h,me),me.X=oe(p,me),me.c=oe(o,me),K.x=oe(h,K),K.X=oe(p,K),K.c=oe(o,K);function oe(ot,_t){return function(Rt){var Ze=[],Pn=-1,Nt=0,Jt=ot.length,Ut,qt,cn;for(Rt instanceof Date||(Rt=new Date(+Rt));++Pn<Jt;)ot.charCodeAt(Pn)===37&&(Ze.push(ot.slice(Nt,Pn)),(qt=a1[Ut=ot.charAt(++Pn)])!=null?Ut=ot.charAt(++Pn):qt=Ut==="e"?" ":"0",(cn=_t[Ut])&&(Ut=cn(Rt,qt)),Ze.push(Ut),Nt=Pn+1);return Ze.push(ot.slice(Nt,Pn)),Ze.join("")}}function ue(ot,_t){return function(Rt){var Ze=of(1900,void 0,1),Pn=de(Ze,ot,Rt+="",0),Nt,Jt;if(Pn!=Rt.length)return null;if("Q"in Ze)return new Date(Ze.Q);if("s"in Ze)return new Date(Ze.s*1e3+("L"in Ze?Ze.L:0));if(_t&&!("Z"in Ze)&&(Ze.Z=0),"p"in Ze&&(Ze.H=Ze.H%12+Ze.p*12),Ze.m===void 0&&(Ze.m="q"in Ze?Ze.q:0),"V"in Ze){if(Ze.V<1||Ze.V>53)return null;"w"in Ze||(Ze.w=1),"Z"in Ze?(Nt=W_(of(Ze.y,0,1)),Jt=Nt.getUTCDay(),Nt=Jt>4||Jt===0?Ff.ceil(Nt):Ff(Nt),Nt=L0.offset(Nt,(Ze.V-1)*7),Ze.y=Nt.getUTCFullYear(),Ze.m=Nt.getUTCMonth(),Ze.d=Nt.getUTCDate()+(Ze.w+6)%7):(Nt=Z_(of(Ze.y,0,1)),Jt=Nt.getDay(),Nt=Jt>4||Jt===0?Lf.ceil(Nt):Lf(Nt),Nt=Nu.offset(Nt,(Ze.V-1)*7),Ze.y=Nt.getFullYear(),Ze.m=Nt.getMonth(),Ze.d=Nt.getDate()+(Ze.w+6)%7)}else("W"in Ze||"U"in Ze)&&("w"in Ze||(Ze.w="u"in Ze?Ze.u%7:"W"in Ze?1:0),Jt="Z"in Ze?W_(of(Ze.y,0,1)).getUTCDay():Z_(of(Ze.y,0,1)).getDay(),Ze.m=0,Ze.d="W"in Ze?(Ze.w+6)%7+Ze.W*7-(Jt+5)%7:Ze.w+Ze.U*7-(Jt+6)%7);return"Z"in Ze?(Ze.H+=Ze.Z/100|0,Ze.M+=Ze.Z%100,W_(Ze)):Z_(Ze)}}function de(ot,_t,Rt,Ze){for(var Pn=0,Nt=_t.length,Jt=Rt.length,Ut,qt;Pn<Nt;){if(Ze>=Jt)return-1;if(Ut=_t.charCodeAt(Pn++),Ut===37){if(Ut=_t.charAt(Pn++),qt=ce[Ut in a1?_t.charAt(Pn++):Ut],!qt||(Ze=qt(ot,Rt,Ze))<0)return-1}else if(Ut!=Rt.charCodeAt(Ze++))return-1}return Ze}function be(ot,_t,Rt){var Ze=D.exec(_t.slice(Rt));return Ze?(ot.p=z.get(Ze[0].toLowerCase()),Rt+Ze[0].length):-1}function Re(ot,_t,Rt){var Ze=G.exec(_t.slice(Rt));return Ze?(ot.w=Q.get(Ze[0].toLowerCase()),Rt+Ze[0].length):-1}function Ve(ot,_t,Rt){var Ze=B.exec(_t.slice(Rt));return Ze?(ot.w=V.get(Ze[0].toLowerCase()),Rt+Ze[0].length):-1}function qe(ot,_t,Rt){var Ze=se.exec(_t.slice(Rt));return Ze?(ot.m=Me.get(Ze[0].toLowerCase()),Rt+Ze[0].length):-1}function Ye(ot,_t,Rt){var Ze=ee.exec(_t.slice(Rt));return Ze?(ot.m=U.get(Ze[0].toLowerCase()),Rt+Ze[0].length):-1}function et(ot,_t,Rt){return de(ot,o,_t,Rt)}function Ie(ot,_t,Rt){return de(ot,h,_t,Rt)}function Je(ot,_t,Rt){return de(ot,p,_t,Rt)}function Qe(ot){return v[ot.getDay()]}function $e(ot){return T[ot.getDay()]}function at(ot){return C[ot.getMonth()]}function zt(ot){return l[ot.getMonth()]}function rt(ot){return b[+(ot.getHours()>=12)]}function ct(ot){return 1+~~(ot.getMonth()/3)}function xt(ot){return v[ot.getUTCDay()]}function vt(ot){return T[ot.getUTCDay()]}function Pt(ot){return C[ot.getUTCMonth()]}function pt(ot){return l[ot.getUTCMonth()]}function Et(ot){return b[+(ot.getUTCHours()>=12)]}function Kt(ot){return 1+~~(ot.getUTCMonth()/3)}return{format:function(ot){var _t=oe(ot+="",me);return _t.toString=function(){return ot},_t},parse:function(ot){var _t=ue(ot+="",!1);return _t.toString=function(){return ot},_t},utcFormat:function(ot){var _t=oe(ot+="",K);return _t.toString=function(){return ot},_t},utcParse:function(ot){var _t=ue(ot+="",!0);return _t.toString=function(){return ot},_t}}}var a1={"-":"",_:" ",0:"0"},ai=/^\s*\d+/,ok=/^%/,sk=/[\\^$*+?|[\]().{}]/g;function zn(n,o,h){var p=n<0?"-":"",b=(p?-n:n)+"",T=b.length;return p+(T<h?new Array(h-T+1).join(o)+b:b)}function lk(n){return n.replace(sk,"\\$&")}function sf(n){return new RegExp("^(?:"+n.map(lk).join("|")+")","i")}function lf(n){return new Map(n.map((o,h)=>[o.toLowerCase(),h]))}function ck(n,o,h){var p=ai.exec(o.slice(h,h+1));return p?(n.w=+p[0],h+p[0].length):-1}function uk(n,o,h){var p=ai.exec(o.slice(h,h+1));return p?(n.u=+p[0],h+p[0].length):-1}function hk(n,o,h){var p=ai.exec(o.slice(h,h+2));return p?(n.U=+p[0],h+p[0].length):-1}function fk(n,o,h){var p=ai.exec(o.slice(h,h+2));return p?(n.V=+p[0],h+p[0].length):-1}function dk(n,o,h){var p=ai.exec(o.slice(h,h+2));return p?(n.W=+p[0],h+p[0].length):-1}function o1(n,o,h){var p=ai.exec(o.slice(h,h+4));return p?(n.y=+p[0],h+p[0].length):-1}function s1(n,o,h){var p=ai.exec(o.slice(h,h+2));return p?(n.y=+p[0]+(+p[0]>68?1900:2e3),h+p[0].length):-1}function pk(n,o,h){var p=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(o.slice(h,h+6));return p?(n.Z=p[1]?0:-(p[2]+(p[3]||"00")),h+p[0].length):-1}function mk(n,o,h){var p=ai.exec(o.slice(h,h+1));return p?(n.q=p[0]*3-3,h+p[0].length):-1}function gk(n,o,h){var p=ai.exec(o.slice(h,h+2));return p?(n.m=p[0]-1,h+p[0].length):-1}function l1(n,o,h){var p=ai.exec(o.slice(h,h+2));return p?(n.d=+p[0],h+p[0].length):-1}function _k(n,o,h){var p=ai.exec(o.slice(h,h+3));return p?(n.m=0,n.d=+p[0],h+p[0].length):-1}function c1(n,o,h){var p=ai.exec(o.slice(h,h+2));return p?(n.H=+p[0],h+p[0].length):-1}function yk(n,o,h){var p=ai.exec(o.slice(h,h+2));return p?(n.M=+p[0],h+p[0].length):-1}function vk(n,o,h){var p=ai.exec(o.slice(h,h+2));return p?(n.S=+p[0],h+p[0].length):-1}function xk(n,o,h){var p=ai.exec(o.slice(h,h+3));return p?(n.L=+p[0],h+p[0].length):-1}function bk(n,o,h){var p=ai.exec(o.slice(h,h+6));return p?(n.L=Math.floor(p[0]/1e3),h+p[0].length):-1}function wk(n,o,h){var p=ok.exec(o.slice(h,h+1));return p?h+p[0].length:-1}function Tk(n,o,h){var p=ai.exec(o.slice(h));return p?(n.Q=+p[0],h+p[0].length):-1}function Sk(n,o,h){var p=ai.exec(o.slice(h));return p?(n.s=+p[0],h+p[0].length):-1}function u1(n,o){return zn(n.getDate(),o,2)}function Mk(n,o){return zn(n.getHours(),o,2)}function Pk(n,o){return zn(n.getHours()%12||12,o,2)}function Ek(n,o){return zn(1+Nu.count(lo(n),n),o,3)}function N2(n,o){return zn(n.getMilliseconds(),o,3)}function Ck(n,o){return N2(n,o)+"000"}function Ik(n,o){return zn(n.getMonth()+1,o,2)}function Ak(n,o){return zn(n.getMinutes(),o,2)}function kk(n,o){return zn(n.getSeconds(),o,2)}function Dk(n){var o=n.getDay();return o===0?7:o}function zk(n,o){return zn(Iu.count(lo(n)-1,n),o,2)}function V2(n){var o=n.getDay();return o>=4||o===0?Ql(n):Ql.ceil(n)}function Rk(n,o){return n=V2(n),zn(Ql.count(lo(n),n)+(lo(n).getDay()===4),o,2)}function Lk(n){return n.getDay()}function Fk(n,o){return zn(Lf.count(lo(n)-1,n),o,2)}function Bk(n,o){return zn(n.getFullYear()%100,o,2)}function Ok(n,o){return n=V2(n),zn(n.getFullYear()%100,o,2)}function Nk(n,o){return zn(n.getFullYear()%1e4,o,4)}function Vk(n,o){var h=n.getDay();return n=h>=4||h===0?Ql(n):Ql.ceil(n),zn(n.getFullYear()%1e4,o,4)}function jk(n){var o=n.getTimezoneOffset();return(o>0?"-":(o*=-1,"+"))+zn(o/60|0,"0",2)+zn(o%60,"0",2)}function h1(n,o){return zn(n.getUTCDate(),o,2)}function Uk(n,o){return zn(n.getUTCHours(),o,2)}function qk(n,o){return zn(n.getUTCHours()%12||12,o,2)}function Gk(n,o){return zn(1+L0.count(Ns(n),n),o,3)}function j2(n,o){return zn(n.getUTCMilliseconds(),o,3)}function $k(n,o){return j2(n,o)+"000"}function Zk(n,o){return zn(n.getUTCMonth()+1,o,2)}function Wk(n,o){return zn(n.getUTCMinutes(),o,2)}function Hk(n,o){return zn(n.getUTCSeconds(),o,2)}function Xk(n){var o=n.getUTCDay();return o===0?7:o}function Yk(n,o){return zn(hm.count(Ns(n)-1,n),o,2)}function U2(n){var o=n.getUTCDay();return o>=4||o===0?ec(n):ec.ceil(n)}function Kk(n,o){return n=U2(n),zn(ec.count(Ns(n),n)+(Ns(n).getUTCDay()===4),o,2)}function Jk(n){return n.getUTCDay()}function Qk(n,o){return zn(Ff.count(Ns(n)-1,n),o,2)}function e5(n,o){return zn(n.getUTCFullYear()%100,o,2)}function t5(n,o){return n=U2(n),zn(n.getUTCFullYear()%100,o,2)}function n5(n,o){return zn(n.getUTCFullYear()%1e4,o,4)}function r5(n,o){var h=n.getUTCDay();return n=h>=4||h===0?ec(n):ec.ceil(n),zn(n.getUTCFullYear()%1e4,o,4)}function i5(){return"+0000"}function f1(){return"%"}function d1(n){return+n}function p1(n){return Math.floor(+n/1e3)}var mu,q2;a5({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function a5(n){return mu=ak(n),q2=mu.format,mu.parse,mu.utcFormat,mu.utcParse,mu}function o5(n){return new Date(n)}function s5(n){return n instanceof Date?+n:+new Date(+n)}function G2(n,o,h,p,b,T,v,l,C,D){var z=x2(),B=z.invert,V=z.domain,G=D(".%L"),Q=D(":%S"),ee=D("%I:%M"),U=D("%I %p"),se=D("%a %d"),Me=D("%b %d"),me=D("%B"),K=D("%Y");function ce(oe){return(C(oe)<oe?G:l(oe)<oe?Q:v(oe)<oe?ee:T(oe)<oe?U:p(oe)<oe?b(oe)<oe?se:Me:h(oe)<oe?me:K)(oe)}return z.invert=function(oe){return new Date(B(oe))},z.domain=function(oe){return arguments.length?V(Array.from(oe,s5)):V().map(o5)},z.ticks=function(oe){var ue=V();return n(ue[0],ue[ue.length-1],oe??10)},z.tickFormat=function(oe,ue){return ue==null?ce:D(ue)},z.nice=function(oe){var ue=V();return(!oe||typeof oe.range!="function")&&(oe=o(ue[0],ue[ue.length-1],oe??10)),oe?V(w2(ue,oe)):z},z.copy=function(){return Hf(z,G2(n,o,h,p,b,T,v,l,C,D))},z}function l5(){return co.apply(G2(rk,ik,lo,Xm,Iu,Nu,Hm,Wm,Fs,q2).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Ym(){var n=0,o=1,h,p,b,T,v=Ii,l=!1,C;function D(B){return B==null||isNaN(B=+B)?C:v(b===0?.5:(B=(T(B)-h)*b,l?Math.max(0,Math.min(1,B)):B))}D.domain=function(B){return arguments.length?([n,o]=B,h=T(n=+n),p=T(o=+o),b=h===p?0:1/(p-h),D):[n,o]},D.clamp=function(B){return arguments.length?(l=!!B,D):l},D.interpolator=function(B){return arguments.length?(v=B,D):v};function z(B){return function(V){var G,Q;return arguments.length?([G,Q]=V,v=B(G,Q),D):[v(0),v(1)]}}return D.range=z(Bu),D.rangeRound=z($m),D.unknown=function(B){return arguments.length?(C=B,D):C},function(B){return T=B,h=B(n),p=B(o),b=h===p?0:1/(p-h),D}}function Gs(n,o){return o.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function F0(){var n=Ou(Ym()(Ii));return n.copy=function(){return Gs(n,F0())},Qo.apply(n,arguments)}function $2(){var n=I0(Ym()).domain([1,10]);return n.copy=function(){return Gs(n,$2()).base(n.base())},Qo.apply(n,arguments)}function Z2(){var n=k0(Ym());return n.copy=function(){return Gs(n,Z2()).constant(n.constant())},Qo.apply(n,arguments)}function B0(){var n=D0(Ym());return n.copy=function(){return Gs(n,B0()).exponent(n.exponent())},Qo.apply(n,arguments)}function c5(){return B0.apply(null,arguments).exponent(.5)}function W2(){var n=[],o=Ii;function h(p){if(p!=null&&!isNaN(p=+p))return o(($f(n,p,1)-1)/(n.length-1))}return h.domain=function(p){if(!arguments.length)return n.slice();n=[];for(let b of p)b!=null&&!isNaN(b=+b)&&n.push(b);return n.sort(Ho),h},h.interpolator=function(p){return arguments.length?(o=p,h):o},h.range=function(){return n.map((p,b)=>o(b/(n.length-1)))},h.quantiles=function(p){return Array.from({length:p+1},(b,T)=>w0(n,T/p))},h.copy=function(){return W2(o).domain(n)},Qo.apply(h,arguments)}function Km(){var n=0,o=.5,h=1,p=1,b,T,v,l,C,D=Ii,z,B=!1,V;function G(ee){return isNaN(ee=+ee)?V:(ee=.5+((ee=+z(ee))-T)*(p*ee<p*T?l:C),D(B?Math.max(0,Math.min(1,ee)):ee))}G.domain=function(ee){return arguments.length?([n,o,h]=ee,b=z(n=+n),T=z(o=+o),v=z(h=+h),l=b===T?0:.5/(T-b),C=T===v?0:.5/(v-T),p=T<b?-1:1,G):[n,o,h]},G.clamp=function(ee){return arguments.length?(B=!!ee,G):B},G.interpolator=function(ee){return arguments.length?(D=ee,G):D};function Q(ee){return function(U){var se,Me,me;return arguments.length?([se,Me,me]=U,D=A3(ee,[se,Me,me]),G):[D(0),D(.5),D(1)]}}return G.range=Q(Bu),G.rangeRound=Q($m),G.unknown=function(ee){return arguments.length?(V=ee,G):V},function(ee){return z=ee,b=ee(n),T=ee(o),v=ee(h),l=b===T?0:.5/(T-b),C=T===v?0:.5/(v-T),p=T<b?-1:1,G}}function O0(){var n=Ou(Km()(Ii));return n.copy=function(){return Gs(n,O0())},Qo.apply(n,arguments)}function H2(){var n=I0(Km()).domain([.1,1,10]);return n.copy=function(){return Gs(n,H2()).base(n.base())},Qo.apply(n,arguments)}function X2(){var n=k0(Km());return n.copy=function(){return Gs(n,X2()).constant(n.constant())},Qo.apply(n,arguments)}function N0(){var n=D0(Km());return n.copy=function(){return Gs(n,N0()).exponent(n.exponent())},Qo.apply(n,arguments)}function u5(){return N0.apply(null,arguments).exponent(.5)}const H_={x:Symbol("origName_x"),x1:Symbol("origName_x1"),x2:Symbol("origName_x2"),y:Symbol("origName_y"),y1:Symbol("origName_y1"),y2:Symbol("origName_y2"),fill:Symbol("origName_color"),stroke:Symbol("origName_color"),opacity:Symbol("origName_opacity"),symbol:Symbol("origName_symbol"),r:Symbol("origName_r"),z:Symbol("origName_z"),sort:Symbol("origName_sort"),filter:Symbol("origName_filter"),interval:Symbol("origName_interval"),length:Symbol("origName_length"),fx:Symbol("origName_fx"),fy:Symbol("origName_fy"),fillOpacity:Symbol("origName_opacity"),strokeOpacity:Symbol("origName_opacity")},h5=["x","y","color","opacity","symbol","r","length","fx","fy","projection"],X_={color:new Set(["linear","categorical","ordinal","diverging","quantile","quantize","quantile-cont","threshold","log","symlog","pow","sqrt","diverging-log","diverging-pow","diverging-sqrt","diverging-symlog"]),x:new Set(["linear","log","symlog","time","ordinal","band","point","quantile","quantize","threshold"]),y:new Set(["linear","log","symlog","time","ordinal","band","point","quantile","quantize","threshold"]),symbol:new Set(["categorical","ordinal"]),opacity:new Set(["linear","log","symlog","sqrt","pow"]),r:new Set(["linear","log","symlog","sqrt","pow"]),length:new Set(["linear","log","symlog","sqrt","pow"]),fx:new Set(["band"]),fy:new Set(["band"]),projection:new Set},Ui={x:"x",x1:"x",x2:"x",y:"y",y1:"y",y2:"y",r:"r",length:"length",fx:"fx",fy:"fy",symbol:"symbol",fill:"color",stroke:"color",opacity:"opacity",fillOpacity:"opacity",strokeOpacity:"opacity"},Y2=/^var\(--([a-z-0-9,\s]+)\)$/,f5=/^color\(/,d5=/^color-mix\(/,p5=/^color-contrast\(/,m5=/^rgba\(/,K2=/^url\(#/,Ai=Symbol("index");function Vs(n){if(typeof n!="object"||n===null||Object.prototype.toString.call(n)!=="[object Object]")return!1;const o=Object.getPrototypeOf(n);if(o===null)return!0;const h=Object.prototype.hasOwnProperty.call(o,"constructor")&&o.constructor;return typeof h=="function"&&h instanceof h&&Function.prototype.call(h)===Function.prototype.call(n)}function Qa(n){return function(){return n}}const J2=Math.cos,V0=Math.min,fm=Math.sin,Hr=Math.sqrt,m1=1e-12,dm=Math.PI,Jm=2*dm,Cy=Math.PI,Iy=2*Cy,ql=1e-6,g5=Iy-ql;function Q2(n){this._+=n[0];for(let o=1,h=n.length;o<h;++o)this._+=arguments[o]+n[o]}function _5(n){let o=Math.floor(n);if(!(o>=0))throw new Error(`invalid digits: ${n}`);if(o>15)return Q2;const h=10**o;return function(p){this._+=p[0];for(let b=1,T=p.length;b<T;++b)this._+=Math.round(arguments[b]*h)/h+p[b]}}class y5{constructor(o){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=o==null?Q2:_5(o)}moveTo(o,h){this._append`M${this._x0=this._x1=+o},${this._y0=this._y1=+h}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(o,h){this._append`L${this._x1=+o},${this._y1=+h}`}quadraticCurveTo(o,h,p,b){this._append`Q${+o},${+h},${this._x1=+p},${this._y1=+b}`}bezierCurveTo(o,h,p,b,T,v){this._append`C${+o},${+h},${+p},${+b},${this._x1=+T},${this._y1=+v}`}arcTo(o,h,p,b,T){if(o=+o,h=+h,p=+p,b=+b,T=+T,T<0)throw new Error(`negative radius: ${T}`);let v=this._x1,l=this._y1,C=p-o,D=b-h,z=v-o,B=l-h,V=z*z+B*B;if(this._x1===null)this._append`M${this._x1=o},${this._y1=h}`;else if(V>ql)if(!(Math.abs(B*C-D*z)>ql)||!T)this._append`L${this._x1=o},${this._y1=h}`;else{let G=p-v,Q=b-l,ee=C*C+D*D,U=G*G+Q*Q,se=Math.sqrt(ee),Me=Math.sqrt(V),me=T*Math.tan((Cy-Math.acos((ee+V-U)/(2*se*Me)))/2),K=me/Me,ce=me/se;Math.abs(K-1)>ql&&this._append`L${o+K*z},${h+K*B}`,this._append`A${T},${T},0,0,${+(B*G>z*Q)},${this._x1=o+ce*C},${this._y1=h+ce*D}`}}arc(o,h,p,b,T,v){if(o=+o,h=+h,p=+p,v=!!v,p<0)throw new Error(`negative radius: ${p}`);let l=p*Math.cos(b),C=p*Math.sin(b),D=o+l,z=h+C,B=1^v,V=v?b-T:T-b;this._x1===null?this._append`M${D},${z}`:(Math.abs(this._x1-D)>ql||Math.abs(this._y1-z)>ql)&&this._append`L${D},${z}`,p&&(V<0&&(V=V%Iy+Iy),V>g5?this._append`A${p},${p},0,1,${B},${o-l},${h-C}A${p},${p},0,1,${B},${this._x1=D},${this._y1=z}`:V>ql&&this._append`A${p},${p},0,${+(V>=Cy)},${B},${this._x1=o+p*Math.cos(T)},${this._y1=h+p*Math.sin(T)}`)}rect(o,h,p,b){this._append`M${this._x0=this._x1=+o},${this._y0=this._y1=+h}h${p=+p}v${+b}h${-p}Z`}toString(){return this._}}function eT(n){let o=3;return n.digits=function(h){if(!arguments.length)return o;if(h==null)o=null;else{const p=Math.floor(h);if(!(p>=0))throw new RangeError(`invalid digits: ${h}`);o=p}return n},()=>new y5(o)}function v5(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function tT(n){this._context=n}tT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,o){switch(n=+n,o=+o,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,o):this._context.moveTo(n,o);break;case 1:this._point=2;default:this._context.lineTo(n,o);break}}};function j0(n){return new tT(n)}function x5(n){return n[0]}function b5(n){return n[1]}function w5(n,o){var h=Qa(!0),p=null,b=j0,T=null,v=eT(l);n=typeof n=="function"?n:n===void 0?x5:Qa(n),o=typeof o=="function"?o:o===void 0?b5:Qa(o);function l(C){var D,z=(C=v5(C)).length,B,V=!1,G;for(p==null&&(T=b(G=v())),D=0;D<=z;++D)!(D<z&&h(B=C[D],D,C))===V&&((V=!V)?T.lineStart():T.lineEnd()),V&&T.point(+n(B,D,C),+o(B,D,C));if(G)return T=null,G+""||null}return l.x=function(C){return arguments.length?(n=typeof C=="function"?C:Qa(+C),l):n},l.y=function(C){return arguments.length?(o=typeof C=="function"?C:Qa(+C),l):o},l.defined=function(C){return arguments.length?(h=typeof C=="function"?C:Qa(!!C),l):h},l.curve=function(C){return arguments.length?(b=C,p!=null&&(T=b(p)),l):b},l.context=function(C){return arguments.length?(C==null?p=T=null:T=b(p=C),l):p},l}class nT{constructor(o,h){this._context=o,this._x=h}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(o,h){switch(o=+o,h=+h,this._point){case 0:{this._point=1,this._line?this._context.lineTo(o,h):this._context.moveTo(o,h);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+o)/2,this._y0,this._x0,h,o,h):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+h)/2,o,this._y0,o,h);break}}this._x0=o,this._y0=h}}function T5(n){return new nT(n,!0)}function S5(n){return new nT(n,!1)}const M5=Hr(3),P5={draw(n,o){const h=Hr(o+V0(o/28,.75))*.59436,p=h/2,b=p*M5;n.moveTo(0,h),n.lineTo(0,-h),n.moveTo(-b,-p),n.lineTo(b,p),n.moveTo(-b,p),n.lineTo(b,-p)}},rT={draw(n,o){const h=Hr(o/dm);n.moveTo(h,0),n.arc(0,0,h,0,Jm)}},E5={draw(n,o){const h=Hr(o/5)/2;n.moveTo(-3*h,-h),n.lineTo(-h,-h),n.lineTo(-h,-3*h),n.lineTo(h,-3*h),n.lineTo(h,-h),n.lineTo(3*h,-h),n.lineTo(3*h,h),n.lineTo(h,h),n.lineTo(h,3*h),n.lineTo(-h,3*h),n.lineTo(-h,h),n.lineTo(-3*h,h),n.closePath()}},iT=Hr(1/3),C5=iT*2,I5={draw(n,o){const h=Hr(o/C5),p=h*iT;n.moveTo(0,-h),n.lineTo(p,0),n.lineTo(0,h),n.lineTo(-p,0),n.closePath()}},A5={draw(n,o){const h=Hr(o)*.62625;n.moveTo(0,-h),n.lineTo(h,0),n.lineTo(0,h),n.lineTo(-h,0),n.closePath()}},k5={draw(n,o){const h=Hr(o-V0(o/7,2))*.87559;n.moveTo(-h,0),n.lineTo(h,0),n.moveTo(0,h),n.lineTo(0,-h)}},D5={draw(n,o){const h=Hr(o),p=-h/2;n.rect(p,p,h,h)}},z5={draw(n,o){const h=Hr(o)*.4431;n.moveTo(h,h),n.lineTo(h,-h),n.lineTo(-h,-h),n.lineTo(-h,h),n.closePath()}},R5=.8908130915292852,aT=fm(dm/10)/fm(7*dm/10),L5=fm(Jm/10)*aT,F5=-J2(Jm/10)*aT,B5={draw(n,o){const h=Hr(o*R5),p=L5*h,b=F5*h;n.moveTo(0,-h),n.lineTo(p,b);for(let T=1;T<5;++T){const v=Jm*T/5,l=J2(v),C=fm(v);n.lineTo(C*h,-l*h),n.lineTo(l*p-C*b,C*p+l*b)}n.closePath()}},Y_=Hr(3),O5={draw(n,o){const h=-Hr(o/(Y_*3));n.moveTo(0,h*2),n.lineTo(-Y_*h,-h),n.lineTo(Y_*h,-h),n.closePath()}},N5=Hr(3),V5={draw(n,o){const h=Hr(o)*.6824,p=h/2,b=h*N5/2;n.moveTo(0,-h),n.lineTo(b,p),n.lineTo(-b,p),n.closePath()}},ha=-.5,fa=Hr(3)/2,Ay=1/Hr(12),j5=(Ay/2+1)*3,U5={draw(n,o){const h=Hr(o/j5),p=h/2,b=h*Ay,T=p,v=h*Ay+h,l=-T,C=v;n.moveTo(p,b),n.lineTo(T,v),n.lineTo(l,C),n.lineTo(ha*p-fa*b,fa*p+ha*b),n.lineTo(ha*T-fa*v,fa*T+ha*v),n.lineTo(ha*l-fa*C,fa*l+ha*C),n.lineTo(ha*p+fa*b,ha*b-fa*p),n.lineTo(ha*T+fa*v,ha*v-fa*T),n.lineTo(ha*l+fa*C,ha*C-fa*l),n.closePath()}},q5={draw(n,o){const h=Hr(o-V0(o/6,1.7))*.6189;n.moveTo(-h,-h),n.lineTo(h,h),n.moveTo(-h,h),n.lineTo(h,-h)}};function oT(n,o){let h=null,p=eT(b);n=typeof n=="function"?n:Qa(n||rT),o=typeof o=="function"?o:Qa(o===void 0?64:+o);function b(){let T;if(h||(h=T=p()),n.apply(this,arguments).draw(h,+o.apply(this,arguments)),T)return h=null,T+""||null}return b.type=function(T){return arguments.length?(n=typeof T=="function"?T:Qa(T),b):n},b.size=function(T){return arguments.length?(o=typeof T=="function"?T:Qa(+T),b):o},b.context=function(T){return arguments.length?(h=T??null,b):h},b}function js(){}function pm(n,o,h){n._context.bezierCurveTo((2*n._x0+n._x1)/3,(2*n._y0+n._y1)/3,(n._x0+2*n._x1)/3,(n._y0+2*n._y1)/3,(n._x0+4*n._x1+o)/6,(n._y0+4*n._y1+h)/6)}function Qm(n){this._context=n}Qm.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:pm(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,o){switch(n=+n,o=+o,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,o):this._context.moveTo(n,o);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:pm(this,n,o);break}this._x0=this._x1,this._x1=n,this._y0=this._y1,this._y1=o}};function G5(n){return new Qm(n)}function sT(n){this._context=n}sT.prototype={areaStart:js,areaEnd:js,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(n,o){switch(n=+n,o=+o,this._point){case 0:this._point=1,this._x2=n,this._y2=o;break;case 1:this._point=2,this._x3=n,this._y3=o;break;case 2:this._point=3,this._x4=n,this._y4=o,this._context.moveTo((this._x0+4*this._x1+n)/6,(this._y0+4*this._y1+o)/6);break;default:pm(this,n,o);break}this._x0=this._x1,this._x1=n,this._y0=this._y1,this._y1=o}};function $5(n){return new sT(n)}function lT(n){this._context=n}lT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(n,o){switch(n=+n,o=+o,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var h=(this._x0+4*this._x1+n)/6,p=(this._y0+4*this._y1+o)/6;this._line?this._context.lineTo(h,p):this._context.moveTo(h,p);break;case 3:this._point=4;default:pm(this,n,o);break}this._x0=this._x1,this._x1=n,this._y0=this._y1,this._y1=o}};function Z5(n){return new lT(n)}function cT(n,o){this._basis=new Qm(n),this._beta=o}cT.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var n=this._x,o=this._y,h=n.length-1;if(h>0)for(var p=n[0],b=o[0],T=n[h]-p,v=o[h]-b,l=-1,C;++l<=h;)C=l/h,this._basis.point(this._beta*n[l]+(1-this._beta)*(p+C*T),this._beta*o[l]+(1-this._beta)*(b+C*v));this._x=this._y=null,this._basis.lineEnd()},point:function(n,o){this._x.push(+n),this._y.push(+o)}};const W5=(function n(o){function h(p){return o===1?new Qm(p):new cT(p,o)}return h.beta=function(p){return n(+p)},h})(.85);function mm(n,o,h){n._context.bezierCurveTo(n._x1+n._k*(n._x2-n._x0),n._y1+n._k*(n._y2-n._y0),n._x2+n._k*(n._x1-o),n._y2+n._k*(n._y1-h),n._x2,n._y2)}function U0(n,o){this._context=n,this._k=(1-o)/6}U0.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:mm(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,o){switch(n=+n,o=+o,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,o):this._context.moveTo(n,o);break;case 1:this._point=2,this._x1=n,this._y1=o;break;case 2:this._point=3;default:mm(this,n,o);break}this._x0=this._x1,this._x1=this._x2,this._x2=n,this._y0=this._y1,this._y1=this._y2,this._y2=o}};const H5=(function n(o){function h(p){return new U0(p,o)}return h.tension=function(p){return n(+p)},h})(0);function q0(n,o){this._context=n,this._k=(1-o)/6}q0.prototype={areaStart:js,areaEnd:js,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(n,o){switch(n=+n,o=+o,this._point){case 0:this._point=1,this._x3=n,this._y3=o;break;case 1:this._point=2,this._context.moveTo(this._x4=n,this._y4=o);break;case 2:this._point=3,this._x5=n,this._y5=o;break;default:mm(this,n,o);break}this._x0=this._x1,this._x1=this._x2,this._x2=n,this._y0=this._y1,this._y1=this._y2,this._y2=o}};const X5=(function n(o){function h(p){return new q0(p,o)}return h.tension=function(p){return n(+p)},h})(0);function G0(n,o){this._context=n,this._k=(1-o)/6}G0.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(n,o){switch(n=+n,o=+o,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:mm(this,n,o);break}this._x0=this._x1,this._x1=this._x2,this._x2=n,this._y0=this._y1,this._y1=this._y2,this._y2=o}};const Y5=(function n(o){function h(p){return new G0(p,o)}return h.tension=function(p){return n(+p)},h})(0);function $0(n,o,h){var p=n._x1,b=n._y1,T=n._x2,v=n._y2;if(n._l01_a>m1){var l=2*n._l01_2a+3*n._l01_a*n._l12_a+n._l12_2a,C=3*n._l01_a*(n._l01_a+n._l12_a);p=(p*l-n._x0*n._l12_2a+n._x2*n._l01_2a)/C,b=(b*l-n._y0*n._l12_2a+n._y2*n._l01_2a)/C}if(n._l23_a>m1){var D=2*n._l23_2a+3*n._l23_a*n._l12_a+n._l12_2a,z=3*n._l23_a*(n._l23_a+n._l12_a);T=(T*D+n._x1*n._l23_2a-o*n._l12_2a)/z,v=(v*D+n._y1*n._l23_2a-h*n._l12_2a)/z}n._context.bezierCurveTo(p,b,T,v,n._x2,n._y2)}function uT(n,o){this._context=n,this._alpha=o}uT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,o){if(n=+n,o=+o,this._point){var h=this._x2-n,p=this._y2-o;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(h*h+p*p,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(n,o):this._context.moveTo(n,o);break;case 1:this._point=2;break;case 2:this._point=3;default:$0(this,n,o);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=n,this._y0=this._y1,this._y1=this._y2,this._y2=o}};const K5=(function n(o){function h(p){return o?new uT(p,o):new U0(p,0)}return h.alpha=function(p){return n(+p)},h})(.5);function hT(n,o){this._context=n,this._alpha=o}hT.prototype={areaStart:js,areaEnd:js,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(n,o){if(n=+n,o=+o,this._point){var h=this._x2-n,p=this._y2-o;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(h*h+p*p,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=n,this._y3=o;break;case 1:this._point=2,this._context.moveTo(this._x4=n,this._y4=o);break;case 2:this._point=3,this._x5=n,this._y5=o;break;default:$0(this,n,o);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=n,this._y0=this._y1,this._y1=this._y2,this._y2=o}};const J5=(function n(o){function h(p){return o?new hT(p,o):new q0(p,0)}return h.alpha=function(p){return n(+p)},h})(.5);function fT(n,o){this._context=n,this._alpha=o}fT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(n,o){if(n=+n,o=+o,this._point){var h=this._x2-n,p=this._y2-o;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(h*h+p*p,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:$0(this,n,o);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=n,this._y0=this._y1,this._y1=this._y2,this._y2=o}};const Q5=(function n(o){function h(p){return o?new fT(p,o):new G0(p,0)}return h.alpha=function(p){return n(+p)},h})(.5);function dT(n){this._context=n}dT.prototype={areaStart:js,areaEnd:js,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(n,o){n=+n,o=+o,this._point?this._context.lineTo(n,o):(this._point=1,this._context.moveTo(n,o))}};function eD(n){return new dT(n)}function g1(n){return n<0?-1:1}function _1(n,o,h){var p=n._x1-n._x0,b=o-n._x1,T=(n._y1-n._y0)/(p||b<0&&-0),v=(h-n._y1)/(b||p<0&&-0),l=(T*b+v*p)/(p+b);return(g1(T)+g1(v))*Math.min(Math.abs(T),Math.abs(v),.5*Math.abs(l))||0}function y1(n,o){var h=n._x1-n._x0;return h?(3*(n._y1-n._y0)/h-o)/2:o}function K_(n,o,h){var p=n._x0,b=n._y0,T=n._x1,v=n._y1,l=(T-p)/3;n._context.bezierCurveTo(p+l,b+l*o,T-l,v-l*h,T,v)}function gm(n){this._context=n}gm.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:K_(this,this._t0,y1(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,o){var h=NaN;if(n=+n,o=+o,!(n===this._x1&&o===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(n,o):this._context.moveTo(n,o);break;case 1:this._point=2;break;case 2:this._point=3,K_(this,y1(this,h=_1(this,n,o)),h);break;default:K_(this,this._t0,h=_1(this,n,o));break}this._x0=this._x1,this._x1=n,this._y0=this._y1,this._y1=o,this._t0=h}}};function pT(n){this._context=new mT(n)}(pT.prototype=Object.create(gm.prototype)).point=function(n,o){gm.prototype.point.call(this,o,n)};function mT(n){this._context=n}mT.prototype={moveTo:function(n,o){this._context.moveTo(o,n)},closePath:function(){this._context.closePath()},lineTo:function(n,o){this._context.lineTo(o,n)},bezierCurveTo:function(n,o,h,p,b,T){this._context.bezierCurveTo(o,n,p,h,T,b)}};function tD(n){return new gm(n)}function nD(n){return new pT(n)}function gT(n){this._context=n}gT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var n=this._x,o=this._y,h=n.length;if(h)if(this._line?this._context.lineTo(n[0],o[0]):this._context.moveTo(n[0],o[0]),h===2)this._context.lineTo(n[1],o[1]);else for(var p=v1(n),b=v1(o),T=0,v=1;v<h;++T,++v)this._context.bezierCurveTo(p[0][T],b[0][T],p[1][T],b[1][T],n[v],o[v]);(this._line||this._line!==0&&h===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(n,o){this._x.push(+n),this._y.push(+o)}};function v1(n){var o,h=n.length-1,p,b=new Array(h),T=new Array(h),v=new Array(h);for(b[0]=0,T[0]=2,v[0]=n[0]+2*n[1],o=1;o<h-1;++o)b[o]=1,T[o]=4,v[o]=4*n[o]+2*n[o+1];for(b[h-1]=2,T[h-1]=7,v[h-1]=8*n[h-1]+n[h],o=1;o<h;++o)p=b[o]/T[o-1],T[o]-=p,v[o]-=p*v[o-1];for(b[h-1]=v[h-1]/T[h-1],o=h-2;o>=0;--o)b[o]=(v[o]-b[o+1])/T[o];for(T[h-1]=(n[h]+b[h-1])/2,o=0;o<h-1;++o)T[o]=2*n[o+1]-b[o+1];return[b,T]}function rD(n){return new gT(n)}function eg(n,o){this._context=n,this._t=o}eg.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(n,o){switch(n=+n,o=+o,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,o):this._context.moveTo(n,o);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,o),this._context.lineTo(n,o);else{var h=this._x*(1-this._t)+n*this._t;this._context.lineTo(h,this._y),this._context.lineTo(h,o)}break}}this._x=n,this._y=o}};function iD(n){return new eg(n,.5)}function aD(n){return new eg(n,0)}function oD(n){return new eg(n,1)}const sD=Math.sqrt(3),lD=2/sD,cD={draw(n,o){const h=Math.sqrt(o/Math.PI),p=h*lD,b=p/2;n.moveTo(0,p),n.lineTo(h,b),n.lineTo(h,-b),n.lineTo(0,-p),n.lineTo(-h,-b),n.lineTo(-h,b),n.closePath()}},_T=new Map([["asterisk",P5],["circle",rT],["cross",E5],["diamond",I5],["diamond2",A5],["hexagon",cD],["plus",k5],["square",D5],["square2",z5],["star",B5],["times",q5],["triangle",O5],["triangle2",V5],["wye",U5]]);function yT(n){return typeof n=="string"?!1:n&&typeof n.draw=="function"}function uD(n){return yT(n)?!0:typeof n!="string"?!1:_T.has(n.toLowerCase())}function vT(n){if(n==null||yT(n))return n;const o=_T.get(`${n}`.toLowerCase());if(o)return o;throw new Error(`invalid symbol: ${n}`)}function Xf(n){return n instanceof Date&&!isNaN(n.getTime())}function x1(n){return n==null||Xf(n)}function hD(n){return n==null||Number.isFinite(n)||typeof n=="string"&&!Number.isNaN(+n)}function fD(n){return n==null||Number.isFinite(n)||Number.isNaN(n)||typeof n=="string"&&!Number.isNaN(+n)}function b1(n){return n==null||typeof n=="string"}function dD(n){return n==null||(typeof n=="string"||typeof n=="object")&&uD(n)}function pD(n){return n==null?!0:typeof n=="string"?(n=`${n}`.toLowerCase(),n==="currentcolor"||Y2.test(n)||f5.test(n)||d5.test(n)||p5.test(n)||m5.test(n)||K2.test(n)||Eu(n)!==null):!1}function ky(n){const o=typeof n;return o==="string"||o==="number"||o==="boolean"||o==="object"||Xf(n)||o===null}function J_(...n){for(const o of n)if(o!=null)return o;return null}function tc(n,o){return o.filter==null||gn(o.filter,n)}function Z0(){return Math.ceil(1e9+Math.random()*1e9).toString(36)}function mD(n){return typeof n=="function"&&n.length===1}function ia(n){return n!=null&&!Number.isNaN(n)&&(typeof n!="number"||Number.isFinite(n))}function Dy(n){return typeof n=="object"&&!Xf(n)&&!Array.isArray(n)&&n!==null}const gD=/^[+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i;function wf(n){return typeof n=="number"&&Number.isFinite(n)?n:typeof n=="string"&&gD.test(n.trim())?parseFloat(n):null}const W0=n=>()=>n,_D={strokeWidth:"stroke-width",strokeDasharray:"stroke-dasharray",strokeLinejoin:"stroke-linejoin",strokeLinecap:"stroke-linecap",blend:"mix-blend-mode",clipPath:"clip-path",mask:"mask",fontFamily:"font-family",fontSize:"font-size",fontStyle:"font-style",fontWeight:"font-weight",textAnchor:"text-anchor",fontVariant:"font-variant",letterSpacing:"letter-spacing",textDecoration:"text-decoration",textTransform:"text-transform",wordSpacing:"word-spacing",cursor:"cursor",pointerEvents:"pointer-events"},yD={fontWeight:"normal"};function xT(n,o){return Object.fromEntries(Object.entries(_D).filter(([h,p])=>p&&o[h]!=null).map(([h,p])=>[p,vD(p,gn(o[h],n,yD[h]||null)??"")]))}function vD(n,o){return(n==="font-size"||n==="stroke-width")&&typeof o=="number"?`${o}px`:o}const w1=Symbol("x"),T1=Symbol("y"),Or=Symbol("originalValue");function xD(n){return n.map((o,h)=>({...o,[Ai]:h}))}function S1({data:n,...o},{withIndex:h}={withIndex:!0}){if(!n)return{data:n,...o};if(!Vs(n[0])&&!Array.isArray(n[0])&&o.y==null){const{y:b,y1:T,y2:v,...l}=o;return{data:Array.from(n).map((C,D)=>({[Ai]:D,[Or]:C})),...l,...h?{x:Ai}:{},y:Or}}return{data:xD(n),...o}}function bD({data:n,...o}){return n?!Vs(n[0])&&Array.isArray(n[0])&&o.x===void 0&&o.y===void 0?{data:n.map(([h,p,...b],T)=>({[Or]:[h,p,...b],[Ai]:T,[w1]:h,[T1]:p})),...o,x:w1,y:T1}:{data:n,...o}:{data:n,...o}}function gn(n,o,h=null){if(typeof n=="function"){const p=n;return o==null?p():p(o.hasOwnProperty(Or)?o[Or]:o,o[Ai])}else{const p=n;if((typeof p=="string"||typeof p=="symbol")&&o&&o[p]!==void 0)return o[n]}return ky(n)?n:h}function bT(n,o){const h=Ui[n]==="x"||Ui[n]==="y",p=Ui[n]==="opacity";return Vs(o)?o:{value:o,scale:!h&&!p&&typeof o=="number"||typeof o>"u"?null:Ui[n],channel:null}}function ki(n,o,h){const p=Ui[n],b=n==="z"?h.z||h.fill||h.stroke:h[n],T=bT(n,b);return T.channel?ki(T.channel,o,h):wD(o,T.value,n,p)}function wD(n,o,h,p){return Vs(n)?typeof o=="function"?o(n[Or]!=null?n[Or]:n,n?.[Ai]):(typeof o=="string"||typeof o=="symbol")&&n[o]!==void 0?n[o]:o===null&&n[h]!==void 0?n[h]:ky(o)?o:null:Array.isArray(n)&&(typeof o=="string"||typeof o=="number")&&n[o]!=null?n[o]:typeof o=="function"?o(n,n?.[Ai]):o!==null&&ky(o)?o:!Array.isArray(n)&&(p==="x"||p==="y")?n:null}const wT={fill:"fill",stroke:"stroke",fillOpacity:"fill-opacity",strokeOpacity:"stroke-opacity",opacity:"opacity"},zy={fill:"stroke",stroke:"fill"};function TT(n,o,h,p,b=null){return{...xT(n,o),fill:"none",stroke:"none",...b&&o[zy[b]]==null?{[b]:"currentColor"}:{},...Object.fromEntries(Object.entries(wT).filter(([T])=>o[T]!=null).map(([T,v])=>[T,v,ki(T,n,o)]).filter(([T,,v])=>ia(v)||T==="fill"||T==="stroke").map(([T,v,l])=>h[T]?l==null&&(T==="fill"||T==="stroke")&&p.options.color.unknown?[v,p.options.color.unknown]:[v,p.scales[Ui[T]].fn(l)]:[v,l]))}}function ST(n,o,h,p,b=null){return`${Ry(TT(n,o,h,p,b))};${o.style||""}`}function Ry(n){return`${Object.entries(n).map(([o,h])=>`${o}: ${h}`).join(";")}`}function ao(n,o,h,p=null,b,T=!1){const v={...xT(o?.datum,h),fill:"none",stroke:"none",...p&&(h[zy[p]]==null||h[zy[p]]==="none")?{[p]:"currentColor"}:{},...Object.fromEntries(Object.entries(wT).filter(([l])=>h[l]!=null).map(([l,C])=>[l,C,T?ki(l,o?.datum,h):o?.[l]]).filter(([l,,C])=>ia(C)||l==="fill"||l==="stroke").map(([l,C,D])=>{if(b[l]){if(D==null&&(l==="fill"||l==="stroke")&&n.options.color.unknown)return[C,n.options.color.unknown]}else if((l==="fill"||l==="stroke")&&D===!0)return[C,"currentColor"];return[C,D]}))};return n.css?[null,n.css(`${Ry(v)};${h.style??""}`)]:[`${Ry(v)};${h.style??""}`,null]}function TD(n,o){dn(o,!0),Mu("svelteplot/facet",{getTestFacet(){return(b,T)=>(T.fx==null||ki("fx",b,T)===o.fx)&&(T.fy==null||ki("fy",b,T)===o.fy)},getFacetState(){return{fx:o.fx,fy:o.fy,left:o.left,top:o.top,right:o.right,bottom:o.bottom,topEmpty:o.topEmpty,bottomEmpty:o.bottomEmpty,leftEmpty:o.leftEmpty,rightEmpty:o.rightEmpty}}});var h=Yt(),p=kt(h);Dn(p,()=>o.children??Qn),Ue(n,h),pn()}function SD(n,o,h){const b=n.filter(v=>v.options.__firstFacet&&v.data.length>0&&!v.options.automatic&&(o.length===1||v.options.fx!=null)&&(h.length===1||v.options.fy!=null)).map(v=>v.data.map(l=>{const C=ki("fx",l,v.options),D=ki("fy",l,v.options);return{fx:C,fy:D}})).flat(1),T=new Map;for(const v of o){T.set(v,new Map);for(const l of h){let C=o.length===1||h.length===1;for(const D of b)if(D.fx===v&&D.fy===l){C=!0;break}T.get(v)?.set(l,!C)}}return T}class MD{#e=hn(50);get width(){return P(this.#e)}set width(o){Vt(this.#e,o,!0)}#t=hn(50);get height(){return P(this.#t)}set height(o){Vt(this.#t,o,!0)}#n=hn(jm({}));get options(){return P(this.#n)}set options(o){Vt(this.#n,o,!0)}#r=hn(0);get facetWidth(){return P(this.#r)}set facetWidth(o){Vt(this.#r,o,!0)}#i=hn(0);get facetHeight(){return P(this.#i)}set facetHeight(o){Vt(this.#i,o,!0)}#a=hn(0);get plotWidth(){return P(this.#a)}set plotWidth(o){Vt(this.#a,o,!0)}#o=hn(0);get plotHeight(){return P(this.#o)}set plotHeight(o){Vt(this.#o,o,!0)}#s=hn();get scales(){return P(this.#s)}set scales(o){Vt(this.#s,o,!0)}#l=hn();get body(){return P(this.#l)}set body(o){Vt(this.#l,o,!0)}#c=hn(!1);get colorSymbolRedundant(){return P(this.#c)}set colorSymbolRedundant(o){Vt(this.#c,o,!0)}#u=hn(!1);get hasFilledDotMarks(){return P(this.#u)}set hasFilledDotMarks(o){Vt(this.#u,o,!0)}#h=hn(null);get css(){return P(this.#h)}set css(o){Vt(this.#h,o,!0)}constructor(o){Object.assign(this,o)}update(o){Object.assign(this,o)}get publicState(){return new PD(this)}}class PD{#e;constructor(o){this.#e=o}get width(){return this.#e.width}get height(){return this.#e.height}get options(){return this.#e.options}get scales(){return this.#e.scales}get plotWidth(){return this.#e.plotWidth}get plotHeight(){return this.#e.plotHeight}get facetWidth(){return this.#e.facetWidth}get facetHeight(){return this.#e.facetHeight}get body(){return this.#e.body}get colorSymbolRedundant(){return this.#e.colorSymbolRedundant}get hasFilledDotMarks(){return this.#e.hasFilledDotMarks}get css(){return this.#e.css}}function ED(n){return new MD({...n})}function Zi(){const{getPlotState:n}=xi("svelteplot");return n().publicState}var CD=nn('<g class="facet" fill="currentColor"><rect fill="transparent" pointer-events="all"></rect><!></g>');function ID(n,o){dn(o,!0);const{updateDimensions:h}=xi("svelteplot"),p=Zi(),b=le(()=>p.scales.fx.domain.length>0),T=le(()=>p.scales.fy.domain.length>0),v=le(()=>P(b)?p.scales.fx.domain:[!0]),l=le(()=>P(T)?p.scales.fy.domain:[!0]),C=le(()=>SD(o.marks,P(v),P(l))),D=le(()=>Kl().paddingOuter(0).paddingInner(P(v).length>1?p.options.fx?.paddingInner??p.options.fx?.padding??.1:0).domain(P(v)).rangeRound([0,p.plotWidth])),z=le(()=>Kl().paddingOuter(0).paddingInner(P(l).length>1?p.options.fy?.paddingInner??p.options.fy?.padding??.1:0).domain(P(l)).rangeRound([0,p.plotHeight])),B=le(()=>P(b)?P(D).bandwidth():p.plotWidth),V=le(()=>P(T)?P(z).bandwidth():p.plotHeight);eI(()=>{h(P(B),P(V))});var G=Yt(),Q=kt(G);ii(Q,17,()=>P(v),ya,(ee,U,se)=>{var Me=Yt(),me=kt(Me);ii(me,17,()=>P(l),ya,(K,ce,oe)=>{var ue=CD();Ct(ue,"data-facet-x",se),Ct(ue,"data-facet-y",oe);let de;var be=At(ue),Re=$t(be);{let Ve=le(()=>se===P(v).length-1),qe=le(()=>oe===P(l).length-1),Ye=le(()=>!!(se===0||P(C).get(P(v)[se-1])?.get(P(ce)))),et=le(()=>!!(oe===0||P(C).get(P(U))?.get(P(l)[oe-1]))),Ie=le(()=>!!(se===P(v).length-1||P(C).get(P(v)[se+1])?.get(P(ce)))),Je=le(()=>!!(oe===P(l).length-1||P(C).get(P(U))?.get(P(l)[oe+1])));TD(Re,{get fx(){return P(U)},get fy(){return P(ce)},left:se===0,get right(){return P(Ve)},top:oe===0,get bottom(){return P(qe)},get leftEmpty(){return P(Ye)},get topEmpty(){return P(et)},get rightEmpty(){return P(Ie)},get bottomEmpty(){return P(Je)},children:(Qe,$e)=>{var at=Yt(),zt=kt(at);Dn(zt,()=>o.children),Ue(Qe,at)},$$slots:{default:!0}})}Tt(ue),Zt((Ve,qe,Ye)=>{Ct(ue,"data-facet",se*P(l).length+oe),Ct(ue,"transform",`translate(${Ve??""}, ${qe??""})`),de=Zr(ue,"",de,Ye),Ct(be,"x",p.options.marginLeft),Ct(be,"y",p.options.marginTop),Ct(be,"width",P(B)),Ct(be,"height",P(V))},[()=>P(b)?P(D)(P(U)):0,()=>P(T)?P(z)(P(ce)):0,()=>({display:P(C).get(P(U))?.get(P(ce))?"none":"block"})]),Ue(K,ue)}),Ue(ee,Me)}),Ue(n,G),pn()}function Q_(n){return n&&typeof n=="object"&&!Array.isArray(n)}function Ly(n,...o){if(!o.length)return n;const h=o.shift();if(Q_(n)&&Q_(h))for(const p in h)Q_(h[p])?(n[p]?n[p]=Object.assign({},n[p]):Object.assign(n,{[p]:{}}),Ly(n[p],h[p])):h[p]!==null&&Object.assign(n,{[p]:h[p]});return Ly(n,...o)}var mn=1e-6,MT=1e-12,Sn=Math.PI,Mr=Sn/2,M1=Sn/4,aa=Sn*2,Ei=180/Sn,Sr=Sn/180,Gn=Math.abs,Vu=Math.atan,Ko=Math.atan2,bn=Math.cos,PT=Math.exp,_m=Math.log,ey=Math.pow,fn=Math.sin,ga=Math.sign||function(n){return n>0?1:n<0?-1:0},$i=Math.sqrt,H0=Math.tan;function ET(n){return n>1?0:n<-1?Sn:Math.acos(n)}function va(n){return n>1?Mr:n<-1?-Mr:Math.asin(n)}function _a(){}function ym(n,o){n&&E1.hasOwnProperty(n.type)&&E1[n.type](n,o)}var P1={Feature:function(n,o){ym(n.geometry,o)},FeatureCollection:function(n,o){for(var h=n.features,p=-1,b=h.length;++p<b;)ym(h[p].geometry,o)}},E1={Sphere:function(n,o){o.sphere()},Point:function(n,o){n=n.coordinates,o.point(n[0],n[1],n[2])},MultiPoint:function(n,o){for(var h=n.coordinates,p=-1,b=h.length;++p<b;)n=h[p],o.point(n[0],n[1],n[2])},LineString:function(n,o){Fy(n.coordinates,o,0)},MultiLineString:function(n,o){for(var h=n.coordinates,p=-1,b=h.length;++p<b;)Fy(h[p],o,0)},Polygon:function(n,o){C1(n.coordinates,o)},MultiPolygon:function(n,o){for(var h=n.coordinates,p=-1,b=h.length;++p<b;)C1(h[p],o)},GeometryCollection:function(n,o){for(var h=n.geometries,p=-1,b=h.length;++p<b;)ym(h[p],o)}};function Fy(n,o,h){var p=-1,b=n.length-h,T;for(o.lineStart();++p<b;)T=n[p],o.point(T[0],T[1],T[2]);o.lineEnd()}function C1(n,o){var h=-1,p=n.length;for(o.polygonStart();++h<p;)Fy(n[h],o,1);o.polygonEnd()}function _u(n,o){n&&P1.hasOwnProperty(n.type)?P1[n.type](n,o):ym(n,o)}function By(n){return[Ko(n[1],n[0]),va(n[2])]}function Au(n){var o=n[0],h=n[1],p=bn(h);return[p*bn(o),p*fn(o),fn(h)]}function Lp(n,o){return n[0]*o[0]+n[1]*o[1]+n[2]*o[2]}function vm(n,o){return[n[1]*o[2]-n[2]*o[1],n[2]*o[0]-n[0]*o[2],n[0]*o[1]-n[1]*o[0]]}function ty(n,o){n[0]+=o[0],n[1]+=o[1],n[2]+=o[2]}function Fp(n,o){return[n[0]*o,n[1]*o,n[2]*o]}function Oy(n){var o=$i(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=o,n[1]/=o,n[2]/=o}function Ny(n,o){function h(p,b){return p=n(p,b),o(p[0],p[1])}return n.invert&&o.invert&&(h.invert=function(p,b){return p=o.invert(p,b),p&&n.invert(p[0],p[1])}),h}function Vy(n,o){return Gn(n)>Sn&&(n-=Math.round(n/aa)*aa),[n,o]}Vy.invert=Vy;function CT(n,o,h){return(n%=aa)?o||h?Ny(A1(n),k1(o,h)):A1(n):o||h?k1(o,h):Vy}function I1(n){return function(o,h){return o+=n,Gn(o)>Sn&&(o-=Math.round(o/aa)*aa),[o,h]}}function A1(n){var o=I1(n);return o.invert=I1(-n),o}function k1(n,o){var h=bn(n),p=fn(n),b=bn(o),T=fn(o);function v(l,C){var D=bn(C),z=bn(l)*D,B=fn(l)*D,V=fn(C),G=V*h+z*p;return[Ko(B*b-G*T,z*h-V*p),va(G*b+B*T)]}return v.invert=function(l,C){var D=bn(C),z=bn(l)*D,B=fn(l)*D,V=fn(C),G=V*b-B*T;return[Ko(B*b+V*T,z*h+G*p),va(G*h-z*p)]},v}function AD(n){n=CT(n[0]*Sr,n[1]*Sr,n.length>2?n[2]*Sr:0);function o(h){return h=n(h[0]*Sr,h[1]*Sr),h[0]*=Ei,h[1]*=Ei,h}return o.invert=function(h){return h=n.invert(h[0]*Sr,h[1]*Sr),h[0]*=Ei,h[1]*=Ei,h},o}function kD(n,o,h,p,b,T){if(h){var v=bn(o),l=fn(o),C=p*h;b==null?(b=o+p*aa,T=o-C/2):(b=D1(v,b),T=D1(v,T),(p>0?b<T:b>T)&&(b+=p*aa));for(var D,z=b;p>0?z>T:z<T;z-=C)D=By([v,-l*bn(z),-l*fn(z)]),n.point(D[0],D[1])}}function D1(n,o){o=Au(o),o[0]-=n,Oy(o);var h=ET(-o[1]);return((-o[2]<0?-h:h)+aa-mn)%aa}function IT(){var n=[],o;return{point:function(h,p,b){o.push([h,p,b])},lineStart:function(){n.push(o=[])},lineEnd:_a,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var h=n;return n=[],o=null,h}}}function Xp(n,o){return Gn(n[0]-o[0])<mn&&Gn(n[1]-o[1])<mn}function Bp(n,o,h,p){this.x=n,this.z=o,this.o=h,this.e=p,this.v=!1,this.n=this.p=null}function AT(n,o,h,p,b){var T=[],v=[],l,C;if(n.forEach(function(Q){if(!((ee=Q.length-1)<=0)){var ee,U=Q[0],se=Q[ee],Me;if(Xp(U,se)){if(!U[2]&&!se[2]){for(b.lineStart(),l=0;l<ee;++l)b.point((U=Q[l])[0],U[1]);b.lineEnd();return}se[0]+=2*mn}T.push(Me=new Bp(U,Q,null,!0)),v.push(Me.o=new Bp(U,null,Me,!1)),T.push(Me=new Bp(se,Q,null,!1)),v.push(Me.o=new Bp(se,null,Me,!0))}}),!!T.length){for(v.sort(o),z1(T),z1(v),l=0,C=v.length;l<C;++l)v[l].e=h=!h;for(var D=T[0],z,B;;){for(var V=D,G=!0;V.v;)if((V=V.n)===D)return;z=V.z,b.lineStart();do{if(V.v=V.o.v=!0,V.e){if(G)for(l=0,C=z.length;l<C;++l)b.point((B=z[l])[0],B[1]);else p(V.x,V.n.x,1,b);V=V.n}else{if(G)for(z=V.p.z,l=z.length-1;l>=0;--l)b.point((B=z[l])[0],B[1]);else p(V.x,V.p.x,-1,b);V=V.p}V=V.o,z=V.z,G=!G}while(!V.v);b.lineEnd()}}}function z1(n){if(o=n.length){for(var o,h=0,p=n[0],b;++h<o;)p.n=b=n[h],b.p=p,p=b;p.n=b=n[0],b.p=p}}function ny(n){return Gn(n[0])<=Sn?n[0]:ga(n[0])*((Gn(n[0])+Sn)%aa-Sn)}function DD(n,o){var h=ny(o),p=o[1],b=fn(p),T=[fn(h),-bn(h),0],v=0,l=0,C=new Yl;b===1?p=Mr+mn:b===-1&&(p=-Mr-mn);for(var D=0,z=n.length;D<z;++D)if(V=(B=n[D]).length)for(var B,V,G=B[V-1],Q=ny(G),ee=G[1]/2+M1,U=fn(ee),se=bn(ee),Me=0;Me<V;++Me,Q=K,U=oe,se=ue,G=me){var me=B[Me],K=ny(me),ce=me[1]/2+M1,oe=fn(ce),ue=bn(ce),de=K-Q,be=de>=0?1:-1,Re=be*de,Ve=Re>Sn,qe=U*oe;if(C.add(Ko(qe*be*fn(Re),se*ue+qe*bn(Re))),v+=Ve?de+be*aa:de,Ve^Q>=h^K>=h){var Ye=vm(Au(G),Au(me));Oy(Ye);var et=vm(T,Ye);Oy(et);var Ie=(Ve^de>=0?-1:1)*va(et[2]);(p>Ie||p===Ie&&(Ye[0]||Ye[1]))&&(l+=Ve^de>=0?1:-1)}}return(v<-mn||v<mn&&C<-MT)^l&1}function kT(n,o,h,p){return function(b){var T=o(b),v=IT(),l=o(v),C=!1,D,z,B,V={point:G,lineStart:ee,lineEnd:U,polygonStart:function(){V.point=se,V.lineStart=Me,V.lineEnd=me,z=[],D=[]},polygonEnd:function(){V.point=G,V.lineStart=ee,V.lineEnd=U,z=i2(z);var K=DD(D,p);z.length?(C||(b.polygonStart(),C=!0),AT(z,RD,K,h,b)):K&&(C||(b.polygonStart(),C=!0),b.lineStart(),h(null,null,1,b),b.lineEnd()),C&&(b.polygonEnd(),C=!1),z=D=null},sphere:function(){b.polygonStart(),b.lineStart(),h(null,null,1,b),b.lineEnd(),b.polygonEnd()}};function G(K,ce){n(K,ce)&&b.point(K,ce)}function Q(K,ce){T.point(K,ce)}function ee(){V.point=Q,T.lineStart()}function U(){V.point=G,T.lineEnd()}function se(K,ce){B.push([K,ce]),l.point(K,ce)}function Me(){l.lineStart(),B=[]}function me(){se(B[0][0],B[0][1]),l.lineEnd();var K=l.clean(),ce=v.result(),oe,ue=ce.length,de,be,Re;if(B.pop(),D.push(B),B=null,!!ue){if(K&1){if(be=ce[0],(de=be.length-1)>0){for(C||(b.polygonStart(),C=!0),b.lineStart(),oe=0;oe<de;++oe)b.point((Re=be[oe])[0],Re[1]);b.lineEnd()}return}ue>1&&K&2&&ce.push(ce.pop().concat(ce.shift())),z.push(ce.filter(zD))}}return V}}function zD(n){return n.length>1}function RD(n,o){return((n=n.x)[0]<0?n[1]-Mr-mn:Mr-n[1])-((o=o.x)[0]<0?o[1]-Mr-mn:Mr-o[1])}const R1=kT(function(){return!0},LD,BD,[-Sn,-Mr]);function LD(n){var o=NaN,h=NaN,p=NaN,b;return{lineStart:function(){n.lineStart(),b=1},point:function(T,v){var l=T>0?Sn:-Sn,C=Gn(T-o);Gn(C-Sn)<mn?(n.point(o,h=(h+v)/2>0?Mr:-Mr),n.point(p,h),n.lineEnd(),n.lineStart(),n.point(l,h),n.point(T,h),b=0):p!==l&&C>=Sn&&(Gn(o-p)<mn&&(o-=p*mn),Gn(T-l)<mn&&(T-=l*mn),h=FD(o,h,T,v),n.point(p,h),n.lineEnd(),n.lineStart(),n.point(l,h),b=0),n.point(o=T,h=v),p=l},lineEnd:function(){n.lineEnd(),o=h=NaN},clean:function(){return 2-b}}}function FD(n,o,h,p){var b,T,v=fn(n-h);return Gn(v)>mn?Vu((fn(o)*(T=bn(p))*fn(h)-fn(p)*(b=bn(o))*fn(n))/(b*T*v)):(o+p)/2}function BD(n,o,h,p){var b;if(n==null)b=h*Mr,p.point(-Sn,b),p.point(0,b),p.point(Sn,b),p.point(Sn,0),p.point(Sn,-b),p.point(0,-b),p.point(-Sn,-b),p.point(-Sn,0),p.point(-Sn,b);else if(Gn(n[0]-o[0])>mn){var T=n[0]<o[0]?Sn:-Sn;b=h*T/2,p.point(-T,b),p.point(0,b),p.point(T,b)}else p.point(o[0],o[1])}function OD(n){var o=bn(n),h=2*Sr,p=o>0,b=Gn(o)>mn;function T(z,B,V,G){kD(G,n,h,V,z,B)}function v(z,B){return bn(z)*bn(B)>o}function l(z){var B,V,G,Q,ee;return{lineStart:function(){Q=G=!1,ee=1},point:function(U,se){var Me=[U,se],me,K=v(U,se),ce=p?K?0:D(U,se):K?D(U+(U<0?Sn:-Sn),se):0;if(!B&&(Q=G=K)&&z.lineStart(),K!==G&&(me=C(B,Me),(!me||Xp(B,me)||Xp(Me,me))&&(Me[2]=1)),K!==G)ee=0,K?(z.lineStart(),me=C(Me,B),z.point(me[0],me[1])):(me=C(B,Me),z.point(me[0],me[1],2),z.lineEnd()),B=me;else if(b&&B&&p^K){var oe;!(ce&V)&&(oe=C(Me,B,!0))&&(ee=0,p?(z.lineStart(),z.point(oe[0][0],oe[0][1]),z.point(oe[1][0],oe[1][1]),z.lineEnd()):(z.point(oe[1][0],oe[1][1]),z.lineEnd(),z.lineStart(),z.point(oe[0][0],oe[0][1],3)))}K&&(!B||!Xp(B,Me))&&z.point(Me[0],Me[1]),B=Me,G=K,V=ce},lineEnd:function(){G&&z.lineEnd(),B=null},clean:function(){return ee|(Q&&G)<<1}}}function C(z,B,V){var G=Au(z),Q=Au(B),ee=[1,0,0],U=vm(G,Q),se=Lp(U,U),Me=U[0],me=se-Me*Me;if(!me)return!V&&z;var K=o*se/me,ce=-o*Me/me,oe=vm(ee,U),ue=Fp(ee,K),de=Fp(U,ce);ty(ue,de);var be=oe,Re=Lp(ue,be),Ve=Lp(be,be),qe=Re*Re-Ve*(Lp(ue,ue)-1);if(!(qe<0)){var Ye=$i(qe),et=Fp(be,(-Re-Ye)/Ve);if(ty(et,ue),et=By(et),!V)return et;var Ie=z[0],Je=B[0],Qe=z[1],$e=B[1],at;Je<Ie&&(at=Ie,Ie=Je,Je=at);var zt=Je-Ie,rt=Gn(zt-Sn)<mn,ct=rt||zt<mn;if(!rt&&$e<Qe&&(at=Qe,Qe=$e,$e=at),ct?rt?Qe+$e>0^et[1]<(Gn(et[0]-Ie)<mn?Qe:$e):Qe<=et[1]&&et[1]<=$e:zt>Sn^(Ie<=et[0]&&et[0]<=Je)){var xt=Fp(be,(-Re+Ye)/Ve);return ty(xt,ue),[et,By(xt)]}}}function D(z,B){var V=p?n:Sn-n,G=0;return z<-V?G|=1:z>V&&(G|=2),B<-V?G|=4:B>V&&(G|=8),G}return kT(v,l,T,p?[0,-n]:[-Sn,n-Sn])}function ND(n,o,h,p,b,T){var v=n[0],l=n[1],C=o[0],D=o[1],z=0,B=1,V=C-v,G=D-l,Q;if(Q=h-v,!(!V&&Q>0)){if(Q/=V,V<0){if(Q<z)return;Q<B&&(B=Q)}else if(V>0){if(Q>B)return;Q>z&&(z=Q)}if(Q=b-v,!(!V&&Q<0)){if(Q/=V,V<0){if(Q>B)return;Q>z&&(z=Q)}else if(V>0){if(Q<z)return;Q<B&&(B=Q)}if(Q=p-l,!(!G&&Q>0)){if(Q/=G,G<0){if(Q<z)return;Q<B&&(B=Q)}else if(G>0){if(Q>B)return;Q>z&&(z=Q)}if(Q=T-l,!(!G&&Q<0)){if(Q/=G,G<0){if(Q>B)return;Q>z&&(z=Q)}else if(G>0){if(Q<z)return;Q<B&&(B=Q)}return z>0&&(n[0]=v+z*V,n[1]=l+z*G),B<1&&(o[0]=v+B*V,o[1]=l+B*G),!0}}}}}var ff=1e9,Op=-ff;function DT(n,o,h,p){function b(D,z){return n<=D&&D<=h&&o<=z&&z<=p}function T(D,z,B,V){var G=0,Q=0;if(D==null||(G=v(D,B))!==(Q=v(z,B))||C(D,z)<0^B>0)do V.point(G===0||G===3?n:h,G>1?p:o);while((G=(G+B+4)%4)!==Q);else V.point(z[0],z[1])}function v(D,z){return Gn(D[0]-n)<mn?z>0?0:3:Gn(D[0]-h)<mn?z>0?2:1:Gn(D[1]-o)<mn?z>0?1:0:z>0?3:2}function l(D,z){return C(D.x,z.x)}function C(D,z){var B=v(D,1),V=v(z,1);return B!==V?B-V:B===0?z[1]-D[1]:B===1?D[0]-z[0]:B===2?D[1]-z[1]:z[0]-D[0]}return function(D){var z=D,B=IT(),V,G,Q,ee,U,se,Me,me,K,ce,oe,ue={point:de,lineStart:qe,lineEnd:Ye,polygonStart:Re,polygonEnd:Ve};function de(Ie,Je){b(Ie,Je)&&z.point(Ie,Je)}function be(){for(var Ie=0,Je=0,Qe=G.length;Je<Qe;++Je)for(var $e=G[Je],at=1,zt=$e.length,rt=$e[0],ct,xt,vt=rt[0],Pt=rt[1];at<zt;++at)ct=vt,xt=Pt,rt=$e[at],vt=rt[0],Pt=rt[1],xt<=p?Pt>p&&(vt-ct)*(p-xt)>(Pt-xt)*(n-ct)&&++Ie:Pt<=p&&(vt-ct)*(p-xt)<(Pt-xt)*(n-ct)&&--Ie;return Ie}function Re(){z=B,V=[],G=[],oe=!0}function Ve(){var Ie=be(),Je=oe&&Ie,Qe=(V=i2(V)).length;(Je||Qe)&&(D.polygonStart(),Je&&(D.lineStart(),T(null,null,1,D),D.lineEnd()),Qe&&AT(V,l,Ie,T,D),D.polygonEnd()),z=D,V=G=Q=null}function qe(){ue.point=et,G&&G.push(Q=[]),ce=!0,K=!1,Me=me=NaN}function Ye(){V&&(et(ee,U),se&&K&&B.rejoin(),V.push(B.result())),ue.point=de,K&&z.lineEnd()}function et(Ie,Je){var Qe=b(Ie,Je);if(G&&Q.push([Ie,Je]),ce)ee=Ie,U=Je,se=Qe,ce=!1,Qe&&(z.lineStart(),z.point(Ie,Je));else if(Qe&&K)z.point(Ie,Je);else{var $e=[Me=Math.max(Op,Math.min(ff,Me)),me=Math.max(Op,Math.min(ff,me))],at=[Ie=Math.max(Op,Math.min(ff,Ie)),Je=Math.max(Op,Math.min(ff,Je))];ND($e,at,n,o,h,p)?(K||(z.lineStart(),z.point($e[0],$e[1])),z.point(at[0],at[1]),Qe||z.lineEnd(),oe=!1):Qe&&(z.lineStart(),z.point(Ie,Je),oe=!1)}Me=Ie,me=Je,K=Qe}return ue}}const jy=n=>n;var ry=new Yl,Uy=new Yl,zT,RT,qy,Gy,Uo={point:_a,lineStart:_a,lineEnd:_a,polygonStart:function(){Uo.lineStart=VD,Uo.lineEnd=UD},polygonEnd:function(){Uo.lineStart=Uo.lineEnd=Uo.point=_a,ry.add(Gn(Uy)),Uy=new Yl},result:function(){var n=ry/2;return ry=new Yl,n}};function VD(){Uo.point=jD}function jD(n,o){Uo.point=LT,zT=qy=n,RT=Gy=o}function LT(n,o){Uy.add(Gy*n-qy*o),qy=n,Gy=o}function UD(){LT(zT,RT)}var ku=1/0,xm=ku,Bf=-ku,bm=Bf,wm={point:qD,lineStart:_a,lineEnd:_a,polygonStart:_a,polygonEnd:_a,result:function(){var n=[[ku,xm],[Bf,bm]];return Bf=bm=-(xm=ku=1/0),n}};function qD(n,o){n<ku&&(ku=n),n>Bf&&(Bf=n),o<xm&&(xm=o),o>bm&&(bm=o)}var $y=0,Zy=0,df=0,Tm=0,Sm=0,vu=0,Wy=0,Hy=0,pf=0,FT,BT,eo,to,da={point:nc,lineStart:L1,lineEnd:F1,polygonStart:function(){da.lineStart=ZD,da.lineEnd=WD},polygonEnd:function(){da.point=nc,da.lineStart=L1,da.lineEnd=F1},result:function(){var n=pf?[Wy/pf,Hy/pf]:vu?[Tm/vu,Sm/vu]:df?[$y/df,Zy/df]:[NaN,NaN];return $y=Zy=df=Tm=Sm=vu=Wy=Hy=pf=0,n}};function nc(n,o){$y+=n,Zy+=o,++df}function L1(){da.point=GD}function GD(n,o){da.point=$D,nc(eo=n,to=o)}function $D(n,o){var h=n-eo,p=o-to,b=$i(h*h+p*p);Tm+=b*(eo+n)/2,Sm+=b*(to+o)/2,vu+=b,nc(eo=n,to=o)}function F1(){da.point=nc}function ZD(){da.point=HD}function WD(){OT(FT,BT)}function HD(n,o){da.point=OT,nc(FT=eo=n,BT=to=o)}function OT(n,o){var h=n-eo,p=o-to,b=$i(h*h+p*p);Tm+=b*(eo+n)/2,Sm+=b*(to+o)/2,vu+=b,b=to*n-eo*o,Wy+=b*(eo+n),Hy+=b*(to+o),pf+=b*3,nc(eo=n,to=o)}function NT(n){this._context=n}NT.prototype={_radius:4.5,pointRadius:function(n){return this._radius=n,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(n,o){switch(this._point){case 0:{this._context.moveTo(n,o),this._point=1;break}case 1:{this._context.lineTo(n,o);break}default:{this._context.moveTo(n+this._radius,o),this._context.arc(n,o,this._radius,0,aa);break}}},result:_a};var Xy=new Yl,iy,VT,jT,mf,gf,Of={point:_a,lineStart:function(){Of.point=XD},lineEnd:function(){iy&&UT(VT,jT),Of.point=_a},polygonStart:function(){iy=!0},polygonEnd:function(){iy=null},result:function(){var n=+Xy;return Xy=new Yl,n}};function XD(n,o){Of.point=UT,VT=mf=n,jT=gf=o}function UT(n,o){mf-=n,gf-=o,Xy.add($i(mf*mf+gf*gf)),mf=n,gf=o}let B1,Mm,O1,N1;class V1{constructor(o){this._append=o==null?qT:YD(o),this._radius=4.5,this._=""}pointRadius(o){return this._radius=+o,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(o,h){switch(this._point){case 0:{this._append`M${o},${h}`,this._point=1;break}case 1:{this._append`L${o},${h}`;break}default:{if(this._append`M${o},${h}`,this._radius!==O1||this._append!==Mm){const p=this._radius,b=this._;this._="",this._append`m0,${p}a${p},${p} 0 1,1 0,${-2*p}a${p},${p} 0 1,1 0,${2*p}z`,O1=p,Mm=this._append,N1=this._,this._=b}this._+=N1;break}}}result(){const o=this._;return this._="",o.length?o:null}}function qT(n){let o=1;this._+=n[0];for(const h=n.length;o<h;++o)this._+=arguments[o]+n[o]}function YD(n){const o=Math.floor(n);if(!(o>=0))throw new RangeError(`invalid digits: ${n}`);if(o>15)return qT;if(o!==B1){const h=10**o;B1=o,Mm=function(b){let T=1;this._+=b[0];for(const v=b.length;T<v;++T)this._+=Math.round(arguments[T]*h)/h+b[T]}}return Mm}function GT(n,o){let h=3,p=4.5,b,T;function v(l){return l&&(typeof p=="function"&&T.pointRadius(+p.apply(this,arguments)),_u(l,b(T))),T.result()}return v.area=function(l){return _u(l,b(Uo)),Uo.result()},v.measure=function(l){return _u(l,b(Of)),Of.result()},v.bounds=function(l){return _u(l,b(wm)),wm.result()},v.centroid=function(l){return _u(l,b(da)),da.result()},v.projection=function(l){return arguments.length?(b=l==null?(n=null,jy):(n=l).stream,v):n},v.context=function(l){return arguments.length?(T=l==null?(o=null,new V1(h)):new NT(o=l),typeof p!="function"&&T.pointRadius(p),v):o},v.pointRadius=function(l){return arguments.length?(p=typeof l=="function"?l:(T.pointRadius(+l),+l),v):p},v.digits=function(l){if(!arguments.length)return h;if(l==null)h=null;else{const C=Math.floor(l);if(!(C>=0))throw new RangeError(`invalid digits: ${l}`);h=C}return o===null&&(T=new V1(h)),v},v.projection(n).digits(h).context(o)}function Yy(n){return{stream:tg(n)}}function tg(n){return function(o){var h=new Ky;for(var p in n)h[p]=n[p];return h.stream=o,h}}function Ky(){}Ky.prototype={constructor:Ky,point:function(n,o){this.stream.point(n,o)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function X0(n,o,h){var p=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),p!=null&&n.clipExtent(null),_u(h,n.stream(wm)),o(wm.result()),p!=null&&n.clipExtent(p),n}function Y0(n,o,h){return X0(n,function(p){var b=o[1][0]-o[0][0],T=o[1][1]-o[0][1],v=Math.min(b/(p[1][0]-p[0][0]),T/(p[1][1]-p[0][1])),l=+o[0][0]+(b-v*(p[1][0]+p[0][0]))/2,C=+o[0][1]+(T-v*(p[1][1]+p[0][1]))/2;n.scale(150*v).translate([l,C])},h)}function $T(n,o,h){return Y0(n,[[0,0],o],h)}function ZT(n,o,h){return X0(n,function(p){var b=+o,T=b/(p[1][0]-p[0][0]),v=(b-T*(p[1][0]+p[0][0]))/2,l=-T*p[0][1];n.scale(150*T).translate([v,l])},h)}function WT(n,o,h){return X0(n,function(p){var b=+o,T=b/(p[1][1]-p[0][1]),v=-T*p[0][0],l=(b-T*(p[1][1]+p[0][1]))/2;n.scale(150*T).translate([v,l])},h)}var j1=16,KD=bn(30*Sr);function U1(n,o){return+o?QD(n,o):JD(n)}function JD(n){return tg({point:function(o,h){o=n(o,h),this.stream.point(o[0],o[1])}})}function QD(n,o){function h(p,b,T,v,l,C,D,z,B,V,G,Q,ee,U){var se=D-p,Me=z-b,me=se*se+Me*Me;if(me>4*o&&ee--){var K=v+V,ce=l+G,oe=C+Q,ue=$i(K*K+ce*ce+oe*oe),de=va(oe/=ue),be=Gn(Gn(oe)-1)<mn||Gn(T-B)<mn?(T+B)/2:Ko(ce,K),Re=n(be,de),Ve=Re[0],qe=Re[1],Ye=Ve-p,et=qe-b,Ie=Me*Ye-se*et;(Ie*Ie/me>o||Gn((se*Ye+Me*et)/me-.5)>.3||v*V+l*G+C*Q<KD)&&(h(p,b,T,v,l,C,Ve,qe,be,K/=ue,ce/=ue,oe,ee,U),U.point(Ve,qe),h(Ve,qe,be,K,ce,oe,D,z,B,V,G,Q,ee,U))}}return function(p){var b,T,v,l,C,D,z,B,V,G,Q,ee,U={point:se,lineStart:Me,lineEnd:K,polygonStart:function(){p.polygonStart(),U.lineStart=ce},polygonEnd:function(){p.polygonEnd(),U.lineStart=Me}};function se(de,be){de=n(de,be),p.point(de[0],de[1])}function Me(){B=NaN,U.point=me,p.lineStart()}function me(de,be){var Re=Au([de,be]),Ve=n(de,be);h(B,V,z,G,Q,ee,B=Ve[0],V=Ve[1],z=de,G=Re[0],Q=Re[1],ee=Re[2],j1,p),p.point(B,V)}function K(){U.point=se,p.lineEnd()}function ce(){Me(),U.point=oe,U.lineEnd=ue}function oe(de,be){me(b=de,be),T=B,v=V,l=G,C=Q,D=ee,U.point=me}function ue(){h(B,V,z,G,Q,ee,T,v,b,l,C,D,j1,p),U.lineEnd=K,K()}return U}}var ez=tg({point:function(n,o){this.stream.point(n*Sr,o*Sr)}});function tz(n){return tg({point:function(o,h){var p=n(o,h);return this.stream.point(p[0],p[1])}})}function nz(n,o,h,p,b){function T(v,l){return v*=p,l*=b,[o+n*v,h-n*l]}return T.invert=function(v,l){return[(v-o)/n*p,(h-l)/n*b]},T}function q1(n,o,h,p,b,T){if(!T)return nz(n,o,h,p,b);var v=bn(T),l=fn(T),C=v*n,D=l*n,z=v/n,B=l/n,V=(l*h-v*o)/n,G=(l*o+v*h)/n;function Q(ee,U){return ee*=p,U*=b,[C*ee-D*U+o,h-D*ee-C*U]}return Q.invert=function(ee,U){return[p*(z*ee-B*U+V),b*(G-B*ee-z*U)]},Q}function $s(n){return HT(function(){return n})()}function HT(n){var o,h=150,p=480,b=250,T=0,v=0,l=0,C=0,D=0,z,B=0,V=1,G=1,Q=null,ee=R1,U=null,se,Me,me,K=jy,ce=.5,oe,ue,de,be,Re;function Ve(Ie){return de(Ie[0]*Sr,Ie[1]*Sr)}function qe(Ie){return Ie=de.invert(Ie[0],Ie[1]),Ie&&[Ie[0]*Ei,Ie[1]*Ei]}Ve.stream=function(Ie){return be&&Re===Ie?be:be=ez(tz(z)(ee(oe(K(Re=Ie)))))},Ve.preclip=function(Ie){return arguments.length?(ee=Ie,Q=void 0,et()):ee},Ve.postclip=function(Ie){return arguments.length?(K=Ie,U=se=Me=me=null,et()):K},Ve.clipAngle=function(Ie){return arguments.length?(ee=+Ie?OD(Q=Ie*Sr):(Q=null,R1),et()):Q*Ei},Ve.clipExtent=function(Ie){return arguments.length?(K=Ie==null?(U=se=Me=me=null,jy):DT(U=+Ie[0][0],se=+Ie[0][1],Me=+Ie[1][0],me=+Ie[1][1]),et()):U==null?null:[[U,se],[Me,me]]},Ve.scale=function(Ie){return arguments.length?(h=+Ie,Ye()):h},Ve.translate=function(Ie){return arguments.length?(p=+Ie[0],b=+Ie[1],Ye()):[p,b]},Ve.center=function(Ie){return arguments.length?(T=Ie[0]%360*Sr,v=Ie[1]%360*Sr,Ye()):[T*Ei,v*Ei]},Ve.rotate=function(Ie){return arguments.length?(l=Ie[0]%360*Sr,C=Ie[1]%360*Sr,D=Ie.length>2?Ie[2]%360*Sr:0,Ye()):[l*Ei,C*Ei,D*Ei]},Ve.angle=function(Ie){return arguments.length?(B=Ie%360*Sr,Ye()):B*Ei},Ve.reflectX=function(Ie){return arguments.length?(V=Ie?-1:1,Ye()):V<0},Ve.reflectY=function(Ie){return arguments.length?(G=Ie?-1:1,Ye()):G<0},Ve.precision=function(Ie){return arguments.length?(oe=U1(ue,ce=Ie*Ie),et()):$i(ce)},Ve.fitExtent=function(Ie,Je){return Y0(Ve,Ie,Je)},Ve.fitSize=function(Ie,Je){return $T(Ve,Ie,Je)},Ve.fitWidth=function(Ie,Je){return ZT(Ve,Ie,Je)},Ve.fitHeight=function(Ie,Je){return WT(Ve,Ie,Je)};function Ye(){var Ie=q1(h,0,0,V,G,B).apply(null,o(T,v)),Je=q1(h,p-Ie[0],b-Ie[1],V,G,B);return z=CT(l,C,D),ue=Ny(o,Je),de=Ny(z,ue),oe=U1(ue,ce),et()}function et(){return be=Re=null,Ve}return function(){return o=n.apply(this,arguments),Ve.invert=o.invert&&qe,Ye()}}function K0(n){var o=0,h=Sn/3,p=HT(n),b=p(o,h);return b.parallels=function(T){return arguments.length?p(o=T[0]*Sr,h=T[1]*Sr):[o*Ei,h*Ei]},b}function rz(n){var o=bn(n);function h(p,b){return[p*o,fn(b)/o]}return h.invert=function(p,b){return[p/o,va(b*o)]},h}function iz(n,o){var h=fn(n),p=(h+fn(o))/2;if(Gn(p)<mn)return rz(n);var b=1+h*(2*p-h),T=$i(b)/p;function v(l,C){var D=$i(b-2*p*fn(C))/p;return[D*fn(l*=p),T-D*bn(l)]}return v.invert=function(l,C){var D=T-C,z=Ko(l,Gn(D))*ga(D);return D*p<0&&(z-=Sn*ga(l)*ga(D)),[z/p,va((b-(l*l+D*D)*p*p)/(2*p))]},v}function Pm(){return K0(iz).scale(155.424).center([0,33.6442])}function XT(){return Pm().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function az(n){var o=n.length;return{point:function(h,p){for(var b=-1;++b<o;)n[b].point(h,p)},sphere:function(){for(var h=-1;++h<o;)n[h].sphere()},lineStart:function(){for(var h=-1;++h<o;)n[h].lineStart()},lineEnd:function(){for(var h=-1;++h<o;)n[h].lineEnd()},polygonStart:function(){for(var h=-1;++h<o;)n[h].polygonStart()},polygonEnd:function(){for(var h=-1;++h<o;)n[h].polygonEnd()}}}function oz(){var n,o,h=XT(),p,b=Pm().rotate([154,0]).center([-2,58.5]).parallels([55,65]),T,v=Pm().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l,C,D={point:function(V,G){C=[V,G]}};function z(V){var G=V[0],Q=V[1];return C=null,p.point(G,Q),C||(T.point(G,Q),C)||(l.point(G,Q),C)}z.invert=function(V){var G=h.scale(),Q=h.translate(),ee=(V[0]-Q[0])/G,U=(V[1]-Q[1])/G;return(U>=.12&&U<.234&&ee>=-.425&&ee<-.214?b:U>=.166&&U<.234&&ee>=-.214&&ee<-.115?v:h).invert(V)},z.stream=function(V){return n&&o===V?n:n=az([h.stream(o=V),b.stream(V),v.stream(V)])},z.precision=function(V){return arguments.length?(h.precision(V),b.precision(V),v.precision(V),B()):h.precision()},z.scale=function(V){return arguments.length?(h.scale(V),b.scale(V*.35),v.scale(V),z.translate(h.translate())):h.scale()},z.translate=function(V){if(!arguments.length)return h.translate();var G=h.scale(),Q=+V[0],ee=+V[1];return p=h.translate(V).clipExtent([[Q-.455*G,ee-.238*G],[Q+.455*G,ee+.238*G]]).stream(D),T=b.translate([Q-.307*G,ee+.201*G]).clipExtent([[Q-.425*G+mn,ee+.12*G+mn],[Q-.214*G-mn,ee+.234*G-mn]]).stream(D),l=v.translate([Q-.205*G,ee+.212*G]).clipExtent([[Q-.214*G+mn,ee+.166*G+mn],[Q-.115*G-mn,ee+.234*G-mn]]).stream(D),B()},z.fitExtent=function(V,G){return Y0(z,V,G)},z.fitSize=function(V,G){return $T(z,V,G)},z.fitWidth=function(V,G){return ZT(z,V,G)},z.fitHeight=function(V,G){return WT(z,V,G)};function B(){return n=o=null,z}return z.scale(1070)}function YT(n){return function(o,h){var p=bn(o),b=bn(h),T=n(p*b);return T===1/0?[2,0]:[T*b*fn(o),T*fn(h)]}}function Yf(n){return function(o,h){var p=$i(o*o+h*h),b=n(p),T=fn(b),v=bn(b);return[Ko(o*T,p*v),va(p&&h*T/p)]}}var KT=YT(function(n){return $i(2/(1+n))});KT.invert=Yf(function(n){return 2*va(n/2)});function sz(){return $s(KT).scale(124.75).clipAngle(180-.001)}var JT=YT(function(n){return(n=ET(n))&&n/fn(n)});JT.invert=Yf(function(n){return n});function lz(){return $s(JT).scale(79.4188).clipAngle(180-.001)}function ng(n,o){return[n,_m(H0((Mr+o)/2))]}ng.invert=function(n,o){return[n,2*Vu(PT(o))-Mr]};function cz(){return QT(ng).scale(961/aa)}function QT(n){var o=$s(n),h=o.center,p=o.scale,b=o.translate,T=o.clipExtent,v=null,l,C,D;o.scale=function(B){return arguments.length?(p(B),z()):p()},o.translate=function(B){return arguments.length?(b(B),z()):b()},o.center=function(B){return arguments.length?(h(B),z()):h()},o.clipExtent=function(B){return arguments.length?(B==null?v=l=C=D=null:(v=+B[0][0],l=+B[0][1],C=+B[1][0],D=+B[1][1]),z()):v==null?null:[[v,l],[C,D]]};function z(){var B=Sn*p(),V=o(AD(o.rotate()).invert([0,0]));return T(v==null?[[V[0]-B,V[1]-B],[V[0]+B,V[1]+B]]:n===ng?[[Math.max(V[0]-B,v),l],[Math.min(V[0]+B,C),D]]:[[v,Math.max(V[1]-B,l)],[C,Math.min(V[1]+B,D)]])}return z()}function Np(n){return H0((Mr+n)/2)}function uz(n,o){var h=bn(n),p=n===o?fn(n):_m(h/bn(o))/_m(Np(o)/Np(n)),b=h*ey(Np(n),p)/p;if(!p)return ng;function T(v,l){b>0?l<-Mr+mn&&(l=-Mr+mn):l>Mr-mn&&(l=Mr-mn);var C=b/ey(Np(l),p);return[C*fn(p*v),b-C*bn(p*v)]}return T.invert=function(v,l){var C=b-l,D=ga(p)*$i(v*v+C*C),z=Ko(v,Gn(C))*ga(C);return C*p<0&&(z-=Sn*ga(v)*ga(C)),[z/p,2*Vu(ey(b/D,1/p))-Mr]},T}function hz(){return K0(uz).scale(109.5).parallels([30,30])}function Em(n,o){return[n,o]}Em.invert=Em;function fz(){return $s(Em).scale(152.63)}function dz(n,o){var h=bn(n),p=n===o?fn(n):(h-bn(o))/(o-n),b=h/p+n;if(Gn(p)<mn)return Em;function T(v,l){var C=b-l,D=p*v;return[C*fn(D),b-C*bn(D)]}return T.invert=function(v,l){var C=b-l,D=Ko(v,Gn(C))*ga(C);return C*p<0&&(D-=Sn*ga(v)*ga(C)),[D/p,b-ga(p)*$i(v*v+C*C)]},T}function pz(){return K0(dz).scale(131.154).center([0,13.9389])}var Tf=1.340264,Sf=-.081106,Mf=893e-6,Pf=.003796,Cm=$i(3)/2,mz=12;function eS(n,o){var h=va(Cm*fn(o)),p=h*h,b=p*p*p;return[n*bn(h)/(Cm*(Tf+3*Sf*p+b*(7*Mf+9*Pf*p))),h*(Tf+Sf*p+b*(Mf+Pf*p))]}eS.invert=function(n,o){for(var h=o,p=h*h,b=p*p*p,T=0,v,l,C;T<mz&&(l=h*(Tf+Sf*p+b*(Mf+Pf*p))-o,C=Tf+3*Sf*p+b*(7*Mf+9*Pf*p),h-=v=l/C,p=h*h,b=p*p*p,!(Gn(v)<MT));++T);return[Cm*n*(Tf+3*Sf*p+b*(7*Mf+9*Pf*p))/bn(h),va(fn(h)/Cm)]};function gz(){return $s(eS).scale(177.158)}function tS(n,o){var h=bn(o),p=bn(n)*h;return[h*fn(n)/p,fn(o)/p]}tS.invert=Yf(Vu);function _z(){return $s(tS).scale(144.049).clipAngle(60)}function nS(n,o){return[bn(o)*fn(n),fn(o)]}nS.invert=Yf(va);function yz(){return $s(nS).scale(249.5).clipAngle(90+mn)}function rS(n,o){var h=bn(o),p=1+bn(n)*h;return[h*fn(n)/p,fn(o)/p]}rS.invert=Yf(function(n){return 2*Vu(n)});function vz(){return $s(rS).scale(250).clipAngle(142)}function iS(n,o){return[_m(H0((Mr+o)/2)),-n]}iS.invert=function(n,o){return[-o,2*Vu(PT(n))-Mr]};function xz(){var n=QT(iS),o=n.center,h=n.rotate;return n.center=function(p){return arguments.length?o([-p[1],p[0]]):(p=o(),[p[1],-p[0]])},n.rotate=function(p){return arguments.length?h([p[0],p[1],p.length>2?p[2]+90:90]):(p=h(),[p[0],p[1],p[2]-90])},h([0,0,90]).scale(159.155)}const bz=W0({stream:n=>n}),wz=.618;function Tz({projOptions:n,inset:o=2,insetTop:h=o,insetRight:p=o,insetBottom:b=o,insetLeft:T=o}={},v){if(n==null)return;if(typeof n.stream=="function")return n;let l,C,D="frame";if(Dy(n)){let be;if({type:n,domain:C,inset:be,insetTop:h=be!==void 0?be:h,insetRight:p=be!==void 0?be:p,insetBottom:b=be!==void 0?be:b,insetLeft:T=be!==void 0?be:T,clip:D=D,...l}=n,n==null)return}let z=wz;const B=n,{width:V,height:G,marginLeft:Q,marginRight:ee,marginTop:U,marginBottom:se}=v,Me=V-Q-ee-T-p,me=G-U-se-h-b,K=B?.({width:Me,height:me,clip:D,...l});if(K==null)return;D=Sz(D,Q,U,V-ee,G-se);let ce=Q+T,oe=U+h,ue,de=be=>be;if(C!=null&&Me>0&&me>0){const[[be,Re],[Ve,qe]]=GT(K).bounds(C),Ye=Math.min(Me/(Ve-be),me/(qe-Re));z=(qe-Re)/(Ve-be),Ye>0?(ce-=(Ye*(be+Ve)-Me)/2,oe-=(Ye*(Re+qe)-me)/2,ue=Yy({point(et,Ie){this.stream.point(et*Ye+ce,Ie*Ye+oe)}}),de=([et,Ie])=>[(et-ce)/Ye,(Ie-oe)/Ye]):console.warn("Warning: the projection could not be fit to the specified domain; using the default scale.")}else C!=null&&console.warn("Warning: the projection could not be fit to the specified domain; using the default scale.");return ue??=ce===0&&oe===0?bz():Yy({point(be,Re){this.stream.point(be+ce,Re+oe)}}),de??=([be,Re])=>[be-ce,Re-oe],{aspectRatio:z,invert([be,Re]){return K.invert(de([be,Re]))},stream:be=>K.stream(ue.stream(D(be)))}}function Sz(n,o,h,p,b){if(n===!1||n==null||typeof n=="number")return T=>T;if(n===!0&&(n="frame"),`${n}`.toLowerCase()==="frame")return DT(o,h,p,b);throw new Error(`unknown projection clip type: ${n}`)}const aS=1e3,oS=aS*60,sS=oS*60,rg=sS*24,Rs=rg*7,Mz=rg*30,Pz=rg*365,J0=new Map([["second",aS],["minute",oS],["hour",sS],["day",rg],["monday",Rs],["tuesday",Rs],["wednesday",Rs],["thursday",Rs],["friday",Rs],["saturday",Rs],["sunday",Rs],["week",Rs],["month",Mz],["year",Pz]]),lS=new Map([["second",Fs],["minute",Wm],["hour",Hm],["day",Nu],["monday",Lf],["tuesday",A2],["wednesday",k2],["thursday",Ql],["friday",D2],["saturday",z2],["sunday",Iu],["week",Iu],["month",Xm],["year",lo]]),cS=new Map([["second",Fs],["minute",E2],["hour",C2],["day",I2],["monday",Ff],["tuesday",R2],["wednesday",L2],["thursday",ec],["friday",F2],["saturday",B2],["sunday",hm],["week",hm],["month",O2],["year",Ns]]),Q0=Symbol("intervalDuration"),ev=Symbol("intervalType");for(const[n,o]of lS)o[Q0]=J0.get(n),o[ev]="time";for(const[n,o]of cS)o[Q0]=J0.get(n),o[ev]="utc";function Ez(n){let o=`${n}`.toLowerCase();o.endsWith("s")&&(o=o.slice(0,-1));let h=1;const p=/^(\d+)\s+/.exec(o);switch(p&&(o=o.slice(p[0].length),h=+p[1]),o){case"quarter":o="month",h*=3;break;case"half":o="month",h*=6;break}let b=cS.get(o);if(!b)throw new Error(`unknown interval: ${n}`);if(h>1&&!b.every)throw new Error(`non-periodic interval: ${o}`);return[o,h]}function Cz(n){return Iz(Ez(n),"time")}function Iz([n,o],h){let p=lS.get(n);return o>1&&(p=p.every(o),p[Q0]=J0.get(n)*o,p[ev]=h),p}function uS(n){if(n!=null){if(typeof n=="number"){0<n&&n<1&&Number.isInteger(1/n)&&(n=-1/n);const o=Math.abs(n);return n<0?{floor:h=>Math.floor(h*o)/o,round:h=>Math.round(h*o)/o,offset:h=>(h*o+1)/o,range:(h,p)=>Bs(Math.ceil(h*o),p*o).map(b=>b/o)}:{floor:h=>Math.floor(h/o)*o,round:h=>Math.round(h/o)*o,offset:h=>h+o,range:(h,p)=>Bs(Math.ceil(h/o),p/o).map(b=>b*o)}}if(typeof n=="string")return Cz(n);if(typeof n.floor!="function")throw new Error("invalid interval; missing floor method");if(typeof n.offset!="function")throw new Error("invalid interval; missing offset method");return n}}function ig(n,o,h,p,b,T){if(o)return o;if(h){const[v,l]=Os(p);if(v==null||l==null)return[];const C=uS(h);return C.range(v,C.offset(l)).filter(D=>D>=v&&D<=l)}return typeof b.ticks=="function"?b.ticks(T):[]}const Vi=Symbol("sortKey"),hS=Symbol("isSorted");function Yp({data:n,...o},h={}){if(!Array.isArray(n))return{data:n,...o};if(o.sort){const{sort:p}=o;return Vs(p)&&typeof p.channel=="string"&&p.channel.charAt(0)==="-"&&(p.channel=p.channel.substring(1),p.order="descending"),{data:typeof o.sort=="function"&&o.sort.length!==1?n.toSorted(o.sort):n.map(T=>({...T,[Vi]:ki("sort",T,{...o,sort:p})})).map(T=>({...T,[Vi]:typeof T[Vi]=="number"&&!Number.isFinite(T[Vi])?Number.POSITIVE_INFINITY:T[Vi]})).toSorted((T,v)=>(typeof T[Vi]=="string"&&typeof v[Vi]=="string"?T[Vi].localeCompare(v[Vi]):T[Vi]>v[Vi]?1:T[Vi]<v[Vi]?-1:0)*(h.reverse||Vs(p)&&p?.order==="descending"?-1:1)).map(({[Vi]:T,...v})=>v),...o,[hS]:p,sort:null}}return{data:n,...o}}function G1(n,o,h,p,b,T){const v=Bo("x",n.x,b,n,o,h,p,T),l=Bo("y",n.y,b,n,o,h,p,T),C=Bo("r",n.r,b,n,o,h,p,T),D=Bo("color",n.color,b,n,o,h,p,T),z=Bo("opacity",n.opacity,b,n,o,h,p,T),B=Bo("length",n.length,b,n,o,h,p,T),V=Bo("symbol",n.symbol,b,n,o,h,p,T),G=Bo("fx",n.fx,b,n,o,h,p,T),Q=Bo("fy",n.fy,b,n,o,h,p,T),ee=n.projection?Tz({projOptions:n.projection,inset:n.inset},{width:o,height:h,marginBottom:n.marginBottom,marginLeft:n.marginLeft,marginRight:n.marginRight,marginTop:n.marginTop}):null;return{x:v,y:l,r:C,color:D,opacity:z,length:B,symbol:V,fx:G,fy:Q,projection:ee}}function Bo(n,o,h,p,b,T,v,l){if(!p.implicitScales&&!o.scale){const ue=n==="color"?()=>"currentColor":()=>0;return ue.range=n==="color"?()=>["currentColor"]:()=>[0],{type:"linear",domain:[0],range:[0],fn:ue,skip:new Map,isDummy:!0}}const C=new Set,D=[],z=new Set,B=new Map;let V=0;const G=new Set,Q=new Set;let ee=p.sortOrdinalDomains??!0;for(const ue of h){(n==="x"||n==="y")&&ue.options[hS]!=null&&(ee=!1);for(const de of ue.channels)if(B.has(de)||B.set(de,new Set),ue.data.length>0){const be=Vs(ue.options[de])?ue.options[de]:{value:ue.options[de],scale:Ui[de]};if(be.scale===n&&(p.implicitScales||o.scale)&&typeof be.value<"u")if(n==="opacity"&&Lz(be.value))B.get(de).add(ue.id);else{const Ve=n==="color"?pD:n==="symbol"?dD:!1;let qe=!!Ve&&ue.data.length>0;if(Ve)for(const Ye of ue.data){const et=gn(be.value,Ye);if(qe=qe&&et!==null&&Ve(et),!qe)break}if(qe&&B.get(de).add(ue.id),typeof be.value=="string"&&!fS(be.value)&&!be.value.startsWith("__")&&ue.data[0][be.value]!==void 0&&G.add(be.value),Q.add(be.value),be.value!=null&&!qe){V++,z.add(ue.type);for(const Ye of ue.data){const et=gn(be.value,Ye);C.add(et),(n==="color"&&o.type==="quantile"||o.type==="quantile-cont")&&D.push(et)}}}(n==="x"||n==="y")&&ue.options[H_[n]]&&!ue.options[H_[n]].startsWith("__")&&G.add(ue.options[H_[n]])}}(n==="x"||n==="y")&&o.sort&&(ee=!0),(n==="x"||n==="y")&&o.sort===!1&&(ee=!1);const U=[...C.values(),...o.domain||[]].filter(ue=>ue!=null),se=o.type==="auto"?kz(n,U,z,o):o.type;if(X_[n]&&!X_[n].has(se))throw new Error(`Invalid scale type ${se} for scale
            ${n}. Valid types are ${[...X_[n]].join(", ")}`);const Me=Fz(se);Me&&ee&&U.sort(Ho);const me=se==="quantile"||se==="quantile-cont"?D.toSorted():U;let K=o.domain?Me?o.domain:Os(o.zero?[0,...o.domain]:o.domain):se==="band"||se==="point"||se==="ordinal"||se==="categorical"||se==="quantile"||se==="quantile-cont"?n==="y"?me.toReversed():me:Os(o.zero?[0,...me]:me);if(o.interval&&(Me?K=Az(K,o.interval,n):z.size>0&&console.error("Setting interval via axis options is only supported for ordinal scales")),!o.scale)throw new Error(`No scale function defined for ${n}`);const ce=o.scale({name:n,type:se,domain:K,scaleOptions:o,plotOptions:p,plotWidth:b,plotHeight:T,plotHasFilledDotMarks:v,plotDefaults:l}),oe=ce.range();return{type:se,domain:K,range:oe,fn:ce,skip:B,manualActiveMarks:V,uniqueScaleProps:Q,autoTitle:se==="time"?null:G.size===1?`${[...G.values()][0]}${se==="log"?" (log)":""}`:null}}function Az(n,o,h){const p=uS(o),[b,T]=Os(n),v=p.range(b,p.offset(T));return h==="y"?v.toReversed():v}const $1={x:new Set(["barY","cell","tickY","waffleY"]),y:new Set(["barX","cell","tickX","waffleX"])};function kz(n,o,h,p={}){if(n==="color")return o.length?o.every(fD)||o.every(x1)?"linear":(o.every(b1),"categorical"):"ordinal";if(n==="symbol")return"ordinal";if(n==="x"||n==="y"){if(p.nice||p.zero)return"linear";if(p.domain&&p.domain.length===2){if(p.domain.every(Number.isFinite))return"linear";if(p.domain.every(Xf))return"time"}}return n==="y"&&Array.from(h).some(b=>$1.y.has(b))||n==="x"&&Array.from(h).some(b=>$1.x.has(b))?"band":o.length?o.length===1?"point":o.every(hD)?n==="r"?"sqrt":"linear":o.every(x1)?"time":o.every(b1)?"point":"linear":"linear"}const Dz=["x","x1","x2","y","y1","y2","r","opacity","fill","fillOpacity","stroke","strokeOpacity","symbol","length"];function zz(n,o,h){return Object.fromEntries(Dz.map(p=>{const b=Ui[p],T=n.scales[b].skip.get(p)||new Set;return[p,!T.has(h.id)&&bT(p,o[p]).scale!==null&&!n.scales[b].isDummy]}))}function fS(n){return Number.isFinite(n)||typeof n=="string"&&n.trim().length>0&&Number.isFinite(+n)}function Rz(n,o,h){return Number.isFinite(n)&&n>=o&&n<=h}function Lz(n){return fS(n)&&Rz(+n,0,1)}function dS(n,o,h,p=!0,b=!0){if(n.projection){let T,v;return n.projection.stream({point(C,D){T=C,v=D}}).point(o,h),[T,v]}return[p?pS("x",n,o):o,b?mS("y",n,h):h]}function pS(n,o,h){return o.x.fn(h)+(n==="x"&&o.x.type==="band"?o.x.fn.bandwidth()*.5:n==="x2"&&o.x.type==="band"?o.x.fn.bandwidth():0)}function mS(n,o,h){return o.y.fn(h)+(n==="y"&&o.y.type==="band"?o.y.fn.bandwidth()*.5:n==="y2"&&o.y.type==="band"?o.y.fn.bandwidth():0)}function Fz(n){return n==="band"||n==="point"||n==="ordinal"||n==="categorical"||n==="threshold"}const Jy=Symbol("svelteplot/defaults");function Bz(n){const h={...Di(),...n};Mu(Jy,h)}function Di(){return wb(Jy)?xi(Jy):wb("svelteplot/defaults")?(console.error("svelteplot: Please use new setPlotDefaults hook instead of 'svelteplot/defaults' context"),xi("svelteplot/defaults")):{}}var Oz=Wt('<div class="plot-header svelte-c5n3b4"><!></div>'),Nz=Wt('<div class="plot-underlay svelte-c5n3b4"><!></div>'),Vz=Wt('<div class="plot-overlay svelte-c5n3b4"><!></div>'),jz=Wt('<figcaption class="plot-footer svelte-c5n3b4"><!></figcaption>'),Uz=Wt('<figure><!> <div class="plot-body svelte-c5n3b4"><!> <svg fill="currentColor"><!><!></svg> <!></div> <!></figure>');function qz(n,o){dn(o,!0);const h=()=>Ra(C,"$autoMarginLeft",v),p=()=>Ra(D,"$autoMarginRight",v),b=()=>Ra(z,"$autoMarginBottom",v),T=()=>Ra(B,"$autoMarginTop",v),[v,l]=_0();let C=Cp(new kp),D=Cp(new kp),z=Cp(new kp),B=Cp(new kp);Mu("svelteplot/autoMargins",{autoMarginLeft:C,autoMarginRight:D,autoMarginBottom:z,autoMarginTop:B});const V=le(()=>Math.max(...h().values())),G=le(()=>Math.max(...p().values())),Q=le(()=>Math.max(...b().values())),ee=le(()=>Math.max(...T().values())),U=Di(),se={height:350,initialWidth:500,inset:0,margin:"auto",colorScheme:"turbo",unknown:"#cccccc99",sortOrdinalDomains:!0,categoricalColorScheme:"observable10",pointScaleHeight:20,bandScaleHeight:30,locale:"en-US",numberFormat:{style:"decimal",useGrouping:"min2",compactDisplay:"short"},markerDotRadius:3,...U,axisX:{anchor:"bottom",implicit:!0,...U.axis,...U.axisX},axisY:{anchor:"left",implicit:!0,...U.axis,...U.axisY},gridX:{implicit:!1,...U.grid,...U.gridX},gridY:{implicit:!1,...U.grid,...U.gridY}};let Me=tn(o,"class",3,""),me=tn(o,"css",19,()=>se.css),K=vr(o,["$$slots","$$events","$$legacy","header","footer","overlay","underlay","children","facetAxes","testid","facet","class","css","width"]),ce=hn(jm(se.initialWidth));Bz(se);let oe=hn([]);const ue=le(()=>P(oe).filter(ve=>!ve.options.automatic)),de=le(()=>!!P(ue).find(ve=>ve.type==="axisX")),be=le(()=>!!P(ue).find(ve=>ve.type==="axisY")),Re=le(()=>!!P(ue).find(ve=>ve.type==="gridX")),Ve=le(()=>!!P(ue).find(ve=>ve.type==="gridY")),qe=le(()=>new Set(P(ue).map(ve=>[...ve.scales.values()].filter(ye=>Object.entries(Ui).filter(([,Xe])=>ye===Xe).map(([Xe])=>Xe).find(Xe=>ve.options[Xe]!=null))).flat(1))),Ye=le(()=>new Set(h5.filter(ve=>!!K[ve]?.domain))),et=le(()=>P(qe).has("x")!==P(qe).has("y")),Ie=le(()=>Pn(K,{explicitScales:P(qe),explicitDomains:P(Ye),hasProjection:!!o.projection,margin:o.margin,inset:o.inset})),Je=le(()=>!!P(ue).find(ve=>ve.type==="dot"&&ve.options.fill)),Qe=le(()=>G1(P(Ie),P(ce),400,P(Je),P(oe),se)),$e=le(()=>!!P(Qe).projection),at=le(()=>(o.width||P(ce))-P(Ie).marginLeft-P(Ie).marginRight),zt=le(()=>Math.max(1,P(Qe).fx.domain.length)),rt=le(()=>Math.max(1,P(Qe).fy.domain.length)),ct=le(()=>P(et)&&P(qe).has("x")?1:P(Qe).y.domain.length),xt=le(()=>P(qe).has("r")&&P(Ie).r.range?P(Ie).r.range[1]*2:se.pointScaleHeight),vt=le(()=>typeof P(Ie).height=="function"?P(Ie).height(P(at)):wf(P(Ie).height)===null||P(Ie).height==="auto"?Math.round(P(Qe).projection&&P(Qe).projection.aspectRatio?P(at)*P(Qe).projection.aspectRatio/P(zt)*P(rt)+P(Ie).marginTop+P(Ie).marginBottom:P(Ie).aspectRatio?Ze(P(Qe).x,P(Qe).y,P(Ie).aspectRatio,P(at),P(Ie).marginTop,P(Ie).marginBottom):(P(et)&&P(qe).has("x")||!P(ue).length?P(rt)*se.bandScaleHeight:P(Qe).y.type==="band"?P(rt)*P(ct)*se.bandScaleHeight:P(Qe).y.type==="point"?P(rt)*P(ct)*P(xt):se.height)+P(Ie).marginTop+P(Ie).marginBottom):wf(P(Ie).height)),Pt=le(()=>P(vt)-P(Ie).marginTop-P(Ie).marginBottom);let pt=hn(null),Et=hn(null),Kt=hn(null),ot=ED(_t());Ir(()=>{ot.update(_t())});function _t(){const ve=G1(P(Ie),P(Et)||P(ce),P(Kt)||P(vt),P(Je),P(oe),se),ye=ve.color.uniqueScaleProps?.size===1&&ve.symbol.uniqueScaleProps?.size===1&&[...ve.color.uniqueScaleProps?.values()][0]===[...ve.symbol.uniqueScaleProps?.values()][0];return{options:P(Ie),width:P(ce),height:P(vt),facetWidth:P(Et),facetHeight:P(Kt),plotHeight:P(Pt),plotWidth:P(at),scales:ve,colorSymbolRedundant:ye,hasFilledDotMarks:P(Je),body:P(pt),css:me()}}Mu("svelteplot",{addMark(ve){P(oe).find(ye=>ye.id===ve.id)||Vt(oe,[...P(oe),ve])},updateMark(ve){},removeMark(ve){Vt(oe,P(oe).filter(ye=>ye.id!==ve.id))},getPlotState(){return ot},getTopLevelFacet(){return o.facet},updateDimensions(ve,ye){P(Et)!==ve&&Vt(Et,ve,!0),P(Kt)!==ye&&Vt(Kt,ye,!0)},updatePlotState(){ot.update(_t())}});function Rt(){return P(ce)}function Ze(ve,ye,Ae,Xe,We,ft){const Mt=ve.type==="band"||ve.type==="point"?ve.domain.length:Math.abs(ve.domain[1]-ve.domain[0]),jt=ye.type==="band"||ye.type==="point"?ye.domain.length:Math.abs(ye.domain[1]-ye.domain[0]);return Xe/Mt*jt/Ae+We+ft}function Pn(ve,ye){return Ly({},{sortOrdinalDomains:se.sortOrdinalDomains},Jt(ye),K)}function Nt(ve,ye,Ae,Xe){const We=typeof ve=="object"&&ve[ye]!=null?ve[ye]:typeof ve=="number"||ve==="auto"?ve:typeof Ae=="object"&&Ae[ye]!=null?Ae[ye]:typeof Ae=="number"||Ae==="auto"?Ae:"auto";return We==="auto"?Xe[ye]:We}function Jt({explicitScales:ve,explicitDomains:ye,hasProjection:Ae,margin:Xe}){const We=ve.has("x")||ye.has("x"),ft=ve.has("y")||ye.has("y"),Mt=We!==ft,jt=We&&!ft,Cn=ft&&!We,yn={left:Ae?0:Math.max(P(V)+1,1),right:Ae||Cn?0:Math.max(P(G)+1,4),top:Ae||jt?0:Math.max(5,P(ee)),bottom:Ae?0:Math.max(5,P(Q))};return{title:"",subtitle:"",caption:"",height:"auto",marginLeft:Nt(Xe,"left",se.margin,yn),marginRight:Nt(Xe,"right",se.margin,yn),marginTop:Nt(Xe,"top",se.margin,yn),marginBottom:Nt(Xe,"bottom",se.margin,yn),inset:Mt?10:se.inset,grid:(se.gridX?.implicit??!1)&&(se.gridY?.implicit??!1),axes:(se.axisX?.implicit??!1)&&(se.axisY?.implicit??!1),frame:se.frame?.implicit??!1,projection:null,aspectRatio:null,facet:{},padding:.1,x:{type:"auto",axis:se.axisX.implicit&&We?se.axisX.anchor:!1,labelAnchor:"auto",reverse:!1,clamp:!1,nice:!1,zero:!1,round:!1,percent:!1,align:.5,tickSpacing:se.axisX.tickSpacing??80,tickFormat:"auto",grid:se.gridX.implicit??!1},y:{type:"auto",axis:se.axisY.implicit&&ft?se.axisY.anchor:!1,labelAnchor:"auto",reverse:!1,clamp:!1,nice:!1,zero:!1,round:!1,percent:!1,align:.5,tickSpacing:se.axisY.tickSpacing??50,tickFormat:"auto",grid:se.gridY.implicit??!1},opacity:{type:"linear",reverse:!1,clamp:!1,nice:!1,zero:!1,round:!1,tickSpacing:0,percent:!1,padding:.1,align:.5},r:{type:"sqrt",reverse:!1,clamp:!1,nice:!1,zero:!0,percent:!1,round:!1,padding:0,align:0},color:{type:"auto",unknown:se.unknown},length:{type:"linear"},symbol:{type:"ordinal"},fx:{type:"band",axis:"top"},fy:{type:"band",axis:"right"},locale:se.locale,css:se.css}}const Ut=le(()=>(ve,ye)=>{const[Ae,Xe]=dS(ot.scales,ve,ye);return{x:Ae,y:Xe}});var qt={getWidth:Rt},cn=Uz();let Pr;var Xr=At(cn);{var oi=ve=>{var ye=Oz(),Ae=At(ye);Dn(Ae,()=>o.header??Qn),Tt(ye),Ue(ve,ye)};It(Xr,ve=>{o.header&&ve(oi)})}var Ar=$t(Xr,2),ba=At(Ar);{var Oa=ve=>{var ye=Nz(),Ae=At(ye);Dn(Ae,()=>o.underlay,()=>P(Ie)),Tt(ye),Ue(ve,ye)};It(ba,ve=>{o.underlay&&ve(Oa)})}var gr=$t(ba,2),ke=At(gr);Dn(ke,()=>o.facetAxes??Qn);var H=$t(ke);ID(H,{get marks(){return P(ue)},children:(ve,ye)=>{var Ae=Yt(),Xe=kt(Ae);{var We=ft=>{var Mt=Yt(),jt=kt(Mt);Dn(jt,()=>o.children,()=>({width:P(ce),height:P(vt),options:P(Ie),scales:ot.scales,mapXY:P(Ut),hasProjection:P($e),hasExplicitAxisX:P(de),hasExplicitAxisY:P(be),hasExplicitGridX:P(Re),hasExplicitGridY:P(Ve)})),Ue(ft,Mt)};It(Xe,ft=>{o.children&&ft(We)})}Ue(ve,Ae)},$$slots:{default:!0}}),Tt(gr);var W=$t(gr,2);{var te=ve=>{var ye=Vz(),Ae=At(ye);Dn(Ae,()=>o.overlay??Qn,()=>({width:P(ce),height:P(vt),options:P(Ie),scales:ot.scales,mapXY:P(Ut),hasProjection:P($e),hasExplicitAxisX:P(de),hasExplicitAxisY:P(be),hasExplicitGridX:P(Re),hasExplicitGridY:P(Ve)})),Tt(ye),Ue(ve,ye)};It(W,ve=>{o.overlay&&ve(te)})}Tt(Ar),xa(Ar,ve=>Vt(pt,ve),()=>P(pt));var Se=$t(Ar,2);{var Ee=ve=>{var ye=jz(),Ae=At(ye);Dn(Ae,()=>o.footer??Qn),Tt(ye),Ue(ve,ye)};It(Se,ve=>{o.footer&&ve(Ee)})}Tt(cn),Zt(()=>{ir(cn,1,`svelteplot ${Me()??""}`,"svelte-c5n3b4"),Ct(cn,"data-testid",o.testid),Pr=Zr(cn,"",Pr,{"max-width":P(Ie).maxWidth}),Ct(gr,"width",o.width||P(ce)),Ct(gr,"height",P(vt)),Ct(gr,"viewBox",`0 0 ${P(ce)??""} ${P(vt)??""}`)}),cI(cn,"clientWidth",ve=>Vt(ce,ve)),Ue(n,cn);var ze=pn(qt);return l(),ze}function Gz(){}function Z1(n){return Object.getOwnPropertySymbols(n).filter(o=>Object.prototype.propertyIsEnumerable.call(n,o))}function W1(n){return n==null?n===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(n)}const $z="[object RegExp]",Zz="[object String]",Wz="[object Number]",Hz="[object Boolean]",H1="[object Arguments]",Xz="[object Symbol]",Yz="[object Date]",Kz="[object Map]",Jz="[object Set]",Qz="[object Array]",e4="[object Function]",t4="[object ArrayBuffer]",ay="[object Object]",n4="[object Error]",r4="[object DataView]",i4="[object Uint8Array]",a4="[object Uint8ClampedArray]",o4="[object Uint16Array]",s4="[object Uint32Array]",l4="[object BigUint64Array]",c4="[object Int8Array]",u4="[object Int16Array]",h4="[object Int32Array]",f4="[object BigInt64Array]",d4="[object Float32Array]",p4="[object Float64Array]";function Qy(n){if(!n||typeof n!="object")return!1;const o=Object.getPrototypeOf(n);return o===null||o===Object.prototype||Object.getPrototypeOf(o)===null?Object.prototype.toString.call(n)==="[object Object]":!1}function gS(n,o){const h={};for(let p=0;p<o.length;p++){const b=o[p];Object.hasOwn(n,b)&&(h[b]=n[b])}return h}function m4(n,o){return n===o||Number.isNaN(n)&&Number.isNaN(o)}function g4(n,o,h){return _f(n,o,void 0,void 0,void 0,void 0,h)}function _f(n,o,h,p,b,T,v){const l=v(n,o,h,p,b,T);if(l!==void 0)return l;if(typeof n==typeof o)switch(typeof n){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return n===o;case"number":return n===o||Object.is(n,o);case"function":return n===o;case"object":return Ef(n,o,T,v)}return Ef(n,o,T,v)}function Ef(n,o,h,p){if(Object.is(n,o))return!0;let b=W1(n),T=W1(o);if(b===H1&&(b=ay),T===H1&&(T=ay),b!==T)return!1;switch(b){case Zz:return n.toString()===o.toString();case Wz:{const C=n.valueOf(),D=o.valueOf();return m4(C,D)}case Hz:case Yz:case Xz:return Object.is(n.valueOf(),o.valueOf());case $z:return n.source===o.source&&n.flags===o.flags;case e4:return n===o}h=h??new Map;const v=h.get(n),l=h.get(o);if(v!=null&&l!=null)return v===o;h.set(n,o),h.set(o,n);try{switch(b){case Kz:{if(n.size!==o.size)return!1;for(const[C,D]of n.entries())if(!o.has(C)||!_f(D,o.get(C),C,n,o,h,p))return!1;return!0}case Jz:{if(n.size!==o.size)return!1;const C=Array.from(n.values()),D=Array.from(o.values());for(let z=0;z<C.length;z++){const B=C[z],V=D.findIndex(G=>_f(B,G,void 0,n,o,h,p));if(V===-1)return!1;D.splice(V,1)}return!0}case Qz:case i4:case a4:case o4:case s4:case l4:case c4:case u4:case h4:case f4:case d4:case p4:{if(typeof Buffer<"u"&&Buffer.isBuffer(n)!==Buffer.isBuffer(o)||n.length!==o.length)return!1;for(let C=0;C<n.length;C++)if(!_f(n[C],o[C],C,n,o,h,p))return!1;return!0}case t4:return n.byteLength!==o.byteLength?!1:Ef(new Uint8Array(n),new Uint8Array(o),h,p);case r4:return n.byteLength!==o.byteLength||n.byteOffset!==o.byteOffset?!1:Ef(new Uint8Array(n),new Uint8Array(o),h,p);case n4:return n.name===o.name&&n.message===o.message;case ay:{if(!(Ef(n.constructor,o.constructor,h,p)||Qy(n)&&Qy(o)))return!1;const D=[...Object.keys(n),...Z1(n)],z=[...Object.keys(o),...Z1(o)];if(D.length!==z.length)return!1;for(let B=0;B<D.length;B++){const V=D[B],G=n[V];if(!Object.hasOwn(o,V))return!1;const Q=o[V];if(!_f(G,Q,V,n,o,h,p))return!1}return!0}default:return!1}}finally{h.delete(n),h.delete(o)}}function X1(n,o){return g4(n,o,Gz)}const _4="__renamed__";var oy,Y1;function y4(){if(Y1)return oy;Y1=1;function n(v,l,C,D,z){for(var B=z+1;D<=z;){var V=D+z>>>1,G=v[V],Q=C!==void 0?C(G,l):G-l;Q>=0?(B=V,z=V-1):D=V+1}return B}function o(v,l,C,D,z){for(var B=z+1;D<=z;){var V=D+z>>>1,G=v[V],Q=C!==void 0?C(G,l):G-l;Q>0?(B=V,z=V-1):D=V+1}return B}function h(v,l,C,D,z){for(var B=D-1;D<=z;){var V=D+z>>>1,G=v[V],Q=C!==void 0?C(G,l):G-l;Q<0?(B=V,D=V+1):z=V-1}return B}function p(v,l,C,D,z){for(var B=D-1;D<=z;){var V=D+z>>>1,G=v[V],Q=C!==void 0?C(G,l):G-l;Q<=0?(B=V,D=V+1):z=V-1}return B}function b(v,l,C,D,z){for(;D<=z;){var B=D+z>>>1,V=v[B],G=C!==void 0?C(V,l):V-l;if(G===0)return B;G<=0?D=B+1:z=B-1}return-1}function T(v,l,C,D,z,B){return typeof C=="function"?B(v,l,C,D===void 0?0:D|0,z===void 0?v.length-1:z|0):B(v,l,void 0,C===void 0?0:C|0,D===void 0?v.length-1:D|0)}return oy={ge:function(v,l,C,D,z){return T(v,l,C,D,z,n)},gt:function(v,l,C,D,z){return T(v,l,C,D,z,o)},lt:function(v,l,C,D,z){return T(v,l,C,D,z,h)},le:function(v,l,C,D,z){return T(v,l,C,D,z,p)},eq:function(v,l,C,D,z){return T(v,l,C,D,z,b)}},oy}var sy,K1;function v4(){if(K1)return sy;K1=1;var n=y4(),o=0,h=1,p=2;sy=me;function b(K,ce,oe,ue,de){this.mid=K,this.left=ce,this.right=oe,this.leftPoints=ue,this.rightPoints=de,this.count=(ce?ce.count:0)+(oe?oe.count:0)+ue.length}var T=b.prototype;function v(K,ce){K.mid=ce.mid,K.left=ce.left,K.right=ce.right,K.leftPoints=ce.leftPoints,K.rightPoints=ce.rightPoints,K.count=ce.count}function l(K,ce){var oe=U(ce);K.mid=oe.mid,K.left=oe.left,K.right=oe.right,K.leftPoints=oe.leftPoints,K.rightPoints=oe.rightPoints,K.count=oe.count}function C(K,ce){var oe=K.intervals([]);oe.push(ce),l(K,oe)}function D(K,ce){var oe=K.intervals([]),ue=oe.indexOf(ce);return ue<0?o:(oe.splice(ue,1),l(K,oe),h)}T.intervals=function(K){return K.push.apply(K,this.leftPoints),this.left&&this.left.intervals(K),this.right&&this.right.intervals(K),K},T.insert=function(K){var ce=this.count-this.leftPoints.length;if(this.count+=1,K[1]<this.mid)this.left?4*(this.left.count+1)>3*(ce+1)?C(this,K):this.left.insert(K):this.left=U([K]);else if(K[0]>this.mid)this.right?4*(this.right.count+1)>3*(ce+1)?C(this,K):this.right.insert(K):this.right=U([K]);else{var oe=n.ge(this.leftPoints,K,Q),ue=n.ge(this.rightPoints,K,ee);this.leftPoints.splice(oe,0,K),this.rightPoints.splice(ue,0,K)}},T.remove=function(K){var ce=this.count-this.leftPoints;if(K[1]<this.mid){if(!this.left)return o;var oe=this.right?this.right.count:0;if(4*oe>3*(ce-1))return D(this,K);var ue=this.left.remove(K);return ue===p?(this.left=null,this.count-=1,h):(ue===h&&(this.count-=1),ue)}else if(K[0]>this.mid){if(!this.right)return o;var de=this.left?this.left.count:0;if(4*de>3*(ce-1))return D(this,K);var ue=this.right.remove(K);return ue===p?(this.right=null,this.count-=1,h):(ue===h&&(this.count-=1),ue)}else{if(this.count===1)return this.leftPoints[0]===K?p:o;if(this.leftPoints.length===1&&this.leftPoints[0]===K){if(this.left&&this.right){for(var be=this,Re=this.left;Re.right;)be=Re,Re=Re.right;if(be===this)Re.right=this.right;else{var Ve=this.left,ue=this.right;be.count-=Re.count,be.right=Re.left,Re.left=Ve,Re.right=ue}v(this,Re),this.count=(this.left?this.left.count:0)+(this.right?this.right.count:0)+this.leftPoints.length}else this.left?v(this,this.left):v(this,this.right);return h}for(var Ve=n.ge(this.leftPoints,K,Q);Ve<this.leftPoints.length&&this.leftPoints[Ve][0]===K[0];++Ve)if(this.leftPoints[Ve]===K){this.count-=1,this.leftPoints.splice(Ve,1);for(var ue=n.ge(this.rightPoints,K,ee);ue<this.rightPoints.length&&this.rightPoints[ue][1]===K[1];++ue)if(this.rightPoints[ue]===K)return this.rightPoints.splice(ue,1),h}return o}};function z(K,ce,oe){for(var ue=0;ue<K.length&&K[ue][0]<=ce;++ue){var de=oe(K[ue]);if(de)return de}}function B(K,ce,oe){for(var ue=K.length-1;ue>=0&&K[ue][1]>=ce;--ue){var de=oe(K[ue]);if(de)return de}}function V(K,ce){for(var oe=0;oe<K.length;++oe){var ue=ce(K[oe]);if(ue)return ue}}T.queryPoint=function(K,ce){if(K<this.mid){if(this.left){var oe=this.left.queryPoint(K,ce);if(oe)return oe}return z(this.leftPoints,K,ce)}else if(K>this.mid){if(this.right){var oe=this.right.queryPoint(K,ce);if(oe)return oe}return B(this.rightPoints,K,ce)}else return V(this.leftPoints,ce)},T.queryInterval=function(K,ce,oe){if(K<this.mid&&this.left){var ue=this.left.queryInterval(K,ce,oe);if(ue)return ue}if(ce>this.mid&&this.right){var ue=this.right.queryInterval(K,ce,oe);if(ue)return ue}return ce<this.mid?z(this.leftPoints,ce,oe):K>this.mid?B(this.rightPoints,K,oe):V(this.leftPoints,oe)};function G(K,ce){return K-ce}function Q(K,ce){var oe=K[0]-ce[0];return oe||K[1]-ce[1]}function ee(K,ce){var oe=K[1]-ce[1];return oe||K[0]-ce[0]}function U(K){if(K.length===0)return null;for(var ce=[],oe=0;oe<K.length;++oe)ce.push(K[oe][0],K[oe][1]);ce.sort(G);for(var ue=ce[ce.length>>1],de=[],be=[],Re=[],oe=0;oe<K.length;++oe){var Ve=K[oe];Ve[1]<ue?de.push(Ve):ue<Ve[0]?be.push(Ve):Re.push(Ve)}var qe=Re,Ye=Re.slice();return qe.sort(Q),Ye.sort(ee),new b(ue,U(de),U(be),qe,Ye)}function se(K){this.root=K}var Me=se.prototype;Me.insert=function(K){this.root?this.root.insert(K):this.root=new b(K[0],null,null,[K],[K])},Me.remove=function(K){if(this.root){var ce=this.root.remove(K);return ce===p&&(this.root=null),ce!==o}return!1},Me.queryPoint=function(K,ce){if(this.root)return this.root.queryPoint(K,ce)},Me.queryInterval=function(K,ce,oe){if(K<=ce&&this.root)return this.root.queryInterval(K,ce,oe)},Object.defineProperty(Me,"count",{get:function(){return this.root?this.root.count:0}}),Object.defineProperty(Me,"intervals",{get:function(){return this.root?this.root.intervals([]):[]}});function me(K){return!K||K.length===0?new se(null):new se(U(K))}return sy}var x4=v4();const b4=Vw(x4);function w4(n,o,h){const p=["fx","fy","z"].map(T=>{let v=null;if(T==="z"?o.z?v="z":o.fill?v="fill":o.stroke&&(v="stroke"):o[T]&&(v=T),v){const l=typeof o[v]=="string"?o[v]:`__group_${v}`;return[v,l,C=>ki(v,C,o)]}else return[null,null,()=>!0]}),b=UA(n,...p.map(T=>T[2]));for(const[T,v]of b){const l={};p[0][0]!==null&&p[0][1]&&(l[p[0][1]]=T);for(const[C,D]of v){p[1][0]!==null&&p[1][1]&&(l[p[1][1]]=C);for(const[z,B]of D)p[2][0]!==null&&p[2][1]&&(l[p[2][1]]=z),h(B,l)}}return Object.fromEntries(p.filter(([T])=>T!==null).map(([T,v])=>[T,v]))}function T4(n,o){if(!n.dodgeX)return n.data;let{anchor:h="left",padding:p=1,r:b=n.dodgeX.r}=yS(n.dodgeX),T;switch(`${h}`.toLowerCase()){case"left":T=M4;break;case"right":T=P4;break;case"middle":T=E4;break;default:throw new Error(`unknown dodge anchor: ${h}`)}return _S("x","y",T,Number(p),b,n,o)}function S4(n,o){if(!n.dodgeY)return n.data;let{anchor:h="bottom",padding:p=1,r:b=n.dodgeY.r}=yS(n.dodgeY),T;switch(`${h}`.toLowerCase()){case"top":T=C4;break;case"bottom":T=I4;break;case"middle":T=A4;break;default:throw new Error(`unknown dodge anchor: ${h}`)}return _S("y","x",T,Number(p),b,n,o)}function _S(n,o,h,p,b,{data:T,...v},l){const{fx:C,fy:D}=v;let[z,B]=h(l);const V=z?D4:k4,G=b!==void 0?b:3;return w4(T,{fx:C,fy:D},Q=>{const ee=b4(),U=Q.filter(Me=>(typeof Me.r!="number"||Me.r>=0)&&isFinite(Me[o])&&isFinite(Me[n])),se=new Float64Array(2*U.length+2);U.forEach((Me,me)=>{const K=Me.r??b??3,ce=z?K+p:0,oe=Me[o]-K,ue=Me[o]+K;let de=2;ee.queryInterval(oe-p,ue+p,([,,Re])=>{const Ve=U[Re][n]-ce,qe=Me[o]-U[Re][o],Ye=p+(v.r?Me.r+U[Re].r:2*G),et=Math.sqrt(Ye*Ye-qe*qe);se[de++]=Ve-et,se[de++]=Ve+et});let be=se.slice(0,de);z&&(be=be.filter(Re=>Re>=0));e:for(const Re of be.sort(V)){for(let Ve=0;Ve<de;Ve+=2)if(se[Ve]+1e-6<Re&&Re<se[Ve+1]-1e-6)continue e;Me[n]=Re+ce;break}ee.insert([oe,ue,me])}),z||(z=1),U.forEach(Me=>Me[n]=Me[n]*z+B)}),T}function yS(n){return typeof n=="string"?{anchor:n}:n}function M4({options:{marginLeft:n}}){return[1,n]}function P4({facetWidth:n,options:{marginLeft:o}}){return[-1,o+n]}function E4({facetWidth:n,options:{marginLeft:o}}){return[0,o+n/2]}function C4({options:{marginTop:n}}){return[1,n]}function I4({facetHeight:n}){return[-1,n]}function A4({facetHeight:n,options:{marginTop:o,marginBottom:h}}){return[0,(o+n)/2]}function k4(n,o){return Math.abs(n)-Math.abs(o)}function D4(n,o){return n-o}var z4=nn('<tspan x="0"> </tspan>'),R4=nn('<text transform="translate(10,10)" class="svelte-1vdc81s"></text>');function oc(n,o){dn(o,!0);let h=tn(o,"data",19,()=>[]),p=tn(o,"channels",19,()=>[]),b=tn(o,"required",19,()=>[]),T=tn(o,"requiredScales",19,()=>({})),v=tn(o,"defaults",19,()=>({})),l=vr(o,["$$slots","$$events","$$legacy","data","children","type","channels","required","requiredScales","defaults"]);const C=le(()=>[...p(),"fx","fy"]),{addMark:D,removeMark:z,getTopLevelFacet:B,getPlotState:V}=xi("svelteplot"),G=le(V),Q=le(B),{getFacetState:ee}=xi("svelteplot/facet"),U=le(ee),se=le(()=>P(U).left),Me=le(()=>P(U).top);class me{id;type;#e=hn([]);get channels(){return P(this.#e)}set channels(ct){Vt(this.#e,ct)}#t=hn(new Set);get scales(){return P(this.#t)}set scales(ct){Vt(this.#t,ct)}#n=hn([]);get data(){return P(this.#n)}set data(ct){Vt(this.#n,ct)}#r=hn({});get options(){return P(this.#r)}set options(ct){Vt(this.#r,ct)}constructor(ct){this.id=Symbol(),this.type=ct}}const K=new me(o.type);Ir(()=>()=>{z(K),ue=!1});const ce=le(()=>o.facet||"auto"),oe=le(()=>({...l,__firstFacet:P(se)&&P(Me),...P(Q)&&P(Q).data&&(P(ce)==="auto"&&P(Q).data===h()||P(ce)==="include")?{fx:P(Q).x,fy:P(Q).y}:{}}));let ue=!1;Ir(()=>{const rt=pa(()=>K.options);X1(rt,P(oe))||(K.options=P(oe))}),Ir(()=>{if(ue)return;const rt=pa(()=>P(C));K.channels=rt,K.scales=new Set(rt.filter(ct=>l[ct]!==0).map(ct=>Ui[ct])),K.data=pa(()=>h()),K.options=pa(()=>P(oe)),D(K),ue=!0});const{getTestFacet:de}=xi("svelteplot/facet"),be=le(de),Re=le(()=>h().map((rt,ct)=>({...rt,[Ai]:ct})).flatMap((rt,ct)=>{const xt=l;if(!P(be)(rt,xt)||!tc(rt,xt))return[];const vt={datum:rt,index:ct};for(const[Pt]of Object.entries(Ui))if(l?.[Pt]!==void 0&&vt[Pt]===void 0&&(vt[Pt]=ki(Pt,rt,l),l[Pt]===Ai)){const pt=P(G).scales[Ui[Pt]];(pt.type==="band"||pt.type==="point")&&(vt[Pt]=pt.domain[vt[Pt]%pt.domain.length])}return[vt]}));let Ve=[];Ir(()=>{(qe(h(),K.data)||qe(P(Re),Ve))&&(Ve=P(Re),K.data=h())});function qe(rt,ct){if(rt.length!==ct.length)return!0;for(let xt=0;xt<rt.length;xt++)for(const[vt]of Object.entries(Ui))if(!X1(rt[xt][vt],ct[xt][vt]))return!0;return!1}const Ye=le(()=>[...b().filter(rt=>l[rt]==null).map(rt=>`missing channel value for ${K.type} mark: ${rt}`),...Object.entries(T()).filter(([rt,ct])=>!ct.includes(P(G).scales[rt].type)).map(([rt,ct])=>`scale type mismatch for ${rt} (needs ${ct.join(" or ")})`)]);Ir(()=>{for(const rt of b())if(l[rt]==null)throw new Error(`missing channel value: ${rt}`)});const et=le(()=>zz(P(G),P(oe),K)),Ie=le(()=>Je(P(Re).flatMap(rt=>{const ct={datum:rt.datum,resolved:rt,index:rt[Ai],valid:!0};if(ct.dx=Number(gn(o.dx,ct.datum,0)),ct.dy=Number(gn(o.dy,ct.datum,0)),P(G).scales.projection&&K.type!=="geo"){for(const xt of["","1","2"])if(l?.[`x${xt}`]!==void 0&&l?.[`y${xt}`]!==void 0){const[vt,Pt]=K.type==="line"?[rt.x,rt.y]:dS(P(G).scales,rt.x,rt.y,P(et).x,P(et).y);ct[`x${xt}`]=vt,ct[`y${xt}`]=Pt,ct.valid=ct.valid&&ia(rt.x)&&ia(rt.y)&&ia(vt)&&ia(Pt)}}for(const[xt,vt]of Object.entries(Ui))if(l?.[xt]!=null&&ct[xt]===void 0){const Pt=rt[xt],pt=l?.[_4]?.[xt]||xt,Et=P(et)[xt]?vt==="x"?pS(pt,P(G).scales,Pt):vt==="y"?mS(pt,P(G).scales,Pt):vt==="color"&&!ia(Pt)?P(G).options.color.unknown:P(G).scales[vt].fn(Pt):Pt;ct.valid=ct.valid&&(vt==="color"||ia(Pt)),ct[xt]=Number.isFinite(Et)&&(vt==="x"||vt==="y")?Et+(vt==="x"?ct.dx:ct.dy):Et}else v()[xt]&&(ct[xt]=v()[xt]);return[ct]}),l));function Je(rt,ct){return ct.dodgeX?T4({data:rt,...ct},P(G)):ct.dodgeY?S4({data:rt,...ct},P(G)):rt}var Qe=Yt(),$e=kt(Qe);{var at=rt=>{var ct=R4();ii(ct,21,()=>P(Ye),ya,(xt,vt,Pt)=>{var pt=z4();Ct(pt,"dy",Pt?14:0);var Et=At(pt,!0);Tt(pt),Zt(()=>$r(Et,P(vt))),Ue(xt,pt)}),Tt(ct),Ue(rt,ct)},zt=rt=>{var ct=Yt(),xt=kt(ct);{var vt=Pt=>{var pt=Yt(),Et=kt(pt);Dn(Et,()=>o.children,()=>({mark:K,usedScales:P(et),scaledData:P(Ie)})),Ue(Pt,pt)};It(xt,Pt=>{o.children&&Pt(vt)},!0)}Ue(rt,ct)};It($e,rt=>{P(Ye).length?rt(at):rt(zt,!1)})}Ue(n,Qe),pn()}function L4(n){const o=[];if(!n.length)return n;for(let p=0;p<n.length;p++)o.push({...n[p],text:[]});const h=Math.max(...n.map(p=>p.text.length));for(let p=0;p<h;p++){const b=n.length>1&&n.every(T=>n[0].text[p]===T.text[p]);for(let T=0;T<n.length;T++)!b&&n[T].text[p]!=null&&o[T].text.push(n[T].text[p])}return o}const Vp={A:7,a:7,B:8,b:7,C:8,c:6,D:9,d:7,E:7,e:7,F:7,f:4,G:9,g:7,H:9,h:7,I:3,i:3,J:5,j:3,K:8,k:6,L:7,l:3,M:11,m:11,N:9,n:7,O:9,o:7,P:8,p:7,Q:9,q:7,R:8,r:4,S:8,s:6,T:7,t:4,U:9,u:7,V:7,v:6,W:11,w:9,X:7,x:6,Y:7,y:6,Z:7,z:5,".":2,",":2,":":2,";":2};function F4(n,o={}){let{minCharactersPerLine:h,minLineWidth:p,maxCharactersPerLine:b,maxLineWidth:T,fontSize:v,monospace:l}={fontSize:12,maxCharactersPerLine:10,...o};const C=[],D=n.split(" ");if(D.forEach((Q,ee)=>{const U=Q.split("-"),se=ee<D.length-1?" ":"";U.length>1?U.forEach((Me,me)=>{const K=me<U.length-1?"-":se;C.push(Me+K)}):C.push(Q+se)}),T||(T=b*Vp.a),!p){const Q=C.map(Me=>Me.length).sort((Me,me)=>Me-me),ee=Math.round(C.length/2),U=Q[ee]??b;p=(h||Math.max(3,Math.min(b*.5,.75*U)))*Vp.a}const z=[],B=[];let V=0;const G=Q=>v/12*(l?Vp.a:Vp[Q]);return C.forEach(Q=>{const ee=a2(Q.split("").map(G));V+ee>T&&V>p&&(z.push(B.join("")),B.length=0,V=0),V+=ee,B.push(Q)}),B.length>0&&z.push(B.join("")),z.filter(Q=>Q!=="")}var B4=nn("<line></line>"),O4=nn('<tspan x="0"> </tspan>'),N4=nn("<text><!></text>"),V4=nn("<g><!><!></g>"),j4=nn("<g></g>");function vS(n,o){dn(o,!0);const h=()=>Ra(me,"$autoMarginLeft",v),p=()=>Ra(K,"$autoMarginRight",v),b=()=>Ra(se,"$autoMarginTop",v),T=()=>Ra(Me,"$autoMarginBottom",v),[v,l]=_0();let C=tn(o,"class",3,"axis-x"),D=tn(o,"text",3,!0);const z=le(()=>o.scaleType==="band"),B=le(()=>P(z)?o.scaleFn.bandwidth():0);function V(de){return Array.isArray(de)?de:typeof de=="string"&&P(z)&&o.options.wordwrap!==!1?F4(de,{maxLineWidth:P(B)*.9,minCharactersPerLine:4,fontSize:+gn(o.tickFontSize,{},11),monospace:!1}):[de]}let G=le(()=>o.plot.options.x.tickRotate||0),Q=le(()=>o.anchor==="bottom"?o.marginTop+o.height:o.marginTop),ee=le(()=>o.scaleType!=="point"&&o.scaleType!=="band");const U=Z0(),{autoMarginTop:se,autoMarginBottom:Me,autoMarginLeft:me,autoMarginRight:K}=xi("svelteplot/autoMargins");let ce=jm([]);const oe=le(()=>{let de=L4(o.ticks.map((Re,Ve)=>{const qe={[Or]:Re,[Ai]:Ve};return{...qe,hidden:!1,dx:+gn(o.options.dx,qe,0),dy:+gn(o.options.dy,qe,0),x:o.scaleFn(Re)+(o.scaleType==="band"?o.scaleFn.bandwidth()*.5:0),text:V(o.tickFormat(Re,Ve,o.ticks)),element:null}}));const be=de.length;if(D())for(let Re=0;Re<be;Re++){let Ve=Re;do Ve--;while(Ve>=0&&de[Ve].hidden);if(Ve>=0){const qe=Math.abs(de[Re].x-de[Ve].x);de[Re].hidden=qe<15}}return de});Ir(()=>{pa(()=>h()),pa(()=>p()),h().set(U,5),p().set(U,10)}),Ir(()=>{if(pa(()=>[b(),T()]),!D())return;const de=o.anchor==="top"?"end":"start",be=Math.ceil(Af(P(oe).map((Re,Ve)=>gn(o.options.anchor,Re,de)!==de||Re.hidden||!tc(Re,o.options)?0:ce[Ve]?ce[Ve].getBoundingClientRect().height:0)))+Math.max(0,o.tickPadding+o.tickSize)+(o.title?15:0);isNaN(be)||(o.anchor==="top"&&b().get(U)!==be?b().set(U,be):o.anchor==="bottom"&&T().get(U)!==be&&T().set(U,be))}),Ir(()=>()=>{T().has(U)&&T().delete(U),b().has(U)&&b().delete(U),h().has(U)&&h().delete(U),p().has(U)&&p().delete(U)});var ue=j4();ii(ue,23,()=>P(oe),de=>de[Or],(de,be,Re)=>{var Ve=Yt(),qe=kt(Ve);{var Ye=et=>{const Ie=le(()=>gn(o.tickClass,P(be))),Je=le(()=>+gn(o.tickFontSize,P(be),10));var Qe=V4(),$e=At(Qe);{var at=ct=>{const xt=le(()=>{const[Pt,pt]=ao(o.plot,{datum:P(be)},o.options,"stroke",{x:!0},!0);return{tickLineStyle:Pt,tickLineClass:pt}});var vt=B4();Zt(()=>{Zr(vt,P(xt).tickLineStyle),ir(vt,0,ri(P(xt).tickLineClass),"svelte-1yg4edo"),Ct(vt,"y2",o.anchor==="bottom"?o.tickSize:-o.tickSize)}),Ue(ct,vt)};It($e,ct=>{o.tickSize&&ct(at)})}var zt=$t($e);{var rt=ct=>{const xt=le(()=>P(be).text),vt=le(()=>P(Re)&&P(oe)[P(Re)-1].text),Pt=le(()=>(o.tickSize+o.tickPadding+(P(G)!==0?P(Je)*.35:0))*(o.anchor==="bottom"?1:-1)),pt=le(()=>{const[_t,Rt]=ao(o.plot,{datum:P(be)},{fontVariant:P(ee)?"tabular-nums":"normal",...o.options,textAnchor:o.options.textAnchor==="auto"?P(G)<0?"end":P(G)>0?"start":"middle":o.options.textAnchor,fontSize:P(Je),stroke:null},"fill",{x:!0},!0);return{textStyle:_t,textClass:Rt}});var Et=N4();Ct(Et,"x",0),Ct(Et,"y",0);var Kt=At(Et);{var ot=_t=>{var Rt=Yt(),Ze=kt(Rt);{var Pn=Jt=>{var Ut=gu();Zt(()=>$r(Ut,P(xt)[0])),Ue(Jt,Ut)},Nt=Jt=>{var Ut=Yt(),qt=kt(Ut);ii(qt,17,()=>P(xt),ya,(cn,Pr,Xr)=>{var oi=O4();Ct(oi,"dy",Xr?12:0);var Ar=At(oi,!0);Tt(oi),Zt(()=>$r(Ar,!P(vt)||P(vt)[Xr]!==P(Pr)||o.options.removeDuplicateTicks===!1?P(Pr):"")),Ue(cn,oi)}),Ue(Jt,Ut)};It(Ze,Jt=>{P(xt).length===1?Jt(Pn):Jt(Nt,!1)})}Ue(_t,Rt)};It(Kt,_t=>{(o.ticks.length>0||P(Re)===0||P(Re)===o.ticks.length-1)&&_t(ot)})}Tt(Et),xa(Et,(_t,Rt)=>ce[Rt]=_t,_t=>ce?.[_t],()=>[P(Re)]),Zt(()=>{Ct(Et,"transform",`translate(0, ${P(Pt)??""})  rotate(${P(G)??""})`),Zr(Et,P(pt).textStyle),ir(Et,0,ri(P(pt).textClass),"svelte-1yg4edo"),Ct(Et,"dominant-baseline",P(G)!==0?"central":o.anchor==="bottom"?"hanging":"auto")}),Ue(ct,Et)};It(zt,ct=>{D()&&ct(rt)})}Tt(Qe),Zt(()=>{ir(Qe,0,`tick ${(P(Ie)||"")??""}`),Ct(Qe,"transform",`translate(${P(be).x+P(be).dx}, ${P(Q)+P(be).dy})`),Ct(Qe,"text-anchor",P(G)<0?"end":P(G)>0?"start":"middle")}),Ue(et,Qe)};It(qe,et=>{tc(P(be),o.options)&&!P(be).hidden&&et(Ye)})}Ue(de,Ve)}),Tt(ue),Zt(()=>ir(ue,0,ri(C()))),Ue(n,ue),pn(),l()}const U4={hour:"numeric",minute:"numeric",month:"short",day:"numeric"},q4=n=>{const o=new Intl.DateTimeFormat(n,U4).format;return h=>o(h).replace(", ",`
`)},G4={month:"short",day:"numeric"},$4=n=>{const o=new Intl.DateTimeFormat(n,G4).format;return h=>o(h).replace(" ",`
`)},Z4={month:"short",year:"numeric"},W4=n=>{const o=new Intl.DateTimeFormat(n,Z4).format;return h=>o(h).replace(" ",`
`)};function xS(n,o,h){const p=(J1(n.domain[1])-J1(n.domain[0]))/o/864e5*100,b=p<1?q4(h):p<30?$4(h):W4(h);return T=>b(T).split(`
`)}function J1(n){return Xf(n)?n.getTime():+n}var H4=nn('<text class="axis-x-title svelte-x6donl"> </text>'),X4=nn("<!><!>",1);function Im(n,o){dn(o,!0);let h=vr(o,["$$slots","$$events","$$legacy"]);const p={tickSize:6,tickPadding:3,tickFontSize:11,titleFontSize:11,textAnchor:"auto",opacity:.8,anchor:"bottom",...Di().axis,...Di().axisX},b=le(()=>({...p,...h})),T=le(()=>P(b).ticks),v=le(()=>({data:Array.isArray(P(T))?P(T):[],tickCount:typeof P(T)=="number"?P(T):void 0,interval:typeof P(T)=="string"?P(T):void 0,...p,...h})),l=le(()=>P(v).data),C=le(()=>Ci(P(v).automatic,!1)),D=le(()=>P(v).title),z=le(()=>P(v).anchor),B=le(()=>Ci(P(v).facetAnchor,"auto")),V=le(()=>P(v).interval),G=le(()=>P(v).tickSize),Q=le(()=>P(v).tickFontSize),ee=le(()=>P(v).tickPadding),U=le(()=>P(v).labelAnchor),se=le(()=>P(v).tickFormat),Me=le(()=>P(v).tickClass),me=le(()=>P(v).class),K=le(()=>P(v).tickCount),ce=le(()=>P(v).tickSpacing),oe=le(()=>Ci(P(v).text,!0)),ue=le(()=>Us(P(v),["data","automatic","title","anchor","facetAnchor","interval","tickSize","tickFontSize","tickPadding","labelAnchor","tickFormat","tickClass","class","tickCount","tickSpacing","text"])),de=Zi(),be=le(()=>P(K)!=null?P(K):P(ce)!=null?Math.max(3,Math.round(de.facetWidth/P(ce))):Math.max(3,Math.round(de.facetWidth/de.options.x.tickSpacing))),Re=le(()=>P(l).length>0?Array.from(new Set(P(l))):ig(de.scales.x.type,de.options.x.ticks,P(V)||de.options.x.interval,de.scales.x.domain,de.scales.x.fn,P(be))),Ve=le(()=>{const ot=Os(de.scales.x.domain).filter(Ze=>typeof Ze=="number"&&Number.isFinite(Ze))??[];if(ot[0]===void 0||ot[1]===void 0)return!1;if(ot[0]<=0&&ot[1]>=0)return!0;const Rt=ot.map(Ze=>Ze===0?-1/0:Math.floor(Math.log10(Math.abs(Ze))));return Rt[0]!==Rt[1]}),qe=le(()=>P(se)||de.options.x.tickFormat),Ye=le(()=>typeof P(qe)=="function"?P(qe):de.scales.x.type==="band"||de.scales.x.type==="point"?ot=>ot:de.scales.x.type==="time"?typeof P(qe)=="object"?ot=>Intl.DateTimeFormat(de.options.locale,P(qe)).format(ot):xS(de.scales.x,de.plotWidth,de.options.locale):typeof P(qe)=="object"?ot=>Intl.NumberFormat(de.options.locale,P(qe)).format(ot):ot=>Intl.NumberFormat(de.options.locale,{...P(Ve)?{notation:"compact"}:{},...p.numberFormat,style:de.options.x.percent?"percent":"decimal"}).format(ot)),et=le(()=>de.options?.x?.label),Ie=le(()=>de.scales.x.type),Je=le(()=>P(Ie)!=="point"&&P(Ie)!=="band"),Qe=le(()=>P(D)!==void 0?P(D)||"":P(et)===null?null:P(et)!==void 0?P(et):de.scales.x.autoTitle?P(Je)?de.options.x?.reverse?` ${de.scales.x.autoTitle}${de.options.x.percent?" (%)":""}`:`${de.scales.x.autoTitle}${de.options.x.percent?" (%)":""} `:de.scales.x.autoTitle:""),$e=le(()=>P(U)||de.options?.x?.labelAnchor||"auto"),at=le(()=>P($e)==="auto"?P(Je)?"right":"center":P($e)),{getFacetState:zt}=xi("svelteplot/facet"),rt=le(zt),ct=le(()=>P(rt).left),xt=le(()=>P(rt).top),vt=le(()=>P(rt).bottom),Pt=le(()=>P(rt).bottomEmpty),pt=le(()=>P(rt).topEmpty),Et=le(()=>P(B)!=="auto"?P(B):P(z)==="bottom"?"bottom-empty":"top-empty"),Kt=le(()=>P(Et)==="top"?P(xt):P(Et)==="bottom"?P(vt):P(Et)==="top-empty"?P(pt):P(Pt));{let ot=le(()=>P(l).length?P(l).map(_t=>({__x:_t})):[]);oc(n,Gi({type:"axisX",get data(){return P(ot)},channels:["x"]},()=>P(ue),{x:"__x",get automatic(){return P(C)},children:(_t,Rt)=>{var Ze=X4(),Pn=kt(Ze);{var Nt=qt=>{var cn=H4(),Pr=At(cn,!0);Tt(cn),Zt(Xr=>{Zr(cn,Xr),Ct(cn,"x",de.options.marginLeft+de.plotWidth*(P(at)==="right"?1:P(at)==="center"?.5:0)),Ct(cn,"y",P(z)==="top"?(P(ue).titleFontSize||11)+5:de.height-(P(ue).titleFontSize||11)-5),Ct(cn,"dominant-baseline",P(z)==="top"?"auto":"hanging"),$r(Pr,P(Qe))},[()=>ST(null,{opacity:.8,...P(ue),stroke:null,fontSize:P(ue).titleFontSize||11,textAnchor:P(at)==="right"?"end":P(at)==="center"?"middle":"start"},{},de,"fill")]),Ue(qt,cn)};It(Pn,qt=>{P(ct)&&P(xt)&&P(Qe)&&qt(Nt)})}var Jt=$t(Pn);{var Ut=qt=>{{let cn=le(()=>({...P(ue),...de.options.x}));vS(qt,{get anchor(){return P(z)},get className(){return P(me)},get labelAnchor(){return P(U)},get options(){return P(cn)},get plot(){return de},get text(){return P(oe)},get tickClass(){return P(Me)},get tickFontSize(){return P(Q)},get tickPadding(){return P(ee)},get ticks(){return P(Re)},get tickSize(){return P(G)},get height(){return de.facetHeight},get marginTop(){return de.options.marginTop},get scaleFn(){return de.scales.x.fn},get scaleType(){return de.scales.x.type},get tickFormat(){return P(Ye)},get title(){return P(Qe)}})}};It(Jt,qt=>{P(Kt)&&qt(Ut)})}Ue(_t,Ze)},$$slots:{default:!0}}))}pn()}var Y4=nn("<line></line>"),K4=nn("<text> </text>"),J4=nn("<g><!><!></g>"),Q4=nn("<g></g>");function bS(n,o){dn(o,!0);const h=()=>Ra(Q,"$autoMarginLeft",T),p=()=>Ra(ee,"$autoMarginRight",T),b=()=>Ra(U,"$autoMarginTop",T),[T,v]=_0();let l=tn(o,"text",3,!0),C=tn(o,"class",3,"axis-y");const D={top:"hanging",center:"middle",bottom:"auto"},z=le(()=>{let Me=o.ticks.map((me,K)=>{const ce={[Or]:me,[Ai]:K};return{...ce,hidden:!1,dx:+gn(o.options.dx,ce,0),dy:+gn(o.options.dy,ce,0),y:o.scaleFn(me)+(o.scaleType==="band"?o.scaleFn.bandwidth()*.5:0),text:o.tickFormat(me,K,o.ticks),element:null}});if(l()){const me=Me.length;for(let K=0;K<me;K++){let ce=K;do ce--;while(ce>=0&&Me[ce].hidden);if(ce>=0){const oe=Math.abs(Me[K].y-Me[ce].y);Me[K].hidden=oe<15}}}return Me});let B=jm([]);const V=le(()=>o.scaleType!=="point"&&o.scaleType!=="band"),G=Z0(),{autoMarginLeft:Q,autoMarginRight:ee,autoMarginTop:U}=xi("svelteplot/autoMargins");Ir(()=>{pa(()=>[h(),p()]);const Me=o.anchor==="left"?"end":"start",me=Math.ceil(Af(P(z).map((K,ce)=>gn(o.options.textAnchor,K,Me)!==Me||K.hidden||!tc(K,o.options)?0:B[ce]?B[ce].getBoundingClientRect().width:0)))+Math.max(0,o.tickPadding+o.tickSize);isNaN(me)||(o.anchor==="left"&&h().get(G)!==me?h().set(G,me):o.anchor==="right"&&p().get(G)!==me&&p().set(G,me))}),Ir(()=>{pa(()=>[b()]),o.title?b().set(G,27):b().delete(G)}),Ir(()=>()=>{h().has(G)&&h().delete(G),p().has(G)&&p().delete(G),b().has(G)&&b().delete(G)});var se=Q4();ii(se,23,()=>P(z),Me=>Me[Or],(Me,me,K)=>{var ce=Yt(),oe=kt(ce);{var ue=de=>{const be=le(()=>gn(o.tickClass,P(me))),Re=le(()=>{const[Je,Qe]=ao(o.plot,{datum:P(me)},{fontVariant:P(V)?"tabular-nums":"normal",...o.options,fontSize:o.tickFontSize,stroke:null},"fill",{y:!0},!0);return{textStyle:Je,textClass:Qe}});var Ve=J4(),qe=At(Ve);{var Ye=Je=>{const Qe=le(()=>{const[at,zt]=ao(o.plot,{datum:P(me)},o.options,"stroke",{y:!0},!0);return{tickLineStyle:at,tickLineClass:zt}});var $e=Y4();Zt(()=>{Zr($e,P(Qe).tickLineStyle),ir($e,0,ri(P(Qe).tickLineClass),"svelte-inyq83"),Ct($e,"x2",o.anchor==="left"?-o.tickSize:o.tickSize)}),Ue(Je,$e)};It(qe,Je=>{o.tickSize&&Je(Ye)})}var et=$t(qe);{var Ie=Je=>{var Qe=K4(),$e=At(Qe,!0);Tt(Qe),xa(Qe,(at,zt)=>B[zt]=at,at=>B?.[at],()=>[P(K)]),Zt(at=>{ir(Qe,0,ri([P(Re).textClass,{"is-left":o.anchor==="left"}]),"svelte-inyq83"),Zr(Qe,P(Re).textStyle),Ct(Qe,"x",(o.tickSize+o.tickPadding)*(o.anchor==="left"?-1:1)),Ct(Qe,"dominant-baseline",D[o.lineAnchor]),$r($e,at)},[()=>Array.isArray(P(me).text)?P(me).text.join(" "):P(me).text]),Ue(Je,Qe)};It(et,Je=>{l()&&Je(Ie)})}Tt(Ve),Zt(()=>{ir(Ve,0,`tick ${(P(be)||"")??""}`),Ct(Ve,"transform",`translate(${P(me).dx+o.marginLeft+(o.anchor==="left"?0:o.width)},${P(me).y+P(me).dy})`)}),Ue(de,Ve)};It(oe,de=>{tc(P(me),o.options)&&!P(me).hidden&&de(ue)})}Ue(Me,ce)}),Tt(se),Zt(()=>ir(se,0,ri(C()))),Ue(n,se),pn(),v()}var e6=nn('<text class="axis-y-title svelte-lok93m" dominant-baseline="hanging"> </text>'),t6=nn("<!><!>",1);function Q1(n,o){dn(o,!0);let h=vr(o,["$$slots","$$events","$$legacy"]);const p={tickSize:6,tickPadding:3,tickFontSize:11,opacity:.8,anchor:"left",textAnchor:"auto",...Di().axis,...Di().axisY},b=le(()=>({...p,...h})),T=le(()=>P(b).ticks),v=le(()=>({data:Array.isArray(P(T))?P(T):[],tickCount:typeof P(T)=="number"?P(T):void 0,interval:typeof P(T)=="string"?P(T):void 0,...p,...h})),l=le(()=>P(v).data),C=le(()=>Ci(P(v).automatic,!1)),D=le(()=>P(v).title),z=le(()=>Ci(P(v).anchor,"left")),B=le(()=>P(v).class),V=le(()=>Ci(P(v).facetAnchor,"auto")),G=le(()=>P(v).interval),Q=le(()=>Ci(P(v).lineAnchor,"center")),ee=le(()=>P(v).textAnchor),U=le(()=>P(v).tickSize),se=le(()=>P(v).tickFontSize),Me=le(()=>P(v).tickPadding),me=le(()=>P(v).tickFormat),K=le(()=>P(v).tickClass),ce=le(()=>P(v).tickCount),oe=le(()=>P(v).tickSpacing),ue=le(()=>Ci(P(v).text,!0)),de=le(()=>Us(P(v),["data","automatic","title","anchor","class","facetAnchor","interval","lineAnchor","textAnchor","tickSize","tickFontSize","tickPadding","tickFormat","tickClass","tickCount","tickSpacing","text"])),be=Zi(),Re=le(()=>P(ce)!=null?P(ce):P(oe)!=null?Math.max(3,Math.round(be.facetHeight/P(oe))):Math.max(2,Math.round(be.facetHeight/be.options.y.tickSpacing))),Ve=le(()=>P(l).length>0?P(l):ig(be.scales.y.type,be.options.y.ticks,P(G)||be.options.y.interval,be.scales.y.domain,be.scales.y.fn,P(Re))),qe=le(()=>{const pt=Os(be.scales.y.domain).filter(ot=>typeof ot=="number"&&Number.isFinite(ot))??[];if(pt[0]===void 0||pt[1]===void 0)return!1;if(pt[0]<=0&&pt[1]>=0)return!0;const Kt=pt.map(ot=>ot===0?-1/0:Math.floor(Math.log10(Math.abs(ot))));return Kt[0]!==Kt[1]}),Ye=le(()=>P(me)||be.options.y.tickFormat),et=le(()=>typeof P(Ye)=="function"?P(Ye):be.scales.y.type==="band"||be.scales.y.type==="point"?pt=>pt:be.scales.y.type==="time"?typeof P(Ye)=="object"?pt=>Intl.DateTimeFormat(be.options.locale,P(Ye)).format(pt):xS(be.scales.y,be.plotWidth,be.options.locale):typeof P(Ye)=="object"?pt=>Intl.NumberFormat(be.options.locale,P(Ye)).format(pt):pt=>Intl.NumberFormat(be.options.locale,{...P(qe)?{notation:"compact"}:{},...p.numberFormat,style:be.options.y.percent?"percent":"decimal"}).format(pt)),Ie=le(()=>be.options.y.label),Je=le(()=>P(D)!==void 0?P(D)||"":P(Ie)===null?null:P(Ie)!==void 0?P(Ie):be.scales.y.autoTitle?`${be.options.y.reverse?"":""} ${be.scales.y.autoTitle}${be.options.y.percent?" (%)":""}`:""),{getFacetState:Qe}=xi("svelteplot/facet"),$e=le(Qe),at=le(()=>P($e).left),zt=le(()=>P($e).leftEmpty),rt=le(()=>P($e).right),ct=le(()=>P($e).rightEmpty),xt=le(()=>P($e).top),vt=le(()=>P(V)!=="auto"?P(V):P(z)==="left"?"left-empty":"right-empty"),Pt=le(()=>P(vt)==="left"?P(at):P(vt)==="right"?P(rt):P(vt)==="left-empty"?P(zt):P(ct));{let pt=le(()=>P(l).length?P(l).map(Kt=>({__y:Kt})):[]),Et=le(()=>({...P(de),y:"__y"}));oc(n,Gi({type:"axisY",get data(){return P(pt)},channels:["y"]},()=>P(Et),{get automatic(){return P(C)},children:(Kt,ot)=>{var _t=t6(),Rt=kt(_t);{var Ze=Jt=>{var Ut=e6();Ct(Ut,"y",5);var qt=At(Ut,!0);Tt(Ut),Zt(cn=>{Zr(Ut,cn),Ct(Ut,"x",P(z)==="left"?0:be.width),$r(qt,P(Je))},[()=>ST(null,{opacity:.8,...P(de),fontSize:P(de).titleFontSize??11,fill:"currentColor",stroke:null,textAnchor:P(z)==="left"?"start":"end"},{},be,"fill")]),Ue(Jt,Ut)};It(Rt,Jt=>{P(at)&&P(xt)&&P(Je)&&Jt(Ze)})}var Pn=$t(Rt);{var Nt=Jt=>{{let Ut=le(()=>({...P(de),textAnchor:P(ee)==null||P(ee)==="auto"?P(z)==="left"?"end":"start":P(ee)}));bS(Jt,{get anchor(){return P(z)},get className(){return P(B)},get lineAnchor(){return P(Q)},get options(){return P(Ut)},get plot(){return be},get text(){return P(ue)},get tickClass(){return P(K)},get tickFontSize(){return P(se)},get tickPadding(){return P(Me)},get ticks(){return P(Ve)},get tickSize(){return P(U)},get marginLeft(){return be.options.marginLeft},get scaleFn(){return be.scales.y.fn},get scaleType(){return be.scales.y.type},get tickFormat(){return P(et)},get title(){return P(Je)},get width(){return be.facetWidth}})}};It(Pn,Jt=>{P(Pt)&&Jt(Nt)})}Ue(Kt,_t)},$$slots:{default:!0}}))}pn()}function n6(n,o,h,p,b={topLeft:0,topRight:0,bottomLeft:0,bottomRight:0}){const T=Math.min(h,p)/2,[v,l,C,D]=(typeof b=="number"?new Array(4).fill(b):[b?.topLeft||0,b?.topRight||0,b?.bottomLeft||0,b?.bottomRight||0]).map(z=>Math.min(z,T));return`
    M ${n+v} ${o}
    H ${n+h-l}
    ${l?`A ${l} ${l} 0 0 1 ${n+h} ${o+l}`:""}
    V ${o+p-D}
    ${D?`A ${D} ${D} 0 0 1 ${n+h-D} ${o+p}`:""}
    H ${n+C}
    ${C?`A ${C} ${C} 0 0 1 ${n} ${o+p-C}`:""}
    V ${o+v}
    ${v?`A ${v} ${v} 0 0 1 ${n+v} ${o}`:""}
    Z
  `}function Am({options:n,datum:o,plot:h}){const p=gS(n,["onclick","oncontextmenu","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onpointercancel","onpointerdown","onpointerenter","onpointerleave","onpointermove","onpointerout","onpointerover","onpointerup","ontouchcancel","ontouchend","ontouchmove","onwheel"]);return b=>{const T=new Map;for(const[v,l]of Object.entries(p))if(l){const C=D=>{const{scales:z,body:B,options:V}=h;if(D instanceof MouseEvent||D instanceof PointerEvent){let G=D.target;for(;G&&!G.classList.contains("facet")&&G.parentElement&&G.parentElement instanceof SVGElement;)G=G.parentElement;const Q=(G?.firstElementChild??B).getBoundingClientRect(),ee=D.clientX-Q.left+(V.marginLeft??0),U=D.clientY-Q.top+(V.marginTop??0);if(z.projection){const[se,Me]=z.projection.invert([ee,U]);D.dataX=se,D.dataY=Me}else D.dataX=ew(z.x,ee),D.dataY=ew(z.y,U)}l(D,o.hasOwnProperty(Or)?o[Or]:o,o[Ai])};T.set(v,C),b.addEventListener(v.substring(2),C)}return(p.onclick||p.onmousedown||p.onmouseup)&&b.setAttribute("role","button"),()=>{for(const[v,l]of T.entries())b.removeEventListener(v.substring(2),l)}}}function ew(n,o){if(n.type==="band"){const h=n.fn.range(),p=n.fn.domain(),b=n.fn.step(),T=h[1]-h[0],v=(o-h[0])*Math.sign(T),l=Math.floor(v/b);return p[l]}return n.fn.invert?n.fn.invert(o):void 0}function r6(n,o){dn(o,!0);let h=tn(o,"datum",19,()=>({})),p=tn(o,"options",19,()=>({}));const b=le(()=>gn(p().href,h(),null)),T=le(()=>gn(p().target,h(),null)),v=le(()=>gn(p().rel,h(),null)),l=le(()=>gn(p().type,h(),null)),C=le(()=>gn(p().download,h(),null)),D=le(()=>Object.fromEntries(Object.entries(p()).filter(([Q])=>Q.startsWith("data-sveltekit-"))));var z=Yt(),B=kt(z);{var V=Q=>{var ee=Yt(),U=kt(ee);Nw(U,()=>"a",!0,(se,Me)=>{La(se,()=>({href:P(b),target:P(T),rel:P(v),type:P(l),download:P(C),...P(D),"aria-label":"link",xmlns:"http://www.w3.org/2000/svg"}));var me=Yt(),K=kt(me);Dn(K,()=>o.children??Qn),Ue(Me,me)}),Ue(Q,ee)},G=Q=>{var ee=Yt(),U=kt(ee);Dn(U,()=>o.children??Qn),Ue(Q,ee)};It(B,Q=>{P(b)?Q(V):Q(G,!1)})}Ue(n,z),pn()}var i6=nn("<path></path>"),a6=nn("<rect></rect>");function wS(n,o){dn(o,!0);let h=tn(o,"class",3,null),p=tn(o,"useInsetAsFallbackVertically",3,!0),b=tn(o,"useInsetAsFallbackHorizontally",3,!0);const T=Zi(),v=le(()=>+gn(o.options.inset,o.datum?.datum,0)),l=le(()=>+gn(o.options.insetLeft,o.datum?.datum,b()?P(v):0)),C=le(()=>+gn(o.options.insetRight,o.datum?.datum,b()?P(v):0)),D=le(()=>+gn(o.options.insetTop,o.datum?.datum,p()?P(v):0)),z=le(()=>+gn(o.options.insetBottom,o.datum?.datum,p()?P(v):0)),B=le(()=>gn(o.options.borderRadius,o.datum?.datum,0)),V=le(()=>typeof P(B)=="number"&&P(B)>0||typeof P(B)=="object"&&Math.max(P(B).topRight??0,P(B).bottomRight??0,P(B).topLeft??0,P(B).bottomLeft??0)>0),G=le(()=>ao(T,o.datum,o.options,o.fallbackStyle?o.fallbackStyle:o.options.stroke&&!o.options.fill?"stroke":"fill",o.usedScales)),Q=le(()=>g0(P(G),2)),ee=le(()=>P(Q)[0]),U=le(()=>P(Q)[1]);{let se=le(()=>o.datum?.datum);r6(n,{get options(){return o.options},get datum(){return P(se)},children:(Me,me)=>{var K=Yt(),ce=kt(K);{var oe=de=>{var be=i6();Cf(be,()=>Am({plot:T,options:o.options,datum:o.datum?.datum})),Zt(Re=>{Ct(be,"transform",`translate(${o.x+P(l)},${o.y+P(z)})`),Ct(be,"d",Re),ir(be,0,ri([P(U),h()])),Zr(be,P(ee))},[()=>n6(0,0,o.width-P(l)-P(C),o.height-P(D)-P(z),P(B))]),Ue(de,be)},ue=de=>{var be=a6();Cf(be,()=>Am({plot:T,options:o.options,datum:o.datum?.datum})),Zt(()=>{Ct(be,"transform",`translate(${o.x+P(l)},${o.y+P(z)})`),Ct(be,"width",o.width-P(l)-P(C)),Ct(be,"height",o.height-P(D)-P(z)),ir(be,0,ri([P(U),h()])),Zr(be,P(ee))}),Ue(de,be)};It(ce,de=>{P(V)?de(oe):de(ue,!1)})}Ue(Me,K)},$$slots:{default:!0}})}pn()}function e0(n,o){dn(o,!0);let h=vr(o,["$$slots","$$events","$$legacy"]);const p={fill:void 0,class:"frame",stroke:void 0,fillOpacity:1,strokeOpacity:1,...Di().frame},b=le(()=>({...p,...h})),T=le(()=>P(b).automatic),v=le(()=>P(b).class),l=le(()=>P(b).fill),C=le(()=>P(b).stroke),D=le(()=>P(b).opacity),z=le(()=>P(b).fillOpacity),B=le(()=>P(b).strokeOpacity),V=le(()=>Us(P(b),["automatic","class","fill","stroke","opacity","fillOpacity","strokeOpacity"])),G=le(()=>gn(P(V).dx,null,0)||0),Q=le(()=>gn(P(V).dy,null,0)||0),ee=Zi();oc(n,{type:"frame",get automatic(){return P(T)},children:(se,Me)=>{let me=()=>Me?.().usedScales;{let K=le(()=>({fill:P(l),stroke:P(C),fillOpacity:P(z),strokeOpacity:P(B),opacity:P(D),datum:{},valid:!0})),ce=le(()=>ee.options.marginLeft+P(G)),oe=le(()=>ee.options.marginTop+P(Q)),ue=le(()=>P(l)==null||P(l)==="none"?"stroke":"fill"),de=le(()=>({...P(V),fill:P(l),stroke:P(C),fillOpacity:P(z),opacity:P(D),strokeOpacity:P(B)}));wS(se,{get class(){return P(v)},get datum(){return P(K)},get x(){return P(ce)},get y(){return P(oe)},get width(){return ee.facetWidth},get height(){return ee.facetHeight},get usedScales(){return me()},get fallbackStyle(){return P(ue)},get options(){return P(de)}})}},$$slots:{default:!0}}),pn()}var o6=Wt('<div class="title svelte-1269hcs"><!></div>'),s6=nn('<path transform="translate(7.5,7.5)" class="svelte-1269hcs"></path>'),l6=nn('<rect width="15" height="15"></rect>'),c6=Wt('<div class="item svelte-1269hcs"><div class="swatch svelte-1269hcs"><svg width="15" height="15"><!></svg></div> <span class="item-label svelte-1269hcs"> </span></div>'),u6=nn("<stop></stop><stop></stop>",1),h6=nn('<defs><linearGradient x2="1"><stop offset="0%"></stop><!><stop offset="100%"></stop></linearGradient></defs><!><!>',1),f6=nn("<stop></stop>"),d6=nn('<defs><linearGradient x2="1"></linearGradient></defs><!><!>',1),p6=Wt("<div><!> <!></div>");function m6(n,o){dn(o,!0);let h=tn(o,"class",3,null);const p=Zi(),b=Di(),T=le(()=>p.options.color.label),v=le(()=>p.scales.color.type),l=le(()=>typeof p.options.color?.tickFormat=="function"?p.options.color.tickFormat:Intl.NumberFormat(p.options.locale,p.options.color.tickFormat||{...b.numberFormat,notation:"compact"}).format),C=Math.round(Math.random()*1e6).toFixed(32);var D=Yt(),z=kt(D);{var B=V=>{var G=p6(),Q=At(G);{var ee=me=>{var K=o6(),ce=At(K);sI(ce,()=>P(T)),Tt(K),Ue(me,K)};It(Q,me=>{P(T)&&me(ee)})}var U=$t(Q,2);{var se=me=>{var K=Yt(),ce=kt(K);ii(ce,16,()=>p.scales.color.domain,oe=>oe,(oe,ue)=>{const de=le(()=>p.scales.symbol.fn(ue)),be=le(()=>vT(P(de)));var Re=c6(),Ve=At(Re),qe=At(Ve),Ye=At(qe);{var et=$e=>{var at=s6();let zt;Zt((rt,ct)=>{Ct(at,"d",rt),zt=Zr(at,"",zt,ct)},[()=>oT(P(be),40)(),()=>({fill:p.hasFilledDotMarks?p.scales.color.fn(ue):"none",stroke:p.hasFilledDotMarks?null:p.scales.color.fn(ue)})]),Ue($e,at)},Ie=$e=>{var at=l6();let zt;Zt(rt=>zt=Zr(at,"",zt,rt),[()=>({fill:p.scales.color.fn(ue)})]),Ue($e,at)};It(Ye,$e=>{p.colorSymbolRedundant?$e(et):$e(Ie,!1)})}Tt(qe),Tt(Ve);var Je=$t(Ve,2),Qe=At(Je,!0);Tt(Je),Tt(Re),Zt(()=>$r(Qe,ue)),Ue(oe,Re)}),Ue(me,K)},Me=me=>{var K=Yt(),ce=kt(K);{var oe=de=>{const be=le(()=>Os(p.scales.color.fn.domain())),Re=le(()=>p.scales.color.range),Ve=le(()=>P(v)==="quantile"?p.scales.color.fn.quantiles():P(v)==="quantize"?p.scales.color.fn.thresholds():p.scales.color.fn.domain()),qe=le(()=>Bs(P(be)[0],P(be)[1],(P(be)[1]-P(be)[0])/P(Re).length).slice(1));{let Ye=le(()=>({domain:P(be),ticks:P(qe)}));Rm(de,{maxWidth:"240px",margin:1,marginLeft:1,marginRight:1,marginTop:6,marginBottom:20,height:38,inset:0,get x(){return P(Ye)},children:(et,Ie)=>{var Je=h6(),Qe=kt(Je),$e=At(Qe),at=At($e),zt=$t(at);ii(zt,17,()=>P(qe),ya,(vt,Pt,pt)=>{const Et=le(()=>100*(P(Pt)-P(be)[0])/(P(be)[1]-P(be)[0]));var Kt=u6(),ot=kt(Kt),_t=$t(ot);Zt((Rt,Ze)=>{Ct(ot,"offset",`${P(Et)-.001}%`),Ct(ot,"stop-color",Rt),Ct(_t,"offset",`${P(Et)??""}%`),Ct(_t,"stop-color",Ze)},[()=>p.scales.color.fn(P(Ve)[pt]-.1),()=>p.scales.color.fn(P(Ve)[pt])]),Ue(vt,Kt)});var rt=$t(zt);Tt($e),Tt(Qe);var ct=$t(Qe);e0(ct,{dy:-5,stroke:null,get fill(){return`url(#gradient-${C??""})`}});var xt=$t(ct);Im(xt,{tickSize:18,dy:-17,tickFormat:(vt,Pt)=>P(l)(P(Ve)[Pt])}),Zt(vt=>{Ct($e,"id",`gradient-${C??""}`),Ct(at,"stop-color",P(Re)[0]),Ct(rt,"stop-color",vt)},[()=>P(Re).at(-1)]),Ue(et,Je)},$$slots:{default:!0}})}},ue=de=>{const be=le(()=>Os(p.scales.color.domain)),Re=le(()=>Bs(P(be)[0],P(be)[1],(P(be)[1]-P(be)[0])/7).slice(1));{let Ve=le(()=>({domain:P(be),tickSpacing:30,tickFormat:P(l)}));Rm(de,{maxWidth:"240px",margin:1,marginLeft:10,marginRight:10,marginTop:6,marginBottom:20,height:38,inset:0,get x(){return P(Ve)},children:(qe,Ye)=>{var et=d6(),Ie=kt(et),Je=At(Ie);ii(Je,20,()=>P(Re),at=>at,(at,zt)=>{var rt=f6();Zt(ct=>{Ct(rt,"offset",`${100*(zt-P(be)[0])/(P(be)[1]-P(be)[0])}%`),Ct(rt,"stop-color",ct)},[()=>p.scales.color.fn(zt)]),Ue(at,rt)}),Tt(Je),Tt(Ie);var Qe=$t(Ie);e0(Qe,{dy:-5,stroke:null,get fill(){return`url(#gradient-${C??""})`}});var $e=$t(Qe);Im($e,{tickSize:18,dy:-17}),Zt(()=>Ct(Je,"id",`gradient-${C??""}`)),Ue(qe,et)},$$slots:{default:!0}})}};It(ce,de=>{P(v)==="quantile"||P(v)==="quantize"||P(v)==="threshold"?de(oe):de(ue,!1)},!0)}Ue(me,K)};It(U,me=>{P(v)==="ordinal"||P(v)==="categorical"?me(se):me(Me,!1)})}Tt(G),Zt(()=>ir(G,1,`color-legend ${(h()||"")??""}`,"svelte-1269hcs")),Ue(V,G)};It(z,V=>{p.scales.color.manualActiveMarks>0&&V(B)})}Ue(n,D),pn()}var g6=nn("<line></line>"),_6=nn('<g class="grid-x"></g>');function y6(n,o){dn(o,!0);let h=vr(o,["$$slots","$$events","$$legacy"]);const p={...Di().grid,...Di().gridX},b=le(()=>({...p,...h})),T=le(()=>Ci(P(b).data,()=>[],!0)),v=le(()=>Ci(P(b).automatic,!1)),l=le(()=>Us(P(b),["data","automatic"])),C=Zi(),D=le(()=>Math.max(3,Math.round(C.facetWidth/C.options.x.tickSpacing))),z=le(()=>(P(T).length>0?P(T):ig(C.scales.x.type,C.options.x.ticks,C.options.x.interval,C.scales.x.domain,C.scales.x.fn,P(D))).map((B,V)=>Vs(B)?{...B,[Ai]:V}:{[Or]:B,[Ai]:V}));{const B=(Q,ee)=>{let U=()=>ee?.().usedScales;var se=_6();ii(se,21,()=>P(z),ya,(Me,me)=>{var K=Yt(),ce=kt(K);{var oe=ue=>{const de=le(()=>C.scales.x.fn(P(me)[Or])+(C.scales.x.type==="band"?C.scales.x.fn.bandwidth()*.5:0)),be=le(()=>ki("y1",P(me),P(l))),Re=le(()=>ki("y2",P(me),P(l))),Ve=le(()=>+gn(P(l)?.dx,P(me),0)),qe=le(()=>+gn(P(l)?.dy,P(me),0)),Ye=le(()=>P(l).y1!=null?C.scales.y.fn(P(be)):C.options.marginTop),et=le(()=>P(l).y2!=null?C.scales.y.fn(P(Re)):C.options.marginTop+C.facetHeight),Ie=le(()=>{const[Qe,$e]=ao(C,{datum:P(me)},P(l),"stroke",U(),!0);return{style:Qe,styleClass:$e}});var Je=g6();Zt(()=>{ir(Je,0,ri(P(Ie).styleClass),"svelte-75g6py"),Ct(Je,"transform",`translate(${P(de)+P(Ve)},${P(qe)??""})`),Zr(Je,P(Ie).style),Ct(Je,"y1",P(Ye)),Ct(Je,"y2",P(et))}),Ue(ue,Je)};It(ce,ue=>{tc(P(me),P(l))&&ue(oe)})}Ue(Me,K)}),Tt(se),Ue(Q,se)};let V=le(()=>P(T).length?P(T).map(Q=>({[Or]:Q})):[]),G=le(()=>({...P(l),x:Or}));oc(n,Gi({type:"gridX",get data(){return P(V)},channels:["y1","y2","x","stroke","strokeOpacity"]},()=>P(G),{get automatic(){return P(v)},children:B,$$slots:{default:!0}}))}pn()}var v6=nn("<line></line>"),x6=nn('<g class="grid-y"></g>');function b6(n,o){dn(o,!0);let h=vr(o,["$$slots","$$events","$$legacy"]);const p={...Di().grid,...Di().gridY},b=le(()=>({...p,...h})),T=le(()=>Ci(P(b).data,()=>[],!0)),v=le(()=>Ci(P(b).automatic,!1)),l=le(()=>Us(P(b),["data","automatic"])),C=Zi(),D=le(()=>Math.max(2,Math.round(C.facetHeight/C.options.y.tickSpacing))),z=le(()=>P(T).length>0?P(T):ig(C.scales.y.type,C.options.y.ticks,C.options.y.interval,C.scales.y.domain,C.scales.y.fn,P(D)));{const B=(Q,ee)=>{let U=()=>ee?.().usedScales;var se=x6();ii(se,21,()=>P(z),ya,(Me,me)=>{var K=Yt(),ce=kt(K);{var oe=ue=>{const de=le(()=>C.scales.y.fn(P(me))+(C.scales.y.type==="band"?C.scales.y.fn.bandwidth()*.5:0)),be=le(()=>ki("x1",P(me),P(l))),Re=le(()=>ki("x2",P(me),P(l))),Ve=le(()=>P(l).x1!=null?C.scales.x.fn(P(be)):C.options.marginLeft),qe=le(()=>P(l).x2!=null?C.scales.x.fn(P(Re)):C.options.marginLeft+C.facetWidth),Ye=le(()=>+gn(P(l)?.dx,P(me),0)),et=le(()=>+gn(P(l)?.dy,P(me),0)),Ie=le(()=>{const[Qe,$e]=ao(C,{datum:{[Or]:P(me)}},P(l),"stroke",U(),!0);return{style:Qe,styleClass:$e}});var Je=v6();Zt(()=>{Zr(Je,P(Ie).style),ir(Je,0,ri(P(Ie).styleClass),"svelte-ykw1ch"),Ct(Je,"transform",`translate(${P(Ye)??""},${P(de)+P(et)})`),Ct(Je,"x1",P(Ve)),Ct(Je,"x2",P(qe))}),Ue(ue,Je)};It(ce,ue=>{tc(P(me),P(l))&&ue(oe)})}Ue(Me,K)}),Tt(se),Ue(Q,se)};let V=le(()=>P(T).length?P(T).map(Q=>({[Or]:Q})):[]),G=le(()=>({...P(l),y:Or}));oc(n,Gi({type:"gridY",get data(){return P(V)},channels:["x1","x2","y","stroke","strokeOpacity"]},()=>P(G),{get automatic(){return P(v)},children:B,$$slots:{default:!0}}))}pn()}var w6=Wt('<div class="item svelte-1vze4d"><div class="swatch svelte-1vze4d"><svg width="15" height="15"><path transform="translate(7.5,7.5)" class="svelte-1vze4d"></path></svg></div> <span class="item-label svelte-1vze4d"> </span></div>'),T6=Wt('<div class="symbol-legend svelte-1vze4d"></div>');function S6(n,o){dn(o,!0);const h=Zi();var p=Yt(),b=kt(p);{var T=v=>{var l=T6();ii(l,20,()=>h.scales.color.domain,C=>C,(C,D)=>{const z=le(()=>h.scales.symbol.fn(D)),B=le(()=>vT(P(z))),V=le(()=>h.colorSymbolRedundant?h.scales.color.fn(D):"currentColor");var G=w6(),Q=At(G),ee=At(Q),U=At(ee);let se;Tt(ee),Tt(Q);var Me=$t(Q,2),me=At(Me,!0);Tt(Me),Tt(G),Zt(K=>{Ct(U,"d",K),se=Zr(U,"",se,{fill:h.hasFilledDotMarks?P(V):"none",stroke:h.hasFilledDotMarks?null:P(V)}),$r(me,D)},[()=>oT(P(B),40)()]),Ue(C,G)}),Tt(l),Ue(v,l)};It(b,v=>{h.scales.color.manualActiveMarks>0&&v(T)})}Ue(n,p),pn()}var M6=nn("<g><!></g>"),P6=nn("<g><!></g>"),E6=nn("<!><!>",1);function C6(n,o){dn(o,!0);const{getPlotState:h}=xi("svelteplot"),p=le(h),b=le(()=>P(p).scales.fx.domain.length>0),T=le(()=>P(p).scales.fy.domain.length>0),v=le(()=>P(b)?P(p).scales.fx.domain:[!0]),l=le(()=>P(T)?P(p).scales.fy.domain:[!0]),C=le(()=>Kl().paddingInner(P(p).options.fx?.paddingInner??P(p).options.fx?.padding??.1).domain(P(v)).rangeRound([0,P(p).plotWidth])),D=le(()=>Kl().paddingInner(P(p).options.fy?.paddingInner??P(p).options.fy?.padding??.1).domain(P(l)).rangeRound([0,P(p).plotHeight]));var z=E6(),B=kt(z);{var V=ee=>{var U=M6(),se=At(U);{let Me=le(()=>P(p).options.fx.tickFormat||(ce=>ce)),me=le(()=>P(p).options.x.axis===P(p).options.fx.axis||P(p).options.x.axis==="both"?25:5),K=le(()=>P(p).options.fx.axisOptions||{});vS(se,Gi({class:"facet-axis-x",get scaleFn(){return P(C)},scaleType:"band",get ticks(){return P(v)},get tickFormat(){return P(Me)},tickFontSize:11,tickSize:0,get tickPadding(){return P(me)},get anchor(){return P(p).options.fx.axis},get options(){return P(K)}},()=>P(p).options.fx.axisProps||{},{get height(){return P(p).plotHeight},get marginTop(){return P(p).options.marginTop},get plot(){return P(p)}}))}Tt(U),Zt(()=>Ct(U,"transform",`translate(${P(p).options.marginLeft??""}, 0)`)),Ue(ee,U)};It(B,ee=>{P(v).length>1&&P(p).options.fx.axis&&ee(V)})}var G=$t(B);{var Q=ee=>{var U=P6(),se=At(U);{let Me=le(()=>P(p).options.fy.tickFormat||(K=>K)),me=le(()=>P(p).options.fy.axisOptions||{});bS(se,Gi({class:"facet-axis-y",get scaleFn(){return P(D)},scaleType:"band",get ticks(){return P(l)},get tickFormat(){return P(Me)},tickFontSize:11,tickSize:0,tickPadding:5,get anchor(){return P(p).options.fy.axis},lineAnchor:"center",get options(){return P(me)}},()=>P(p).options.fy.axisProps||{},{get width(){return P(p).plotWidth},get marginLeft(){return P(p).options.marginLeft},get plot(){return P(p)}}))}Tt(U),Zt(()=>Ct(U,"transform",`translate(0, ${P(p).options.marginTop??""})`)),Ue(ee,U)};It(G,ee=>{P(l).length>1&&P(p).options.fy.axis&&ee(Q)})}Ue(n,z),pn()}function _n(n){for(var o=n.length/6|0,h=new Array(o),p=0;p<o;)h[p]="#"+n.slice(p*6,++p*6);return h}const I6=_n("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),A6=_n("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),k6=_n("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),D6=_n("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),z6=_n("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),R6=_n("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),L6=_n("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),F6=_n("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),B6=_n("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),O6=_n("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),er=n=>b3(n[n.length-1]);var TS=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(_n);const SS=er(TS);var MS=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(_n);const PS=er(MS);var ES=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(_n);const CS=er(ES);var IS=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(_n);const AS=er(IS);var t0=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(_n);const km=er(t0);var kS=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(_n);const DS=er(kS);var n0=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(_n);const Dm=er(n0);var zS=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(_n);const RS=er(zS);var LS=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(_n);const FS=er(LS);var BS=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(_n);const OS=er(BS);var NS=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(_n);const VS=er(NS);var jS=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(_n);const US=er(jS);var qS=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(_n);const GS=er(qS);var $S=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(_n);const ZS=er($S);var WS=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(_n);const HS=er(WS);var XS=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(_n);const YS=er(XS);var KS=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(_n);const JS=er(KS);var QS=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(_n);const eM=er(QS);var tM=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(_n);const nM=er(tM);var rM=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(_n);const iM=er(rM);var aM=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(_n);const oM=er(aM);var sM=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(_n);const lM=er(sM);var cM=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(_n);const uM=er(cM);var r0=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(_n);const zm=er(r0);var hM=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(_n);const fM=er(hM);var dM=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(_n);const pM=er(dM);var mM=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(_n);const gM=er(mM);function _M(n){return n=Math.max(0,Math.min(1,n)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-n*(35.34-n*(2381.73-n*(6402.7-n*(7024.72-n*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+n*(170.73+n*(52.82-n*(131.46-n*(176.58-n*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+n*(442.36-n*(2482.43-n*(6167.24-n*(6614.94-n*2475.67)))))))+")"}const yM=P0(so(300,.5,0),so(-240,.5,1));var vM=P0(so(-100,.75,.35),so(80,1.5,.8)),xM=P0(so(260,.75,.35),so(80,1.5,.8)),jp=so();function bM(n){(n<0||n>1)&&(n-=Math.floor(n));var o=Math.abs(n-.5);return jp.h=360*n-100,jp.s=1.5-1.5*o,jp.l=.8-.9*o,jp+""}var Up=Df(),N6=Math.PI/3,V6=Math.PI*2/3;function wM(n){var o;return n=(.5-n)*Math.PI,Up.r=255*(o=Math.sin(n))*o,Up.g=255*(o=Math.sin(n+N6))*o,Up.b=255*(o=Math.sin(n+V6))*o,Up+""}function TM(n){return n=Math.max(0,Math.min(1,n)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+n*(1172.33-n*(10793.56-n*(33300.12-n*(38394.49-n*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+n*(557.33+n*(1225.33-n*(3574.96-n*(1073.77+n*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+n*(3211.1-n*(15327.97-n*(27814-n*(22569.18-n*6838.66)))))))+")"}function ag(n){var o=n.length;return function(h){return n[Math.max(0,Math.min(o-1,Math.floor(h*o)))]}}const SM=ag(_n("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var MM=ag(_n("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),PM=ag(_n("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),EM=ag(_n("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));const j6=["#4269d0","#efb118","#ff725c","#6cc5b0","#3ca951","#ff8ab7","#a463f2","#97bbf5","#9c6b4e","#9498a0"],CM=new Map([["accent",A6],["category10",I6],["dark2",k6],["observable10",j6],["paired",D6],["pastel1",z6],["pastel2",R6],["set1",L6],["set2",F6],["set3",B6],["tableau10",O6]]);function U6(n){return n!=null&&CM.has(`${n}`.toLowerCase())}const IM=new Map([["brbg",Oo(TS,SS)],["prgn",Oo(MS,PS)],["piyg",Oo(ES,CS)],["puor",Oo(IS,AS)],["rdbu",Oo(t0,km)],["rdgy",Oo(kS,DS)],["rdylbu",Oo(n0,Dm)],["rdylgn",Oo(zS,RS)],["spectral",Oo(LS,FS)],["burd",tw(t0,km)],["buylrd",tw(n0,Dm)],["blues",Gr(sM,lM)],["greens",Gr(cM,uM)],["grays",Gr(r0,zm)],["greys",Gr(r0,zm)],["oranges",Gr(mM,gM)],["purples",Gr(hM,fM)],["reds",Gr(dM,pM)],["turbo",No(TM)],["viridis",No(SM)],["magma",No(MM)],["inferno",No(PM)],["plasma",No(EM)],["cividis",No(_M)],["cubehelix",No(yM)],["warm",No(vM)],["cool",No(xM)],["bugn",Gr(BS,OS)],["bupu",Gr(NS,VS)],["gnbu",Gr(jS,US)],["orrd",Gr(qS,GS)],["pubu",Gr(WS,HS)],["pubugn",Gr($S,ZS)],["purd",Gr(XS,YS)],["rdpu",Gr(KS,JS)],["ylgn",Gr(tM,nM)],["ylgnbu",Gr(QS,eM)],["ylorbr",Gr(rM,iM)],["ylorrd",Gr(aM,oM)],["rainbow",nw(bM)],["sinebow",nw(wM)]]);function q6(n){return IM.has(`${n}`.toLowerCase())}function Gr(n,o){return h=>h===1?[n[3][1]]:h===2?[n[3][1],n[3][2]]:(h=Math.max(3,Math.floor(h)),h>9?Wf(o,h):n[h])}function Oo(n,o){return h=>h===2?[n[3][0],n[3][2]]:(h=Math.max(3,Math.floor(h)),h>11?Wf(o,h):n[h])}function tw(n,o){return h=>h===2?[n[3][2],n[3][0]]:(h=Math.max(3,Math.floor(h)),h>11?Wf(p=>o(1-p),h):n[h].slice().reverse())}function No(n){return o=>Wf(n,Math.max(2,Math.floor(o)))}function nw(n){return o=>Wf(n,Math.floor(o)+1).slice(0,-1)}function rw(n){const o=`${n}`.toLowerCase(),h=IM.get(o);if(!h)throw new Error(`unknown ordinal scheme: ${o}`);return h}const i0=new Map([["brbg",SS],["prgn",PS],["piyg",CS],["puor",AS],["rdbu",km],["rdgy",DS],["rdylbu",Dm],["rdylgn",RS],["spectral",FS],["burd",n=>km(1-n)],["buylrd",n=>Dm(1-n)],["blues",lM],["greens",uM],["grays",zm],["greys",zm],["purples",fM],["reds",pM],["oranges",gM],["turbo",TM],["viridis",SM],["magma",MM],["inferno",PM],["plasma",EM],["cividis",_M],["cubehelix",yM],["warm",vM],["cool",xM],["bugn",OS],["bupu",VS],["gnbu",US],["orrd",GS],["pubugn",ZS],["pubu",HS],["purd",YS],["rdpu",JS],["ylgnbu",eM],["ylgn",nM],["ylorbr",iM],["ylorrd",oM],["rainbow",bM],["sinebow",wM]]);function G6(n){return i0.has(String(n).toLowerCase())}function iw(n){const o=`${n}`.toLowerCase();if(!i0.has(o))throw new Error(`unknown quantitative scheme: ${o}`);return i0.get(o)}const $6=new Set(["brbg","prgn","piyg","puor","rdbu","rdgy","rdylbu","rdylgn","spectral","burd","buylrd"]);function Z6(n){return n!=null&&$6.has(`${n}`.toLowerCase())}function AM(n,o=[],h={}){const p=n(...o),b=p;for(const[T,v]of Object.entries(h)){const l=b[T];if(typeof l!="function")throw new Error(`function ${T} does not exist`);l(v)}return p}function a0(n,o=6){const h=n[0]<0&&n[1]<0;h&&(n=[n[0]*-1,n[1]*-1]);const p=n[1]<n[0];if(p&&(n=n.slice(0).reverse()),n[0]<0||n[1]<0)return[];if(n[0]===0)return If(n[0],n[1],o-2);let b=1;o+=2;let T=aw(n,b);if(T[0].num>o)for(;T[0].num>o;)b*=10,T=aw(n,b);else if(T[T.length-1].num<o){const l=If(n[0],n[1],o-2);return p&&l.reverse(),l}o-=2;const v=T.map(l=>({...l,ticks:l.ticks.filter(C=>C>=n[0]&&C<=n[1])})).map(l=>({...l,diff:Math.abs(l.ticks.length-o)})).sort((l,C)=>l.diff-C.diff)[0].ticks;return p&&v.reverse(),h?v.map(l=>l*-1):v}const W6=[[10],[5,4,5],[3,10/3],[2,2.5,2],[1.5,2,5/3,2]];function aw(n,o=1){return W6.map(h=>{let p=Math.pow(10,Math.floor(Math.log10(n[0]))),b=0;const T=[p];for(;p<n[1]&&T.length<50;)p*=h[b]*o,T.push(p),b=(b+1)%h.length;return{ticks:T,num:T.length}})}const H6={point:QA,band:Kl,linear:cm,time:l5,sqrt:tk,pow:z0,log:A0,symlog:T2,ordinal:Um,sequential:F0,diverging:O0},ly={linear:F0,log:$2,symlog:Z2,pow:B0,sqrt:c5,"quantile-cont":W2},cy={diverging:O0,"diverging-log":H2,"diverging-symlog":X2,"diverging-pow":N0,"diverging-sqrt":u5},ow={threshold:P2,quantize:M2,quantile:S2};function X6({name:n,type:o,domain:h,scaleOptions:p,plotOptions:b,plotWidth:T,plotHeight:v,plotHasFilledDotMarks:l,plotDefaults:C}){let D,z;z=p?.range||K6(n,p,b,T,v,l),p.reverse&&z.reverse();const B=n==="x"||n==="y"?Math.round(Math.abs(z[0]-z[1])/p.tickSpacing):void 0,V={domain:h,range:z,...(o==="linear"||o==="log")&&p.nice?{nice:p.nice?B:!0}:{},...o==="linear"?{clamp:p.clamp,...p.round?{interpolate:$m}:{}}:{},...o==="log"?{base:p.base||10}:{},...o==="symlog"?{constant:p.constant||1}:{},...o==="band"||o==="point"?{align:p.align,...o==="point"?{padding:wf(J_(p.padding,b.padding,.15))}:{paddingInner:wf(J_(p.paddingInner,p.padding,b.padding,.15)),paddingOuter:wf(J_(p.paddingOuter,p.padding,b.padding,.15))}}:{}};if(D=AM(H6[o],[],V),(o==="band"||o==="point")&&(D.ticks=()=>h),o==="log")D.ticks=G=>a0(h,G);else if(o==="symlog"){const G=Math.max(Math.abs(h[0]),Math.abs(h[1]));D.ticks=Q=>{const ee=a0([V.constant+1,G],Q/2);return[...ee.map(U=>-U).reverse(),0,...ee]}}return D}function Y6({type:n,domain:o,scaleOptions:h,plotOptions:p,plotWidth:b,plotHeight:T,plotHasFilledDotMarks:v,plotDefaults:l}){let C,D;const{scheme:z,interpolate:B,pivot:V,n:G=n==="threshold"?o.length+1:9,unknown:Q=l.unknown}=h;if(n==="categorical"||n==="ordinal"){let ee=z||l.categoricalColorScheme;if(Qy(ee)){const U=Object.values(ee),se=Object.keys(ee);for(const Me of o)ee[Me]==null&&(se.push(Me),U.push(Q));o=se,ee=U}D=Array.isArray(ee)?ee:U6(ee)?CM.get(ee):rw(ee)(o.length),C=Um().domain(o).range(D)}else if(ow[n]){const ee=z||l.colorScheme;if(D=Array.isArray(ee)&&(h.n==null||h.n===ee.length)?ee.slice(0):Array.isArray(ee)?Bs(G).map(U=>U/(G-1)).map(cm(ee.map((U,se)=>se/(ee.length-1)),ee).interpolate($b)):B?Bs(G).map(U=>B(U/(G-1))):q6(ee)?rw(ee)(G):null,D==null)throw new Error("unknown ordinal scheme "+ee);h.reverse&&(D=D.toReversed()),C=ow[n]().domain(o).range(D)}else if(ly[n]||cy[n]){const ee=ly[n]||cy[n],U=z||l.colorScheme;if(B)C=ee(o,B);else if(Array.isArray(U)){const se=1/(U.length-1);C=ee(o,(n==="linear"?cm:A0)(Bs(0,1+se/2,se),U).interpolate($b))}else if(cy[n]||h.type==="auto"&&Z6(U)){const se=Math.max(Math.abs(o[0]),Math.abs(o[1])),Me=V!=null?[o[0],V,o[1]]:[-se,0,se];C=ee(Me,iw(U))}else(ly[n]||h.type==="auto"&&G6(U))&&(C=ee(o,iw(U)));n==="log"&&(C.ticks=se=>a0(o,se))}return C||(console.error("color problem",n),C=()=>"red",C.range=()=>["red"]),C}function K6(n,o,h,p,b,T){const{marginTop:v,marginLeft:l,inset:C}=h,{insetLeft:D,insetRight:z,insetTop:B,insetBottom:V}=o;return n==="opacity"?[0,1]:n==="length"?[0,20]:n==="x"?[l+(D||C||0),l+p-(z||C||0)]:n==="y"?[b+v-(V||C||0),v+(B||C||0)]:n==="r"?[0,10]:n==="symbol"?T?["circle","cross","diamond","square","star","triangle","wye"]:["circle","plus","times","triangle2","asterisk","square2","diamond2"]:[]}const J6=W0({stream:n=>n}),Q6=W0({...Yy({point(n,o){this.stream.point(n,-o)}}),invert(n,o){return[n,-o]}}),kM=Math.PI,Vo=2*kM;function eR(n){switch(`${n}`.toLowerCase()){case"albers-usa":return ka(oz,.7463,.4673);case"albers":return qp(XT,.7463,.4673);case"azimuthal-equal-area":return ka(sz,4,4);case"azimuthal-equidistant":return ka(lz,Vo,Vo);case"conic-conformal":return qp(hz,Vo,Vo);case"conic-equal-area":return qp(Pm,6.1702,2.9781);case"conic-equidistant":return qp(pz,7.312,3.6282);case"equal-earth":return ka(gz,5.4133,2.6347);case"equirectangular":return ka(fz,Vo,kM);case"gnomonic":return ka(_z,3.4641,3.4641);case"identity":return{type:J6};case"reflect-y":return{type:Q6};case"mercator":return ka(cz,Vo,Vo);case"orthographic":return ka(yz,2,2);case"stereographic":return ka(vz,2,2);case"transverse-mercator":return ka(xz,Vo,Vo);default:throw new Error(`unknown projection type: ${n}`)}}function ka(n,o,h){return{type:({width:p,height:b,rotate:T,precision:v=.15,clip:l})=>{const C=n();return v!=null&&C.precision?.(v),T!=null&&C.rotate?.(T),typeof l=="number"&&C.clipAngle?.(l),C.scale(Math.min(p/o,b/h)),C.translate([p/2,b/2]),C},aspectRatio:h/o}}function qp(n,o,h){const{type:p,aspectRatio:b}=ka(n,o,h);return{type:T=>{const{parallels:v,domain:l,width:C,height:D}=T,z=p(T);return v!=null&&(z.parallels?.(v),l===void 0&&z.fitSize([C,D],{type:"Sphere"})),z},aspectRatio:b}}var tR=Wt("<h2> </h2>"),nR=Wt("<h3> </h3>"),rR=Wt("<!> <!> <!> <!> <!>",1),iR=Wt("<div> </div>"),aR=Wt("<!> <!>",1),oR=Wt('<div class="error svelte-1j5ln2u"> </div>'),sR=nn('<tspan x="0"> </tspan>'),lR=nn('<text class="error svelte-1j5ln2u" transform="translate(10,10)"></text>'),cR=Wt("<!> <!>",1),uR=Wt("<!> <!>",1),hR=Wt("<!> <!> <!> <!> <!> <!>",1);function Rm(n,o){dn(o,!0);const h=z=>{var B=rR(),V=kt(B);{var G=oe=>{var ue=tR(),de=At(ue,!0);Tt(ue),Zt(()=>$r(de,o.title)),Ue(oe,ue)};It(V,oe=>{o.title&&oe(G)})}var Q=$t(V,2);{var ee=oe=>{var ue=nR(),de=At(ue,!0);Tt(ue),Zt(()=>$r(de,o.subtitle)),Ue(oe,ue)};It(Q,oe=>{o.subtitle&&oe(ee)})}var U=$t(Q,2);{var se=oe=>{var ue=Yt(),de=kt(ue);Dn(de,()=>o.header??Qn),Ue(oe,ue)};It(U,oe=>{o.header&&oe(se)})}var Me=$t(U,2);{var me=oe=>{m6(oe,{})};It(Me,oe=>{o.color?.legend&&oe(me)})}var K=$t(Me,2);{var ce=oe=>{S6(oe,{})};It(K,oe=>{o.symbol?.legend&&oe(ce)})}Ue(z,B)},p=z=>{var B=aR(),V=kt(B);{var G=U=>{var se=iR(),Me=At(se,!0);Tt(se),Zt(()=>$r(Me,o.caption)),Ue(U,se)};It(V,U=>{o.caption&&U(G)})}var Q=$t(V,2);{var ee=U=>{var se=Yt(),Me=kt(se);Dn(Me,()=>o.footer??Qn),Ue(U,se)};It(Q,U=>{o.footer&&U(ee)})}Ue(z,B)};let b=vr(o,["$$slots","$$events","$$legacy","header","footer","overlay","underlay","children","testid","facet","projection"]);const T=le(()=>{if(o.projection&&typeof o.projection!="function"&&typeof o.projection?.type!="function"){const{type:z,aspectRatio:B}=eR(Dy(o.projection)?o.projection.type:o.projection);return{...Dy(o.projection)?o.projection:{},type:z,aspectRatio:B}}return o.projection}),v=le(()=>Object.fromEntries(["x","y","r","color","opacity","symbol","length","fx","fy"].map(z=>{const B=l(b[z]),V=B.scale||(z==="color"?Y6:X6);return[z,{...B,scale:V}]})));function l(z){return z===!1?{axis:!1}:Array.isArray(z)?{domain:z}:z||{}}var C=Yt(),D=kt(C);Tb(D,{failed:(B,V=Qn)=>{var G=oR(),Q=At(G);Tt(G),Zt(()=>$r(Q,`Error: ${V().message??""}`)),Ue(B,G)}},B=>{{const V=(U,se)=>{let Me=()=>se?.().hasProjection,me=()=>se?.().hasExplicitAxisX,K=()=>se?.().hasExplicitAxisY,ce=()=>se?.().hasExplicitGridX,oe=()=>se?.().hasExplicitGridY,ue=()=>se?.().options,de=()=>se?.().scales,be=()=>Us(se?.(),["hasProjection","hasExplicitAxisX","hasExplicitAxisY","hasExplicitGridX","hasExplicitGridY","options","scales"]);var Re=Yt(),Ve=kt(Re);Tb(Ve,{onerror:Ye=>console.error(Ye),failed:(Ye,et=Qn,Ie=Qn)=>{var Je=lR();ii(Je,21,()=>et().message.split(`
`),ya,(Qe,$e,at)=>{var zt=sR();Ct(zt,"dy",at?14:0);var rt=At(zt,!0);Tt(zt),Zt(()=>$r(rt,P($e))),Ue(Qe,zt)}),Tt(Je),Ue(Ye,Je)}},Ye=>{var et=hR(),Ie=kt(et);{var Je=pt=>{var Et=cR(),Kt=kt(Et);{var ot=Ze=>{Im(Ze,{anchor:"top",automatic:!0})};It(Kt,Ze=>{ue().axes&&(ue().x.axis==="top"||ue().x.axis==="both")&&Ze(ot)})}var _t=$t(Kt,2);{var Rt=Ze=>{Im(Ze,{anchor:"bottom",automatic:!0})};It(_t,Ze=>{ue().axes&&(ue().x.axis==="bottom"||ue().x.axis==="both")&&Ze(Rt)})}Ue(pt,Et)};It(Ie,pt=>{!Me()&&!me()&&pt(Je)})}var Qe=$t(Ie,2);{var $e=pt=>{var Et=uR(),Kt=kt(Et);{var ot=Ze=>{Q1(Ze,{anchor:"left",automatic:!0})};It(Kt,Ze=>{ue().axes&&(ue().y.axis==="left"||ue().y.axis==="both")&&Ze(ot)})}var _t=$t(Kt,2);{var Rt=Ze=>{Q1(Ze,{anchor:"right",automatic:!0})};It(_t,Ze=>{ue().axes&&(ue().y.axis==="right"||ue().y.axis==="both")&&Ze(Rt)})}Ue(pt,Et)};It(Qe,pt=>{!Me()&&!K()&&pt($e)})}var at=$t(Qe,2);{var zt=pt=>{y6(pt,{automatic:!0})};It(at,pt=>{!ce()&&(ue().grid||ue().x.grid)&&pt(zt)})}var rt=$t(at,2);{var ct=pt=>{b6(pt,{automatic:!0})};It(rt,pt=>{!oe()&&(ue().grid||ue().y.grid)&&pt(ct)})}var xt=$t(rt,2);{var vt=pt=>{e0(pt,{automatic:!0})};It(xt,pt=>{ue().frame&&pt(vt)})}var Pt=$t(xt,2);{let pt=le(()=>({options:ue(),scales:de(),...be()}));Dn(Pt,()=>o.children??Qn,()=>P(pt))}Ue(Ye,et)}),Ue(U,Re)},G=U=>{C6(U,{})};let Q=le(()=>o.header||o.title||o.subtitle||o.color?.legend||o.symbol?.legend?h:null),ee=le(()=>o.footer||o?.caption?p:null);qz(B,Gi({get overlay(){return o.overlay},get underlay(){return o.underlay}},()=>b,{get header(){return P(Q)},get footer(){return P(ee)},get projection(){return P(T)},implicitScales:!0},()=>P(v),{children:V,facetAxes:G,$$slots:{default:!0,facetAxes:!0}}))}}),Ue(n,C),pn()}var fR=nn("<g><!></g>");function dR(n,o){let h=tn(o,"length",3,1),p=tn(o,"class",3,null),b=vr(o,["$$slots","$$events","$$legacy","length","children","class"]);var T=Yt(),v=kt(T);{var l=D=>{var z=fR();La(z,()=>({class:p(),...b}));var B=At(z);Dn(B,()=>o.children),Tt(z),Ue(D,z)},C=D=>{var z=Yt(),B=kt(z);Dn(B,()=>o.children),Ue(D,z)};It(v,D=>{h()>1||p()?D(l):D(C,!1)})}Ue(n,T)}const pR=new Map([["basis",G5],["basis-closed",$5],["basis-open",Z5],["bundle",W5],["bump-x",T5],["bump-y",S5],["cardinal",H5],["cardinal-closed",X5],["cardinal-open",Y5],["catmull-rom",K5],["catmull-rom-closed",J5],["catmull-rom-open",Q5],["linear",j0],["linear-closed",eD],["monotone-x",tD],["monotone-y",nD],["natural",rD],["step",iD],["step-after",oD],["step-before",aD]]);function mR(n=j0,o){if(typeof n=="function")return n;const h=pR.get(`${n}`.toLowerCase());if(!h)throw new Error(`unknown curve: ${n}`);if(o!==void 0){if("beta"in h)return h.beta(o);if("tension"in h)return h.tension(o);if("alpha"in h)return h.alpha(o)}return h}const xu=new class{#e=em(window.devicePixelRatio);#t(){const o=Aw(window.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),"change",()=>{Vt(this.#e,window.devicePixelRatio),o(),this.#t()})}constructor(){this.#t()}get current(){return P(this.#e),window.devicePixelRatio}};var gR=Wt("<canvas></canvas>"),_R=nn('<foreignObject x="0" y="0" class="svelte-zr9o7x"><!></foreignObject>');function yR(n,o){dn(o,!0);const h=new DA("prefers-color-scheme: dark");let p=hn(void 0);const b=D=>{const z=D.ownerDocument.documentElement,B=new MutationObserver(()=>{Vt(p,getComputedStyle(z).colorScheme,!0)});return B.observe(z,{attributes:!0}),()=>{B.disconnect()}};let T=vr(o,["$$slots","$$events","$$legacy"]);const v=Zi();var l=_R(),C=At(l);vy(C,()=>[P(p),h.current],D=>{var z=gR();La(z,()=>({xmlns:"http://www.w3.org/1999/xhtml",...T,width:v.width*(xu.current??1),height:v.height*(xu.current??1),style:`width: ${v.width??""}px; height: ${v.height??""}px;`}),void 0,void 0,void 0,"svelte-zr9o7x"),Ue(D,z)}),Tt(l),Cf(l,()=>b),Zt(()=>{Ct(l,"width",v.width),Ct(l,"height",v.height)}),Ue(n,l),pn()}function o0(n,o){if(`${n}`.toLowerCase()==="currentcolor"&&(n=getComputedStyle(o?.parentElement?.parentElement).getPropertyValue("color")),Y2.test(n)&&(n=getComputedStyle(o).getPropertyValue(n.slice(4,-1))),K2.test(n)){const p=n.match(/^url\((#[^)]+)\)/)[1],b=o.ownerDocument.querySelector(p);if(b&&b.nodeName.toLowerCase()==="lineargradient"){const T=+b.getAttribute("x1"),v=+b.getAttribute("x2"),l=+b.getAttribute("y1"),C=+b.getAttribute("y2"),D=o.getContext("2d").createLinearGradient(T,l,v,C);for(const z of b.querySelectorAll("stop")){const B=+z.getAttribute("offset"),V=o0(z.getAttribute("stop-color"),o);D.addColorStop(Math.min(1,Math.max(0,B)),V)}return D}}return n}var vR=nn("<g></g>");function xR(n,o){dn(o,!0);let h=vr(o,["$$slots","$$events","$$legacy"]);const p={...Di().cell},b=le(()=>({...p,...h})),T=le(()=>Ci(P(b).data,()=>[{}],!0)),v=le(()=>Ci(P(b).class,"")),l=le(()=>Us(P(b),["data","class"])),C=Zi(),D=le(()=>P(l).sort!==void 0?Yp(S1({data:P(T),...P(l)})):Yp({...Yp({...S1({data:P(T),...P(l)}),sort:{channel:"x"}}),sort:{channel:"y"}}));oc(n,Gi({type:"cell",required:["x","y"],requiredScales:{x:["band"],y:["band"]},channels:["x","y","fill","stroke","opacity","fillOpacity","strokeOpacity"]},()=>P(D),{children:(B,V)=>{let G=()=>V?.().scaledData,Q=()=>V?.().usedScales;const ee=le(()=>C.scales.x.fn.bandwidth()),U=le(()=>C.scales.y.fn.bandwidth());var se=vR();ii(se,21,G,ya,(Me,me)=>{var K=Yt(),ce=kt(K);{var oe=ue=>{{let de=le(()=>P(me).x-P(ee)*.5),be=le(()=>P(me).y-P(U)*.5);wS(ue,{get datum(){return P(me)},get class(){return P(v)},get usedScales(){return Q()},get options(){return P(D)},get x(){return P(de)},get y(){return P(be)},get width(){return P(ee)},get height(){return P(U)}})}};It(ce,ue=>{P(me).valid&&(P(D).fill==null||ia(ki("fill",P(me).datum,P(D))))&&ue(oe)})}Ue(Me,K)}),Tt(se),Zt(()=>{ir(se,0,`cell ${(P(v)||"")??""}`),Ct(se,"data-fill",Q().fillOpacity)}),Ue(B,se)},$$slots:{default:!0}})),pn()}const bR={count:n=>Array.from(n).length,min:Sy,max:Af,mode:JA,sum:a2,mean:XA,median:YA,identity:n=>n,variance:t2,deviation:BA,first:n=>n[0],last:n=>n.at(-1),difference:n=>n.at(-1)-n[0],ratio:n=>n.at(-1)/n[0]};new Proxy(bR,{get(n,o){if(String(o).charAt(0)==="p"&&String(o).length===3){const h=+String(o).slice(1)/100;return wR(h)}return Reflect.get(n,o)},has(n,o){return String(o).charAt(0)==="p"&&String(o).length===3?!0:Reflect.has(n,o)}});function wR(n){return(o,h)=>w0(o,n,h)}var TR=nn("<circle></circle>"),SR=nn("<path></path>"),MR=nn("<marker><!></marker>");function PR(n,o){dn(o,!0);const h=z=>({viewBox:"-3 -3 6 6",path:"M0,-3v6",width:6,height:6,orient:z,color:"stroke"}),p={circle:{width:6.67,height:6.67,orient:0,color:"fill",bg:"stroke"},dot:{width:6.67,height:6.67,orient:0,color:"fill"},"circle-stroke":{width:6.67,height:6.67,orient:0,color:"stroke",bg:"fill"},tick:h("auto"),"tick-x":h(90),"tick-y":h(0),arrow:{path:"M-1.5,-3l3,3l-3,3",width:6.67,height:6.67,orient:"auto",color:"stroke"},"arrow-reverse":{path:"M1.5,-3l-3,3l3,3",width:6.67,height:6.67,orient:"auto",color:"stroke"}},b=Di().markerDotRadius,T=le(()=>({fill:"none",[p[o.shape].color]:o.color,...p[o.shape].bg?{[p[o.shape].bg]:"var(--svp-bg)"}:{}}));var v=MR();La(v,()=>({id:o.id,viewBox:p[o.shape].viewBox||"-5 -5 10 10",markerWidth:p[o.shape].width,orient:p[o.shape].orient,markerHeight:p[o.shape].height,"stroke-width":"1.5",...P(T)}));var l=At(v);{var C=z=>{var B=TR();Zt(()=>Ct(B,"r",b)),Ue(z,B)},D=z=>{var B=SR();Zt(()=>Ct(B,"d",p[o.shape].path)),Ue(z,B)};It(l,z=>{o.shape==="dot"||o.shape==="circle"||o.shape==="circle-stroke"?z(C):z(D,!1)})}Tt(v),Ue(n,v),pn()}var ER=nn("<path></path>"),CR=nn('<path stroke="none" fill="none"></path><text dy="-3"><textPath> </textPath></text>',1),IR=nn("<g><!><!><path></path><!></g>");function AR(n,o){dn(o,!0);let h=tn(o,"class",3,null),p=tn(o,"textStyleClass",3,null);const b=Z0(),T=Zi(),v=le(()=>o.text&&o.d!=null?o.d.split(/[LMC]/).slice(1):[]),l=le(()=>P(v).length>0),C=le(()=>o.text&&P(l)?P(v).at(0).split(",").map(Number):[]),D=le(()=>o.text&&P(l)?P(v).at(-1).split(",").map(Number):[]),z=le(()=>o.text&&P(l)?P(C)[0]<P(D).at(-2):!0),B=le(()=>!o.text||P(z)?o.d:o.dInv),V=le(()=>gn(o.strokeWidth,o.datum,1.4));var G=IR(),Q=At(G);ii(Q,17,()=>Object.entries({start:o.markerStart,mid:o.markerMid,end:o.markerEnd,all:o.marker}),([K,ce])=>K,(K,ce,oe,ue)=>{var de=le(()=>g0(P(ce),2));let be=()=>P(de)[0],Re=()=>P(de)[1];const Ve=le(()=>`marker-${be()==="all"?"":`${be()}-`}${b}`);var qe=Yt(),Ye=kt(qe);{var et=Je=>{var Qe=Yt(),$e=kt(Qe);Dn($e,Re,()=>P(Ve),()=>o.color),Ue(Je,Qe)},Ie=Je=>{var Qe=Yt(),$e=kt(Qe);{var at=zt=>{{let rt=le(()=>Re()===!0?"circle":gn(Re(),o.datum));PR(zt,{get id(){return P(Ve)},get shape(){return P(rt)},get color(){return o.color}})}};It($e,zt=>{Re()&&zt(at)},!0)}Ue(Je,Qe)};It(Ye,Je=>{mD(Re())?Je(et):Je(Ie,!1)})}Ue(K,qe)});var ee=$t(Q);{var U=K=>{var ce=ER();Zt(()=>{Ct(ce,"d",o.d),Zr(ce,`fill:none;stroke-width: ${(o.strokeWidth||1)+10}; stroke: transparent; stroke-opacity:0`)}),Ue(K,ce)};It(ee,K=>{(o.mark.options.onmouseenter||o.mark.options.onclick)&&K(U)})}var se=$t(ee);Cf(se,()=>Am({plot:T,options:o.mark.options,datum:o.datum}));var Me=$t(se);{var me=K=>{var ce=CR(),oe=kt(ce),ue=$t(oe),de=At(ue),be=At(de,!0);Tt(de),Tt(ue),Zt(()=>{Ct(oe,"d",P(B)),Ct(oe,"id",b),Zr(ue,o.textStyle),ir(ue,0,ri(p()),"svelte-12l946b"),Ct(de,"startOffset",o.startOffset),Ct(de,"href",`#${b??""}`),$r(be,o.text)}),Ue(K,ce)};It(Me,K=>{o.text&&K(me)})}Tt(G),Cf(G,()=>Am({plot:T,options:o.mark.options,datum:o.datum})),Zt(()=>{Ct(G,"transform",o.transform),ir(G,0,ri(h())),Ct(G,"stroke-width",P(V)),Ct(se,"marker-start",o.markerStart||o.marker?`url(#marker-${o.markerStart?"start-":""}${b})`:null),Ct(se,"marker-mid",o.markerMid||o.marker?`url(#marker-${o.markerMid?"mid-":""}${b})`:null),Ct(se,"marker-end",o.markerEnd||o.marker?`url(#marker-${o.markerEnd?"end-":""}${b})`:null),Ct(se,"d",o.d),Zr(se,o.style)}),Ue(n,G),pn()}function kR(n,o){dn(o,!0);const h=Zi();function p(T){return T==null?1:+T}const b=T=>{const v=T.getContext("2d");Ir(()=>{if(v){o.linePath.context(v),v.resetTransform(),v.scale(xu.current??1,xu.current??1),v.lineJoin="round",v.lineCap="round";for(const l of o.groupedLineData){if(l.length<2)continue;const C=l[0];if(!C||!C.valid)continue;let{stroke:D,...z}=TT(C.datum,o.mark.options,o.usedScales,h,"stroke");const B=p(z.opacity),V=p(z["stroke-opacity"]),G=gn(o.mark.options.strokeWidth,C.datum,1.4);if(o.mark.options.outlineStroke){const Q=o0(o.mark.options.outlineStroke,T),ee=o.mark.options.outlineStrokeWidth??G+2,U=o.mark.options.outlineStrokeOpacity??1;v.lineWidth=ee,v.strokeStyle=Q,v.globalAlpha=B*U,v.beginPath(),o.linePath(l),v.stroke()}D=o0(D,T),D&&D!=="none"&&(v.lineWidth=G??1.4),v.strokeStyle=D||"currentColor",v.globalAlpha=B*V,v.beginPath(),o.linePath(l),v.stroke()}o.linePath.context(null)}return()=>{v?.clearRect(0,0,h.width*(xu.current??1),h.height*(xu.current??1))}})};yR(n,{[rI()]:b}),pn()}var DR=nn("<path></path>"),zR=nn("<!><!>",1),RR=nn("<g></g>");function LR(n,o){dn(o,!0);let h=vr(o,["$$slots","$$events","$$legacy"]);const p={curve:"auto",tension:0,canvas:!1,class:null,lineClass:null,...Di().line},b=le(()=>({...p,...h})),T=le(()=>Ci(P(b).data,()=>[{}],!0)),v=le(()=>P(b).curve),l=le(()=>P(b).tension),C=le(()=>P(b).text),D=le(()=>P(b).canvas),z=le(()=>P(b).class),B=le(()=>P(b).lineClass),V=le(()=>Us(P(b),["data","curve","tension","text","canvas","class","lineClass"])),G=le(()=>Yp(bD({data:P(T),...P(V)})));function Q(me,K){if(!K)return[me];let ce=[];const oe=[ce];let ue;for(const de of me){const be=gn(K,de.datum);be===ue?ce.push(de):(ce=[de],oe.push(ce),ue=be)}return oe}const ee=le(()=>P(G).z||P(G).stroke),U=Zi(),se=le(()=>U.scales.projection&&P(v)==="auto"?Me(U.scales.projection):AM(w5,[],{curve:mR(P(v)==="auto"?"linear":P(v),P(l)),x:me=>me.x,y:me=>me.y,defined:me=>ia(me.x)&&ia(me.y)}));function Me(me){const K=GT(me),ce=oe=>{let ue=[];const de=[ue];for(const{x:be,y:Re}of oe)!ia(be)||!ia(Re)?(ue=[],de.push(ue)):ue.push([be,Re]);return K({type:"MultiLineString",coordinates:de})};return ce.context=K.context,ce}oc(n,Gi({type:"line",channels:["x","y","opacity","stroke","strokeOpacity"],required:["x","y"]},()=>P(G),{children:(K,ce)=>{let oe=()=>ce?.().mark,ue=()=>ce?.().usedScales,de=()=>ce?.().scaledData;var be=Yt(),Re=kt(be);{var Ve=qe=>{const Ye=le(()=>Q(de(),P(ee)));var et=Yt(),Ie=kt(et);{var Je=$e=>{kR($e,{get groupedLineData(){return P(Ye)},get mark(){return oe()},get usedScales(){return ue()},get linePath(){return P(se)},get groupByKey(){return P(ee)}})},Qe=$e=>{var at=RR();ii(at,21,()=>P(Ye),ya,(zt,rt)=>{const ct=le(()=>P(se)(P(rt)));var xt=Yt(),vt=kt(xt);{var Pt=pt=>{{let Et=le(()=>gn(P(B),P(rt)[0]));dR(pt,{get class(){return P(Et)},children:(Kt,ot)=>{const _t=le(()=>{const[Ut,qt]=ao(U,P(rt)[0],{strokeWidth:1.4,strokeLinejoin:"round",...P(G),stroke:P(rt)[0].stroke},"stroke",ue());return{style:Ut,styleClass:qt}}),Rt=le(()=>{const[Ut,qt]=ao(U,P(rt)[0],{textAnchor:"middle",...gS(P(G),["fontSize","fontWeight","fontStyle","textAnchor"]),strokeWidth:P(G).textStrokeWidth?P(G).textStrokeWidth:P(G).textStroke?2:0,fill:P(G).textFill||P(rt)[0].stroke,stroke:P(G).textStroke},"fill",ue(),!0);return{textStyle:Ut,textStyleClass:qt}});var Ze=zR(),Pn=kt(Ze);{var Nt=Ut=>{const qt=le(()=>{const[Pr,Xr]=ao(U,{...P(rt)[0],stroke:P(V).outlineStroke},{strokeLinejoin:"round",...P(G),stroke:P(V).outlineStroke,strokeOpacity:P(V).outlineStrokeOpacity??1,strokeWidth:P(V).outlineStrokeWidth||gn(P(V).strokeWidth,P(rt)[0].datum,1.4)+2},"stroke",ue());return{outlineStyle:Pr,outlineStyleClass:Xr}});var cn=DR();Zt(()=>{Ct(cn,"d",P(ct)),Zr(cn,P(qt).outlineStyle),ir(cn,0,ri(["is-outline",P(qt).outlineStyleClass]))}),Ue(Ut,cn)};It(Pn,Ut=>{P(V).outlineStroke&&Ut(Nt)})}var Jt=$t(Pn);{let Ut=le(()=>P(C)?P(se)(P(rt).toReversed()):null),qt=le(()=>P(rt)[0].stroke||"currentColor"),cn=le(()=>P(C)?gn(P(C),P(rt)[0].datum):null),Pr=le(()=>gn(P(G).textStartOffset,P(rt)[0].datum,"50%"));AR(Jt,{get mark(){return oe()},get scales(){return U.scales},get markerStart(){return P(G).markerStart},get markerMid(){return P(G).markerMid},get markerEnd(){return P(G).markerEnd},get marker(){return P(G).marker},get strokeWidth(){return P(G).strokeWidth},get datum(){return P(rt)[0].datum},get d(){return P(ct)},get dInv(){return P(Ut)},get color(){return P(qt)},get style(){return P(_t).style},get class(){return P(_t).styleClass},get text(){return P(cn)},get startOffset(){return P(Pr)},get textStyle(){return P(Rt).textStyle},get textStyleClass(){return P(Rt).textStyleClass}})}Ue(Kt,Ze)},$$slots:{default:!0}})}};It(vt,pt=>{P(ct)&&pt(Pt)})}Ue(zt,xt)}),Tt(at),Zt(()=>ir(at,0,ri(["lines",P(z)]))),Ue($e,at)};It(Ie,$e=>{P(D)?$e(Je):$e(Qe,!1)})}Ue(qe,et)};It(Re,qe=>{de().length>0&&qe(Ve)})}Ue(K,be)},$$slots:{default:!0}})),pn()}var FR=Wt('<div class="relative"><!></div>'),BR=Wt('<div class="flex gap-2"><button>Line Chart</button> <button>Heatmap</button></div> <!>',1),OR=Wt('<div class="h-96 flex items-center justify-center text-gray-500"><p>No visitor data available</p></div>'),NR=Wt('<div class="space-y-4"><!></div>');function VR(n,o){dn(o,!0);let h=hn("heatmap"),p=le(()=>o.data.map(C=>({...C,date:`${C.Year}-${String(C.Month).padStart(2,"0")}`})));var b=NR(),T=At(b);{var v=C=>{var D=BR(),z=kt(D),B=At(z);B.__click=()=>Vt(h,"line");var V=$t(B,2);V.__click=()=>Vt(h,"heatmap"),Tt(z);var G=$t(z,2);{var Q=U=>{var se=Yt(),Me=kt(se);vy(Me,()=>"line-chart",me=>{Rm(me,{y:{grid:!0,axis:"both"},x:{tickRotate:-45,tickSpacing:100},children:(K,ce)=>{LR(K,{canvas:!0,get data(){return P(p)},x:"date",y:"RecreationVisits"})},$$slots:{default:!0}})}),Ue(U,se)},ee=U=>{var se=Yt(),Me=kt(se);vy(Me,()=>"heatmap-chart",me=>{var K=FR(),ce=At(K);Rm(ce,{grid:!0,padding:.1,aspectRatio:1,color:{legend:!0,scheme:"Blues"},x:{tickRotate:-45},y:{axis:"both"},children:(oe,ue)=>{xR(oe,{get data(){return o.data},x:"Year",y:"Month",fill:"RecreationVisits"})},$$slots:{default:!0}}),Tt(K),Ue(me,K)}),Ue(U,se)};It(G,U=>{P(h)==="line"?U(Q):U(ee,!1)})}Zt(()=>{ir(B,1,`px-4 py-2 rounded text-sm ${P(h)==="line"?"bg-blue-500 text-white":"bg-gray-200"}`),ir(V,1,`px-4 py-2 rounded text-sm ${P(h)==="heatmap"?"bg-blue-500 text-white":"bg-gray-200"}`)}),Ue(C,D)},l=C=>{var D=OR();Ue(C,D)};It(T,C=>{o.data&&o.data.length>0?C(v):C(l,!1)})}Tt(b),Ue(n,b),pn()}qf(["click"]);var jR=Wt("<div><!></div>");function uy(n,o){dn(o,!0);let h=tn(o,"ref",15,null),p=vr(o,["$$slots","$$events","$$legacy","ref","class","children"]);var b=jR();La(b,v=>({"data-slot":"card",class:v,...p}),[()=>Xo("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",o.class)]);var T=At(b);Dn(T,()=>o.children??Qn),Tt(b),xa(b,v=>h(v),()=>h()),Ue(n,b),pn()}var UR=Wt("<div><!></div>");function hy(n,o){dn(o,!0);let h=tn(o,"ref",15,null),p=vr(o,["$$slots","$$events","$$legacy","ref","class","children"]);var b=UR();La(b,v=>({"data-slot":"card-content",class:v,...p}),[()=>Xo("px-6",o.class)]);var T=At(b);Dn(T,()=>o.children??Qn),Tt(b),xa(b,v=>h(v),()=>h()),Ue(n,b),pn()}var qR=Wt("<p><!></p>");function sw(n,o){dn(o,!0);let h=tn(o,"ref",15,null),p=vr(o,["$$slots","$$events","$$legacy","ref","class","children"]);var b=qR();La(b,v=>({"data-slot":"card-description",class:v,...p}),[()=>Xo("text-muted-foreground text-sm",o.class)]);var T=At(b);Dn(T,()=>o.children??Qn),Tt(b),xa(b,v=>h(v),()=>h()),Ue(n,b),pn()}var GR=Wt("<div><!></div>");function lw(n,o){dn(o,!0);let h=tn(o,"ref",15,null),p=vr(o,["$$slots","$$events","$$legacy","ref","class","children"]);var b=GR();La(b,v=>({"data-slot":"card-header",class:v,...p}),[()=>Xo("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",o.class)]);var T=At(b);Dn(T,()=>o.children??Qn),Tt(b),xa(b,v=>h(v),()=>h()),Ue(n,b),pn()}var $R=Wt("<div><!></div>");function cw(n,o){dn(o,!0);let h=tn(o,"ref",15,null),p=vr(o,["$$slots","$$events","$$legacy","ref","class","children"]);var b=$R();La(b,v=>({"data-slot":"card-title",class:v,...p}),[()=>Xo("leading-none font-semibold",o.class)]);var T=At(b);Dn(T,()=>o.children??Qn),Tt(b),xa(b,v=>h(v),()=>h()),Ue(n,b),pn()}var ZR={value:()=>{}};function DM(){for(var n=0,o=arguments.length,h={},p;n<o;++n){if(!(p=arguments[n]+"")||p in h||/[\s.]/.test(p))throw new Error("illegal type: "+p);h[p]=[]}return new Kp(h)}function Kp(n){this._=n}function WR(n,o){return n.trim().split(/^|\s+/).map(function(h){var p="",b=h.indexOf(".");if(b>=0&&(p=h.slice(b+1),h=h.slice(0,b)),h&&!o.hasOwnProperty(h))throw new Error("unknown type: "+h);return{type:h,name:p}})}Kp.prototype=DM.prototype={constructor:Kp,on:function(n,o){var h=this._,p=WR(n+"",h),b,T=-1,v=p.length;if(arguments.length<2){for(;++T<v;)if((b=(n=p[T]).type)&&(b=HR(h[b],n.name)))return b;return}if(o!=null&&typeof o!="function")throw new Error("invalid callback: "+o);for(;++T<v;)if(b=(n=p[T]).type)h[b]=uw(h[b],n.name,o);else if(o==null)for(b in h)h[b]=uw(h[b],n.name,null);return this},copy:function(){var n={},o=this._;for(var h in o)n[h]=o[h].slice();return new Kp(n)},call:function(n,o){if((b=arguments.length-2)>0)for(var h=new Array(b),p=0,b,T;p<b;++p)h[p]=arguments[p+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(T=this._[n],p=0,b=T.length;p<b;++p)T[p].value.apply(o,h)},apply:function(n,o,h){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var p=this._[n],b=0,T=p.length;b<T;++b)p[b].value.apply(o,h)}};function HR(n,o){for(var h=0,p=n.length,b;h<p;++h)if((b=n[h]).name===o)return b.value}function uw(n,o,h){for(var p=0,b=n.length;p<b;++p)if(n[p].name===o){n[p]=ZR,n=n.slice(0,p).concat(n.slice(p+1));break}return h!=null&&n.push({name:o,value:h}),n}var s0="http://www.w3.org/1999/xhtml";const hw={svg:"http://www.w3.org/2000/svg",xhtml:s0,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function og(n){var o=n+="",h=o.indexOf(":");return h>=0&&(o=n.slice(0,h))!=="xmlns"&&(n=n.slice(h+1)),hw.hasOwnProperty(o)?{space:hw[o],local:n}:n}function XR(n){return function(){var o=this.ownerDocument,h=this.namespaceURI;return h===s0&&o.documentElement.namespaceURI===s0?o.createElement(n):o.createElementNS(h,n)}}function YR(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function zM(n){var o=og(n);return(o.local?YR:XR)(o)}function KR(){}function tv(n){return n==null?KR:function(){return this.querySelector(n)}}function JR(n){typeof n!="function"&&(n=tv(n));for(var o=this._groups,h=o.length,p=new Array(h),b=0;b<h;++b)for(var T=o[b],v=T.length,l=p[b]=new Array(v),C,D,z=0;z<v;++z)(C=T[z])&&(D=n.call(C,C.__data__,z,T))&&("__data__"in C&&(D.__data__=C.__data__),l[z]=D);return new Fa(p,this._parents)}function QR(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function eL(){return[]}function RM(n){return n==null?eL:function(){return this.querySelectorAll(n)}}function tL(n){return function(){return QR(n.apply(this,arguments))}}function nL(n){typeof n=="function"?n=tL(n):n=RM(n);for(var o=this._groups,h=o.length,p=[],b=[],T=0;T<h;++T)for(var v=o[T],l=v.length,C,D=0;D<l;++D)(C=v[D])&&(p.push(n.call(C,C.__data__,D,v)),b.push(C));return new Fa(p,b)}function LM(n){return function(){return this.matches(n)}}function FM(n){return function(o){return o.matches(n)}}var rL=Array.prototype.find;function iL(n){return function(){return rL.call(this.children,n)}}function aL(){return this.firstElementChild}function oL(n){return this.select(n==null?aL:iL(typeof n=="function"?n:FM(n)))}var sL=Array.prototype.filter;function lL(){return Array.from(this.children)}function cL(n){return function(){return sL.call(this.children,n)}}function uL(n){return this.selectAll(n==null?lL:cL(typeof n=="function"?n:FM(n)))}function hL(n){typeof n!="function"&&(n=LM(n));for(var o=this._groups,h=o.length,p=new Array(h),b=0;b<h;++b)for(var T=o[b],v=T.length,l=p[b]=[],C,D=0;D<v;++D)(C=T[D])&&n.call(C,C.__data__,D,T)&&l.push(C);return new Fa(p,this._parents)}function BM(n){return new Array(n.length)}function fL(){return new Fa(this._enter||this._groups.map(BM),this._parents)}function Lm(n,o){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=o}Lm.prototype={constructor:Lm,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,o){return this._parent.insertBefore(n,o)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function dL(n){return function(){return n}}function pL(n,o,h,p,b,T){for(var v=0,l,C=o.length,D=T.length;v<D;++v)(l=o[v])?(l.__data__=T[v],p[v]=l):h[v]=new Lm(n,T[v]);for(;v<C;++v)(l=o[v])&&(b[v]=l)}function mL(n,o,h,p,b,T,v){var l,C,D=new Map,z=o.length,B=T.length,V=new Array(z),G;for(l=0;l<z;++l)(C=o[l])&&(V[l]=G=v.call(C,C.__data__,l,o)+"",D.has(G)?b[l]=C:D.set(G,C));for(l=0;l<B;++l)G=v.call(n,T[l],l,T)+"",(C=D.get(G))?(p[l]=C,C.__data__=T[l],D.delete(G)):h[l]=new Lm(n,T[l]);for(l=0;l<z;++l)(C=o[l])&&D.get(V[l])===C&&(b[l]=C)}function gL(n){return n.__data__}function _L(n,o){if(!arguments.length)return Array.from(this,gL);var h=o?mL:pL,p=this._parents,b=this._groups;typeof n!="function"&&(n=dL(n));for(var T=b.length,v=new Array(T),l=new Array(T),C=new Array(T),D=0;D<T;++D){var z=p[D],B=b[D],V=B.length,G=yL(n.call(z,z&&z.__data__,D,p)),Q=G.length,ee=l[D]=new Array(Q),U=v[D]=new Array(Q),se=C[D]=new Array(V);h(z,B,ee,U,se,G,o);for(var Me=0,me=0,K,ce;Me<Q;++Me)if(K=ee[Me]){for(Me>=me&&(me=Me+1);!(ce=U[me])&&++me<Q;);K._next=ce||null}}return v=new Fa(v,p),v._enter=l,v._exit=C,v}function yL(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function vL(){return new Fa(this._exit||this._groups.map(BM),this._parents)}function xL(n,o,h){var p=this.enter(),b=this,T=this.exit();return typeof n=="function"?(p=n(p),p&&(p=p.selection())):p=p.append(n+""),o!=null&&(b=o(b),b&&(b=b.selection())),h==null?T.remove():h(T),p&&b?p.merge(b).order():b}function bL(n){for(var o=n.selection?n.selection():n,h=this._groups,p=o._groups,b=h.length,T=p.length,v=Math.min(b,T),l=new Array(b),C=0;C<v;++C)for(var D=h[C],z=p[C],B=D.length,V=l[C]=new Array(B),G,Q=0;Q<B;++Q)(G=D[Q]||z[Q])&&(V[Q]=G);for(;C<b;++C)l[C]=h[C];return new Fa(l,this._parents)}function wL(){for(var n=this._groups,o=-1,h=n.length;++o<h;)for(var p=n[o],b=p.length-1,T=p[b],v;--b>=0;)(v=p[b])&&(T&&v.compareDocumentPosition(T)^4&&T.parentNode.insertBefore(v,T),T=v);return this}function TL(n){n||(n=SL);function o(B,V){return B&&V?n(B.__data__,V.__data__):!B-!V}for(var h=this._groups,p=h.length,b=new Array(p),T=0;T<p;++T){for(var v=h[T],l=v.length,C=b[T]=new Array(l),D,z=0;z<l;++z)(D=v[z])&&(C[z]=D);C.sort(o)}return new Fa(b,this._parents).order()}function SL(n,o){return n<o?-1:n>o?1:n>=o?0:NaN}function ML(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function PL(){return Array.from(this)}function EL(){for(var n=this._groups,o=0,h=n.length;o<h;++o)for(var p=n[o],b=0,T=p.length;b<T;++b){var v=p[b];if(v)return v}return null}function CL(){let n=0;for(const o of this)++n;return n}function IL(){return!this.node()}function AL(n){for(var o=this._groups,h=0,p=o.length;h<p;++h)for(var b=o[h],T=0,v=b.length,l;T<v;++T)(l=b[T])&&n.call(l,l.__data__,T,b);return this}function kL(n){return function(){this.removeAttribute(n)}}function DL(n){return function(){this.removeAttributeNS(n.space,n.local)}}function zL(n,o){return function(){this.setAttribute(n,o)}}function RL(n,o){return function(){this.setAttributeNS(n.space,n.local,o)}}function LL(n,o){return function(){var h=o.apply(this,arguments);h==null?this.removeAttribute(n):this.setAttribute(n,h)}}function FL(n,o){return function(){var h=o.apply(this,arguments);h==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,h)}}function BL(n,o){var h=og(n);if(arguments.length<2){var p=this.node();return h.local?p.getAttributeNS(h.space,h.local):p.getAttribute(h)}return this.each((o==null?h.local?DL:kL:typeof o=="function"?h.local?FL:LL:h.local?RL:zL)(h,o))}function OM(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function OL(n){return function(){this.style.removeProperty(n)}}function NL(n,o,h){return function(){this.style.setProperty(n,o,h)}}function VL(n,o,h){return function(){var p=o.apply(this,arguments);p==null?this.style.removeProperty(n):this.style.setProperty(n,p,h)}}function jL(n,o,h){return arguments.length>1?this.each((o==null?OL:typeof o=="function"?VL:NL)(n,o,h??"")):Du(this.node(),n)}function Du(n,o){return n.style.getPropertyValue(o)||OM(n).getComputedStyle(n,null).getPropertyValue(o)}function UL(n){return function(){delete this[n]}}function qL(n,o){return function(){this[n]=o}}function GL(n,o){return function(){var h=o.apply(this,arguments);h==null?delete this[n]:this[n]=h}}function $L(n,o){return arguments.length>1?this.each((o==null?UL:typeof o=="function"?GL:qL)(n,o)):this.node()[n]}function NM(n){return n.trim().split(/^|\s+/)}function nv(n){return n.classList||new VM(n)}function VM(n){this._node=n,this._names=NM(n.getAttribute("class")||"")}VM.prototype={add:function(n){var o=this._names.indexOf(n);o<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var o=this._names.indexOf(n);o>=0&&(this._names.splice(o,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function jM(n,o){for(var h=nv(n),p=-1,b=o.length;++p<b;)h.add(o[p])}function UM(n,o){for(var h=nv(n),p=-1,b=o.length;++p<b;)h.remove(o[p])}function ZL(n){return function(){jM(this,n)}}function WL(n){return function(){UM(this,n)}}function HL(n,o){return function(){(o.apply(this,arguments)?jM:UM)(this,n)}}function XL(n,o){var h=NM(n+"");if(arguments.length<2){for(var p=nv(this.node()),b=-1,T=h.length;++b<T;)if(!p.contains(h[b]))return!1;return!0}return this.each((typeof o=="function"?HL:o?ZL:WL)(h,o))}function YL(){this.textContent=""}function KL(n){return function(){this.textContent=n}}function JL(n){return function(){var o=n.apply(this,arguments);this.textContent=o??""}}function QL(n){return arguments.length?this.each(n==null?YL:(typeof n=="function"?JL:KL)(n)):this.node().textContent}function eF(){this.innerHTML=""}function tF(n){return function(){this.innerHTML=n}}function nF(n){return function(){var o=n.apply(this,arguments);this.innerHTML=o??""}}function rF(n){return arguments.length?this.each(n==null?eF:(typeof n=="function"?nF:tF)(n)):this.node().innerHTML}function iF(){this.nextSibling&&this.parentNode.appendChild(this)}function aF(){return this.each(iF)}function oF(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function sF(){return this.each(oF)}function lF(n){var o=typeof n=="function"?n:zM(n);return this.select(function(){return this.appendChild(o.apply(this,arguments))})}function cF(){return null}function uF(n,o){var h=typeof n=="function"?n:zM(n),p=o==null?cF:typeof o=="function"?o:tv(o);return this.select(function(){return this.insertBefore(h.apply(this,arguments),p.apply(this,arguments)||null)})}function hF(){var n=this.parentNode;n&&n.removeChild(this)}function fF(){return this.each(hF)}function dF(){var n=this.cloneNode(!1),o=this.parentNode;return o?o.insertBefore(n,this.nextSibling):n}function pF(){var n=this.cloneNode(!0),o=this.parentNode;return o?o.insertBefore(n,this.nextSibling):n}function mF(n){return this.select(n?pF:dF)}function gF(n){return arguments.length?this.property("__data__",n):this.node().__data__}function _F(n){return function(o){n.call(this,o,this.__data__)}}function yF(n){return n.trim().split(/^|\s+/).map(function(o){var h="",p=o.indexOf(".");return p>=0&&(h=o.slice(p+1),o=o.slice(0,p)),{type:o,name:h}})}function vF(n){return function(){var o=this.__on;if(o){for(var h=0,p=-1,b=o.length,T;h<b;++h)T=o[h],(!n.type||T.type===n.type)&&T.name===n.name?this.removeEventListener(T.type,T.listener,T.options):o[++p]=T;++p?o.length=p:delete this.__on}}}function xF(n,o,h){return function(){var p=this.__on,b,T=_F(o);if(p){for(var v=0,l=p.length;v<l;++v)if((b=p[v]).type===n.type&&b.name===n.name){this.removeEventListener(b.type,b.listener,b.options),this.addEventListener(b.type,b.listener=T,b.options=h),b.value=o;return}}this.addEventListener(n.type,T,h),b={type:n.type,name:n.name,value:o,listener:T,options:h},p?p.push(b):this.__on=[b]}}function bF(n,o,h){var p=yF(n+""),b,T=p.length,v;if(arguments.length<2){var l=this.node().__on;if(l){for(var C=0,D=l.length,z;C<D;++C)for(b=0,z=l[C];b<T;++b)if((v=p[b]).type===z.type&&v.name===z.name)return z.value}return}for(l=o?xF:vF,b=0;b<T;++b)this.each(l(p[b],o,h));return this}function qM(n,o,h){var p=OM(n),b=p.CustomEvent;typeof b=="function"?b=new b(o,h):(b=p.document.createEvent("Event"),h?(b.initEvent(o,h.bubbles,h.cancelable),b.detail=h.detail):b.initEvent(o,!1,!1)),n.dispatchEvent(b)}function wF(n,o){return function(){return qM(this,n,o)}}function TF(n,o){return function(){return qM(this,n,o.apply(this,arguments))}}function SF(n,o){return this.each((typeof o=="function"?TF:wF)(n,o))}function*MF(){for(var n=this._groups,o=0,h=n.length;o<h;++o)for(var p=n[o],b=0,T=p.length,v;b<T;++b)(v=p[b])&&(yield v)}var PF=[null];function Fa(n,o){this._groups=n,this._parents=o}function Kf(){return new Fa([[document.documentElement]],PF)}function EF(){return this}Fa.prototype=Kf.prototype={constructor:Fa,select:JR,selectAll:nL,selectChild:oL,selectChildren:uL,filter:hL,data:_L,enter:fL,exit:vL,join:xL,merge:bL,selection:EF,order:wL,sort:TL,call:ML,nodes:PL,node:EL,size:CL,empty:IL,each:AL,attr:BL,style:jL,property:$L,classed:XL,text:QL,html:rF,raise:aF,lower:sF,append:lF,insert:uF,remove:fF,clone:mF,datum:gF,on:bF,dispatch:SF,[Symbol.iterator]:MF};function rv(n,o,h){n.prototype=o.prototype=h,h.constructor=n}function GM(n,o){var h=Object.create(n.prototype);for(var p in o)h[p]=o[p];return h}function Jf(){}var Nf=.7,Fm=1/Nf,Tu="\\s*([+-]?\\d+)\\s*",Vf="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",oo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",CF=/^#([0-9a-f]{3,8})$/,IF=new RegExp(`^rgb\\(${Tu},${Tu},${Tu}\\)$`),AF=new RegExp(`^rgb\\(${oo},${oo},${oo}\\)$`),kF=new RegExp(`^rgba\\(${Tu},${Tu},${Tu},${Vf}\\)$`),DF=new RegExp(`^rgba\\(${oo},${oo},${oo},${Vf}\\)$`),zF=new RegExp(`^hsl\\(${Vf},${oo},${oo}\\)$`),RF=new RegExp(`^hsla\\(${Vf},${oo},${oo},${Vf}\\)$`),fw={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};rv(Jf,jf,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:dw,formatHex:dw,formatHex8:LF,formatHsl:FF,formatRgb:pw,toString:pw});function dw(){return this.rgb().formatHex()}function LF(){return this.rgb().formatHex8()}function FF(){return $M(this).formatHsl()}function pw(){return this.rgb().formatRgb()}function jf(n){var o,h;return n=(n+"").trim().toLowerCase(),(o=CF.exec(n))?(h=o[1].length,o=parseInt(o[1],16),h===6?mw(o):h===3?new qi(o>>8&15|o>>4&240,o>>4&15|o&240,(o&15)<<4|o&15,1):h===8?Gp(o>>24&255,o>>16&255,o>>8&255,(o&255)/255):h===4?Gp(o>>12&15|o>>8&240,o>>8&15|o>>4&240,o>>4&15|o&240,((o&15)<<4|o&15)/255):null):(o=IF.exec(n))?new qi(o[1],o[2],o[3],1):(o=AF.exec(n))?new qi(o[1]*255/100,o[2]*255/100,o[3]*255/100,1):(o=kF.exec(n))?Gp(o[1],o[2],o[3],o[4]):(o=DF.exec(n))?Gp(o[1]*255/100,o[2]*255/100,o[3]*255/100,o[4]):(o=zF.exec(n))?yw(o[1],o[2]/100,o[3]/100,1):(o=RF.exec(n))?yw(o[1],o[2]/100,o[3]/100,o[4]):fw.hasOwnProperty(n)?mw(fw[n]):n==="transparent"?new qi(NaN,NaN,NaN,0):null}function mw(n){return new qi(n>>16&255,n>>8&255,n&255,1)}function Gp(n,o,h,p){return p<=0&&(n=o=h=NaN),new qi(n,o,h,p)}function BF(n){return n instanceof Jf||(n=jf(n)),n?(n=n.rgb(),new qi(n.r,n.g,n.b,n.opacity)):new qi}function l0(n,o,h,p){return arguments.length===1?BF(n):new qi(n,o,h,p??1)}function qi(n,o,h,p){this.r=+n,this.g=+o,this.b=+h,this.opacity=+p}rv(qi,l0,GM(Jf,{brighter(n){return n=n==null?Fm:Math.pow(Fm,n),new qi(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Nf:Math.pow(Nf,n),new qi(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new qi(Xl(this.r),Xl(this.g),Xl(this.b),Bm(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:gw,formatHex:gw,formatHex8:OF,formatRgb:_w,toString:_w}));function gw(){return`#${$l(this.r)}${$l(this.g)}${$l(this.b)}`}function OF(){return`#${$l(this.r)}${$l(this.g)}${$l(this.b)}${$l((isNaN(this.opacity)?1:this.opacity)*255)}`}function _w(){const n=Bm(this.opacity);return`${n===1?"rgb(":"rgba("}${Xl(this.r)}, ${Xl(this.g)}, ${Xl(this.b)}${n===1?")":`, ${n})`}`}function Bm(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Xl(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function $l(n){return n=Xl(n),(n<16?"0":"")+n.toString(16)}function yw(n,o,h,p){return p<=0?n=o=h=NaN:h<=0||h>=1?n=o=NaN:o<=0&&(n=NaN),new za(n,o,h,p)}function $M(n){if(n instanceof za)return new za(n.h,n.s,n.l,n.opacity);if(n instanceof Jf||(n=jf(n)),!n)return new za;if(n instanceof za)return n;n=n.rgb();var o=n.r/255,h=n.g/255,p=n.b/255,b=Math.min(o,h,p),T=Math.max(o,h,p),v=NaN,l=T-b,C=(T+b)/2;return l?(o===T?v=(h-p)/l+(h<p)*6:h===T?v=(p-o)/l+2:v=(o-h)/l+4,l/=C<.5?T+b:2-T-b,v*=60):l=C>0&&C<1?0:v,new za(v,l,C,n.opacity)}function NF(n,o,h,p){return arguments.length===1?$M(n):new za(n,o,h,p??1)}function za(n,o,h,p){this.h=+n,this.s=+o,this.l=+h,this.opacity=+p}rv(za,NF,GM(Jf,{brighter(n){return n=n==null?Fm:Math.pow(Fm,n),new za(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Nf:Math.pow(Nf,n),new za(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,o=isNaN(n)||isNaN(this.s)?0:this.s,h=this.l,p=h+(h<.5?h:1-h)*o,b=2*h-p;return new qi(fy(n>=240?n-240:n+120,b,p),fy(n,b,p),fy(n<120?n+240:n-120,b,p),this.opacity)},clamp(){return new za(vw(this.h),$p(this.s),$p(this.l),Bm(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=Bm(this.opacity);return`${n===1?"hsl(":"hsla("}${vw(this.h)}, ${$p(this.s)*100}%, ${$p(this.l)*100}%${n===1?")":`, ${n})`}`}}));function vw(n){return n=(n||0)%360,n<0?n+360:n}function $p(n){return Math.max(0,Math.min(1,n||0))}function fy(n,o,h){return(n<60?o+(h-o)*n/60:n<180?h:n<240?o+(h-o)*(240-n)/60:o)*255}const ZM=n=>()=>n;function VF(n,o){return function(h){return n+h*o}}function jF(n,o,h){return n=Math.pow(n,h),o=Math.pow(o,h)-n,h=1/h,function(p){return Math.pow(n+p*o,h)}}function UF(n){return(n=+n)==1?WM:function(o,h){return h-o?jF(o,h,n):ZM(isNaN(o)?h:o)}}function WM(n,o){var h=o-n;return h?VF(n,h):ZM(isNaN(n)?o:n)}const xw=(function n(o){var h=UF(o);function p(b,T){var v=h((b=l0(b)).r,(T=l0(T)).r),l=h(b.g,T.g),C=h(b.b,T.b),D=WM(b.opacity,T.opacity);return function(z){return b.r=v(z),b.g=l(z),b.b=C(z),b.opacity=D(z),b+""}}return p.gamma=n,p})(1);function Ls(n,o){return n=+n,o=+o,function(h){return n*(1-h)+o*h}}var c0=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,dy=new RegExp(c0.source,"g");function qF(n){return function(){return n}}function GF(n){return function(o){return n(o)+""}}function $F(n,o){var h=c0.lastIndex=dy.lastIndex=0,p,b,T,v=-1,l=[],C=[];for(n=n+"",o=o+"";(p=c0.exec(n))&&(b=dy.exec(o));)(T=b.index)>h&&(T=o.slice(h,T),l[v]?l[v]+=T:l[++v]=T),(p=p[0])===(b=b[0])?l[v]?l[v]+=b:l[++v]=b:(l[++v]=null,C.push({i:v,x:Ls(p,b)})),h=dy.lastIndex;return h<o.length&&(T=o.slice(h),l[v]?l[v]+=T:l[++v]=T),l.length<2?C[0]?GF(C[0].x):qF(o):(o=C.length,function(D){for(var z=0,B;z<o;++z)l[(B=C[z]).i]=B.x(D);return l.join("")})}var bw=180/Math.PI,u0={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function HM(n,o,h,p,b,T){var v,l,C;return(v=Math.sqrt(n*n+o*o))&&(n/=v,o/=v),(C=n*h+o*p)&&(h-=n*C,p-=o*C),(l=Math.sqrt(h*h+p*p))&&(h/=l,p/=l,C/=l),n*p<o*h&&(n=-n,o=-o,C=-C,v=-v),{translateX:b,translateY:T,rotate:Math.atan2(o,n)*bw,skewX:Math.atan(C)*bw,scaleX:v,scaleY:l}}var Zp;function ZF(n){const o=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return o.isIdentity?u0:HM(o.a,o.b,o.c,o.d,o.e,o.f)}function WF(n){return n==null||(Zp||(Zp=document.createElementNS("http://www.w3.org/2000/svg","g")),Zp.setAttribute("transform",n),!(n=Zp.transform.baseVal.consolidate()))?u0:(n=n.matrix,HM(n.a,n.b,n.c,n.d,n.e,n.f))}function XM(n,o,h,p){function b(D){return D.length?D.pop()+" ":""}function T(D,z,B,V,G,Q){if(D!==B||z!==V){var ee=G.push("translate(",null,o,null,h);Q.push({i:ee-4,x:Ls(D,B)},{i:ee-2,x:Ls(z,V)})}else(B||V)&&G.push("translate("+B+o+V+h)}function v(D,z,B,V){D!==z?(D-z>180?z+=360:z-D>180&&(D+=360),V.push({i:B.push(b(B)+"rotate(",null,p)-2,x:Ls(D,z)})):z&&B.push(b(B)+"rotate("+z+p)}function l(D,z,B,V){D!==z?V.push({i:B.push(b(B)+"skewX(",null,p)-2,x:Ls(D,z)}):z&&B.push(b(B)+"skewX("+z+p)}function C(D,z,B,V,G,Q){if(D!==B||z!==V){var ee=G.push(b(G)+"scale(",null,",",null,")");Q.push({i:ee-4,x:Ls(D,B)},{i:ee-2,x:Ls(z,V)})}else(B!==1||V!==1)&&G.push(b(G)+"scale("+B+","+V+")")}return function(D,z){var B=[],V=[];return D=n(D),z=n(z),T(D.translateX,D.translateY,z.translateX,z.translateY,B,V),v(D.rotate,z.rotate,B,V),l(D.skewX,z.skewX,B,V),C(D.scaleX,D.scaleY,z.scaleX,z.scaleY,B,V),D=z=null,function(G){for(var Q=-1,ee=V.length,U;++Q<ee;)B[(U=V[Q]).i]=U.x(G);return B.join("")}}}var HF=XM(ZF,"px, ","px)","deg)"),XF=XM(WF,", ",")",")"),zu=0,yf=0,cf=0,YM=1e3,Om,vf,Nm=0,rc=0,sg=0,Uf=typeof performance=="object"&&performance.now?performance:Date,KM=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function iv(){return rc||(KM(YF),rc=Uf.now()+sg)}function YF(){rc=0}function Vm(){this._call=this._time=this._next=null}Vm.prototype=JM.prototype={constructor:Vm,restart:function(n,o,h){if(typeof n!="function")throw new TypeError("callback is not a function");h=(h==null?iv():+h)+(o==null?0:+o),!this._next&&vf!==this&&(vf?vf._next=this:Om=this,vf=this),this._call=n,this._time=h,h0()},stop:function(){this._call&&(this._call=null,this._time=1/0,h0())}};function JM(n,o,h){var p=new Vm;return p.restart(n,o,h),p}function KF(){iv(),++zu;for(var n=Om,o;n;)(o=rc-n._time)>=0&&n._call.call(void 0,o),n=n._next;--zu}function ww(){rc=(Nm=Uf.now())+sg,zu=yf=0;try{KF()}finally{zu=0,QF(),rc=0}}function JF(){var n=Uf.now(),o=n-Nm;o>YM&&(sg-=o,Nm=n)}function QF(){for(var n,o=Om,h,p=1/0;o;)o._call?(p>o._time&&(p=o._time),n=o,o=o._next):(h=o._next,o._next=null,o=n?n._next=h:Om=h);vf=n,h0(p)}function h0(n){if(!zu){yf&&(yf=clearTimeout(yf));var o=n-rc;o>24?(n<1/0&&(yf=setTimeout(ww,n-Uf.now()-sg)),cf&&(cf=clearInterval(cf))):(cf||(Nm=Uf.now(),cf=setInterval(JF,YM)),zu=1,KM(ww))}}function Tw(n,o,h){var p=new Vm;return o=o==null?0:+o,p.restart(b=>{p.stop(),n(b+o)},o,h),p}var e8=DM("start","end","cancel","interrupt"),t8=[],QM=0,Sw=1,f0=2,Jp=3,Mw=4,d0=5,Qp=6;function lg(n,o,h,p,b,T){var v=n.__transition;if(!v)n.__transition={};else if(h in v)return;n8(n,h,{name:o,index:p,group:b,on:e8,tween:t8,time:T.time,delay:T.delay,duration:T.duration,ease:T.ease,timer:null,state:QM})}function av(n,o){var h=Ba(n,o);if(h.state>QM)throw new Error("too late; already scheduled");return h}function uo(n,o){var h=Ba(n,o);if(h.state>Jp)throw new Error("too late; already running");return h}function Ba(n,o){var h=n.__transition;if(!h||!(h=h[o]))throw new Error("transition not found");return h}function n8(n,o,h){var p=n.__transition,b;p[o]=h,h.timer=JM(T,0,h.time);function T(D){h.state=Sw,h.timer.restart(v,h.delay,h.time),h.delay<=D&&v(D-h.delay)}function v(D){var z,B,V,G;if(h.state!==Sw)return C();for(z in p)if(G=p[z],G.name===h.name){if(G.state===Jp)return Tw(v);G.state===Mw?(G.state=Qp,G.timer.stop(),G.on.call("interrupt",n,n.__data__,G.index,G.group),delete p[z]):+z<o&&(G.state=Qp,G.timer.stop(),G.on.call("cancel",n,n.__data__,G.index,G.group),delete p[z])}if(Tw(function(){h.state===Jp&&(h.state=Mw,h.timer.restart(l,h.delay,h.time),l(D))}),h.state=f0,h.on.call("start",n,n.__data__,h.index,h.group),h.state===f0){for(h.state=Jp,b=new Array(V=h.tween.length),z=0,B=-1;z<V;++z)(G=h.tween[z].value.call(n,n.__data__,h.index,h.group))&&(b[++B]=G);b.length=B+1}}function l(D){for(var z=D<h.duration?h.ease.call(null,D/h.duration):(h.timer.restart(C),h.state=d0,1),B=-1,V=b.length;++B<V;)b[B].call(n,z);h.state===d0&&(h.on.call("end",n,n.__data__,h.index,h.group),C())}function C(){h.state=Qp,h.timer.stop(),delete p[o];for(var D in p)return;delete n.__transition}}function r8(n,o){var h=n.__transition,p,b,T=!0,v;if(h){o=o==null?null:o+"";for(v in h){if((p=h[v]).name!==o){T=!1;continue}b=p.state>f0&&p.state<d0,p.state=Qp,p.timer.stop(),p.on.call(b?"interrupt":"cancel",n,n.__data__,p.index,p.group),delete h[v]}T&&delete n.__transition}}function i8(n){return this.each(function(){r8(this,n)})}function a8(n,o){var h,p;return function(){var b=uo(this,n),T=b.tween;if(T!==h){p=h=T;for(var v=0,l=p.length;v<l;++v)if(p[v].name===o){p=p.slice(),p.splice(v,1);break}}b.tween=p}}function o8(n,o,h){var p,b;if(typeof h!="function")throw new Error;return function(){var T=uo(this,n),v=T.tween;if(v!==p){b=(p=v).slice();for(var l={name:o,value:h},C=0,D=b.length;C<D;++C)if(b[C].name===o){b[C]=l;break}C===D&&b.push(l)}T.tween=b}}function s8(n,o){var h=this._id;if(n+="",arguments.length<2){for(var p=Ba(this.node(),h).tween,b=0,T=p.length,v;b<T;++b)if((v=p[b]).name===n)return v.value;return null}return this.each((o==null?a8:o8)(h,n,o))}function ov(n,o,h){var p=n._id;return n.each(function(){var b=uo(this,p);(b.value||(b.value={}))[o]=h.apply(this,arguments)}),function(b){return Ba(b,p).value[o]}}function eP(n,o){var h;return(typeof o=="number"?Ls:o instanceof jf?xw:(h=jf(o))?(o=h,xw):$F)(n,o)}function l8(n){return function(){this.removeAttribute(n)}}function c8(n){return function(){this.removeAttributeNS(n.space,n.local)}}function u8(n,o,h){var p,b=h+"",T;return function(){var v=this.getAttribute(n);return v===b?null:v===p?T:T=o(p=v,h)}}function h8(n,o,h){var p,b=h+"",T;return function(){var v=this.getAttributeNS(n.space,n.local);return v===b?null:v===p?T:T=o(p=v,h)}}function f8(n,o,h){var p,b,T;return function(){var v,l=h(this),C;return l==null?void this.removeAttribute(n):(v=this.getAttribute(n),C=l+"",v===C?null:v===p&&C===b?T:(b=C,T=o(p=v,l)))}}function d8(n,o,h){var p,b,T;return function(){var v,l=h(this),C;return l==null?void this.removeAttributeNS(n.space,n.local):(v=this.getAttributeNS(n.space,n.local),C=l+"",v===C?null:v===p&&C===b?T:(b=C,T=o(p=v,l)))}}function p8(n,o){var h=og(n),p=h==="transform"?XF:eP;return this.attrTween(n,typeof o=="function"?(h.local?d8:f8)(h,p,ov(this,"attr."+n,o)):o==null?(h.local?c8:l8)(h):(h.local?h8:u8)(h,p,o))}function m8(n,o){return function(h){this.setAttribute(n,o.call(this,h))}}function g8(n,o){return function(h){this.setAttributeNS(n.space,n.local,o.call(this,h))}}function _8(n,o){var h,p;function b(){var T=o.apply(this,arguments);return T!==p&&(h=(p=T)&&g8(n,T)),h}return b._value=o,b}function y8(n,o){var h,p;function b(){var T=o.apply(this,arguments);return T!==p&&(h=(p=T)&&m8(n,T)),h}return b._value=o,b}function v8(n,o){var h="attr."+n;if(arguments.length<2)return(h=this.tween(h))&&h._value;if(o==null)return this.tween(h,null);if(typeof o!="function")throw new Error;var p=og(n);return this.tween(h,(p.local?_8:y8)(p,o))}function x8(n,o){return function(){av(this,n).delay=+o.apply(this,arguments)}}function b8(n,o){return o=+o,function(){av(this,n).delay=o}}function w8(n){var o=this._id;return arguments.length?this.each((typeof n=="function"?x8:b8)(o,n)):Ba(this.node(),o).delay}function T8(n,o){return function(){uo(this,n).duration=+o.apply(this,arguments)}}function S8(n,o){return o=+o,function(){uo(this,n).duration=o}}function M8(n){var o=this._id;return arguments.length?this.each((typeof n=="function"?T8:S8)(o,n)):Ba(this.node(),o).duration}function P8(n,o){if(typeof o!="function")throw new Error;return function(){uo(this,n).ease=o}}function E8(n){var o=this._id;return arguments.length?this.each(P8(o,n)):Ba(this.node(),o).ease}function C8(n,o){return function(){var h=o.apply(this,arguments);if(typeof h!="function")throw new Error;uo(this,n).ease=h}}function I8(n){if(typeof n!="function")throw new Error;return this.each(C8(this._id,n))}function A8(n){typeof n!="function"&&(n=LM(n));for(var o=this._groups,h=o.length,p=new Array(h),b=0;b<h;++b)for(var T=o[b],v=T.length,l=p[b]=[],C,D=0;D<v;++D)(C=T[D])&&n.call(C,C.__data__,D,T)&&l.push(C);return new Jo(p,this._parents,this._name,this._id)}function k8(n){if(n._id!==this._id)throw new Error;for(var o=this._groups,h=n._groups,p=o.length,b=h.length,T=Math.min(p,b),v=new Array(p),l=0;l<T;++l)for(var C=o[l],D=h[l],z=C.length,B=v[l]=new Array(z),V,G=0;G<z;++G)(V=C[G]||D[G])&&(B[G]=V);for(;l<p;++l)v[l]=o[l];return new Jo(v,this._parents,this._name,this._id)}function D8(n){return(n+"").trim().split(/^|\s+/).every(function(o){var h=o.indexOf(".");return h>=0&&(o=o.slice(0,h)),!o||o==="start"})}function z8(n,o,h){var p,b,T=D8(o)?av:uo;return function(){var v=T(this,n),l=v.on;l!==p&&(b=(p=l).copy()).on(o,h),v.on=b}}function R8(n,o){var h=this._id;return arguments.length<2?Ba(this.node(),h).on.on(n):this.each(z8(h,n,o))}function L8(n){return function(){var o=this.parentNode;for(var h in this.__transition)if(+h!==n)return;o&&o.removeChild(this)}}function F8(){return this.on("end.remove",L8(this._id))}function B8(n){var o=this._name,h=this._id;typeof n!="function"&&(n=tv(n));for(var p=this._groups,b=p.length,T=new Array(b),v=0;v<b;++v)for(var l=p[v],C=l.length,D=T[v]=new Array(C),z,B,V=0;V<C;++V)(z=l[V])&&(B=n.call(z,z.__data__,V,l))&&("__data__"in z&&(B.__data__=z.__data__),D[V]=B,lg(D[V],o,h,V,D,Ba(z,h)));return new Jo(T,this._parents,o,h)}function O8(n){var o=this._name,h=this._id;typeof n!="function"&&(n=RM(n));for(var p=this._groups,b=p.length,T=[],v=[],l=0;l<b;++l)for(var C=p[l],D=C.length,z,B=0;B<D;++B)if(z=C[B]){for(var V=n.call(z,z.__data__,B,C),G,Q=Ba(z,h),ee=0,U=V.length;ee<U;++ee)(G=V[ee])&&lg(G,o,h,ee,V,Q);T.push(V),v.push(z)}return new Jo(T,v,o,h)}var N8=Kf.prototype.constructor;function V8(){return new N8(this._groups,this._parents)}function j8(n,o){var h,p,b;return function(){var T=Du(this,n),v=(this.style.removeProperty(n),Du(this,n));return T===v?null:T===h&&v===p?b:b=o(h=T,p=v)}}function tP(n){return function(){this.style.removeProperty(n)}}function U8(n,o,h){var p,b=h+"",T;return function(){var v=Du(this,n);return v===b?null:v===p?T:T=o(p=v,h)}}function q8(n,o,h){var p,b,T;return function(){var v=Du(this,n),l=h(this),C=l+"";return l==null&&(C=l=(this.style.removeProperty(n),Du(this,n))),v===C?null:v===p&&C===b?T:(b=C,T=o(p=v,l))}}function G8(n,o){var h,p,b,T="style."+o,v="end."+T,l;return function(){var C=uo(this,n),D=C.on,z=C.value[T]==null?l||(l=tP(o)):void 0;(D!==h||b!==z)&&(p=(h=D).copy()).on(v,b=z),C.on=p}}function $8(n,o,h){var p=(n+="")=="transform"?HF:eP;return o==null?this.styleTween(n,j8(n,p)).on("end.style."+n,tP(n)):typeof o=="function"?this.styleTween(n,q8(n,p,ov(this,"style."+n,o))).each(G8(this._id,n)):this.styleTween(n,U8(n,p,o),h).on("end.style."+n,null)}function Z8(n,o,h){return function(p){this.style.setProperty(n,o.call(this,p),h)}}function W8(n,o,h){var p,b;function T(){var v=o.apply(this,arguments);return v!==b&&(p=(b=v)&&Z8(n,v,h)),p}return T._value=o,T}function H8(n,o,h){var p="style."+(n+="");if(arguments.length<2)return(p=this.tween(p))&&p._value;if(o==null)return this.tween(p,null);if(typeof o!="function")throw new Error;return this.tween(p,W8(n,o,h??""))}function X8(n){return function(){this.textContent=n}}function Y8(n){return function(){var o=n(this);this.textContent=o??""}}function K8(n){return this.tween("text",typeof n=="function"?Y8(ov(this,"text",n)):X8(n==null?"":n+""))}function J8(n){return function(o){this.textContent=n.call(this,o)}}function Q8(n){var o,h;function p(){var b=n.apply(this,arguments);return b!==h&&(o=(h=b)&&J8(b)),o}return p._value=n,p}function eB(n){var o="text";if(arguments.length<1)return(o=this.tween(o))&&o._value;if(n==null)return this.tween(o,null);if(typeof n!="function")throw new Error;return this.tween(o,Q8(n))}function tB(){for(var n=this._name,o=this._id,h=nP(),p=this._groups,b=p.length,T=0;T<b;++T)for(var v=p[T],l=v.length,C,D=0;D<l;++D)if(C=v[D]){var z=Ba(C,o);lg(C,n,h,D,v,{time:z.time+z.delay+z.duration,delay:0,duration:z.duration,ease:z.ease})}return new Jo(p,this._parents,n,h)}function nB(){var n,o,h=this,p=h._id,b=h.size();return new Promise(function(T,v){var l={value:v},C={value:function(){--b===0&&T()}};h.each(function(){var D=uo(this,p),z=D.on;z!==n&&(o=(n=z).copy(),o._.cancel.push(l),o._.interrupt.push(l),o._.end.push(C)),D.on=o}),b===0&&T()})}var rB=0;function Jo(n,o,h,p){this._groups=n,this._parents=o,this._name=h,this._id=p}function nP(){return++rB}var jo=Kf.prototype;Jo.prototype={constructor:Jo,select:B8,selectAll:O8,selectChild:jo.selectChild,selectChildren:jo.selectChildren,filter:A8,merge:k8,selection:V8,transition:tB,call:jo.call,nodes:jo.nodes,node:jo.node,size:jo.size,empty:jo.empty,each:jo.each,on:R8,attr:p8,attrTween:v8,style:$8,styleTween:H8,text:K8,textTween:eB,remove:F8,tween:s8,delay:w8,duration:M8,ease:E8,easeVarying:I8,end:nB,[Symbol.iterator]:jo[Symbol.iterator]};function iB(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var aB={time:null,delay:0,duration:250,ease:iB};function oB(n,o){for(var h;!(h=n.__transition)||!(h=h[o]);)if(!(n=n.parentNode))throw new Error(`transition ${o} not found`);return h}function sB(n){var o,h;n instanceof Jo?(o=n._id,n=n._name):(o=nP(),(h=aB).time=iv(),n=n==null?null:n+"");for(var p=this._groups,b=p.length,T=0;T<b;++T)for(var v=p[T],l=v.length,C,D=0;D<l;++D)(C=v[D])&&lg(C,n,o,D,v,h||oB(C,o));return new Jo(p,this._parents,n,o)}Kf.prototype.interrupt=i8;Kf.prototype.transition=sB;var Pw={},py={},my=34,uf=10,gy=13;function rP(n){return new Function("d","return {"+n.map(function(o,h){return JSON.stringify(o)+": d["+h+'] || ""'}).join(",")+"}")}function lB(n,o){var h=rP(n);return function(p,b){return o(h(p),b,n)}}function Ew(n){var o=Object.create(null),h=[];return n.forEach(function(p){for(var b in p)b in o||h.push(o[b]=b)}),h}function ji(n,o){var h=n+"",p=h.length;return p<o?new Array(o-p+1).join(0)+h:h}function cB(n){return n<0?"-"+ji(-n,6):n>9999?"+"+ji(n,6):ji(n,4)}function uB(n){var o=n.getUTCHours(),h=n.getUTCMinutes(),p=n.getUTCSeconds(),b=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":cB(n.getUTCFullYear())+"-"+ji(n.getUTCMonth()+1,2)+"-"+ji(n.getUTCDate(),2)+(b?"T"+ji(o,2)+":"+ji(h,2)+":"+ji(p,2)+"."+ji(b,3)+"Z":p?"T"+ji(o,2)+":"+ji(h,2)+":"+ji(p,2)+"Z":h||o?"T"+ji(o,2)+":"+ji(h,2)+"Z":"")}function hB(n){var o=new RegExp('["'+n+`
\r]`),h=n.charCodeAt(0);function p(B,V){var G,Q,ee=b(B,function(U,se){if(G)return G(U,se-1);Q=U,G=V?lB(U,V):rP(U)});return ee.columns=Q||[],ee}function b(B,V){var G=[],Q=B.length,ee=0,U=0,se,Me=Q<=0,me=!1;B.charCodeAt(Q-1)===uf&&--Q,B.charCodeAt(Q-1)===gy&&--Q;function K(){if(Me)return py;if(me)return me=!1,Pw;var oe,ue=ee,de;if(B.charCodeAt(ue)===my){for(;ee++<Q&&B.charCodeAt(ee)!==my||B.charCodeAt(++ee)===my;);return(oe=ee)>=Q?Me=!0:(de=B.charCodeAt(ee++))===uf?me=!0:de===gy&&(me=!0,B.charCodeAt(ee)===uf&&++ee),B.slice(ue+1,oe-1).replace(/""/g,'"')}for(;ee<Q;){if((de=B.charCodeAt(oe=ee++))===uf)me=!0;else if(de===gy)me=!0,B.charCodeAt(ee)===uf&&++ee;else if(de!==h)continue;return B.slice(ue,oe)}return Me=!0,B.slice(ue,Q)}for(;(se=K())!==py;){for(var ce=[];se!==Pw&&se!==py;)ce.push(se),se=K();V&&(ce=V(ce,U++))==null||G.push(ce)}return G}function T(B,V){return B.map(function(G){return V.map(function(Q){return z(G[Q])}).join(n)})}function v(B,V){return V==null&&(V=Ew(B)),[V.map(z).join(n)].concat(T(B,V)).join(`
`)}function l(B,V){return V==null&&(V=Ew(B)),T(B,V).join(`
`)}function C(B){return B.map(D).join(`
`)}function D(B){return B.map(z).join(n)}function z(B){return B==null?"":B instanceof Date?uB(B):o.test(B+="")?'"'+B.replace(/"/g,'""')+'"':B}return{parse:p,parseRows:b,format:v,formatBody:l,formatRows:C,formatRow:D,formatValue:z}}var fB=hB(","),Cw=fB.parse;function Iw(n){for(var o in n){var h=n[o].trim(),p,b;if(!h)h=null;else if(h==="true")h=!0;else if(h==="false")h=!1;else if(h==="NaN")h=NaN;else if(!isNaN(p=+h))h=p;else if(b=h.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/))dB&&b[4]&&!b[7]&&(h=h.replace(/-/g,"/").replace(/T/," ")),h=new Date(h);else continue;n[o]=h}return n}const dB=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours();function xf(n,o,h){this.k=n,this.x=o,this.y=h}xf.prototype={constructor:xf,scale:function(n){return n===1?this:new xf(this.k*n,this.x,this.y)},translate:function(n,o){return n===0&o===0?this:new xf(this.k,this.x+this.k*n,this.y+this.k*o)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};xf.prototype;var pB=Wt('<p class="text-center text-lg">Loading data...</p>'),mB=Wt("<!> <!>",1),gB=Wt("<!> <!>",1),_B=Wt("<!> <!>",1),yB=Wt('<div class="h-[400px] flex items-center justify-center text-gray-500"><p>No visitor data available for this park</p></div>'),vB=Wt("<!> <!>",1),xB=Wt('<div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><!> <!></div>'),bB=Wt('<div class="min-h-screen bg-gray-50 p-8"><div class="container mx-auto max-w-7xl"><h1 class="text-4xl font-bold mb-8">National Parks Visit Data Dashboard</h1> <!></div></div>');function AB(n,o){dn(o,!0);let h=hn([]),p=hn([]),b=hn(null),T=hn(!0),v=le(()=>P(b)?P(p).filter(G=>G.UnitCode===P(b).Code):[]);kw(async()=>{try{const[G,Q]=await Promise.all([fetch("/data/clean_park.csv"),fetch("/data/clean_visit.csv")]),ee=await G.text();Vt(h,Cw(ee,Iw));const U=await Q.text();Vt(p,Cw(U,Iw)),console.log("Visit data columns:",Object.keys(P(p)[0]||{})),console.log("Visit data first row:",P(p)[0]);const se=P(h).find(Me=>Me.Code==="YOSE");Vt(b,se||P(h)[0],!0),Vt(T,!1)}catch(G){console.error("Error loading data:",G),Vt(T,!1)}});function l(G){Vt(b,G,!0)}var C=bB(),D=At(C),z=$t(At(D),2);{var B=G=>{uy(G,{children:(Q,ee)=>{hy(Q,{class:"p-12",children:(U,se)=>{var Me=pB();Ue(U,Me)},$$slots:{default:!0}})},$$slots:{default:!0}})},V=G=>{var Q=xB(),ee=At(Q);uy(ee,{children:(se,Me)=>{var me=gB(),K=kt(me);lw(K,{children:(oe,ue)=>{var de=mB(),be=kt(de);cw(be,{children:(Ve,qe)=>{R_();var Ye=gu("National Parks Map");Ue(Ve,Ye)},$$slots:{default:!0}});var Re=$t(be,2);sw(Re,{children:(Ve,qe)=>{R_();var Ye=gu();Zt(()=>$r(Ye,`${P(h).length??""} parks loaded  Click a marker to view visitor data`)),Ue(Ve,Ye)},$$slots:{default:!0}}),Ue(oe,de)},$$slots:{default:!0}});var ce=$t(K,2);hy(ce,{class:"p-0 h-[500px]",children:(oe,ue)=>{CA(oe,{get parks(){return P(h)},get selectedPark(){return P(b)},onParkClick:l})},$$slots:{default:!0}}),Ue(se,me)},$$slots:{default:!0}});var U=$t(ee,2);uy(U,{children:(se,Me)=>{var me=vB(),K=kt(me);lw(K,{children:(oe,ue)=>{var de=_B(),be=kt(de);cw(be,{children:(Ve,qe)=>{R_();var Ye=gu();Zt(()=>$r(Ye,P(b)?P(b).Name:"Select a Park")),Ue(Ve,Ye)},$$slots:{default:!0}});var Re=$t(be,2);sw(Re,{children:(Ve,qe)=>{var Ye=Yt(),et=kt(Ye);{var Ie=Qe=>{var $e=gu();Zt(()=>$r($e,`Visitor patterns  ${P(v).length??""} data points`)),Ue(Qe,$e)},Je=Qe=>{var $e=gu("Click a park marker to view visitor data");Ue(Qe,$e)};It(et,Qe=>{P(v).length>0?Qe(Ie):Qe(Je,!1)})}Ue(Ve,Ye)},$$slots:{default:!0}}),Ue(oe,de)},$$slots:{default:!0}});var ce=$t(K,2);hy(ce,{children:(oe,ue)=>{var de=Yt(),be=kt(de);{var Re=qe=>{VR(qe,{get data(){return P(v)}})},Ve=qe=>{var Ye=yB();Ue(qe,Ye)};It(be,qe=>{P(v).length>0?qe(Re):qe(Ve,!1)})}Ue(oe,de)},$$slots:{default:!0}}),Ue(se,me)},$$slots:{default:!0}}),Tt(Q),Ue(G,Q)};It(z,G=>{P(T)?G(B):G(V,!1)})}Tt(D),Tt(C),Ue(n,C),pn()}export{AB as component};
